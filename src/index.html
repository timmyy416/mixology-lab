<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>居家調酒實驗室 - Home Mixology Lab</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <!-- Firebase SDK (Module) -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
      import {
        getAuth,
        signInWithPopup,
        GoogleAuthProvider,
        signOut,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      // [注意] 請確認此處的設定與您的 Firebase Console > Project Settings 中的設定一致
      const firebaseConfig = {
        apiKey: "AIzaSyAsdPV7Em9xIyr-2HjpyG4nbrcE7GdDUpg",
        authDomain: "home-bartending-lab.firebaseapp.com",
        projectId: "home-bartending-lab",
        storageBucket: "home-bartending-lab.firebasestorage.app",
        messagingSenderId: "975937953200",
        appId: "1:975937953200:web:49784e2b4aebe103c00a75",
        measurementId: "G-GF5BVYL7CY",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth(app);
      auth.languageCode = "zh-TW";
      const db = getFirestore(app);
      const provider = new GoogleAuthProvider();
      provider.addScope("profile");
      provider.addScope("email");
      provider.setCustomParameters({ prompt: "select_account" });

      // [除錯用] 驗證 Firebase 與資料庫初始化狀態
      if (app && db) {
        console.log(
          "%c✅ Firebase 與 Firestore 資料庫已成功初始化",
          "color: #10b981; font-weight: bold; font-size: 14px;"
        );
        console.log("目前連結專案 ID:", firebaseConfig.projectId);
      } else {
        console.error("❌ Firebase 初始化失敗");
      }

      // Expose to Global for Alpine.js
      window.firebaseService = {
        login: async () => {
          if (window.location.protocol === "file:") {
            alert(
              "Google 登入功能無法在檔案模式 (file://) 下運作。\n請使用 Local Server (例如 VSCode Live Server) 開啟此網頁。"
            );
            return;
          }
          try {
            await signInWithPopup(auth, provider);
            console.log("Google 登入成功");
          } catch (error) {
            console.error("Login failed", error);
            let errorMessage = "登入失敗: " + error.message;

            // 針對常見錯誤提供更清楚的提示
            if (error.code === "auth/configuration-not-found") {
              errorMessage =
                "設定錯誤 (auth/configuration-not-found)：\n請確認 Firebase Console > Authentication > Sign-in method 中已啟用「Google」登入供應商。";
            } else if (error.code === "auth/popup-closed-by-user") {
              errorMessage = "登入已取消 (視窗被關閉)";
            } else if (error.code === "auth/unauthorized-domain") {
              errorMessage =
                "網域未授權 (auth/unauthorized-domain)：\n目前的網域尚未加入 Firebase 白名單。\n請前往 Firebase Console > Authentication > Settings > Authorized domains 新增此網域。";
            }
            alert(errorMessage);
          }
        },
        logout: async () => {
          await signOut(auth);
        },
        save: async (uid, data) => {
          try {
            await setDoc(
              doc(db, "users", uid),
              { content: data, updatedAt: new Date() },
              { merge: true }
            );
            alert("☁️ 雲端備份成功！");
          } catch (e) {
            console.error("Save failed", e);
            alert("備份失敗: " + e.message);
          }
        },
        load: async (uid) => {
          try {
            const docSnap = await getDoc(doc(db, "users", uid));
            return docSnap.exists() ? docSnap.data().content : null;
          } catch (e) {
            console.error("Load failed", e);
            alert("讀取失敗: " + e.message);
            return null;
          }
        },
        onAuth: (cb) => {
          return onAuthStateChanged(auth, (user) => {
            // 轉換為純物件，避免 Alpine.js Proxy 與 Firebase User 物件衝突導致 UI 無法更新
            if (user) {
              const { uid, displayName, email, photoURL } = user;
              cb({ uid, displayName, email, photoURL });
            } else {
              cb(null);
            }
          });
        },
      };

      // Notify Alpine that Firebase is ready
      window.dispatchEvent(new Event("firebase-ready"));
    </script>

    <style>
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fade-in {
        animation: fadeIn 0.4s ease-out forwards;
      }
      /* 統一全站卷軸樣式 */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 99px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
      [x-cloak] {
        display: none !important;
      }
      html {
        overflow-y: scroll;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>

    <script>
      // 在 Alpine 載入前先定義邏輯，確保初始化時能找到資料
      document.addEventListener("alpine:init", () => {
        Alpine.data("cocktailApp", () => ({
          activeTab: "home",
          isBottleFormOpen: false,
          isModifierFormOpen: false,
          isRecipeFormOpen: false,
          isRecipeModalOpen: false,
          isNoteModalOpen: false,
          selectedRecipe: null,
          darkMode: localStorage.getItem("theme") === "dark",
          isSidebarOpen: window.innerWidth >= 768,
          searchQuery: "",
          myIngredients: ["gin", "tonic", "juice_lime"],
          myBottles: [],
          shoppingList: [],
          editingBottleId: null,
          editingRecipeId: null,
          favoriteRecipes: [],
          filterBase: "all",
          filterDifficulty: "all",
          filterStyle: "all",
          filterBottleType: "all",
          sortBottleBy: "date_desc",
          // Firebase User State
          user: null,
          // 設定與偏好
          barName: "居家調酒實驗室",
          bartenderName: "Home Mixology Lab",
          unit: "ml",
          // 輪盤資料
          rouletteRotation: 0,
          isSpinning: false,
          rouletteResult: null,
          rouletteCandidates: [],
          menuSelectedRecipes: [],
          isMenuGenerated: false,
          currentScale: 1,
          batchMode: false,
          targetVolume: 2000,
          // AI Bartender
          geminiApiKey: localStorage.getItem('gemini_api_key') || '',
          isAiModalOpen: false,
          aiLoading: false,
          aiResult: null,

          // 表單資料
          bottleForm: {
            typeId: "gin",
            name: "",
            brand: "",
            price: "",
            location: "",
            purchaseDate: "",
            rating: 5,
            notes: "",
            tags: "",
            features: "",
            remaining: 100,
            volume: 750,
          },
          drinkingHistory: [],
          isJournalModalOpen: false,
          journalForm: { id: null, recipeId: null, recipeName: '', date: '', rating: 0, notes: '' },
          modifierForm: { categoryIndex: 0, name: "", desc: "", tag: "" },
          recipeForm: {
            name: "",
            category: "",
            abv: "",
            difficulty: 1,
            flavor: "",
            features: "",
            tags: "",
            ingredients: [],
            amounts: {},
            steps: "",
            tips: "",
            cost: null,
            profile: { sweet: 1, sour: 1, bitter: 1, boozy: 1, complex: 1 },
          },
          noteForm: { id: null, name: "", rating: 0, notes: "" },

          navigation: [
            { id: "home", label: "首頁", icon: "book-open" },
            { id: "ingredients", label: "調酒材料", icon: "flask-conical" },
            { id: "laboratory", label: "實驗室", icon: "beaker" },
            { id: "roulette", label: "喝什麼", icon: "dices" },
            { id: "journal", label: "飲酒日誌", icon: "history" },
            { id: "collection", label: "酒櫃", icon: "archive" },
            { id: "settings", label: "設定", icon: "settings" },
          ],

          shopItems: [
            { name: "高登琴酒 (Gordon's)", price: 380, icon: "wine" },
            { name: "舒味思通寧水 (2罐)", price: 50, icon: "beer" },
            { name: "新鮮檸檬 (1顆)", price: 15, icon: "citrus" },
            { name: "超商硬冰塊 (1包)", price: 25, icon: "zap" },
          ],

          spiritsData: [
            {
              id: "whiskey",
              name: "威士忌 (Whiskey / Whisky)",
              title: "第一卷：穀物與時間的藝術",
              intro:
                "威士忌是「穀物發酵」後經蒸餾，並在「橡木桶」中陳年的烈酒。其風味公式為：原料 (20%) + 蒸餾 (20%) + 桶陳 (60%)。",
              icon: "wine",
              color: "bg-amber-100 text-amber-800",
              sections: [
                {
                  title: "1. 核心原料與化學",
                  points: [
                    {
                      name: "大麥麥芽 (Malted Barley)",
                      desc: "提供酶（將澱粉轉化為糖）。產生餅乾、堅果、穀物香。",
                    },
                    {
                      name: "泥煤 (Peat)",
                      desc: "蘇格蘭特產。古代苔蘚植物碳化後的燃料。燃燒燻乾麥芽時，酚類物質 (Phenols) 附著在麥芽上，產生「消毒水、煙燻、培根」味。",
                    },
                    {
                      name: "玉米 (Corn)",
                      desc: "美國波本主力。產生甜味、奶油、油潤感。",
                    },
                    {
                      name: "裸麥 (Rye)",
                      desc: "產生辛辣、胡椒、乾燥香料味。",
                    },
                  ],
                },
                {
                  title: "2. 兩大主流體系",
                  subsections: [
                    {
                      title: "A. 蘇格蘭威士忌 (Scotch Whisky)",
                      intro: "必須在蘇格蘭蒸餾、陳年至少三年。",
                      points: [
                        {
                          name: "單一麥芽 (Single Malt)",
                          desc: "100% 大麥麥芽，單一酒廠生產，使用壺式蒸餾器 (Pot Still)（保留更多雜質與風味）。個性強烈。",
                        },
                        {
                          name: "調和威士忌 (Blended)",
                          desc: "麥芽威士忌 + 穀物威士忌。強調口感滑順與品質一致性（如 Johnnie Walker）。",
                        },
                      ],
                      notesTitle: "五大產區風格：",
                      notes: [
                        "<strong>Islay (艾雷島)</strong>： 重泥煤、海鹽、碘味 (Laphroaig, Ardbeg)。",
                        "<strong>Speyside (斯佩賽)</strong>： 花果香、優雅甜美 (Macallan, Glenfiddich)。",
                        "<strong>Highland (高地)</strong>： 風格多變，通常較厚實。",
                        "<strong>Lowland (低地)</strong>： 輕盈草本，多為三次蒸餾。",
                        "<strong>Campbeltown (坎貝爾鎮)</strong>： 油潤鹹味。",
                      ],
                    },
                    {
                      title: "B. 美國威士忌 (American Whiskey)",
                      points: [
                        {
                          name: "波本 (Bourbon)",
                          desc: "原料 51% 以上玉米，必須使用全新的烘烤橡木桶。風味充滿香草 (Vanillin)、焦糖、椰子味。",
                        },
                        {
                          name: "裸麥 (Rye)",
                          desc: "原料 51% 以上裸麥。口感銳利、不甜、辛辣。是許多經典調酒 (Manhattan) 的原始基酒。",
                        },
                      ],
                    },
                  ],
                },
              ],
            },
            {
              id: "gin",
              name: "琴酒 (Gin)",
              title: "第二卷：植物學家的香水",
              intro:
                "琴酒本質上是<strong>「加味伏特加」</strong>。它是唯一不依賴陳年，完全靠植物香料 (Botanicals) 決勝負的烈酒。",
              icon: "wine",
              color: "bg-green-100 text-green-800",
              sections: [
                {
                  title: "1. 核心定義",
                  content:
                    "基底為中性烈酒 (96% ABV)，必須加入杜松子 (Juniper Berries) 為主調，其他香料隨意。",
                },
                {
                  title: "2. 香氣萃取法 (The Science of Infusion)",
                  points: [
                    {
                      name: "浸泡法 (Steeping/Maceration)",
                      desc: "將香料泡在酒精裡煮。風味強烈、厚重。",
                    },
                    {
                      name: "蒸氣注入法 (Vapor Infusion / Carter Head Still)",
                      desc: "將香料放在蒸餾器頂端的「香料籃」，酒精蒸氣通過時帶走香氣。風味極其輕盈、優雅（如 Bombay Sapphire）。",
                    },
                  ],
                },
                {
                  title: "3. 四大風格分類",
                  points: [
                    {
                      name: "London Dry Gin (倫敦干型)",
                      desc: "全球標準。規定蒸餾後不得添加任何糖分或人工香料。杜松子味最重，風格銳利乾淨 (Beefeater, Tanqueray)。",
                    },
                    {
                      name: "Plymouth Gin (普利茅斯)",
                      desc: "產地保護。帶有泥土氣息，比倫敦型稍微甜潤一點。",
                    },
                    {
                      name: "Old Tom Gin (老湯姆)",
                      desc: "加了糖的琴酒。流行於 19 世紀，是做 Tom Collins 的正宗選擇。",
                    },
                    {
                      name: "New Western / Modern Gin (現代琴酒)",
                      desc: "叛逆者。降低杜松子比例，強調花香、柑橘或特殊原料（如小黃瓜、玫瑰）。(Hendrick's, Roku)。",
                    },
                  ],
                },
              ],
            },
            {
              id: "rum",
              name: "蘭姆酒 (Rum)",
              title: "第三卷：糖與熱帶的靈魂",
              intro:
                "蘭姆酒是甘蔗的產物。它的光譜極廣，從比水還乾淨的白蘭姆，到比醬油還濃的黑蘭姆都有。",
              icon: "wine",
              color: "bg-yellow-100 text-yellow-800",
              sections: [
                {
                  title: "1. 原料差異 (關鍵分水嶺)",
                  points: [
                    {
                      name: "工業蘭姆酒 (Industrial Rum)",
                      desc: "95% 的市場主流。使用製糖副產品<strong>「糖蜜 (Molasses)」</strong>發酵。帶有焦糖、太妃糖味。",
                    },
                    {
                      name: "農業蘭姆酒 (Rhum Agricole)",
                      desc: "法屬島嶼特產。使用<strong>「100% 新鮮甘蔗汁」</strong>發酵。帶有強烈的青草、橄欖、甚至類似汽油的野味。",
                    },
                  ],
                },
                {
                  title: "2. 酯類 (Esters) 與發酵",
                  intro: "蘭姆酒的靈魂在於酯類。",
                  points: [
                    {
                      name: "長時間發酵",
                      desc: '牙買加 (Jamaica) 的蘭姆酒會讓酵母工作很久，產生大量酯類，形成著名的 "Funk" (發酵水果、熟透香蕉味)。',
                    },
                    {
                      name: "短時間發酵",
                      desc: "古巴/波多黎各 (Spanish style) 追求快速乾淨，風味清淡。",
                    },
                  ],
                },
                {
                  title: "3. 顏色分類學",
                  points: [
                    {
                      name: "White (白)",
                      desc: "短暫陳年後經活性碳過濾。清爽，做 Mojito。",
                    },
                    { name: "Gold (金)", desc: "桶陳約 2-5 年。有些許桶味。" },
                    {
                      name: "Dark (黑)",
                      desc: "重度桶陳或加入焦糖調色。口感濃厚，做 Mai Tai。",
                    },
                    { name: "Spiced (香料)", desc: "加入香草、肉桂等香料。" },
                  ],
                },
              ],
            },
            {
              id: "tequila",
              name: "龍舌蘭 (Tequila)",
              title: "第四卷：沙漠與陽光的血液",
              intro:
                "最受法規嚴格保護的烈酒之一。所有的 Tequila 都是 Mezcal，但不是所有的 Mezcal 都是 Tequila。",
              icon: "zap",
              color: "bg-orange-100 text-orange-800",
              sections: [
                {
                  title: "1. 核心法規 (Appellation of Origin)",
                  points: [
                    {
                      name: "產地",
                      desc: "必須產自墨西哥五大特定州（核心是 Jalisco）。",
                    },
                    {
                      name: "原料",
                      desc: '必須含有 51% 以上的藍色韋伯龍舌蘭 (Blue Weber Agave)。優質產品會標示 "100% de Agave"（必選）。',
                    },
                  ],
                },
                {
                  title: "2. 關鍵製程：Tequila vs Mezcal",
                  intro: "這兩者的區別在於「如何煮熟龍舌蘭心 (Piña)」：",
                  points: [
                    {
                      name: "Tequila",
                      desc: "使用蒸氣（磚造烤爐或高壓釜）。風味是乾淨的草本、柑橘、胡椒味。",
                    },
                    {
                      name: "Mezcal",
                      desc: "使用土坑悶燒 (Earthen Pit)。木材燃燒的煙霧會滲入果心，產生強烈的煙燻、泥土、橡膠味。",
                    },
                  ],
                },
                {
                  title: "3. 陳年分級 (Aging Classifications)",
                  points: [
                    {
                      name: "Blanco / Silver (銀)",
                      desc: "0 - 2 個月。最能喝出龍舌蘭原本的草味與辛辣。",
                    },
                    {
                      name: "Reposado (微陳)",
                      desc: "2 個月 - 1 年。在橡木桶稍作停留，顏色淡金，口感變圓潤。最平衡。",
                    },
                    {
                      name: "Añejo (陳年)",
                      desc: "1 - 3 年。桶味重，像威士忌。",
                    },
                    {
                      name: "Extra Añejo",
                      desc: "3 年以上。極昂貴，像干邑白蘭地。",
                    },
                  ],
                },
              ],
            },
            {
              id: "vodka",
              name: "伏特加 (Vodka)",
              title: "第五卷：純淨的極致",
              intro:
                "伏特加在化學上追求的是乙醇的純淨度，在品飲上追求的是質地 (Texture)。",
              icon: "glass-water",
              color: "bg-blue-100 text-blue-800",
              sections: [
                {
                  title: "1. 蒸餾邏輯",
                  content:
                    "使用連續式蒸餾器 (Column Still) 蒸餾至 95% ABV 以上，去除所有風味雜質 (Congeners)，再加水稀釋。最後經過活性碳 (Charcoal) 或石英過濾，確保無色無味。",
                },
                {
                  title: "2. 原料對口感的影響 (唯一的變數)",
                  intro: "雖然沒味道，但不同原料會帶來不同的「口感重量」：",
                  points: [
                    {
                      name: "小麥 (Wheat)",
                      desc: "輕盈、清脆、帶有微弱的麵包甜香 (Absolut, Grey Goose)。",
                    },
                    {
                      name: "裸麥 (Rye)",
                      desc: "紮實、帶有微弱的辛辣感與堅果味 (Belvedere)。",
                    },
                    {
                      name: "馬鈴薯 (Potato)",
                      desc: "油潤、奶油感、口感最厚重 (Chopin)。",
                    },
                    { name: "玉米 (Corn)", desc: "甜味明顯 (Tito's)。" },
                  ],
                },
              ],
            },
            {
              id: "brandy",
              name: "白蘭地 (Brandy)",
              title: "第六卷：水果的靈魂濃縮",
              intro:
                "廣義來說，任何「水果發酵蒸餾酒」都叫白蘭地。但狹義的王者是干邑 (Cognac)。",
              icon: "wine",
              color: "bg-purple-100 text-purple-800",
              sections: [
                {
                  title: "1. 兩大核心與法規",
                  intro: "法國針對白蘭地有極嚴格的產區認證 (AOC)。",
                  subsections: [
                    {
                      title: "A. 干邑 (Cognac) — 貴族",
                      points: [
                        { name: "產地", desc: "法國干邑區。" },
                        {
                          name: "原料",
                          desc: "白葡萄 (Ugni Blanc 為主)。這種葡萄很酸，做成酒很難喝，但蒸餾後極佳。",
                        },
                        {
                          name: "製程",
                          desc: "必須使用夏朗德壺式蒸餾器 (Charentais Pot Still) 進行兩次蒸餾。",
                        },
                        { name: "風味", desc: "細緻、花香、杏桃、香草。" },
                      ],
                    },
                    {
                      title: "B. 雅馬邑 (Armagnac) — 騎士",
                      points: [
                        { name: "產地", desc: "法國雅馬邑區。" },
                        {
                          name: "製程",
                          desc: "使用小型連續式蒸餾器，一次蒸餾。",
                        },
                        {
                          name: "風味",
                          desc: "因為只蒸餾一次，保留更多雜質，口感比干邑更粗獷、強壯、帶有梅子與泥土味。",
                        },
                      ],
                    },
                  ],
                },
                {
                  title: "2. 陳年分級 (The Codes)",
                  intro: "這是判讀白蘭地價格的密碼：",
                  points: [
                    {
                      name: "V.S. (Very Special)",
                      desc: "最年輕的酒液陳年至少 2 年。",
                    },
                    {
                      name: "V.S.O.P. (Very Superior Old Pale)",
                      desc: "最年輕的酒液陳年至少 4 年。",
                    },
                    {
                      name: "X.O. (Extra Old)",
                      desc: "最年輕的酒液陳年至少 10 年（舊制為 6 年）。",
                    },
                  ],
                },
              ],
            },
          ],

          toolsData: [
            {
              category: "混合系統 (The Mixing System)",
              categoryDesc: "這是調酒師的引擎室，負責冷卻、混合與稀釋。",
              icon: "flask-round",
              groups: [
                {
                  groupName: "1. 雪克杯 (Shakers)",
                  items: [
                    {
                      name: "波士頓雪克杯 (Boston Shaker)",
                      points: {
                        構造: "由一個大的金屬杯 (Tin) 和一個小的金屬杯 (Mini Tin) 或玻璃杯組成。",
                        職業觀點:
                          "全球專業酒吧首選。金屬對金屬 (Tin on Tin) 的熱傳導最快，冷卻效率最高，且聲音清脆好聽。",
                        適用: "所有需要搖盪的調酒。",
                      },
                    },
                    {
                      name: "三段式雪克杯 (Cobbler Shaker)",
                      points: {
                        構造: "杯身、自帶濾網的中蓋、小頂蓋。",
                        職業觀點:
                          "適合日式調酒 (Hard Shake) 技法。因為造型圓潤，能搖出細緻的碎冰，但氣泡量不如波士頓杯豐富。",
                        缺點: "熱脹冷縮容易卡死。",
                      },
                    },
                    {
                      name: "巴黎式雪克杯 (Parisian / French Shaker)",
                      points: {
                        構造: "像葫蘆一樣的兩段式金屬杯（沒有濾網）。",
                        職業觀點:
                          "最美觀，結合了波士頓的容量與 Cobbler 的線條。但需要另外搭配濾網，使用較少見。",
                      },
                    },
                  ],
                },
                {
                  groupName: "2. 攪拌杯 (Mixing Glass)",
                  items: [
                    {
                      name: "亞萊杯 (Yarai Mixing Glass)",
                      points: {
                        特徵: "寬底、有導流嘴、杯身有鑽石切割紋路（防滑）。",
                        材質: "通常是厚玻璃或水晶。",
                        職業觀點:
                          "做 Martini 或 Old Fashioned 專用。厚壁能保持冷度，寬底讓冰塊旋轉順暢。",
                      },
                    },
                    {
                      name: "金屬攪拌杯 (Metal Mixing Tin)",
                      points: {
                        特徵: "不鏽鋼製。",
                        職業觀點: "降溫極快，不會打破，但無法欣賞液體的顏色。",
                      },
                    },
                  ],
                },
                {
                  groupName: "3. 吧叉匙 (Bar Spoon)",
                  items: [
                    {
                      name: "吧叉匙 (Bar Spoon)",
                      points: {
                        構造: "長螺旋柄，一端是湯匙（通常 5ml），另一端可能是叉子（叉水果）、圓餅（搗壓用）或水滴狀（配重）。",
                        長度: "通常為 30cm - 40cm，甚至 50cm（從杯底輕鬆攪拌）。",
                        螺旋紋:
                          "讓手指能順暢轉動，也讓液體能順流而下做分層 (Layering)。",
                      },
                    },
                  ],
                },
              ],
            },
            {
              category: "過濾與測量 (Filter & Measure)",
              categoryDesc: "精準度與口感的守門員。",
              icon: "ruler",
              groups: [
                {
                  groupName: "1. 濾冰器 (Strainers)",
                  items: [
                    {
                      name: "霍桑隔冰匙 (Hawthorne Strainer)",
                      points: {
                        特徵: "扁平金屬板帶有彈簧圈 (Spring)。",
                        用途: "搭配波士頓雪克杯。彈簧能伸縮適應杯口大小，並過濾掉大冰塊。",
                        技巧: "推動上面的「滑門 (Gate Control)」可以控制倒出的水流大小與是否讓碎冰通過。",
                      },
                    },
                    {
                      name: "茱莉普濾網 (Julep Strainer)",
                      points: {
                        特徵: "像一個大的多孔湯匙。",
                        用途: "搭配攪拌杯 (Mixing Glass)。優雅地卡在杯口，適合不含碎冰的攪拌型調酒。",
                      },
                    },
                    {
                      name: "雙層過濾網 (Fine Mesh Strainer / Tea Strainer)",
                      points: {
                        特徵: "錐形的細密濾網。",
                        用途: "Double Strain (雙重過濾)。放在霍桑隔冰匙下方，濾掉搖盪產生的細小碎冰 (Ice Chips) 和果肉渣，確保口感如絲綢般滑順。",
                      },
                    },
                  ],
                },
                {
                  groupName: "2. 量酒器 (Jigger)",
                  items: [
                    {
                      name: "日式量酒器 (Japanese Style)",
                      points: {
                        特徵: "高瘦型，線條優雅。",
                        優點: "杯口窄，倒酒時即使手抖也不容易灑出來，且刻度精細。",
                      },
                    },
                    {
                      name: "貝爾量酒器 (Bell Style)",
                      points: {
                        特徵: "像鈴鐺一樣圓潤，手感厚實。",
                        優點: "不易傾倒，且容易清洗。",
                      },
                    },
                    {
                      name: "多層次量酒器 (Multi-Level / Oxo)",
                      points: {
                        特徵: "像量杯一樣有階梯狀刻度。",
                        優點: "一個抵多個，適合家用。",
                      },
                    },
                  ],
                },
              ],
            },
            {
              category: "冰塊處理 (Ice Tools)",
              categoryDesc: "這是區分玩家與職人的領域。",
              icon: "ice-cream-2",
              groups: [
                {
                  groupName: "1. 修冰工具",
                  items: [
                    {
                      name: "冰鑿 (Ice Pick)",
                      points: {
                        "單叉 (1-point)": "像錐子，用於精細修整或鑿開大冰磚。",
                        "三叉 (3-point)":
                          "像爪子，用於將大冰塊快速分裂成直線。",
                      },
                    },
                    {
                      name: "冰刀 (Ice Knife / Saws)",
                      points: { 用途: "用於鋸開大塊透明冰磚。" },
                    },
                    {
                      name: "冰鏟 (Ice Scoop)",
                      points: {
                        絕對規則:
                          "永遠不要用玻璃杯去鏟冰！如果不小心破在冰槽裡，你得把整槽冰融掉清創。一定要用不鏽鋼或塑膠冰鏟。",
                      },
                    },
                  ],
                },
                {
                  groupName: "2. 碎冰工具",
                  items: [
                    {
                      name: "路易斯冰袋 (Lewis Bag)",
                      points: { 材質: "厚帆布袋。", 功能: "用來吸水。" },
                    },
                    {
                      name: "木槌 (Mallet)",
                      points: {
                        操作: "把冰塊放進帆布袋，用木槌用力敲打。袋子會吸走融水，給你乾燥的碎冰 (Dry Crushed Ice)，這比果汁機打出來的濕碎冰好用一百倍（做 Mojito 必備）。",
                      },
                    },
                  ],
                },
                {
                  groupName: "3. 冰夾 (Ice Tongs)",
                  items: [
                    {
                      name: "冰夾 (Ice Tongs)",
                      points: {
                        用途: "衛生第一，雖然手很乾淨，但客人不想看到你的指紋在冰塊上。",
                      },
                    },
                  ],
                },
              ],
            },
            {
              category: "蔬果與裝飾 (Prep & Garnish)",
              categoryDesc: "處理新鮮材料的利器。",
              icon: "citrus",
              groups: [
                {
                  groupName: "1. 榨汁與處理",
                  items: [
                    {
                      name: "手壓榨汁器 (Mexican Elbow / Hand Press)",
                      points: {
                        特徵: "有黃色(檸檬)與綠色(萊姆)兩種大小。",
                        優點: "翻過來壓，連皮油一起擠進去，香氣最足。",
                      },
                    },
                    {
                      name: "搗棒 (Muddler)",
                      points: {
                        材質: "木頭（傳統但易發霉）、不鏽鋼+塑膠頭（衛生好清洗）。",
                        "齒狀 vs 平面":
                          "齒狀適合壓水果（防滑）；平面適合壓香草（薄荷），因為齒狀容易把葉脈磨碎產生苦味。",
                      },
                    },
                  ],
                },
                {
                  groupName: "2. 刀工與裝飾",
                  items: [
                    {
                      name: "削皮刀 (Y-Peeler)",
                      points: {
                        用途: "快速削下厚薄一致的柑橘皮 (Twist)。一定要選刀鋒利的。",
                      },
                    },
                    {
                      name: "溝紋刀 (Channel Knife)",
                      points: { 用途: "能削出細細長長的螺旋條狀皮。" },
                    },
                    {
                      name: "吧檯刀 (Paring Knife)",
                      points: {
                        特徵: "小而鋒利的水果刀，用於切片、切角、修整果皮邊緣。",
                      },
                    },
                    {
                      name: "長鑷子 (Garnish Tweezers)",
                      points: {
                        用途: "外科手術級的精準度。用來放置微小的花朵、香草或調整冰塊上的裝飾位置。",
                      },
                    },
                  ],
                },
              ],
            },
            {
              category: "服務與周邊 (Service & Misc)",
              categoryDesc: "讓流程順暢的輔助工具。",
              icon: "concierge-bell",
              groups: [
                {
                  groupName: "1. 注酒器 (Pour Spouts)",
                  items: [
                    {
                      name: "金屬酒嘴 (Speed Pourer)",
                      points: {
                        功能: "裝在酒瓶口，提供穩定的流速（通常是「數秒法」計算容量的基礎）。",
                        結構: "有一個長的倒酒管和一個小的進氣孔。",
                        防塵蓋: "居家使用建議買有蓋子的，防果蠅。",
                      },
                    },
                  ],
                },
                {
                  groupName: "2. 開瓶器 (Openers)",
                  items: [
                    {
                      name: "酒侍刀 (Waiter's Friend / Wine Key)",
                      points: {
                        功能: "結合了螺旋鑽（紅酒）、刀片（割錫箔）和開瓶器（啤酒）。每個調酒師口袋都要有一把。",
                      },
                    },
                    {
                      name: "V-Rod 開瓶器",
                      points: {
                        功能: "一頭開啤酒，另一頭可以用來從酒瓶上拔下卡緊的注酒器。",
                      },
                    },
                  ],
                },
                {
                  groupName: "3. 鹽口盤 (Glass Rimmer)",
                  items: [
                    {
                      name: "鹽口盤 (Glass Rimmer)",
                      points: {
                        構造: "三層圓盤，分別裝檸檬汁、鹽、糖。",
                        用途: "快速製作 Margarita 的鹽口。",
                        備註: "專業調酒師通常不用這個，而是用檸檬片抹半圈杯口，再撒鹽，這樣更精緻且可控制量。",
                      },
                    },
                  ],
                },
              ],
            },
          ],

          glasswareData: {
            intro:
              "在專業調酒學（Mixology）中，杯具不僅僅是容器，它是<strong>「熱力學的控制器」、「香氣的擴大器」，以及「美學的展示台」</strong>。選錯杯子，會導致氣泡流失過快、溫度失控，甚至讓香氣無法正確傳遞。",
            functions: [
              {
                name: "溫度控制 (Temperature)",
                desc: "有腳 (Stem) 還是無腳？厚底還是薄壁？決定了手溫傳導的速度。",
              },
              {
                name: "香氣運作 (Aroma)",
                desc: "杯口是內縮 (聚香) 還是外擴 (散香)？決定了鼻腔接收風味的方式。",
              },
              {
                name: "氣泡保存 (Carbonation)",
                desc: "杯身是細長 (煙囪效應) 還是寬扁？決定了氣泡存活的時間。",
              },
            ],
            systems: [
              {
                name: "第一體系：高腳杯家族 (The Stemmed Family)",
                logic:
                  "核心邏輯： 隔離熱源。長腳設計是為了讓手掌遠離酒液，適用於濾掉冰塊的短飲 (Served Up)。",
                icon: "martini",
                glasses: [
                  {
                    name: "1. 馬丁尼杯 (Martini Glass / V-Shape)",
                    details: {
                      構造: "經典的圓錐體 V 字型，長腳。",
                      物理原理:
                        "極大化表面積： 寬闊的杯口讓酒液最大程度接觸空氣，使琴酒的杜松子或伏特加的氣息瞬間爆發。\n張力邊緣： 倒滿時液體表面張力極高，視覺張力強。",
                      缺點: "重心高易翻倒，且極易灑出（移動困難）。",
                      標準容量: "150ml - 200ml。",
                      適用: "Dry Martini, Cosmopolitan, Gibson。",
                    },
                  },
                  {
                    name: "2. 淺碟香檳杯 (Coupe Glass)",
                    details: {
                      構造: "寬口、淺底、圓弧狀的碗型 (Bowl)。",
                      歷史: "傳說是依照瑪麗安東尼皇后的胸型設計的（迷思），早期用於喝香檳，但因氣泡散失太快而被淘汰，轉而成為調酒杯主流。",
                      物理優勢:
                        "防灑： 杯緣通常微微內縮 (Tapered Rim)，比 V 型杯更穩。\n承載泡沫： 圓弧底部非常適合承托 Shake 後產生的綿密泡沫 (Foam) 或蛋白霜。",
                      適用: "Daiquiri, Gimlet, Clover Club, Sidecar。",
                    },
                  },
                  {
                    name: "3. 尼克與諾拉杯 (Nick & Nora Glass)",
                    details: {
                      構造: "介於 V 型和 Coupe 之間，像是一個小鈴鐺，杯壁較直。",
                      起源: "得名於 1934 年電影《The Thin Man》中的偵探夫妻檔。",
                      物理優勢:
                        "溫控王： 容量較小 (約 150-170ml)，表面積小，酒液回溫速度比 Coupe 慢，適合高濃度、需慢慢啜飲的攪拌型調酒。\n精準洗線 (Wash Line)： 倒酒後液面離杯口距離完美，視覺優雅。",
                      適用: "現代酒吧的 Stirred Drinks (如 Manhattan, Martinez)。",
                    },
                  },
                ],
              },
              {
                name: "第二體系：平底杯家族 (The Tumbler Family)",
                logic:
                  "核心邏輯： 容納冰塊與操作。厚底設計允許在杯中直接搗壓 (Muddle) 或構建 (Build)。",
                icon: "glass-water",
                glasses: [
                  {
                    name: "1. 古典杯 (Old Fashioned Glass / Rocks Glass)",
                    details: {
                      介紹: "這是酒吧最忙碌的杯子。",
                      "Double Rocks (雙份古典杯)":
                        "構造： 容量約 300-350ml，直身或微寬口。\n功能： 現代主流。專為放入一顆 2吋大冰球 或 大方冰 設計。大冰塊表面積小，融水極慢。",
                      "Single Rocks (單份古典杯)":
                        "構造： 容量約 180-240ml。\n功能： 用於純飲烈酒 (Neat) 或不加冰的 Sazerac。",
                      物理特徵:
                        "底部非常厚實 (Weighted Base)，除隔熱外，主要為了承受搗棒壓碎糖方或水果的力道。",
                    },
                  },
                  {
                    name: "2. 烈酒杯 (Shot Glass)",
                    details: {
                      構造: "小容量，厚底。",
                      容量: "Single Shot: 30ml (1 oz)\nDouble Shot: 60ml (2 oz)",
                      功能: "一口飲盡 (Shooter) 或作為測量工具（在沒有量酒器時）。",
                    },
                  },
                ],
              },
              {
                name: "第三體系：長飲杯家族 (The Highball Family)",
                logic:
                  "核心邏輯： 煙囪效應 (Chimney Effect)。專為含氣泡的長飲 (Long Drinks) 設計。",
                icon: "beer",
                glasses: [
                  {
                    name: "1. 海可波杯 (Highball Glass)",
                    details: {
                      構造: "標準直筒狀，高度中等。",
                      容量: "約 240-300ml。",
                      物理原理:
                        "1:3 或 1:4 的酒水比例。適合標準的 Gin Tonic 或 Whiskey Highball。",
                    },
                  },
                  {
                    name: "2. 可林杯 (Collins Glass)",
                    details: {
                      構造: "比 Highball 更高、更窄長。",
                      容量: "約 300-400ml。",
                      物理原理:
                        "更加極端的煙囪效應。氣泡從底部升到頂部的路徑變長，且液體與空氣接觸面積最小，氣泡保存力最強。",
                      適用: "Tom Collins, Mojito, Long Island Iced Tea。",
                    },
                  },
                  {
                    name: "3. 司令杯 (Sling Glass)",
                    details: {
                      構造: "帶有短腳，杯身向上微寬，流線型。",
                      適用: "Singapore Sling 或熱帶果汁類長飲。",
                    },
                  },
                ],
              },
              {
                name: "第四體系：特殊功能家族 (Specialty / Functional)",
                logic: "核心邏輯： 為特定化學反應或文化體驗而生。",
                icon: "flask-conical",
                glasses: [
                  {
                    name: "1. 銅杯 (Copper Mug)",
                    details: {
                      專屬: "Moscow Mule (莫斯科騾子)。",
                      物理原理:
                        "熱傳導 (Thermal Conductivity)。銅的導熱係數極高。當冰塊放入，杯壁會瞬間變得冰手，嘴唇接觸時會感到強烈的冰鎮刺激感，這是玻璃無法複製的體驗。",
                      注意: "現代銅杯內部通常鍍有鎳或不鏽鋼，防止銅中毒。",
                    },
                  },
                  {
                    name: "2. 茱莉普杯 (Julep Cup)",
                    details: {
                      專屬: "Mint Julep。",
                      構造: "銀製或錫製的梯形杯。",
                      物理原理:
                        "同樣利用金屬導熱。傳統上要把碎冰裝到滿出來，杯壁外側會結一層厚厚的白霜 (Beading)，視覺極其消暑。",
                    },
                  },
                  {
                    name: "3. 颶風杯 (Hurricane Glass)",
                    details: {
                      構造: "曲線瓶身，像古早的煤油燈罩。容量巨大 (400ml+)。",
                      適用: "Tiki (熱帶) 調酒。如 Pina Colada。",
                      功能: "巨大的容量是為了容納大量的碎冰、多種蘭姆酒與誇張的水果裝飾 (Garnish)。",
                    },
                  },
                  {
                    name: "4. 聞香杯 (Glencairn Glass / Snifter)",
                    details: {
                      "Glencairn (格蘭凱恩)":
                        "鬱金香形，寬肚縮口。\n功能： 寬肚讓威士忌揮發，縮口將香氣強制集中噴射進鼻腔。品酒 (Tasting) 專用。",
                      "Snifter (白蘭地球杯)":
                        "矮腳大肚杯。\n功能： 傳統用法是用掌心托住杯底，利用手溫溫熱白蘭地以釋放香氣（現代觀點認為這會過度揮發酒精，現在多改用鬱金香杯）。",
                    },
                  },
                  {
                    name: "5. 愛爾蘭咖啡杯 (Irish Coffee Glass)",
                    details: {
                      構造: "帶手把的耐熱玻璃杯 (Tempered Glass)。",
                      功能: "承受熱飲高溫，且透明杯身能展示「黑咖啡 + 白鮮奶油」的分層美學。",
                    },
                  },
                ],
              },
              {
                name: "第五體系：氣泡酒家族 (Sparkling Family)",
                logic: "核心邏輯： 雖然源自葡萄酒，但在調酒中不可或缺。",
                icon: "sparkles",
                glasses: [
                  {
                    name: "1. 香檳笛杯 (Champagne Flute)",
                    details: {
                      構造: "極細長。",
                      物理原理: "最小化接觸面積，讓氣泡能持續上升很久。",
                      適用: "Mimosa, Bellini, French 75。",
                    },
                  },
                  {
                    name: "2. 香檳碟杯 (Champagne Saucer)",
                    details: {
                      說明: "即上述的 Coupe。雖然現在不拿來喝香檳（氣泡跑太快），但它是著名的「香檳塔」專用杯。",
                    },
                  },
                ],
              },
            ],
          },

          modifiers: [
            {
              category: "氣泡與副材料 (Mixers)",
              iconType: "glass-water",
              items: [
                {
                  id: "tonic",
                  name: "通寧水",
                  desc: "帶有奎寧苦味，琴酒靈魂伴侶。",
                  tag: "氣泡",
                },
                { id: "soda", name: "蘇打水", desc: "無味清爽。", tag: "氣泡" },
                {
                  id: "coke",
                  name: "可樂",
                  desc: "蘭姆酒好拍檔。",
                  tag: "氣泡",
                },
                {
                  id: "ginger_beer",
                  name: "薑汁汽水",
                  desc: "辛辣氣泡感。",
                  tag: "氣泡",
                },
                {
                  id: "sprite",
                  name: "雪碧",
                  desc: "檸檬風味汽水。",
                  tag: "氣泡",
                },
                {
                  id: "ginger_ale",
                  name: "薑汁汽水 (Ale)",
                  desc: "溫和的薑味汽水。",
                  tag: "氣泡",
                },
                {
                  id: "soda_grapefruit",
                  name: "葡萄柚汽水",
                  desc: "帕洛瑪調酒靈魂。",
                  tag: "氣泡",
                },
                {
                  id: "coffee_espresso",
                  name: "濃縮咖啡",
                  desc: "咖啡馬丁尼基底。",
                  tag: "咖啡",
                },
                {
                  id: "coffee_hot",
                  name: "熱咖啡",
                  desc: "愛爾蘭咖啡用。",
                  tag: "咖啡",
                },
                {
                  id: "coconut_milk",
                  name: "椰奶",
                  desc: "濃郁熱帶風味。",
                  tag: "奶香",
                },
              ],
            },
            {
              category: "利口酒 & 加烈酒 (Liqueurs)",
              iconType: "wine",
              items: [
                {
                  id: "orange_liqueur",
                  name: "橙酒 (Cointreau)",
                  desc: "濃郁柑橘香氣，調酒必備。",
                  tag: "甜",
                },
                {
                  id: "campari",
                  name: "金巴利 (Campari)",
                  desc: "義大利藥草苦酒，開胃酒之王。",
                  tag: "苦",
                },
                {
                  id: "vermouth_dry",
                  name: "不甜香艾酒",
                  desc: "白葡萄酒基底，馬丁尼專用。",
                  tag: "草本",
                },
                {
                  id: "vermouth_sweet",
                  name: "甜香艾酒",
                  desc: "紅葡萄酒基底，色澤深紅。",
                  tag: "甜",
                },
                {
                  id: "kahlua",
                  name: "咖啡利口酒",
                  desc: "濃郁咖啡香與香草味。",
                  tag: "甜",
                },
                {
                  id: "baileys",
                  name: "貝禮詩奶酒",
                  desc: "愛爾蘭威士忌與鮮奶油。",
                  tag: "奶香",
                },
                {
                  id: "liqueur_cherry",
                  name: "櫻桃白蘭地",
                  desc: "帶有櫻桃果香。",
                  tag: "甜",
                },
                {
                  id: "liqueur_benedictine",
                  name: "班尼迪克汀",
                  desc: "藥草利口酒。",
                  tag: "藥草",
                },
                {
                  id: "liqueur_violet",
                  name: "紫羅蘭酒",
                  desc: "夢幻紫色花香。",
                  tag: "花香",
                },
                {
                  id: "liqueur_maraschino",
                  name: "黑櫻桃酒",
                  desc: "獨特果核香氣。",
                  tag: "甜",
                },
                {
                  id: "lillet_blanc",
                  name: "麗葉酒",
                  desc: "法國開胃酒。",
                  tag: "花果",
                },
                {
                  id: "absinthe",
                  name: "艾碧斯",
                  desc: "綠色精靈，茴香。",
                  tag: "藥草",
                },
                {
                  id: "liqueur_peach",
                  name: "水蜜桃酒",
                  desc: "香甜水蜜桃味。",
                  tag: "果香",
                },
                {
                  id: "rum_dark",
                  name: "深色蘭姆酒",
                  desc: "陳年風味，焦糖香。",
                  tag: "基酒",
                },
                {
                  id: "rum_151",
                  name: "151 蘭姆酒",
                  desc: "75.5% 高濃度烈酒。",
                  tag: "烈酒",
                },
                {
                  id: "liqueur_cassis",
                  name: "黑醋栗利口酒",
                  desc: "酸甜莓果味。",
                  tag: "果香",
                },
                {
                  id: "liqueur_cacao",
                  name: "可可酒",
                  desc: "巧克力風味。",
                  tag: "甜",
                },
                {
                  id: "pisco",
                  name: "皮斯可",
                  desc: "秘魯葡萄蒸餾酒。",
                  tag: "基酒",
                },
                {
                  id: "aperol",
                  name: "艾普羅",
                  desc: "義大利橘色開胃酒。",
                  tag: "苦甜",
                },
                {
                  id: "sparkling_wine",
                  name: "氣泡酒",
                  desc: "Prosecco 或香檳。",
                  tag: "氣泡",
                },
                {
                  id: "liqueur_mint",
                  name: "薄荷酒",
                  desc: "綠色清涼薄荷。",
                  tag: "香草",
                },
                {
                  id: "liqueur_amaretto",
                  name: "杏仁酒",
                  desc: "杏仁豆腐風味。",
                  tag: "甜",
                },
                {
                  id: "sloe_gin",
                  name: "黑刺李琴酒",
                  desc: "莓果風味琴酒。",
                  tag: "果香",
                },
                {
                  id: "liqueur_apricot",
                  name: "杏桃白蘭地",
                  desc: "杏桃果香。",
                  tag: "果香",
                },
                {
                  id: "liqueur_drambuie",
                  name: "蜂蜜威士忌酒",
                  desc: "蘇格蘭藥草蜂蜜酒。",
                  tag: "甜",
                },
                {
                  id: "whiskey_peat",
                  name: "泥煤威士忌",
                  desc: "強烈煙燻消毒水味。",
                  tag: "煙燻",
                },
              ],
            },
            {
              category: "酸甜與果汁 (Juices & Syrups)",
              iconType: "citrus",
              items: [
                {
                  id: "juice_lemon",
                  name: "黃檸檬汁",
                  desc: "溫和酸度，帶有清香。",
                  tag: "酸",
                },
                {
                  id: "juice_lime",
                  name: "綠萊姆汁",
                  desc: "尖銳酸度，熱帶調酒靈魂。",
                  tag: "酸",
                },
                {
                  id: "juice_orange",
                  name: "柳橙汁",
                  desc: "新鮮現榨為佳。",
                  tag: "果香",
                },
                {
                  id: "juice_cranberry",
                  name: "蔓越莓汁",
                  desc: "酸甜澀感，色澤鮮豔。",
                  tag: "果香",
                },
                {
                  id: "syrup_simple",
                  name: "糖漿 (Simple)",
                  desc: "1:1 砂糖水，平衡酸度。",
                  tag: "甜",
                },
                {
                  id: "grenadine",
                  name: "紅石榴糖漿",
                  desc: "鮮紅調色用，莓果風味。",
                  tag: "甜",
                },
                {
                  id: "honey",
                  name: "蜂蜜",
                  desc: "獨特花蜜香氣。",
                  tag: "甜",
                },
                {
                  id: "juice_pineapple",
                  name: "鳳梨汁",
                  desc: "熱帶水果之王。",
                  tag: "果香",
                },
                {
                  id: "juice_tomato",
                  name: "番茄汁",
                  desc: "血腥瑪麗必備。",
                  tag: "蔬果",
                },
                {
                  id: "syrup_almond",
                  name: "杏仁糖漿",
                  desc: "Tiki 調酒常用。",
                  tag: "甜",
                },
                {
                  id: "syrup_passion",
                  name: "百香果糖漿",
                  desc: "熱帶酸甜風味。",
                  tag: "酸甜",
                },
                {
                  id: "syrup_agave",
                  name: "龍舌蘭糖漿",
                  desc: "獨特植物甜味。",
                  tag: "甜",
                },
                {
                  id: "sugar",
                  name: "砂糖/方糖",
                  desc: "基礎甜味來源。",
                  tag: "甜",
                },
                {
                  id: "syrup_ginger",
                  name: "薑糖漿",
                  desc: "辛辣甜味。",
                  tag: "辛辣",
                },
                {
                  id: "juice_grapefruit",
                  name: "葡萄柚汁",
                  desc: "帶有苦味的柑橘果汁。",
                  tag: "果香",
                },
              ],
            },
            {
              category: "裝飾與苦精 (Garnish & Bitters)",
              iconType: "flower",
              items: [
                {
                  id: "bitters_angostura",
                  name: "安格氏苦精",
                  desc: "調酒的鹽巴，增加層次。",
                  tag: "苦",
                },
                {
                  id: "mint",
                  name: "薄荷葉",
                  desc: "拍打後釋放清涼香氣。",
                  tag: "香草",
                },
                {
                  id: "olive",
                  name: "橄欖",
                  desc: "馬丁尼標配，帶有鹹味。",
                  tag: "鹹",
                },
                {
                  id: "salt",
                  name: "鹽",
                  desc: "杯口鹽圈 (Rim) 使用。",
                  tag: "鹹",
                },
                {
                  id: "orange_peel",
                  name: "橙皮",
                  desc: "擠壓皮油增添香氣。",
                  tag: "香氣",
                },
                {
                  id: "sauce_worcestershire",
                  name: "伍斯特醬",
                  desc: "英式烏醋。",
                  tag: "鹹鮮",
                },
                {
                  id: "sauce_tabasco",
                  name: "辣椒醬",
                  desc: "增加辛辣感。",
                  tag: "辣",
                },
                {
                  id: "celery",
                  name: "芹菜",
                  desc: "裝飾與提味。",
                  tag: "蔬果",
                },
                {
                  id: "cream",
                  name: "鮮奶油",
                  desc: "增加綿密口感。",
                  tag: "奶香",
                },
                {
                  id: "egg_white",
                  name: "蛋白",
                  desc: "搖盪產生綿密泡沫。",
                  tag: "口感",
                },
                {
                  id: "nutmeg",
                  name: "肉豆蔻",
                  desc: "磨粉增添香氣。",
                  tag: "香料",
                },
                {
                  id: "cucumber",
                  name: "小黃瓜",
                  desc: "清爽瓜果香氣。",
                  tag: "蔬果",
                },
                {
                  id: "basil",
                  name: "羅勒",
                  desc: "獨特草本香氣。",
                  tag: "香草",
                },
              ],
            },
          ],

          categoryNames: {
            base: "基酒",
            liqueur: "利口酒",
            mixer: "副材料與調味",
            fresh: "新鮮蔬果",
            pantry: "調味",
          },

          recipes: [
            {
              id: 1,
              name: "Gin Tonic (琴通寧)",
              category: "Gin / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["經典", "氣泡", "清爽"],
              flavor: "清爽氣泡、微苦回甘",
              features: "琴酒與通寧水的完美結合，簡單卻考驗細節的經典調酒。",
              ingredients: [
                { id: "gin", amount: "45ml" },
                { id: "tonic", amount: "補滿 (約120ml)" },
                { id: "juice_lemon", amount: "1個" },
              ],
              steps: [
                "將高球杯裝滿冰塊。",
                "倒入琴酒。",
                "沿著杯壁緩緩倒入通寧水（保留氣泡）。",
                "輕輕提拉冰塊混合（勿過度攪拌）。",
                "擠入檸檬汁並將檸檬角放入杯中。",
              ],
              tips: "冰塊要裝滿杯子，通寧水要冰鎮。",
            },
            {
              id: 2,
              name: "Dry Martini (干馬丁尼)",
              category: "Gin / 攪拌法 (Stir)",
              abv: "高 (~30%)",
              difficulty: 3,
              tags: ["雞尾酒之王", "辛辣", "高酒精"],
              flavor: "辛辣、乾燥、草本香氣",
              features: "被譽為雞尾酒之王，展現琴酒與香艾酒的完美結合。",
              ingredients: [
                { id: "gin", amount: "60ml" },
                { id: "vermouth_dry", amount: "10ml" },
                { id: "olive", amount: "1顆" },
              ],
              steps: [
                "預先將馬丁尼杯冰鎮。",
                "在攪拌杯中加入冰塊。",
                "倒入琴酒與香艾酒。",
                "使用吧叉匙攪拌約 30-45 秒至充分冷卻。",
                "濾掉冰塊，倒入馬丁尼杯。",
                "放入橄欖裝飾。",
              ],
              tips: "攪拌(Stir)而非搖盪，保持酒體清澈如水。",
            },
            {
              id: 3,
              name: "Negroni (內格羅尼)",
              category: "Gin / 攪拌法 (Stir)",
              abv: "中高 (~24%)",
              difficulty: 2,
              tags: ["苦甜", "經典", "開胃"],
              flavor: "苦甜平衡、藥草香",
              features: "義大利經典開胃酒，苦甜風味令人著迷，藥草香氣濃郁。",
              ingredients: [
                { id: "gin", amount: "30ml" },
                { id: "campari", amount: "30ml" },
                { id: "vermouth_sweet", amount: "30ml" },
                { id: "orange_peel", amount: "1片" },
              ],
              steps: [
                "在岩石杯中放入一顆大冰塊。",
                "依序倒入琴酒、金巴利與甜香艾酒。",
                "攪拌約 20 秒使其混合冷卻。",
                "擠壓橙皮釋放精油，並放入杯中裝飾。",
              ],
              tips: "經典 1:1:1 比例，加冰攪拌冷卻即可。",
            },
            {
              id: 4,
              name: "Gimlet (琴蕾)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["酸甜", "經典", "短飲"],
              flavor: "酸甜銳利、清新",
              features: "雷蒙德·錢德勒筆下的經典，酸甜銳利，清新爽口。",
              ingredients: [
                { id: "gin", amount: "60ml" },
                { id: "juice_lime", amount: "22.5ml" },
                { id: "syrup_simple", amount: "22.5ml" },
              ],
              steps: [
                "將材料倒入雪克杯。",
                "加入冰塊用力搖盪（Shake）。",
                "濾入冰鎮過的淺碟香檳杯。",
              ],
              tips: "使用新鮮萊姆汁風味最佳。",
            },
            {
              id: 5,
              name: "White Lady (白色佳人)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中高 (~22%)",
              difficulty: 2,
              tags: ["三合一", "經典", "短飲"],
              flavor: "柑橘香、酸甜、優雅",
              features: "優雅的白色雞尾酒，帶有細緻的柑橘香氣與酸甜口感。",
              ingredients: [
                { id: "gin", amount: "40ml" },
                { id: "orange_liqueur", amount: "30ml" },
                { id: "juice_lemon", amount: "20ml" },
              ],
              steps: [
                "將所有材料倒入雪克杯。",
                "加入冰塊搖盪均勻。",
                "濾入冰鎮過的雞尾酒杯。",
              ],
              tips: "搖盪要充分，使酒體產生綿密口感。",
            },
            {
              id: 6,
              name: "Singapore Sling (新加坡司令)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中 (~15%)",
              difficulty: 3,
              tags: ["長飲", "熱帶", "複雜"],
              flavor: "熱帶水果、甜美、層次豐富",
              features: "源自新加坡萊佛士酒店，充滿熱帶風情的華麗調酒。",
              ingredients: [
                { id: "gin", amount: "30ml" },
                { id: "liqueur_cherry", amount: "15ml" },
                { id: "liqueur_benedictine", amount: "7.5ml" },
                { id: "orange_liqueur", amount: "7.5ml" },
                { id: "juice_pineapple", amount: "120ml" },
                { id: "juice_lime", amount: "15ml" },
                { id: "grenadine", amount: "10ml" },
                { id: "bitters_angostura", amount: "1滴" },
              ],
              steps: [
                "將所有材料倒入雪克杯。",
                "加入冰塊用力搖盪。",
                "過濾倒入裝滿冰塊的高球杯。",
                "以鳳梨片與櫻桃裝飾。",
              ],
              tips: "材料繁多，比例需精準控制。",
            },
            {
              id: 7,
              name: "Tom Collins (湯姆柯林斯)",
              category: "Gin / 直調法 (Build)",
              abv: "低 (~12%)",
              difficulty: 1,
              tags: ["長飲", "夏日", "解渴"],
              flavor: "檸檬汽水感、清爽",
              features: "經典的琴酒檸檬蘇打，夏日解渴首選。",
              ingredients: [
                { id: "gin", amount: "45ml" },
                { id: "juice_lemon", amount: "30ml" },
                { id: "syrup_simple", amount: "15ml" },
                { id: "soda", amount: "補滿" },
              ],
              steps: [
                "在高球杯中加入琴酒、檸檬汁與糖漿攪拌。",
                "加入冰塊。",
                "補滿蘇打水並輕輕提拉。",
                "放入檸檬片裝飾。",
              ],
              tips: "使用新鮮檸檬汁口感更佳。",
            },
            {
              id: 8,
              name: "Bee's Knees (蜜蜂之膝)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 2,
              tags: ["禁酒令時期", "酸甜", "復古"],
              flavor: "蜂蜜香、酸甜、圓潤",
              features: "禁酒令時期的經典，蜂蜜的甜潤中和了琴酒的銳利。",
              ingredients: [
                { id: "gin", amount: "60ml" },
                { id: "juice_lemon", amount: "22.5ml" },
                { id: "honey", amount: "22.5ml" },
              ],
              steps: [
                "將琴酒、檸檬汁與蜂蜜糖漿倒入雪克杯。",
                "加冰搖盪至冷卻。",
                "濾入冰鎮過的雞尾酒杯。",
              ],
              tips: "蜂蜜糖漿可用蜂蜜與水 1:1 調製以便溶解。",
            },
            {
              id: 9,
              name: "Aviation (飛行)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 3,
              tags: ["花香", "經典", "視覺系"],
              flavor: "花香、夢幻藍紫色",
              features: "帶有夢幻紫羅蘭花香的經典調酒，色澤如天空般迷人。",
              ingredients: [
                { id: "gin", amount: "45ml" },
                { id: "liqueur_violet", amount: "5ml" },
                { id: "liqueur_maraschino", amount: "15ml" },
                { id: "juice_lemon", amount: "15ml" },
              ],
              steps: [
                "將所有材料倒入雪克杯。",
                "加冰搖盪。",
                "雙重過濾倒入馬丁尼杯。",
                "沉入一顆酒漬櫻桃。",
              ],
              tips: "紫羅蘭酒用量需謹慎，以免蓋過其他風味。",
            },
            {
              id: 10,
              name: "Corpse Reviver #2 (亡者復甦二號)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中高 (~22%)",
              difficulty: 3,
              tags: ["醒酒酒", "經典", "層次豐富"],
              flavor: "柑橘、藥草、茴香尾韻",
              features: "著名的醒酒酒，層次豐富，帶有淡淡的艾碧斯香氣。",
              ingredients: [
                { id: "gin", amount: "22.5ml" },
                { id: "orange_liqueur", amount: "22.5ml" },
                { id: "lillet_blanc", amount: "22.5ml" },
                { id: "juice_lemon", amount: "22.5ml" },
                { id: "absinthe", amount: "1滴" },
              ],
              steps: [
                "在冰鎮的杯中倒入艾碧斯刷杯後倒掉。",
                "將其他材料加入雪克杯搖盪。",
                "濾入杯中。",
              ],
              tips: "艾碧斯刷杯能提供香氣而不搶味。",
            },
            {
              id: 11,
              name: "Moscow Mule (莫斯科騾子)",
              category: "Vodka / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["銅杯", "長飲", "派對"],
              flavor: "薑味辛辣、清爽",
              features: "使用銅杯盛裝的經典調酒，薑汁汽水帶來清爽辛辣感。",
              ingredients: [
                { id: "vodka", amount: "45ml" },
                { id: "ginger_beer", amount: "補滿 (約120ml)" },
                { id: "juice_lemon", amount: "10ml" },
              ],
              steps: [
                "銅馬克杯裝滿冰塊。",
                "倒入伏特加與檸檬汁。",
                "補滿薑汁汽水。",
                "輕輕攪拌，放上薄荷葉裝飾。",
              ],
              tips: "銅杯能保持冰涼口感。",
            },
            {
              id: 12,
              name: "Cosmopolitan (柯夢波丹)",
              category: "Vodka / 搖盪法 (Shake)",
              abv: "中 (~18%)",
              difficulty: 2,
              tags: ["都會", "女性喜愛", "短飲"],
              flavor: "莓果酸甜、粉紅時尚",
              features: "慾望城市女主角的最愛，時尚與性感的象徵。",
              ingredients: [
                { id: "vodka", amount: "40ml" },
                { id: "orange_liqueur", amount: "15ml" },
                { id: "juice_cranberry", amount: "30ml" },
                { id: "juice_lemon", amount: "15ml" },
              ],
              steps: [
                "將液體材料加入雪克杯。",
                "加冰搖盪。",
                "濾入馬丁尼杯。",
                "噴附橙皮油。",
              ],
              tips: "搖盪後濾掉冰塊，呈現粉紅色澤。",
            },
            {
              id: 13,
              name: "Bloody Mary (血腥瑪麗)",
              category: "Vodka / 滾動法 (Roll)",
              abv: "低 (~10%)",
              difficulty: 2,
              tags: ["解宿醉", "早午餐", "鹹味"],
              flavor: "鹹鮮、辛辣、蔬菜味",
              features: "著名的解宿醉酒，口感豐富如冷湯。",
              ingredients: [
                { id: "vodka", amount: "45ml" },
                { id: "juice_tomato", amount: "90ml" },
                { id: "juice_lemon", amount: "15ml" },
                { id: "sauce_worcestershire", amount: "適量" },
                { id: "sauce_tabasco", amount: "適量" },
                { id: "celery", amount: "1根" },
              ],
              steps: [
                "雪克杯加冰與所有材料。",
                "使用滾動法（Rolling）混和避免番茄汁過度起泡。",
                "倒入裝滿冰的高球杯。",
                "插入芹菜棒。",
              ],
              tips: "可依個人口味調整辣度與鹹度。",
            },
            {
              id: 14,
              name: "Espresso Martini (咖啡馬丁尼)",
              category: "Vodka / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 3,
              tags: ["餐後酒", "提神", "甜點系"],
              flavor: "濃郁咖啡、綿密泡沫",
              features: "結合咖啡與酒精的現代經典，泡沫綿密。",
              ingredients: [
                { id: "vodka", amount: "40ml" },
                { id: "kahlua", amount: "20ml" },
                { id: "coffee_espresso", amount: "30ml" },
                { id: "syrup_simple", amount: "5-10ml" },
              ],
              steps: [
                "將液體材料加入雪克杯。",
                "加入大量冰塊用力搖盪（Hard Shake）。",
                "濾入馬丁尼杯。",
                "放上三顆咖啡豆裝飾。",
              ],
              tips: "必須趁熱縮咖啡新鮮時搖盪，泡沫才豐富。",
            },
            {
              id: 15,
              name: "Screwdriver (螺絲起子)",
              category: "Vodka / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["派對", "超簡單", "長飲"],
              flavor: "果汁感、簡單",
              features: "最簡單的伏特加調酒，據說是用螺絲起子攪拌而得名。",
              ingredients: [
                { id: "vodka", amount: "45ml" },
                { id: "juice_orange", amount: "補滿" },
              ],
              steps: [
                "高球杯裝滿冰塊。",
                "倒入伏特加。",
                "補滿柳橙汁。",
                "攪拌均勻。",
              ],
              tips: "使用新鮮柳橙汁風味最佳。",
            },
            {
              id: 16,
              name: "White Russian (白色俄羅斯)",
              category: "Vodka / 直調法 (Build)",
              abv: "中 (~18%)",
              difficulty: 1,
              tags: ["甜點系", "餐後", "奶香"],
              flavor: "咖啡牛奶、滑順、甜美",
              features: "如甜點般的調酒，滑順的鮮奶油與咖啡酒完美融合。",
              ingredients: [
                { id: "vodka", amount: "40ml" },
                { id: "kahlua", amount: "20ml" },
                { id: "cream", amount: "30ml" },
              ],
              steps: [
                "在古典杯中加入冰塊。",
                "倒入伏特加與咖啡酒攪拌。",
                "將鮮奶油緩緩倒在表面使其漂浮。",
              ],
              tips: "鮮奶油可稍微打發，層次更分明。",
            },
            {
              id: 17,
              name: "Black Russian (黑色俄羅斯)",
              category: "Vodka / 攪拌法 (Stir)",
              abv: "高 (~30%)",
              difficulty: 1,
              tags: ["重口味", "經典", "簡單"],
              flavor: "咖啡苦甜、酒精感重",
              features: "白色俄羅斯的前身，風味更為濃烈直接。",
              ingredients: [
                { id: "vodka", amount: "50ml" },
                { id: "kahlua", amount: "20ml" },
              ],
              steps: [
                "在古典杯中加入冰塊。",
                "倒入伏特加與咖啡酒。",
                "輕輕攪拌冷卻。",
              ],
              tips: "適合喜愛重口味的飲用者。",
            },
            {
              id: 18,
              name: "Kamikaze (神風特攻隊)",
              category: "Vodka / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["Shot", "酸味", "派對"],
              flavor: "酸度強烈、清爽醒腦",
              features: "酸度強烈，常以 Shot 的形式飲用。",
              ingredients: [
                { id: "vodka", amount: "30ml" },
                { id: "orange_liqueur", amount: "30ml" },
                { id: "juice_lemon", amount: "30ml" },
              ],
              steps: [
                "將材料倒入雪克杯。",
                "加冰搖盪。",
                "濾入一口杯(Shot)或雞尾酒杯。",
              ],
              tips: "比例 1:1:1，簡單易記。",
            },
            {
              id: 19,
              name: "Sex on the Beach (性慾海灘)",
              category: "Vodka / 直調法 (Build)",
              abv: "低 (~12%)",
              difficulty: 1,
              tags: ["長飲", "派對", "妹酒"],
              flavor: "熱帶水果、甜美",
              features: "名字大膽，風味卻是甜美的熱帶水果風情。",
              ingredients: [
                { id: "vodka", amount: "40ml" },
                { id: "liqueur_peach", amount: "20ml" },
                { id: "juice_orange", amount: "40ml" },
                { id: "juice_cranberry", amount: "40ml" },
              ],
              steps: [
                "高球杯裝滿冰塊。",
                "依序倒入所有材料。",
                "攪拌均勻，以柳橙片裝飾。",
              ],
              tips: "分層倒入可製造視覺效果。",
            },
            {
              id: 20,
              name: "Vesper (維斯佩爾)",
              category: "Vodka/Gin / 搖盪法 (Shake)",
              abv: "高 (~35%)",
              difficulty: 2,
              tags: ["007", "電影", "重酒感"],
              flavor: "強烈、草本、007最愛",
              features: "007 龐德的原創酒譜，結合琴酒與伏特加的烈性。",
              ingredients: [
                { id: "gin", amount: "45ml" },
                { id: "vodka", amount: "15ml" },
                { id: "lillet_blanc", amount: "7.5ml" },
              ],
              steps: [
                "將酒類加入雪克杯。",
                "加冰用力搖盪。",
                "濾入馬丁尼杯。",
                "削檸檬皮裝飾。",
              ],
              tips: "Shaken, not stirred.",
            },
            {
              id: 21,
              name: "Mojito (莫希托)",
              category: "Rum / 直調+搗碎 (Muddle)",
              abv: "低 (~10%)",
              difficulty: 2,
              tags: ["夏日", "人氣", "長飲"],
              flavor: "薄荷清涼、酸甜",
              features: "古巴國民調酒，夏日消暑首選。",
              ingredients: [
                { id: "rum", amount: "45ml" },
                { id: "mint", amount: "8-10片" },
                { id: "sugar", amount: "2茶匙" },
                { id: "juice_lime", amount: "2個(萊姆角)" },
                { id: "soda", amount: "補滿" },
              ],
              steps: [
                "杯中放入薄荷、糖與萊姆角輕輕搗壓。",
                "加入碎冰與蘭姆酒攪拌。",
                "補滿蘇打水與碎冰。",
              ],
              tips: "輕壓薄荷葉即可，不要搗碎以免產生苦味。",
            },
            {
              id: 22,
              name: "Daiquiri (戴基里)",
              category: "Rum / 搖盪法 (Shake)",
              abv: "中高 (~22%)",
              difficulty: 2,
              tags: ["三合一", "經典", "海明威"],
              flavor: "酸甜平衡、清爽",
              features: "海明威的最愛，考驗調酒師功力的經典酸酒。",
              ingredients: [
                { id: "rum", amount: "60ml" },
                { id: "juice_lime", amount: "20ml" },
                { id: "syrup_simple", amount: "20ml" },
              ],
              steps: [
                "將材料加入雪克杯。",
                "加冰搖盪。",
                "濾入冰鎮過的淺碟香檳杯。",
              ],
              tips: "搖盪要猛烈，產生細緻碎冰口感。",
            },
            {
              id: 23,
              name: "Cuba Libre (自由古巴)",
              category: "Rum / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["簡單", "派對", "長飲"],
              flavor: "可樂甜、微酸",
              features: "慶祝古巴獨立的酒款，簡單卻經典。",
              ingredients: [
                { id: "rum", amount: "50ml" },
                { id: "coke", amount: "120ml" },
                { id: "juice_lime", amount: "10ml" },
              ],
              steps: [
                "高球杯裝滿冰塊。",
                "擠入萊姆汁，倒入蘭姆酒。",
                "補滿可樂。",
                "放入萊姆角。",
              ],
              tips: "加入萊姆汁是與 Rum Coke 的區別。",
            },
            {
              id: 24,
              name: "Mai Tai (邁泰)",
              category: "Rum / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 3,
              tags: ["Tiki", "熱帶", "度假"],
              flavor: "熱帶水果、堅果香、豐富",
              features: "Tiki 調酒的代表作，層次豐富的熱帶風味。",
              ingredients: [
                { id: "rum", amount: "30ml" },
                { id: "rum_dark", amount: "30ml" },
                { id: "orange_liqueur", amount: "15ml" },
                { id: "syrup_almond", amount: "10ml" },
                { id: "juice_lime", amount: "30ml" },
              ],
              steps: [
                "除深色蘭姆酒外，其他材料加冰搖盪。",
                "倒入裝滿碎冰的杯中。",
                "漂浮深色蘭姆酒。",
                "裝飾薄荷葉。",
              ],
              tips: "使用高品質的杏仁糖漿是關鍵。",
            },
            {
              id: 25,
              name: "Piña Colada (鳳梨可樂達)",
              category: "Rum / 混合法 (Blend)",
              abv: "低 (~12%)",
              difficulty: 2,
              tags: ["Tiki", "冰沙", "甜美"],
              flavor: "椰香、鳳梨、奶昔感",
              features: "波多黎各國酒，濃郁的椰奶與鳳梨香氣。",
              ingredients: [
                { id: "rum", amount: "30ml" },
                { id: "coconut_milk", amount: "30ml" },
                { id: "juice_pineapple", amount: "90ml" },
              ],
              steps: [
                "將材料與冰塊放入果汁機打成冰沙。",
                "倒入颶風杯。",
                "裝飾鳳梨片。",
              ],
              tips: "若無果汁機，可使用搖盪法代替。",
            },
            {
              id: 26,
              name: "Dark 'n' Stormy (月黑風高)",
              category: "Rum / 直調法 (Build)",
              abv: "低 (~12%)",
              difficulty: 1,
              tags: ["長飲", "辛辣", "經典"],
              flavor: "薑辣、焦糖、氣泡",
              features: "深色蘭姆酒漂浮在薑汁啤酒上，如暴風雨前的烏雲。",
              ingredients: [
                { id: "rum_dark", amount: "60ml" },
                { id: "ginger_beer", amount: "100ml" },
                { id: "juice_lime", amount: "10ml" },
              ],
              steps: [
                "高球杯裝滿冰塊。",
                "倒入薑汁啤酒與萊姆汁。",
                "將深色蘭姆酒緩緩倒在頂層。",
                "攪拌後飲用。",
              ],
              tips: "分層效果是視覺重點。",
            },
            {
              id: 27,
              name: "Zombie (殭屍)",
              category: "Rum / 搖盪法 (Shake)",
              abv: "高 (~30%)",
              difficulty: 4,
              tags: ["Tiki", "斷片酒", "高濃度"],
              flavor: "極度濃烈、果香掩蓋酒味",
              features: "Tiki 文化的傳奇，高酒精濃度卻順口易飲。",
              ingredients: [
                { id: "rum", amount: "30ml" },
                { id: "rum_dark", amount: "30ml" },
                { id: "rum_151", amount: "30ml" },
                { id: "juice_pineapple", amount: "30ml" },
                { id: "juice_lime", amount: "30ml" },
                { id: "syrup_passion", amount: "15ml" },
                { id: "bitters_angostura", amount: "1滴" },
              ],
              steps: [
                "除151外所有材料加冰搖盪。",
                "倒入碎冰杯。",
                "漂浮151蘭姆酒，可點火。",
              ],
              tips: "每人限點兩杯的強力調酒。",
            },
            {
              id: 28,
              name: "Jungle Bird (叢林鳥)",
              category: "Rum / 搖盪法 (Shake)",
              abv: "中 (~18%)",
              difficulty: 3,
              tags: ["Tiki", "苦味", "層次"],
              flavor: "苦甜交織、鳳梨香",
              features: "少數使用金巴利的 Tiki 調酒，苦甜風味獨特。",
              ingredients: [
                { id: "rum_dark", amount: "45ml" },
                { id: "campari", amount: "20ml" },
                { id: "juice_pineapple", amount: "45ml" },
                { id: "juice_lime", amount: "15ml" },
                { id: "syrup_simple", amount: "15ml" },
              ],
              steps: [
                "將所有材料加入雪克杯。",
                "加冰搖盪。",
                "濾入裝有大冰塊的古典杯。",
              ],
              tips: "鳳梨汁產生的泡沫能增加口感。",
            },
            {
              id: 29,
              name: "Canchanchara (坎昌查拉)",
              category: "Rum / 攪拌法 (Stir)",
              abv: "中 (~18%)",
              difficulty: 2,
              tags: ["古巴最古老", "簡單", "順口"],
              flavor: "蜂蜜甜潤、原始風味",
              features: "古巴最古老的調酒之一，使用蜂蜜帶來獨特風味。",
              ingredients: [
                { id: "rum", amount: "60ml" },
                { id: "honey", amount: "20ml" },
                { id: "juice_lime", amount: "20ml" },
              ],
              steps: [
                "混合蜂蜜水與萊姆汁。",
                "加入蘭姆酒與大量碎冰。",
                "快速攪拌至杯壁結霜。",
              ],
              tips: "使用陶杯盛裝更有風味。",
            },
            {
              id: 30,
              name: "X.Y.Z.",
              category: "Rum / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["短飲", "經典", "三合一"],
              flavor: "柑橘酸甜",
              features: "代表「結束」的調酒，意指這杯之後再無更好的選擇。",
              ingredients: [
                { id: "rum", amount: "30ml" },
                { id: "orange_liqueur", amount: "15ml" },
                { id: "juice_lemon", amount: "15ml" },
              ],
              steps: ["將材料加入雪克杯。", "加冰搖盪。", "濾入雞尾酒杯。"],
              tips: "側車 (Sidecar) 的蘭姆酒版本。",
            },
            {
              id: 31,
              name: "Old Fashioned (古典雞尾酒)",
              category: "Whiskey / 攪拌法 (Stir)",
              abv: "高 (~35%)",
              difficulty: 3,
              tags: ["經典", "硬漢", "慢飲"],
              flavor: "麥芽香、苦甜、陳穩",
              features: "最古老的雞尾酒形式，品味威士忌的最佳方式。",
              ingredients: [
                { id: "whiskey", amount: "60ml" },
                { id: "sugar", amount: "1顆" },
                { id: "bitters_angostura", amount: "2-3滴" },
                { id: "orange_peel", amount: "1片" },
              ],
              steps: [
                "方糖加苦精與少許水搗碎。",
                "加入大冰塊與一半威士忌攪拌。",
                "加剩餘威士忌攪拌至冷卻。",
                "噴附橙皮油。",
              ],
              tips: "慢慢攪拌融水，釋放威士忌香氣。",
            },
            {
              id: 32,
              name: "Whiskey Sour (威士忌酸酒)",
              category: "Whiskey / 搖盪法 (Shake)",
              abv: "中 (~18%)",
              difficulty: 2,
              tags: ["酸甜", "經典", "人氣"],
              flavor: "酸甜、滑順(若加蛋白)",
              features: "酸甜平衡的經典威士忌調酒，加入蛋白可增加綿密口感。",
              ingredients: [
                { id: "whiskey", amount: "45ml" },
                { id: "juice_lemon", amount: "30ml" },
                { id: "syrup_simple", amount: "15ml" },
                { id: "egg_white", amount: "1顆(選用)" },
              ],
              steps: [
                "將材料加入雪克杯。",
                "乾搖打發蛋白。",
                "加冰再次搖盪。",
                "濾入杯中。",
              ],
              tips: "乾搖 (Dry Shake) 是產生泡沫的關鍵。",
            },
            {
              id: 33,
              name: "Highball (威士忌蘇打)",
              category: "Whiskey / 直調法 (Build)",
              abv: "低 (~8%)",
              difficulty: 1,
              tags: ["居酒屋", "搭餐", "長飲"],
              flavor: "氣泡清爽、麥香",
              features: "極致清爽，能引出威士忌最純粹的香氣。",
              ingredients: [
                { id: "whiskey", amount: "45ml" },
                { id: "soda", amount: "補滿" },
                { id: "juice_lemon", amount: "1個(檸檬角)" },
              ],
              steps: [
                "冰杯。",
                "倒入威士忌攪拌。",
                "沿杯壁倒入蘇打水。",
                "輕輕提拉冰塊。",
                "加入檸檬角。",
              ],
              tips: "杯子與威士忌都要先冷凍過，氣泡更持久。",
            },
            {
              id: 34,
              name: "Manhattan (曼哈頓)",
              category: "Whiskey / 攪拌法 (Stir)",
              abv: "高 (~30%)",
              difficulty: 3,
              tags: ["雞尾酒之后", "短飲", "經典"],
              flavor: "藥草甜、濃厚、優雅",
              features: "被稱為雞尾酒之后，優雅而濃郁。",
              ingredients: [
                { id: "whiskey", amount: "50ml" },
                { id: "vermouth_sweet", amount: "20ml" },
                { id: "bitters_angostura", amount: "2滴" },
              ],
              steps: [
                "攪拌杯加冰。",
                "倒入所有材料。",
                "攪拌冷卻。",
                "濾入馬丁尼杯，放櫻桃。",
              ],
              tips: "建議使用裸麥威士忌 (Rye Whiskey)。",
            },
            {
              id: 35,
              name: "Mint Julep (薄荷朱利普)",
              category: "Whiskey / 直調+搗碎 (Muddle)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["賽馬酒", "夏日", "碎冰"],
              flavor: "極度冰涼、薄荷香、波本甜",
              features: "美國肯塔基賽馬的傳統飲料，極度冰涼消暑。",
              ingredients: [
                { id: "whiskey", amount: "60ml" },
                { id: "mint", amount: "8片" },
                { id: "syrup_simple", amount: "15ml" },
              ],
              steps: [
                "搗薄荷糖。",
                "加酒與碎冰攪拌至杯壁結霜。",
                "補滿碎冰與薄荷裝飾。",
              ],
              tips: "使用金屬杯能保持最佳冰度。",
            },
            {
              id: 36,
              name: "Boulevardier (林蔭大道)",
              category: "Whiskey / 攪拌法 (Stir)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["變化版", "苦味", "經典"],
              flavor: "Negroni威士忌版、苦甜",
              features: "Negroni 的威士忌版本，更加厚實溫暖。",
              ingredients: [
                { id: "whiskey", amount: "45ml" },
                { id: "campari", amount: "30ml" },
                { id: "vermouth_sweet", amount: "30ml" },
              ],
              steps: [
                "攪拌杯加冰與所有材料。",
                "攪拌冷卻。",
                "濾入加冰古典杯。",
                "橙皮裝飾。",
              ],
              tips: "適合秋冬飲用的苦甜調酒。",
            },
            {
              id: 37,
              name: "Sazerac (賽澤瑞克)",
              category: "Whiskey / 攪拌法 (Stir)",
              abv: "高 (~35%)",
              difficulty: 4,
              tags: ["紐奧良", "經典", "行家"],
              flavor: "茴香、藥草、層次極多",
              features: "紐奧良的官方雞尾酒，工序繁複但風味絕佳。",
              ingredients: [
                { id: "whiskey", amount: "60ml" },
                { id: "bitters_angostura", amount: "3滴" },
                { id: "absinthe", amount: "5ml" },
                { id: "sugar", amount: "1顆" },
              ],
              steps: [
                "冰鎮杯子並用艾碧斯刷杯。",
                "另一杯搗糖與苦精，加酒攪拌。",
                "濾入刷過艾碧斯的杯中。",
                "噴附檸檬皮油。",
              ],
              tips: "不加冰塊飲用，需充分攪拌冷卻。",
            },
            {
              id: 38,
              name: "Rusty Nail (鏽釘)",
              category: "Whiskey / 直調法 (Build)",
              abv: "高 (~35%)",
              difficulty: 1,
              tags: ["簡單", "重酒感", "經典"],
              flavor: "蜂蜜藥草、濃厚",
              features: "簡單卻濃烈的經典，蜂蜜威士忌酒帶來獨特藥草香。",
              ingredients: [
                { id: "whiskey", amount: "45ml" },
                { id: "liqueur_drambuie", amount: "25ml" },
              ],
              steps: ["古典杯放大冰塊。", "倒入兩種酒。", "輕輕攪拌。"],
              tips: "使用蘇格蘭威士忌風味最佳。",
            },
            {
              id: 39,
              name: "Penicillin (盤尼西林)",
              category: "Whiskey / 搖盪法 (Shake)",
              abv: "中 (~18%)",
              difficulty: 3,
              tags: ["現代經典", "療癒", "層次"],
              flavor: "煙燻泥煤、薑辣、酸甜",
              features: "現代經典調酒，煙燻泥煤與薑味帶來療癒感。",
              ingredients: [
                { id: "whiskey", amount: "50ml" },
                { id: "syrup_ginger", amount: "20ml" },
                { id: "juice_lemon", amount: "20ml" },
                { id: "whiskey_peat", amount: "7.5ml" },
              ],
              steps: [
                "主材料加冰搖盪。",
                "濾入加冰杯。",
                "漂浮泥煤威士忌。",
                "薑片裝飾。",
              ],
              tips: "泥煤威士忌最後漂浮，香氣更明顯。",
            },
            {
              id: 40,
              name: "Irish Coffee (愛爾蘭咖啡)",
              category: "Whiskey / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 2,
              tags: ["熱調酒", "冬季", "暖身"],
              flavor: "熱飲、咖啡奶香、酒香",
              features: "溫暖身心的熱調酒，咖啡與威士忌的完美結合。",
              ingredients: [
                { id: "whiskey", amount: "40ml" },
                { id: "coffee_hot", amount: "120ml" },
                { id: "cream", amount: "適量" },
              ],
              steps: ["溫杯。", "咖啡溶糖。", "加入威士忌。", "鋪上鮮奶油。"],
              tips: "鮮奶油需輕輕鋪在表面，不要攪拌。",
            },
            {
              id: 41,
              name: "Margarita (瑪格麗特)",
              category: "Tequila / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["經典", "鹽口杯", "短飲"],
              flavor: "酸、甜、鹹、植物香",
              features: "龍舌蘭調酒的代名詞，鹽口杯是其靈魂。",
              ingredients: [
                { id: "tequila", amount: "45ml" },
                { id: "orange_liqueur", amount: "20ml" },
                { id: "juice_lemon", amount: "20ml" },
                { id: "salt", amount: "適量" },
              ],
              steps: ["製作鹽口杯。", "材料加冰搖盪。", "濾入杯中。"],
              tips: "杯口抹鹽圈(Salt Rim)是靈魂。",
            },
            {
              id: 42,
              name: "Paloma (帕洛瑪)",
              category: "Tequila / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["墨西哥國民酒", "長飲", "夏日"],
              flavor: "葡萄柚香、微苦清爽",
              features: "墨西哥最受歡迎的調酒，清爽的葡萄柚風味。",
              ingredients: [
                { id: "tequila", amount: "45ml" },
                { id: "soda_grapefruit", amount: "100ml" },
                { id: "juice_lemon", amount: "10ml" },
              ],
              steps: ["加冰。", "倒酒與檸檬。", "補滿汽水。", "輕輕攪拌。"],
              tips: "可使用葡萄柚切片裝飾。",
            },
            {
              id: 43,
              name: "Tequila Sunrise (龍舌蘭日出)",
              category: "Tequila / 直調法 (Build)",
              abv: "低 (~12%)",
              difficulty: 1,
              tags: ["漸層", "派對", "甜美"],
              flavor: "柳橙甜、漸層美",
              features: "如日出般的夢幻漸層，滾石樂團的最愛。",
              ingredients: [
                { id: "tequila", amount: "45ml" },
                { id: "juice_orange", amount: "90ml" },
                { id: "grenadine", amount: "15ml" },
              ],
              steps: ["加冰。", "倒酒與果汁攪拌。", "沉入紅石榴糖漿。"],
              tips: "紅石榴糖漿最後沿杯壁緩緩倒入。",
            },
            {
              id: 44,
              name: "Tommy's Margarita",
              category: "Tequila / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 2,
              tags: ["現代經典", "純粹", "酸甜"],
              flavor: "強調龍舌蘭原味、無橙酒干擾",
              features: "現代經典版本，使用龍舌蘭糖漿取代橙酒，風味更純粹。",
              ingredients: [
                { id: "tequila", amount: "60ml" },
                { id: "juice_lime", amount: "30ml" },
                { id: "syrup_agave", amount: "15ml" },
              ],
              steps: ["加冰搖盪。", "濾入加冰古典杯。"],
              tips: "更能凸顯優質龍舌蘭的風味。",
            },
            {
              id: 45,
              name: "El Diablo (惡魔)",
              category: "Tequila / 直調法 (Build)",
              abv: "低 (~12%)",
              difficulty: 1,
              tags: ["長飲", "易飲", "派對"],
              flavor: "莓果酸甜、薑味",
              features: "酸甜莓果與辛辣薑味的完美平衡。",
              ingredients: [
                { id: "tequila", amount: "45ml" },
                { id: "liqueur_cassis", amount: "15ml" },
                { id: "juice_lime", amount: "15ml" },
                { id: "ginger_ale", amount: "適量" },
              ],
              steps: ["加冰。", "倒酒與萊姆。", "補滿薑汁汽水。"],
              tips: "黑醋栗利口酒帶來獨特的深紅色。",
            },
            {
              id: 46,
              name: "Batanga (巴坦加)",
              category: "Tequila / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["簡單", "長飲", "墨西哥"],
              flavor: "鹹味可樂、龍舌蘭香",
              features: "墨西哥當地的喝法，用刀攪拌是其特色。",
              ingredients: [
                { id: "tequila", amount: "50ml" },
                { id: "coke", amount: "補滿" },
                { id: "salt", amount: "適量" },
              ],
              steps: ["鹽口。", "加冰。", "倒酒補可樂。", "用刀攪拌。"],
              tips: "傳說中必須用切萊姆的刀攪拌才對味。",
            },
            {
              id: 47,
              name: "Matador (鬥牛士)",
              category: "Tequila / 搖盪法 (Shake)",
              abv: "中 (~15%)",
              difficulty: 2,
              tags: ["水果", "短飲", "簡單"],
              flavor: "鳳梨酸甜、熱帶感",
              features: "鳳梨與龍舌蘭的經典組合，酸甜適中。",
              ingredients: [
                { id: "tequila", amount: "45ml" },
                { id: "juice_pineapple", amount: "60ml" },
                { id: "juice_lemon", amount: "15ml" },
              ],
              steps: ["加冰搖盪。", "濾入冰杯。"],
              tips: "搖盪至產生泡沫口感更佳。",
            },
            {
              id: 48,
              name: "Long Island Iced Tea (長島冰茶)",
              category: "Mix / 直調法 (Build)",
              abv: "高 (~25%但無感)",
              difficulty: 2,
              tags: ["失身酒", "混酒", "派對"],
              flavor: "像檸檬紅茶但超烈",
              features: "混酒之王，雖然沒有茶，但喝起來像檸檬紅茶。",
              ingredients: [
                { id: "gin", amount: "15ml" },
                { id: "vodka", amount: "15ml" },
                { id: "rum", amount: "15ml" },
                { id: "tequila", amount: "15ml" },
                { id: "orange_liqueur", amount: "15ml" },
                { id: "juice_lemon", amount: "25ml" },
                { id: "syrup_simple", amount: "15ml" },
                { id: "coke", amount: "適量" },
              ],
              steps: [
                "除可樂外所有材料加冰搖盪(或直調)。",
                "濾入冰杯。",
                "補可樂。",
              ],
              tips: "小心飲用，後勁強烈。",
            },
            {
              id: 49,
              name: "Sidecar (側車)",
              category: "Brandy / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["三合一", "經典", "優雅"],
              flavor: "葡萄果香、柑橘、酸甜",
              features: "白蘭地調酒的代表作，優雅而平衡。",
              ingredients: [
                { id: "brandy", amount: "50ml" },
                { id: "orange_liqueur", amount: "20ml" },
                { id: "juice_lemon", amount: "20ml" },
              ],
              steps: ["加冰搖盪。", "濾入糖口杯(選用)。"],
              tips: "經典酸酒比例 2:1:1，杯口可抹糖圈。",
            },
            {
              id: 50,
              name: "Brandy Alexander (白蘭地亞歷山大)",
              category: "Brandy / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 2,
              tags: ["甜點系", "餐後", "奶香"],
              flavor: "巧克力奶昔、滑順甜美",
              features: "如融化冰淇淋般的甜點酒，滑順濃郁。",
              ingredients: [
                { id: "brandy", amount: "30ml" },
                { id: "liqueur_cacao", amount: "30ml" },
                { id: "cream", amount: "30ml" },
              ],
              steps: ["加冰搖盪。", "濾入杯中。", "撒肉豆蔻粉。"],
              tips: "肉豆蔻粉能提升香氣層次。",
            },
            {
              id: 51,
              name: "Vieux Carré (老廣場)",
              category: "Brandy / 攪拌法 (Stir)",
              abv: "高 (~30%)",
              difficulty: 3,
              tags: ["紐奧良", "行家", "重酒感"],
              flavor: "藥草、木質、複雜厚重",
              features: "紐奧良法國區的經典，風味複雜厚重。",
              ingredients: [
                { id: "whiskey", amount: "20ml" },
                { id: "brandy", amount: "20ml" },
                { id: "vermouth_sweet", amount: "20ml" },
                { id: "bitters_angostura", amount: "適量" },
              ],
              steps: ["加冰攪拌。", "濾入加冰古典杯。"],
              tips: "需充分攪拌釋放香氣。",
            },
            {
              id: 52,
              name: "Horse's Neck (馬頸)",
              category: "Brandy / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["裝飾", "長飲", "簡單"],
              flavor: "薑味、清爽",
              features: "以長長的檸檬皮裝飾如馬頸而得名。",
              ingredients: [
                { id: "brandy", amount: "45ml" },
                { id: "ginger_ale", amount: "補滿" },
                { id: "juice_lemon", amount: "1個(長檸檬皮)" },
              ],
              steps: ["削長檸檬皮入杯。", "加冰。", "倒酒與汽水。"],
              tips: "檸檬皮削得越長越好。",
            },
            {
              id: 53,
              name: "Pisco Sour (皮斯可酸酒)",
              category: "Brandy / 搖盪法 (Shake)",
              abv: "中 (~18%)",
              difficulty: 3,
              tags: ["南美", "酸甜", "蛋白"],
              flavor: "葡萄蒸餾香、綿密泡沫",
              features: "南美洲的經典，皮斯可獨特的葡萄香氣。",
              ingredients: [
                { id: "pisco", amount: "60ml" },
                { id: "juice_lemon", amount: "30ml" },
                { id: "syrup_simple", amount: "20ml" },
                { id: "egg_white", amount: "適量" },
              ],
              steps: ["乾搖打發。", "加冰搖盪。", "濾入杯。", "滴苦精。"],
              tips: "最後滴上苦精可去除蛋白腥味。",
            },
            {
              id: 54,
              name: "Aperol Spritz",
              category: "Liqueur / 直調法 (Build)",
              abv: "低 (~11%)",
              difficulty: 1,
              tags: ["開胃酒", "義大利", "輕鬆"],
              flavor: "柳橙苦甜、氣泡感",
              features: "義大利最受歡迎的開胃酒，橘色氣泡充滿活力。",
              ingredients: [
                { id: "aperol", amount: "60ml" },
                { id: "sparkling_wine", amount: "90ml" },
                { id: "soda", amount: "30ml" },
              ],
              steps: ["加冰。", "依序倒入氣泡酒、Aperol、蘇打水。"],
              tips: "比例 3:2:1 (氣泡酒:Aperol:蘇打水)。",
            },
            {
              id: 55,
              name: "Americano (美國佬)",
              category: "Liqueur / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["開胃酒", "Negroni前身", "低酒精"],
              flavor: "苦甜藥草、清爽",
              features: "Negroni 的前身，少了琴酒更為清爽低負擔。",
              ingredients: [
                { id: "campari", amount: "30ml" },
                { id: "vermouth_sweet", amount: "30ml" },
                { id: "soda", amount: "補滿" },
              ],
              steps: ["加冰。", "倒酒。", "補蘇打水。", "攪拌。"],
              tips: "適合下午飲用的輕鬆調酒。",
            },
            {
              id: 56,
              name: "Grasshopper (綠色蚱蜢)",
              category: "Liqueur / 搖盪法 (Shake)",
              abv: "低 (~15%)",
              difficulty: 2,
              tags: ["甜點系", "顏色美", "餐後"],
              flavor: "薄荷巧克力、冰淇淋感",
              features: "經典的甜點酒，薄荷巧克力口味。",
              ingredients: [
                { id: "liqueur_mint", amount: "30ml" },
                { id: "liqueur_cacao", amount: "30ml" },
                { id: "cream", amount: "30ml" },
              ],
              steps: ["加冰搖盪。", "濾入杯中。"],
              tips: "顏色如蚱蜢般翠綠。",
            },
            {
              id: 57,
              name: "B-52 (B52轟炸機)",
              category: "Liqueur / 分層法 (Layer)",
              abv: "中 (~25%)",
              difficulty: 4,
              tags: ["分層", "Shot", "視覺系"],
              flavor: "咖啡奶香橙味、一口乾",
              features: "著名的分層 Shot，視覺效果十足。",
              ingredients: [
                { id: "kahlua", amount: "15ml" },
                { id: "baileys", amount: "15ml" },
                { id: "orange_liqueur", amount: "15ml" },
              ],
              steps: ["依序沿湯匙背緩緩倒入形成分層。"],
              tips: "密度不同是分層的關鍵，動作要輕。",
            },
            {
              id: 58,
              name: "Amaretto Sour (杏仁酸酒)",
              category: "Liqueur / 搖盪法 (Shake)",
              abv: "低 (~15%)",
              difficulty: 2,
              tags: ["酸甜", "低酒精", "妹酒"],
              flavor: "杏仁豆腐味、酸甜",
              features: "帶有杏仁豆腐香氣的酸甜調酒，接受度極高。",
              ingredients: [
                { id: "liqueur_amaretto", amount: "60ml" },
                { id: "juice_lemon", amount: "30ml" },
                { id: "syrup_simple", amount: "10ml" },
              ],
              steps: ["乾搖打發。", "加冰搖盪。", "濾入加冰杯。"],
              tips: "杏仁酒本身較甜，糖漿可斟酌。",
            },
            {
              id: 59,
              name: "Negroni Sbagliato",
              category: "Liqueur / 直調法 (Build)",
              abv: "低 (~15%)",
              difficulty: 1,
              tags: ["網紅酒", "開胃", "變化版"],
              flavor: "苦甜、氣泡、比原版清爽",
              features: "美麗的錯誤，將琴酒換成氣泡酒，意外好喝。",
              ingredients: [
                { id: "campari", amount: "30ml" },
                { id: "vermouth_sweet", amount: "30ml" },
                { id: "sparkling_wine", amount: "30ml" },
              ],
              steps: ["加冰。", "倒酒攪拌。", "補氣泡酒。"],
              tips: "Sbagliato 在義大利文中意為「錯誤」。",
            },
            {
              id: 60,
              name: "Charlie Chaplin (卓別林)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 2,
              tags: ["復古", "酸甜", "低酒精"],
              flavor: "梅果酸甜、杏桃香",
              features: "以喜劇大師命名的經典調酒，酸甜適中。",
              ingredients: [
                { id: "sloe_gin", amount: "30ml" },
                { id: "liqueur_apricot", amount: "30ml" },
                { id: "juice_lemon", amount: "30ml" },
              ],
              steps: ["加冰搖盪。", "濾入雞尾酒杯。"],
              tips: "黑刺李琴酒帶有獨特的莓果風味。",
            },
          ],

          get allIngredientsList() {
            let list = [];
            this.spiritsData.forEach((s) =>
              list.push({ id: s.id, name: s.name, category: "base" })
            );
            this.modifiers.forEach((cat) => {
              cat.items.forEach((item) =>
                list.push({ id: item.id, name: item.name, category: "mixer" })
              );
            });
            return list;
          },

          getGroupedIngredients() {
            let groups = {};
            this.allIngredientsList.forEach((ing) => {
              if (!groups[ing.category]) groups[ing.category] = [];
              groups[ing.category].push(ing);
            });
            return groups;
          },

          getRecipeIngredientsGrouped() {
            let groups = {
              "六大基酒 (Base Spirits)": this.spiritsData.map((s) => ({
                id: s.id,
                name: s.name,
              })),
            };
            this.modifiers.forEach((cat) => {
              groups[cat.category] = cat.items.map((i) => ({
                id: i.id,
                name: i.name,
              }));
            });
            return groups;
          },

          toggleFavorite(id) {
            if (this.favoriteRecipes.includes(id)) {
              this.favoriteRecipes = this.favoriteRecipes.filter(
                (fid) => fid !== id
              );
            } else {
              this.favoriteRecipes.push(id);
            }
          },

          get favoriteRecipeList() {
            return this.recipes.filter((r) =>
              this.favoriteRecipes.includes(r.id)
            );
          },

          get commonTags() {
            const tags = new Set([
              "經典",
              "酸甜",
              "清爽",
              "高酒精",
              "派對",
              "長飲",
              "短飲",
              "熱帶",
              "苦甜",
              "Tiki",
              "妹酒",
              "重口味",
            ]);

            this.recipes.forEach((r) => {
              if (r.tags && Array.isArray(r.tags)) {
                r.tags.forEach((t) => tags.add(t));
              }
            });

            return Array.from(tags).sort();
          },

          // ABV Map for calculation
          abvMap: {
            gin: 40,
            vodka: 40,
            rum: 40,
            tequila: 40,
            whiskey: 40,
            brandy: 40,
            pisco: 40,
            rum_dark: 40,
            rum_151: 75.5,
            whiskey_peat: 40,
            sloe_gin: 26,
            vermouth_dry: 18,
            vermouth_sweet: 16,
            lillet_blanc: 17,
            campari: 25,
            aperol: 11,
            orange_liqueur: 40,
            kahlua: 20,
            baileys: 17,
            liqueur_cherry: 24,
            liqueur_benedictine: 40,
            liqueur_violet: 22,
            liqueur_maraschino: 32,
            absinthe: 70,
            liqueur_peach: 18,
            liqueur_cassis: 16,
            liqueur_cacao: 25,
            liqueur_mint: 24,
            liqueur_amaretto: 28,
            liqueur_apricot: 24,
            liqueur_drambuie: 40,
            sparkling_wine: 12,
          },

          getIngredientABV(id) {
            return this.abvMap[id] || 0;
          },

          parseVolume(amount, id) {
            if (!amount) return 0;
            let str = amount.toString().toLowerCase();
            // Handle ml
            const mlMatch = str.match(/(\d+(\.\d+)?)\s*ml/);
            if (mlMatch) return parseFloat(mlMatch[1]);

            // Handle oz
            const ozMatch = str.match(/(\d+(\.\d+)?)\s*oz/);
            if (ozMatch) return parseFloat(ozMatch[1]) * 30;

            // Special keywords
            if (str.includes("補滿")) return 120;
            if (str.includes("適量") || str.includes("少許")) return 2;
            if (str.includes("dash") || str.includes("滴")) return 1;
            if (str.includes("tsp") || str.includes("茶匙")) return 5;

            // Fruit/Veg counts
            if (
              str.includes("個") ||
              str.includes("顆") ||
              str.includes("片")
            ) {
              if (id.includes("juice") || id === "lemon" || id === "lime")
                return 30;
              return 0;
            }

            return 0;
          },

          calculateRecipeABV(recipe) {
            if (!recipe || !recipe.ingredients) return 0;
            let totalVol = 0;
            let totalAlc = 0;

            recipe.ingredients.forEach((ing) => {
              const vol = this.parseVolume(ing.amount, ing.id);
              const abv = this.getIngredientABV(ing.id);
              totalVol += vol;
              totalAlc += vol * (abv / 100);
            });

            if (totalVol === 0) return 0;
            return Math.round((totalAlc / totalVol) * 100);
          },

          get selectableRecipes() {
            return this.filteredRecipes.map((r) => {
              let missing = (r.ingredients || [])
                .filter((ing) => !this.myIngredients.includes(ing.id))
                .map((ing) => ing.id);
              return { ...r, missing };
            });
          },

          getScaledAmount(amount, id) {
            if (!amount) return "";
            if (this.currentScale === 1) return this.convertAmount(amount);

            // 針對「補滿」的特殊處理 (Batch Mode)
            if (this.batchMode && amount.includes("補滿")) {
                const baseVol = this.parseVolume(amount, id || '');
                const totalVol = Math.round(baseVol * this.currentScale);
                return `${totalVol} ml`;
            }

            // 自動辨識並乘算字串中的數字
            let scaled = amount.replace(/(\d+(\.\d+)?)/g, (match) => {
              const num = parseFloat(match);
              if (isNaN(num)) return match;
              let newNum = num * this.currentScale;
              // 避免出現過多小數位
              return parseFloat(newNum.toFixed(1));
            });

            return this.convertAmount(scaled);
          },

          getRecipeTotalVolume(recipe) {
            if (!recipe || !recipe.ingredients) return 0;
            let total = 0;
            recipe.ingredients.forEach(ing => {
                total += this.parseVolume(ing.amount, ing.id);
            });
            return total || 150; // 若無法計算則回傳預設值避免錯誤
          },

          toggleBatchMode() {
            this.batchMode = !this.batchMode;
            if (this.batchMode) {
                this.updateBatchScale();
            } else {
                this.currentScale = 1;
            }
          },

          updateBatchScale() {
            if (!this.selectedRecipe) return;
            const total = this.getRecipeTotalVolume(this.selectedRecipe);
            if (total > 0) {
                this.currentScale = this.targetVolume / total;
            }
          },

          openRecipeDetail(recipe) {
            this.selectedRecipe = recipe;
            this.currentScale = 1;
            this.batchMode = false;
            this.targetVolume = 2000;
            this.isRecipeModalOpen = true;
          },

          estimateCost(recipe) {
            // 1. 檢查手動設定的成本
            if (recipe && typeof recipe.cost === "number") {
              return Math.ceil(recipe.cost * this.currentScale);
            }

            // 2. 若無手動設定，則自動計算
            if (!recipe || !recipe.ingredients) return 0;
            let totalCost = 0;
            
            // 市場行情預設成本 (NTD/ml) - 當酒櫃找不到時的參考價
            const defaultCosts = {
                base: 0.8,    // 一般基酒 (~$600/瓶)
                liqueur: 1.0, // 利口酒 (~$750/瓶)
                mixer: 0.15,  // 汽水/通寧水 (~$50/罐)
                juice: 0.5,   // 新鮮果汁 (~$15/顆)
                syrup: 0.2,   // 糖漿
                bitters: 3.0, // 苦精 (用量少單價高)
                egg: 10,      // 蛋 (單顆)
                garnish: 2    // 裝飾物
            };

            recipe.ingredients.forEach(ing => {
                // 1. 計算份量 (ml)
                let vol = this.parseVolume(ing.amount, ing.id);
                
                // 特殊處理：蛋
                if (ing.id === 'egg_white' || ing.id === 'egg_whole') {
                    totalCost += defaultCosts.egg;
                    return;
                }
                
                // 2. 決定單價 (NTD/ml)
                let costPerMl = 0;
                
                // A. 優先查酒櫃 (取平均價)
                const myStock = this.myBottles.filter(b => b.typeId === ing.id && b.price);
                if (myStock.length > 0) {
                    const avgPrice = myStock.reduce((sum, b) => sum + (parseFloat(b.price) || 0), 0) / myStock.length;
                    // 假設標準瓶 750ml (若為大瓶裝可自行調整參數，此為估算值)
                    costPerMl = avgPrice / 750;
                } else {
                    // B. 查不到則使用預設估算
                    if (this.spiritsData.some(s => s.id === ing.id)) costPerMl = defaultCosts.base;
                    else if (ing.id.includes('liqueur') || ing.id.includes('vermouth') || ing.id === 'campari' || ing.id === 'aperol') costPerMl = defaultCosts.liqueur;
                    else if (ing.id.includes('juice') || ing.id === 'lemon' || ing.id === 'lime') costPerMl = defaultCosts.juice;
                    else if (ing.id.includes('syrup') || ing.id === 'sugar' || ing.id === 'honey') costPerMl = defaultCosts.syrup;
                    else if (ing.id.includes('bitters')) costPerMl = defaultCosts.bitters;
                    else if (ing.id.includes('soda') || ing.id.includes('tonic') || ing.id.includes('coke') || ing.id.includes('ginger')) costPerMl = defaultCosts.mixer;
                    else costPerMl = 0.1; // 其他雜項
                }
                
                totalCost += vol * costPerMl;
            });

            // 乘上目前的份數倍率
            return Math.ceil(totalCost * this.currentScale);
          },

          // --- Radar Chart Helpers ---
          getRadarPath(profile, radius = 80) {
            const p = profile || { sweet: 0, sour: 0, bitter: 0, boozy: 0, complex: 0 };
            const values = [p.sweet, p.sour, p.bitter, p.boozy, p.complex];
            return values.map((v, i) => {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
                const r = (v / 5) * radius;
                const x = 100 + r * Math.cos(angle);
                const y = 100 + r * Math.sin(angle);
                return `${x},${y}`;
            }).join(" ");
          },
          getRadarGrid(level, radius = 80) {
            const points = [];
            for(let i=0; i<5; i++) {
                const angle = (Math.PI * 2 * i) / 5 - Math.PI / 2;
                const r = (level / 5) * radius;
                const x = 100 + r * Math.cos(angle);
                const y = 100 + r * Math.sin(angle);
                points.push(`${x},${y}`);
            }
            return points.join(" ");
          },

          get filteredRecipes() {
            let result = this.recipes;

            if (this.searchQuery) {
              const lowerQuery = this.searchQuery.toLowerCase();
              result = result.filter(
                (r) =>
                  r.name.toLowerCase().includes(lowerQuery) ||
                  r.ingredients.some((i) =>
                    this.getIngredientName(i.id)
                      .toLowerCase()
                      .includes(lowerQuery)
                  )
              );
            }

            if (this.filterBase !== "all") {
              result = result.filter((r) =>
                r.ingredients.some((i) => i.id === this.filterBase)
              );
            }

            if (this.filterDifficulty !== "all") {
              result = result.filter(
                (r) => r.difficulty === parseInt(this.filterDifficulty)
              );
            }

            if (this.filterStyle !== "all") {
              result = result.filter(
                (r) => r.tags && r.tags.includes(this.filterStyle)
              );
            }

            return result;
          },

          get filteredBottles() {
            if (!this.searchQuery) return this.myBottles;
            const lowerQuery = this.searchQuery.toLowerCase();
            return this.myBottles.filter(
              (b) =>
                b.name.toLowerCase().includes(lowerQuery) ||
                (b.brand && b.brand.toLowerCase().includes(lowerQuery)) ||
                this.getIngredientName(b.typeId)
                  .toLowerCase()
                  .includes(lowerQuery)
            );
          },

          getAvailableRecipes() {
            return this.recipes
              .map((r) => {
                let missing = (r.ingredients || [])
                  .filter((ing) => !this.myIngredients.includes(ing.id))
                  .map((ing) => ing.id);
                return { ...r, missing };
              })
              .sort((a, b) => a.missing.length - b.missing.length);
          },

          getReadyRecipes() {
            return this.getAvailableRecipes().filter(
              (r) => r.missing.length === 0
            );
          },
          getNearMissRecipes() {
            return this.getAvailableRecipes().filter(
              (r) => r.missing.length === 1
            );
          },
          getOtherRecipes() {
            return this.getAvailableRecipes().filter(
              (r) => r.missing.length > 1
            );
          },

          get generatedMenuList() {
            return this.menuSelectedRecipes.map((id) =>
              this.recipes.find((r) => r.id === id)
            );
          },

          get totalAssetValue() {
            return this.myBottles.reduce((total, bottle) => {
                const price = parseFloat(bottle.price);
                return total + (isNaN(price) ? 0 : price);
            }, 0);
          },

          getIngredientName(id) {
            let item = this.allIngredientsList.find((i) => i.id === id);
            // Fallback to ID if not found (useful for AI generated ingredients)
            return item ? item.name : id;
          },

          getMissingNames(missingIds) {
            return missingIds
              .map((id) => this.getIngredientName(id))
              .join(", ");
          },

          convertStep(step) {
            if (this.unit === "ml") return step;
            return step.replace(/(\d+)\s*ml/gi, (match, p1) => {
              const ml = parseFloat(p1);
              const oz = Math.round((ml / 30) * 100) / 100; // 簡單換算 30ml = 1oz，保留兩位小數
              return oz + " oz";
            });
          },

          convertAmount(amount) {
            if (this.unit === "ml") return amount;
            if (!amount) return "";
            return amount.replace(/(\d+(\.\d+)?)\s*ml/gi, (match, p1) => {
              const ml = parseFloat(p1);
              const oz = Math.round((ml / 30) * 100) / 100;
              return oz + " oz";
            });
          },

          toggleIngredient(id) {
            if (this.myIngredients.includes(id)) {
              this.myIngredients = this.myIngredients.filter((i) => i !== id);
            } else {
              this.myIngredients.push(id);
            }
          },

          openAddBottleModal(typeId = "gin") {
            this.editingBottleId = null;
            this.bottleForm = {
              typeId: typeId,
              name: "",
              brand: "",
              price: "",
              location: "",
              purchaseDate: "",
              rating: 5,
              notes: "",
              tags: "",
              features: "",
              remaining: 100,
            volume: 750,
            };
            this.isBottleFormOpen = true;
          },

          editBottle(bottle) {
            this.editingBottleId = bottle.id;
            // Manually copy properties to avoid proxy issues and ensure all fields exist
            this.bottleForm = {
              typeId: bottle.typeId || "gin",
              name: bottle.name || "",
              brand: bottle.brand || "",
              price: bottle.price || "",
              location: bottle.location || "",
              purchaseDate: bottle.purchaseDate || "",
              rating: bottle.rating ?? 5,
              notes: bottle.notes || "",
              tags: (bottle.tags || []).join(", "),
              features: bottle.features || "",
              remaining: bottle.remaining ?? 100,
              volume: bottle.volume || 750,
            };
            this.isBottleFormOpen = true;
          },

          saveBottle() {
            const bottleData = {
              ...this.bottleForm,
              tags: (this.bottleForm.tags || "")
                .split(",")
                .map((t) => t.trim())
                .filter((t) => t),
            };

            if (this.editingBottleId) {
              const index = this.myBottles.findIndex(
                (b) => b.id === this.editingBottleId
              );
              if (index !== -1) {
                this.myBottles[index] = {
                  id: this.editingBottleId,
                  ...bottleData,
                };
              }
            } else {
              this.myBottles.push({
                id: Date.now(),
                ...bottleData,
              });
              if (!this.myIngredients.includes(this.bottleForm.typeId)) {
                this.myIngredients.push(this.bottleForm.typeId);
              }
            }

            this.isBottleFormOpen = false;
            this.$nextTick(() => lucide.createIcons());
          },

          deleteBottle(id) {
            this.myBottles = this.myBottles.filter((b) => b.id !== id);
          },

          deleteRecipe(id) {
            if (confirm("確定要刪除這份酒譜嗎？")) {
              this.recipes = this.recipes.filter((r) => r.id !== id);
            }
          },

          deleteModifier(catIndex, itemId) {
            if (confirm("確定要刪除這個調味資料嗎？")) {
              this.modifiers[catIndex].items = this.modifiers[
                catIndex
              ].items.filter((i) => i.id !== itemId);
            }
          },

          saveModifier() {
            const catIndex = this.modifierForm.categoryIndex;
            const newItem = {
              id: "custom_" + Date.now(),
              name: this.modifierForm.name,
              desc: this.modifierForm.desc,
              tag: this.modifierForm.tag || "自訂",
            };
            if (this.modifiers[catIndex]) {
              this.modifiers[catIndex].items.push(newItem);
            }
            this.isModifierFormOpen = false;
            this.modifierForm = {
              categoryIndex: 0,
              name: "",
              desc: "",
              tag: "",
            };
            this.$nextTick(() => lucide.createIcons());
          },

          openAddRecipeModal() {
            this.editingRecipeId = null;
            this.recipeForm = {
              name: "",
              category: "自創酒譜",
              abv: "10%",
              difficulty: 1,
              flavor: "",
              features: "",
              tags: "",
              ingredients: [],
              amounts: {},
              steps: "",
              tips: "",
              cost: null,
              profile: { sweet: 1, sour: 1, bitter: 1, boozy: 1, complex: 1 },
            };
            this.isRecipeFormOpen = true;
          },

          editRecipe(recipe) {
            this.editingRecipeId = recipe.id;
            const amounts = {};
            recipe.ingredients.forEach((i) => {
              amounts[i.id] = i.amount;
            });
            this.recipeForm = {
              name: recipe.name,
              category: recipe.category || "自創酒譜",
              abv: recipe.abv || "未知",
              difficulty: recipe.difficulty || 1,
              flavor: recipe.flavor,
              features: recipe.features || "",
              tags: (recipe.tags || []).join(", "),
              ingredients: recipe.ingredients.map((i) => i.id),
              amounts: amounts,
              steps: recipe.steps.join("\n"),
              tips: recipe.tips,
              cost: recipe.cost ?? null,
              profile: recipe.profile || { sweet: 1, sour: 1, bitter: 1, boozy: 1, complex: 1 },
            };
            this.isRecipeFormOpen = true;
          },

          openNoteModal(recipe) {
            this.noteForm = {
              id: recipe.id,
              name: recipe.name,
              rating: recipe.myRating || 0,
              notes: recipe.myNotes || "",
            };
            this.isNoteModalOpen = true;
          },

          saveNote() {
            const index = this.recipes.findIndex(
              (r) => r.id === this.noteForm.id
            );
            if (index !== -1) {
              this.recipes[index].myRating = parseInt(this.noteForm.rating);
              this.recipes[index].myNotes = this.noteForm.notes;
              // Watcher 會自動觸發 saveData
            }
            this.isNoteModalOpen = false;
            this.$nextTick(() => lucide.createIcons());
          },

          deleteNote() {
            if (confirm("確定要刪除這筆評分與筆記嗎？")) {
                const index = this.recipes.findIndex(
                  (r) => r.id === this.noteForm.id
                );
                if (index !== -1) {
                  // 使用物件替換以確保 computed properties (如 getAvailableRecipes) 能偵測到變更
                  this.recipes[index] = {
                    ...this.recipes[index],
                    myRating: 0,
                    myNotes: ""
                  };
                  this.noteForm.rating = 0;
                  this.noteForm.notes = "";
                }
                this.isNoteModalOpen = false;
                this.$nextTick(() => lucide.createIcons());
            }
          },

          saveRecipe() {
            const ingredientsArray = this.recipeForm.ingredients.map((id) => {
              return { id, amount: this.recipeForm.amounts[id] || "適量" };
            });

            const recipeData = {
              name: this.recipeForm.name,
              category: this.recipeForm.category,
              abv: this.recipeForm.abv,
              difficulty: parseInt(this.recipeForm.difficulty),
              tags: this.recipeForm.tags
                .split(/[,，]/)
                .map((t) => t.trim())
                .filter((t) => t),
              flavor: this.recipeForm.flavor,
              features: this.recipeForm.features,
              ingredients: ingredientsArray,
              steps: this.recipeForm.steps.split("\n").filter((s) => s.trim()),
              tips: this.recipeForm.tips,
              cost: !isNaN(parseFloat(this.recipeForm.cost))
                ? parseFloat(this.recipeForm.cost)
                : null,
              profile: {
                sweet: parseInt(this.recipeForm.profile.sweet),
                sour: parseInt(this.recipeForm.profile.sour),
                bitter: parseInt(this.recipeForm.profile.bitter),
                boozy: parseInt(this.recipeForm.profile.boozy),
                complex: parseInt(this.recipeForm.profile.complex),
              },
            };

            if (this.editingRecipeId) {
              const index = this.recipes.findIndex(
                (r) => r.id === this.editingRecipeId
              );
              if (index !== -1) {
                this.recipes[index] = {
                  ...this.recipes[index],
                  ...recipeData,
                };
              }
            } else {
              this.recipes.push({
                id: Date.now(),
                ...recipeData,
              });
            }

            this.isRecipeFormOpen = false;
            this.editingRecipeId = null;
            this.recipeForm = {
              name: "",
              category: "",
              abv: "",
              difficulty: 1,
              flavor: "",
              features: "",
              tags: "",
              ingredients: [],
              amounts: {},
              steps: "",
              tips: "",
              cost: null,
              profile: { sweet: 1, sour: 1, bitter: 1, boozy: 1, complex: 1 },
            };
            this.$nextTick(() => lucide.createIcons());
          },

          addToShoppingList(missingIds) {
            let count = 0;
            missingIds.forEach((id) => {
              if (!this.shoppingList.some((item) => item.id === id)) {
                this.shoppingList.push({
                  id: id,
                  name: this.getIngredientName(id),
                  checked: false,
                });
                count++;
              }
            });
            if (count > 0) {
              this.saveData();
              alert(`已將 ${count} 項材料加入購物清單！`);
            } else {
              alert("這些材料都已經在清單中囉！");
            }
          },

          removeFromShoppingList(index) {
            this.shoppingList.splice(index, 1);
            this.saveData();
          },

          setupRoulette() {
            const partyOptions = [
              { name: "自己喝一杯", flavor: "逃不掉的，乾杯吧！" },
              { name: "安全下莊", flavor: "恭喜！這回合你是觀眾。" },
              { name: "指定人喝", flavor: "權力在你手中，選個幸運兒。" },
              { name: "左邊的人喝", flavor: "你的左手邊那位，請舉杯。" },
              { name: "右邊的人喝", flavor: "你的右手邊那位，別裝傻。" },
              { name: "大家一起喝", flavor: "Cheers! 氣氛炒起來！" },
              { name: "與對面喝交杯", flavor: "深情對望，喝完這杯。" },
              { name: "下一位喝兩杯", flavor: "把這份福氣加倍傳下去。" },
            ];

            // 隨機打亂
            this.rouletteCandidates = partyOptions.sort(
              () => 0.5 - Math.random()
            );
            this.rouletteRotation = 0;
            this.rouletteResult = null;
          },

          getRouletteGradient() {
            const count = this.rouletteCandidates.length;
            if (count === 0) return "#cbd5e1 0% 100%"; // 灰色預設

            let gradient = [];
            const colors = [
              "#fcd34d",
              "#fbbf24",
              "#f59e0b",
              "#d97706",
              "#fcd34d",
              "#fbbf24",
              "#f59e0b",
              "#d97706",
            ]; // Amber shades
            const step = 100 / count;

            for (let i = 0; i < count; i++) {
              gradient.push(
                `${colors[i % colors.length]} ${i * step}% ${(i + 1) * step}%`
              );
            }
            return gradient.join(", ");
          },

          spinRoulette() {
            if (this.isSpinning || this.rouletteCandidates.length === 0) return;
            this.isSpinning = true;
            this.rouletteResult = null;

            // 旋轉至少 5 圈 + 隨機角度
            const spinAmount = 360 * 5 + Math.floor(Math.random() * 360);
            this.rouletteRotation += spinAmount;

            setTimeout(() => {
              this.isSpinning = false;
              const count = this.rouletteCandidates.length;
              const segmentAngle = 360 / count;
              // 計算指針指向的區塊 (指針在上方 0 度，輪盤順時針轉，相當於指針逆時針移動)
              const currentRot = this.rouletteRotation % 360;
              const pointerAngle = (360 - currentRot) % 360;
              const winningIndex = Math.floor(pointerAngle / segmentAngle);
              this.rouletteResult = this.rouletteCandidates[winningIndex];

              // 簡單的慶祝效果
              if (this.rouletteResult) {
                // 可以加入音效或 confetti
              }
            }, 3000); // 配合 CSS transition 時間
          },

          pickRandomRecipe() {
            if (this.recipes.length === 0) return;
            const randomRecipe =
              this.recipes[Math.floor(Math.random() * this.recipes.length)];
            this.openRecipeDetail(randomRecipe);
            this.rouletteResult = null; // 清除輪盤結果，下次進來是新的
          },

          async generateAiCocktail() {
            if (!this.geminiApiKey) {
              alert("請先至「設定」頁面輸入 Gemini API Key！");
              return;
            }

            this.aiLoading = true;
            this.aiResult = null;

            // 準備庫存清單
            const inventory = this.myIngredients.map(id => this.getIngredientName(id)).join(', ');
            const specificBottles = this.myBottles.map(b => `${b.name} (${this.getIngredientName(b.typeId)})`).join(', ');
            
            const prompt = `
              Role: World Class Mixologist.
              Task: Invent a NEW, unique cocktail recipe based on the user's available inventory.
              
              User's Inventory (Ingredients): ${inventory}
              User's Specific Bottles: ${specificBottles}
              (Assume basic pantry items like Sugar, Water, Ice, Simple Syrup are available).

              Requirements:
              1. The cocktail must be drinkable and balanced.
              2. Give it a creative name and a short backstory (features).
              3. Analyze the flavor profile (1-5 scale).
              4. Return ONLY raw JSON (no markdown formatting).

              JSON Structure:
              {
                "name": "String",
                "flavor": "String (e.g. Fruity, Spicy)",
                "features": "String (Description/Story)",
                "ingredients": [
                  {"name": "String (Ingredient Name)", "amount": "String (e.g. 45ml)"}
                ],
                "steps": ["String (Step 1)", "String (Step 2)"],
                "profile": {
                  "sweet": 1-5,
                  "sour": 1-5,
                  "bitter": 1-5,
                  "boozy": 1-5,
                  "complex": 1-5
                }
              }
            `;

            try {
              const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${this.geminiApiKey}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  contents: [{ parts: [{ text: prompt }] }]
                })
              });

              const data = await response.json();
              
              if (data.error) {
                throw new Error(data.error.message);
              }

              let text = data.candidates[0].content.parts[0].text;
              // Clean up markdown if present
              text = text.replace(/```json/g, '').replace(/```/g, '').trim();
              
              this.aiResult = JSON.parse(text);

            } catch (error) {
              console.error("AI Generation failed", error);
              alert("AI 調酒師連線失敗：\n" + error.message);
            } finally {
              this.aiLoading = false;
            }
          },

          saveAiRecipe() {
            if (!this.aiResult) return;

            // 嘗試將 AI 產生的材料名稱對應回系統 ID，若無則使用名稱當 ID
            const ingredients = this.aiResult.ingredients.map(aiIng => {
                // 簡單模糊比對
                const found = this.allIngredientsList.find(i => i.name === aiIng.name || i.name.includes(aiIng.name) || aiIng.name.includes(i.name));
                return {
                    id: found ? found.id : aiIng.name,
                    amount: aiIng.amount
                };
            });

            const newRecipe = {
                id: Date.now(),
                name: this.aiResult.name,
                category: "AI 特調",
                abv: "未知",
                difficulty: 3,
                flavor: this.aiResult.flavor,
                features: this.aiResult.features,
                tags: ["AI", "特調"],
                ingredients: ingredients,
                steps: this.aiResult.steps,
                tips: "由 AI 智能調酒師生成",
                cost: null,
                profile: this.aiResult.profile,
                myRating: 0,
                myNotes: ""
            };

            this.recipes.push(newRecipe);
            this.isAiModalOpen = false;
            this.aiResult = null;
            alert("已將 AI 特調加入酒譜庫！");
            this.activeTab = 'recipes';
          },

          async testAiConnection() {
             if (!this.geminiApiKey) {
              alert("請先輸入 API Key");
              return;
            }
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash-exp:generateContent?key=${this.geminiApiKey}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  contents: [{ parts: [{ text: "Say 'OK'" }] }]
                })
              });
              const data = await response.json();
              if(response.ok) alert("連線成功！(Gemini 2.0)");
              else alert("連線失敗：" + (data.error?.message || "請檢查 API Key"));
            } catch(e) {
                alert("連線錯誤：" + e.message);
            }
          },

          // --- Firebase Actions ---
          loginFirebase() {
            if (window.firebaseService) window.firebaseService.login();
          },

          logoutFirebase() {
            if (window.firebaseService) window.firebaseService.logout();
          },

          async saveToCloud() {
            if (!this.user || !window.firebaseService) return;
            const data = {
              myIngredients: this.myIngredients,
              myBottles: this.myBottles,
              recipes: this.recipes,
              favoriteRecipes: this.favoriteRecipes,
              modifiers: this.modifiers,
              shoppingList: this.shoppingList,
              drinkingHistory: this.drinkingHistory,
              barName: this.barName,
              bartenderName: this.bartenderName,
              unit: this.unit,
            };
            await window.firebaseService.save(this.user.uid, data);
          },

          async loadFromCloud() {
            if (!this.user || !window.firebaseService) return;
            const data = await window.firebaseService.load(this.user.uid);
            if (data) {
              if (confirm("發現雲端備份資料，是否覆蓋目前的本地資料？")) {
                this.applyData(data);
                alert("☁️ 資料同步完成！");
              }
            } else {
              alert("尚無雲端備份資料。");
            }
          },

          shareRecipe(recipe) {
            let text = `🍸 ${recipe.name}\n`;
            text += `------------------\n`;
            text += `📜 分類：${recipe.category}\n`;
            text += `🔥 難度：${"★".repeat(recipe.difficulty)}\n`;
            text += `👅 風味：${recipe.flavor}\n\n`;

            text += `🥃 材料：\n`;
            recipe.ingredients.forEach((ing) => {
              const amount = this.convertAmount(ing.amount);
              const name = this.getIngredientName(ing.id);
              text += `• ${name} ${amount}\n`;
            });

            text += `\n🥣 步驟：\n`;
            recipe.steps.forEach((step, index) => {
              text += `${index + 1}. ${this.convertStep(step)}\n`;
            });

            if (recipe.tips) {
              text += `\n💡 秘訣：${recipe.tips}\n`;
            }

            text += `\n------------------\n`;
            text += `🏠 ${this.barName}\n`;
            text += `👨‍🍳 ${this.bartenderName}`;

            navigator.clipboard
              .writeText(text)
              .then(() => {
                alert("📋 酒譜已複製到剪貼簿！\n快去分享給朋友吧！");
              })
              .catch((err) => {
                console.error("複製失敗", err);
                alert("複製失敗，請手動截圖分享。");
              });
          },

          generateRecipeImage(recipe) {
            const canvas = document.createElement("canvas");
            const ctx = canvas.getContext("2d");
            const w = 800;
            const h = 1200;
            canvas.width = w;
            canvas.height = h;

            // Background
            const gradient = ctx.createLinearGradient(0, 0, 0, h);
            gradient.addColorStop(0, "#0f172a"); // slate-900
            gradient.addColorStop(1, "#1e293b"); // slate-800
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, w, h);

            // Decorative Elements
            ctx.fillStyle = "rgba(245, 158, 11, 0.1)"; // amber-500 with opacity
            ctx.beginPath();
            ctx.arc(w, 0, 400, 0, Math.PI * 2);
            ctx.fill();
            ctx.beginPath();
            ctx.arc(0, h, 300, 0, Math.PI * 2);
            ctx.fill();

            // Header (Bar Info)
            ctx.textAlign = "center";
            ctx.fillStyle = "#f59e0b"; // amber-500
            ctx.font = "bold 32px sans-serif";
            ctx.fillText(this.barName, w / 2, 80);

            ctx.fillStyle = "#94a3b8"; // slate-400
            ctx.font = "24px sans-serif";
            ctx.fillText(this.bartenderName, w / 2, 120);

            // Recipe Title
            ctx.fillStyle = "#ffffff";
            ctx.font = "bold 60px sans-serif";
            if (ctx.measureText(recipe.name).width > 700) {
                 ctx.font = "bold 40px sans-serif";
            }
            ctx.fillText(recipe.name, w / 2, 250);

            // Meta Info
            ctx.fillStyle = "#cbd5e1"; // slate-300
            ctx.font = "30px sans-serif";
            ctx.fillText(`${recipe.category}  •  ${recipe.abv}`, w / 2, 310);

            // Flavor
            ctx.fillStyle = "#f59e0b";
            ctx.font = "italic 32px sans-serif";
            ctx.fillText(`"${recipe.flavor}"`, w / 2, 370);

            // Divider
            ctx.strokeStyle = "#334155";
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(100, 430);
            ctx.lineTo(700, 430);
            ctx.stroke();

            // Ingredients List
            let y = 520;
            ctx.textAlign = "left";
            ctx.fillStyle = "#94a3b8";
            ctx.font = "bold 28px sans-serif";
            ctx.fillText("INGREDIENTS", 100, y);
            y += 60;
            ctx.font = "36px sans-serif";
            ctx.fillStyle = "#ffffff";
            recipe.ingredients.forEach(ing => {
                const name = this.getIngredientName(ing.id);
                const amount = this.convertAmount(ing.amount);
                ctx.textAlign = "left";
                ctx.fillText(`• ${name}`, 100, y);
                ctx.textAlign = "right";
                ctx.fillStyle = "#f59e0b";
                ctx.fillText(amount, 700, y);
                ctx.fillStyle = "#ffffff";
                y += 60;
            });

            // Footer
            ctx.textAlign = "center";
            ctx.fillStyle = "#475569";
            ctx.font = "20px sans-serif";
            ctx.fillText("Generated by Home Mixology Lab", w / 2, h - 40);

            // Trigger Download
            try {
                const link = document.createElement("a");
                link.download = `Cocktail_${recipe.name.replace(/\s+/g, '_')}.png`;
                link.href = canvas.toDataURL("image/png");
                link.click();
            } catch (e) {
                console.error("Image generation failed", e);
                alert("圖片生成失敗，請稍後再試。");
            }
          },

          openJournalModal(recipe) {
            const now = new Date();
            // Format for datetime-local input: YYYY-MM-DDTHH:mm
            const dateStr = new Date(now.getTime() - (now.getTimezoneOffset() * 60000)).toISOString().slice(0, 16);
            
            this.journalForm = {
                id: null,
                recipeId: recipe.id,
                recipeName: recipe.name,
                date: dateStr,
                rating: parseInt(recipe.myRating) || 0,
                notes: ''
            };
            this.isJournalModalOpen = true;
          },

          editJournalEntry(entry) {
            // 確保取得最新的資料 (避免列表未更新導致的舊資料問題)
            const freshEntry = this.drinkingHistory.find(h => h.id === entry.id) || entry;
            this.journalForm = {
                id: freshEntry.id,
                recipeId: freshEntry.recipeId,
                recipeName: freshEntry.recipeName,
                date: freshEntry.date,
                rating: parseInt(freshEntry.rating, 10) || 0,
                notes: freshEntry.notes || ''
            };
            this.isJournalModalOpen = true;
          },

          saveJournalEntry() {
            const rating = parseInt(this.journalForm.rating, 10) || 0;

            if (this.journalForm.id) {
                const index = this.drinkingHistory.findIndex(h => h.id === this.journalForm.id);
                if (index !== -1) {
                    this.drinkingHistory[index] = {
                        ...this.drinkingHistory[index],
                        date: this.journalForm.date,
                        rating: rating,
                        notes: this.journalForm.notes
                    };
                    alert("日誌紀錄已更新！");
                }
            } else {
                // 確保 ID 正確生成 (覆蓋 journalForm 中的 null)
                const newEntry = {
                    ...this.journalForm,
                    id: Date.now(),
                    rating: rating
                };
                this.drinkingHistory.unshift(newEntry);
                alert("已紀錄到飲酒日誌！");
            }
            this.isJournalModalOpen = false;
            this.saveData();
          },

          deleteJournalEntry(id) {
            if(confirm("確定要刪除這筆紀錄嗎？")) {
                this.drinkingHistory = this.drinkingHistory.filter(h => h.id !== id);
                this.saveData();
            }
          },

          get journalStats() {
             const total = this.drinkingHistory.length;
             const oneWeekAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
             const thisWeek = this.drinkingHistory.filter(h => new Date(h.date) >= oneWeekAgo).length;
             
             const counts = {};
             const baseCounts = {};

             this.drinkingHistory.forEach(h => {
                 counts[h.recipeName] = (counts[h.recipeName] || 0) + 1;
                 
                 // 計算最常喝的基酒
                 const recipe = this.recipes.find(r => r.id === h.recipeId);
                 if (recipe && recipe.ingredients) {
                     recipe.ingredients.forEach(ing => {
                         const spirit = this.spiritsData.find(s => s.id === ing.id);
                         if (spirit) baseCounts[spirit.name.split(' ')[0]] = (baseCounts[spirit.name.split(' ')[0]] || 0) + 1;
                     });
                 }
             });

             const topRecipe = Object.entries(counts).sort((a,b) => b[1] - a[1])[0];
             const topBase = Object.entries(baseCounts).sort((a,b) => b[1] - a[1])[0];
             
             return {
                 total,
                 thisWeek,
                 favorite: topRecipe ? `${topRecipe[0]} (${topRecipe[1]}杯)` : '尚無資料',
                 favoriteBase: topBase ? `${topBase[0]} (${topBase[1]}杯)` : '尚無資料'
             };
          },

          saveData() {
            localStorage.setItem(
              "cocktail_data",
              JSON.stringify({
                myIngredients: this.myIngredients,
                myBottles: this.myBottles,
                recipes: this.recipes,
                favoriteRecipes: this.favoriteRecipes,
                modifiers: this.modifiers,
                shoppingList: this.shoppingList,
                drinkingHistory: this.drinkingHistory,
                barName: this.barName,
                bartenderName: this.bartenderName,
                unit: this.unit,
              })
            );
          },

          loadData() {
            const saved = localStorage.getItem("cocktail_data");
            if (saved) {
              try {
                const data = JSON.parse(saved);
                this.applyData(data);
              } catch (e) {
                console.error("Failed to load data", e);
              }
            }
          },

          applyData(data) {
            if (data.myIngredients) this.myIngredients = data.myIngredients;
            if (data.myBottles) this.myBottles = data.myBottles;
            if (data.favoriteRecipes)
              this.favoriteRecipes = data.favoriteRecipes;
            if (data.drinkingHistory) this.drinkingHistory = data.drinkingHistory;

            if (data.recipes) {
              const savedRecipes = data.recipes;
              const savedIds = new Set(savedRecipes.map((r) => r.id));
              const newRecipes = this.recipes.filter(
                (r) => !savedIds.has(r.id)
              );
              this.recipes = [...savedRecipes, ...newRecipes].sort(
                (a, b) => a.id - b.id
              );
            }

            if (data.modifiers) {
              const savedIds = new Set();
              data.modifiers.forEach((cat) =>
                cat.items.forEach((i) => savedIds.add(i.id))
              );
              this.modifiers.forEach((defaultCat) => {
                let targetCat = data.modifiers.find(
                  (c) => c.category === defaultCat.category
                );
                if (!targetCat) {
                  data.modifiers.push(JSON.parse(JSON.stringify(defaultCat)));
                } else {
                  defaultCat.items.forEach((item) => {
                    if (!savedIds.has(item.id)) targetCat.items.push(item);
                  });
                }
              });
              this.modifiers = data.modifiers;
            }

            if (data.shoppingList) this.shoppingList = data.shoppingList;
            if (data.barName) this.barName = data.barName;
            if (data.bartenderName) this.bartenderName = data.bartenderName;
            if (data.unit) this.unit = data.unit;
          },

          toggleTheme() {
            this.darkMode = !this.darkMode;
            if (this.darkMode) {
              document.documentElement.classList.add("dark");
              localStorage.setItem("theme", "dark");
            } else {
              document.documentElement.classList.remove("dark");
              localStorage.setItem("theme", "light");
            }
          },

          backupData() {
            const data = {
              myIngredients: this.myIngredients,
              myBottles: this.myBottles,
              recipes: this.recipes,
              modifiers: this.modifiers,
              shoppingList: this.shoppingList,
              barName: this.barName,
              bartenderName: this.bartenderName,
              unit: this.unit,
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {
              type: "application/json",
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download =
              "cocktail_lab_backup_" +
              new Date().toISOString().slice(0, 10) +
              ".json";
            a.click();
          },

          triggerImport() {
            this.$refs.fileInput.click();
          },

          importDataFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const data = JSON.parse(e.target.result);
                if (data.myIngredients) this.myIngredients = data.myIngredients;
                if (data.myBottles) this.myBottles = data.myBottles;
                if (data.recipes) this.recipes = data.recipes;
                if (data.modifiers) this.modifiers = data.modifiers;
                if (data.shoppingList) this.shoppingList = data.shoppingList;
                if (data.drinkingHistory) this.drinkingHistory = data.drinkingHistory;
                if (data.barName) this.barName = data.barName;
                if (data.bartenderName) this.bartenderName = data.bartenderName;
                if (data.unit) this.unit = data.unit;
                alert("資料匯入成功！");
              } catch (err) {
                alert("匯入失敗，檔案格式錯誤。");
              }
            };
            reader.readAsText(file);
            event.target.value = "";
          },

          resetData() {
            if (
              confirm("確定要重置所有資料嗎？這將會清除您的酒櫃與自訂設定。")
            ) {
              localStorage.removeItem("cocktail_data");
              location.reload();
            }
          },

          init() {
            this.loadData();

            // Setup Firebase Listener
            const setupFirebase = () => {
              if (window.firebaseService)
                window.firebaseService.onAuth((u) => (this.user = u));
            };
            if (window.firebaseService) setupFirebase();
            window.addEventListener("firebase-ready", setupFirebase);

            this.$watch("myIngredients", () => this.saveData());
            this.$watch("myBottles", () => this.saveData());
            this.$watch("recipes", () => this.saveData());
            this.$watch("favoriteRecipes", () => {
              this.saveData();
            });
            this.$watch("modifiers", () => this.saveData());
            this.$watch("shoppingList", () => this.saveData());
            this.$watch("drinkingHistory", () => this.saveData());
            this.$watch("barName", (val) => {
              this.saveData();
              document.title = val + " - " + this.bartenderName;
            });
            this.$watch("bartenderName", (val) => {
              this.saveData();
              document.title = this.barName + " - " + val;
            });
            this.$watch("unit", () => this.saveData());

            this.$watch("geminiApiKey", (val) => {
              localStorage.setItem("gemini_api_key", val);
            });

            lucide.createIcons();
            this.$watch("activeTab", () => {
              this.searchQuery = "";
              this.$nextTick(() => lucide.createIcons());
            });
            this.$watch("isBottleFormOpen", () =>
              this.$nextTick(() => lucide.createIcons())
            );
            this.$watch("isModifierFormOpen", () =>
              this.$nextTick(() => lucide.createIcons())
            );
            this.$watch("isRecipeFormOpen", () =>
              this.$nextTick(() => lucide.createIcons())
            );
            this.$watch("isRecipeModalOpen", () =>
              this.$nextTick(() => lucide.createIcons())
            );
            this.$watch("isNoteModalOpen", () =>
              this.$nextTick(() => lucide.createIcons())
            );
            this.$watch("isJournalModalOpen", () =>
              this.$nextTick(() => lucide.createIcons())
            );
            this.setupRoulette(); // 初始化輪盤
            if (this.darkMode) {
              document.documentElement.classList.add("dark");
            } else {
              document.documentElement.classList.remove("dark");
            }
          },
        }));
      });
    </script>
    <!-- Alpine.js CDN (放在邏輯定義之後) -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>
  <body
    class="bg-slate-50 dark:bg-slate-950 font-sans text-slate-800 dark:text-slate-100 transition-colors duration-300"
    x-data="cocktailApp()"
    x-init="init()"
  >
    <div class="flex min-h-screen relative">
      <!-- --- 平板/電腦版 側邊選單 --- -->
      <aside
        class="bg-slate-900 text-white w-72 shrink-0 h-screen top-0 flex-col p-6 flex transition-all z-40 fixed md:sticky"
        x-show="isSidebarOpen"
        x-cloak
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="-translate-x-full opacity-0"
        x-transition:enter-end="translate-x-0 opacity-100"
        x-transition:leave="transition ease-in duration-300"
        x-transition:leave-start="translate-x-0 opacity-100"
        x-transition:leave-end="-translate-x-full opacity-0"
      >
        <div class="flex justify-between items-center mb-10">
          <div
            @click="activeTab = 'home'"
            class="flex items-center gap-3 cursor-pointer group"
          >
            <div
              class="bg-amber-500 p-2 rounded-lg group-hover:rotate-12 transition text-slate-900"
            >
              <i data-lucide="wine"></i>
            </div>
            <div>
              <h1 class="text-lg font-black tracking-tight" x-text="barName">
                居家調酒實驗室
              </h1>
              <p
                class="text-slate-400 text-[9px] uppercase tracking-widest font-bold"
                x-text="bartenderName"
              ></p>
            </div>
          </div>
          <button
            @click="isSidebarOpen = false"
            class="text-slate-400 hover:text-white transition"
          >
            <i data-lucide="chevrons-left"></i>
          </button>
        </div>

        <nav class="space-y-2 flex-1 overflow-y-auto no-scrollbar pr-2">
          <template x-for="tab in navigation" :key="tab.id">
            <button
              @click="activeTab = tab.id"
              :class="(activeTab === tab.id || (tab.id === 'ingredients' && ['spirits', 'modifiers', 'tools', 'glassware'].includes(activeTab)) || (tab.id === 'laboratory' && ['recipes', 'bar', 'favorites', 'menu'].includes(activeTab))) ? 'bg-amber-500 text-slate-900 shadow-lg' : 'text-slate-400 hover:bg-slate-800 hover:text-white'"
              class="w-full px-5 py-4 rounded-2xl font-bold text-sm flex items-center gap-4 transition-all"
            >
              <i :data-lucide="tab.icon" class="w-5 h-5"></i>
              <span x-text="tab.label"></span>
            </button>
          </template>
        </nav>
      </aside>

      <!-- --- 漢堡選單按鈕 (當側邊欄隱藏時顯示) --- -->
      <button
        class="fixed top-6 left-6 z-50 bg-slate-900 text-white p-3 rounded-xl shadow-xl hover:bg-slate-800 transition hover:scale-110 print:hidden"
        x-show="!isSidebarOpen"
        @click="isSidebarOpen = true"
        x-cloak
      >
        <i data-lucide="menu"></i>
      </button>

      <!-- --- 主內容區域 --- -->
      <div
        class="flex-1 min-w-0 bg-slate-50 dark:bg-slate-950 transition-colors duration-300"
      >
        <main
          class="max-w-7xl mx-auto p-4 md:p-8 lg:p-10 pb-48 md:pb-10 transition-all duration-300"
          :class="!isSidebarOpen ? 'md:pt-24' : ''"
        >
          <!-- === 首頁 === -->
          <div
            x-show="activeTab === 'home'"
            class="space-y-10 animate-fade-in"
            x-cloak
          >
            <div
              class="bg-slate-900 dark:bg-slate-900 text-white rounded-[2rem] p-6 md:p-10 lg:p-16 shadow-2xl relative overflow-hidden flex flex-col lg:flex-row items-center gap-10"
            >
              <div class="relative z-10 flex-1 text-center lg:text-left">
                <div
                  class="bg-amber-500/10 text-amber-500 text-xs font-black px-3 py-1 rounded-full w-fit mx-auto lg:mx-0 mb-4 uppercase tracking-widest"
                >
                  入門指南
                </div>
                <h2 class="text-4xl lg:text-6xl font-black mb-6 leading-tight">
                  探索無限可能的<br /><span class="text-amber-500"
                    >微醺藝術</span
                  >
                </h2>
                <p class="mb-8 text-slate-400 text-lg max-w-xl mx-auto lg:mx-0">
                  想喝一杯好的雞尾酒，不一定要走進昂貴的酒吧，我們相信最好的酒吧，就是你家的客廳。<br /><br />我們為所有熱愛生活的朋友，打造了一個最親民的調酒指南。無論你是剛買下第一支琴酒的初學者，還是追求派對驚喜的居家調酒師，這裡都有你需要的靈感。
                </p>
                <div
                  class="flex flex-wrap justify-center lg:justify-start gap-4"
                >
                  <button
                    @click="activeTab = 'bar'"
                    class="bg-amber-500 hover:bg-amber-400 text-slate-900 font-black py-4 px-10 rounded-2xl transition-all hover:scale-105 shadow-xl shadow-amber-500/20"
                  >
                    進入我的吧檯
                  </button>
                  <button
                    @click="activeTab = 'collection'"
                    class="bg-slate-800 hover:bg-slate-700 text-white font-black py-4 px-10 rounded-2xl transition-all"
                  >
                    管理我的酒櫃
                  </button>
                </div>
              </div>
              <div
                class="relative w-64 lg:w-96 h-64 lg:h-96 flex items-center justify-center"
              >
                <div
                  class="absolute inset-0 bg-amber-500/20 blur-[100px] rounded-full"
                ></div>
                <i
                  data-lucide="wine"
                  class="w-48 h-48 lg:w-64 lg:h-64 text-amber-500 relative z-10 drop-shadow-2xl"
                ></i>
              </div>
            </div>

            <!-- 我的待買清單 -->
            <div x-show="shoppingList.length > 0" class="animate-fade-in">
              <h3
                class="text-2xl font-black mb-6 flex items-center gap-3 text-slate-800 dark:text-white"
              >
                <i data-lucide="list-todo" class="text-amber-500"></i>
                我的待買清單
              </h3>
              <div
                class="bg-white dark:bg-slate-900 rounded-3xl p-8 border border-slate-200 dark:border-slate-800 shadow-sm mb-10"
              >
                <div class="space-y-3">
                  <template
                    x-for="(item, index) in shoppingList"
                    :key="item.id"
                  >
                    <div
                      class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 group transition hover:border-amber-200 dark:hover:border-amber-800"
                    >
                      <div class="flex items-center gap-3">
                        <input
                          type="checkbox"
                          x-model="item.checked"
                          class="w-5 h-5 rounded text-amber-500 focus:ring-amber-500 border-slate-300 cursor-pointer"
                          @change="saveData()"
                        />
                        <span
                          :class="item.checked ? 'line-through text-slate-400' : 'text-slate-700 dark:text-slate-200 font-bold'"
                          x-text="item.name"
                        ></span>
                      </div>
                      <button
                        @click="removeFromShoppingList(index)"
                        class="text-slate-400 hover:text-red-500 transition p-2 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-xl"
                      >
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                      </button>
                    </div>
                  </template>
                </div>
              </div>
            </div>

            <!-- 500元攻略 -->
            <div class="grid lg:grid-cols-3 gap-8">
              <div
                class="lg:col-span-2 bg-white dark:bg-slate-900 rounded-3xl p-8 border border-slate-200 dark:border-slate-800 shadow-sm"
              >
                <h3
                  class="text-2xl font-black mb-6 flex items-center gap-3 text-slate-800 dark:text-white"
                >
                  <i data-lucide="shopping-bag" class="text-amber-500"></i> 新手
                  500 元採購清單
                </h3>
                <div class="grid sm:grid-cols-2 gap-4">
                  <template x-for="item in shopItems">
                    <div
                      class="flex justify-between items-center p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 font-bold text-slate-700 dark:text-slate-200"
                    >
                      <div class="flex items-center gap-3">
                        <i
                          :data-lucide="item.icon"
                          class="w-4 h-4 text-slate-400"
                        ></i>
                        <span x-text="item.name"></span>
                      </div>
                      <div
                        class="font-black text-amber-600"
                        x-text="'$' + item.price"
                      ></div>
                    </div>
                  </template>
                  <div
                    class="sm:col-span-2 mt-2 p-5 bg-green-50 dark:bg-green-900/20 border border-green-100 dark:border-green-900 rounded-2xl flex justify-between items-center font-black"
                  >
                    <span class="text-green-800 dark:text-green-400"
                      >總計預算控制</span
                    >
                    <span class="text-2xl text-green-600">$470</span>
                  </div>
                </div>
              </div>
              <div
                class="bg-amber-600 dark:bg-amber-700 text-white rounded-3xl p-8 flex flex-col justify-between shadow-xl"
              >
                <div>
                  <h3 class="text-2xl font-black mb-4 flex items-center gap-2">
                    <i data-lucide="info"></i> 學習秘訣
                  </h3>
                  <p class="text-amber-100 font-medium leading-relaxed italic">
                    「冰塊」是調酒中最便宜卻也最重要的材料。超市購買的硬冰塊，能極大減少融水量，維持酒體香氣不被稀釋。
                  </p>
                </div>
                <button
                  @click="activeTab = 'spirits'"
                  class="mt-6 w-full py-3 bg-white/10 hover:bg-white/20 rounded-xl font-bold transition"
                >
                  查看基酒百科 →
                </button>
              </div>
            </div>
          </div>

          <!-- === 調酒材料 (Ingredients Hub) === -->
          <div
            x-show="activeTab === 'ingredients'"
            class="space-y-10 animate-fade-in"
            x-cloak
          >
            <div>
              <h2 class="text-4xl font-black text-slate-900 dark:text-white">
                調酒材料
              </h2>
              <p class="text-slate-500 mt-2 text-lg">
                工欲善其事，必先利其器。認識這些構成微醺的靈魂元素。
              </p>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
              <!-- 六大基酒 Card -->
              <div
                @click="activeTab = 'spirits'"
                class="bg-white dark:bg-slate-900 p-8 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 hover:border-amber-400 dark:hover:border-amber-400 cursor-pointer group transition-all hover:shadow-xl relative overflow-hidden"
              >
                <div
                  class="absolute top-0 right-0 p-10 opacity-10 group-hover:opacity-20 transition-opacity"
                >
                  <i data-lucide="wine" class="w-32 h-32 text-amber-500"></i>
                </div>
                <div class="relative z-10">
                  <div
                    class="w-14 h-14 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="wine" class="w-8 h-8"></i>
                  </div>
                  <h3
                    class="text-2xl font-black text-slate-900 dark:text-white mb-2"
                  >
                    六大基酒百科
                  </h3>
                  <p
                    class="text-slate-500 dark:text-slate-400 font-medium mb-6"
                  >
                    琴酒、伏特加、威士忌、蘭姆酒、龍舌蘭、白蘭地。<br />探索這六位調酒世界的基石。
                  </p>
                  <span
                    class="text-amber-600 dark:text-amber-400 font-bold flex items-center gap-2 group-hover:gap-4 transition-all"
                  >
                    前往探索 <i data-lucide="arrow-right" class="w-4 h-4"></i>
                  </span>
                </div>
              </div>

              <!-- 調味與裝飾 Card -->
              <div
                @click="activeTab = 'modifiers'"
                class="bg-white dark:bg-slate-900 p-8 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 hover:border-green-400 dark:hover:border-green-400 cursor-pointer group transition-all hover:shadow-xl relative overflow-hidden"
              >
                <div
                  class="absolute top-0 right-0 p-10 opacity-10 group-hover:opacity-20 transition-opacity"
                >
                  <i data-lucide="leaf" class="w-32 h-32 text-green-500"></i>
                </div>
                <div class="relative z-10">
                  <div
                    class="w-14 h-14 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="leaf" class="w-8 h-8"></i>
                  </div>
                  <h3
                    class="text-2xl font-black text-slate-900 dark:text-white mb-2"
                  >
                    調味與裝飾
                  </h3>
                  <p
                    class="text-slate-500 dark:text-slate-400 font-medium mb-6"
                  >
                    利口酒、糖漿、果汁、苦精與裝飾物。<br />讓調酒風味與視覺更上一層樓的魔法。
                  </p>
                  <span
                    class="text-green-600 dark:text-green-400 font-bold flex items-center gap-2 group-hover:gap-4 transition-all"
                  >
                    前往探索 <i data-lucide="arrow-right" class="w-4 h-4"></i>
                  </span>
                </div>
              </div>

              <!-- 杯具 Card -->
              <div
                @click="activeTab = 'glassware'"
                class="bg-white dark:bg-slate-900 p-8 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 hover:border-purple-400 dark:hover:border-purple-400 cursor-pointer group transition-all hover:shadow-xl relative overflow-hidden"
              >
                <div
                  class="absolute top-0 right-0 p-10 opacity-10 group-hover:opacity-20 transition-opacity"
                >
                  <i
                    data-lucide="martini"
                    class="w-32 h-32 text-purple-500"
                  ></i>
                </div>
                <div class="relative z-10">
                  <div
                    class="w-14 h-14 bg-purple-100 dark:bg-purple-900/30 text-purple-600 dark:text-purple-400 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="martini" class="w-8 h-8"></i>
                  </div>
                  <h3
                    class="text-2xl font-black text-slate-900 dark:text-white mb-2"
                  >
                    杯具百科
                  </h3>
                  <p
                    class="text-slate-500 dark:text-slate-400 font-medium mb-6"
                  >
                    杯具是熱力學的控制器、香氣的擴大器，以及美學的展示台。
                  </p>
                  <span
                    class="text-purple-600 dark:text-purple-400 font-bold flex items-center gap-2 group-hover:gap-4 transition-all"
                  >
                    前往探索 <i data-lucide="arrow-right" class="w-4 h-4"></i>
                  </span>
                </div>
              </div>

              <!-- 工具 Card -->
              <div
                @click="activeTab = 'tools'"
                class="bg-white dark:bg-slate-900 p-8 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 hover:border-blue-400 dark:hover:border-blue-400 cursor-pointer group transition-all hover:shadow-xl relative overflow-hidden"
              >
                <div
                  class="absolute top-0 right-0 p-10 opacity-10 group-hover:opacity-20 transition-opacity"
                >
                  <i data-lucide="hammer" class="w-32 h-32 text-blue-500"></i>
                </div>
                <div class="relative z-10">
                  <div
                    class="w-14 h-14 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-400 rounded-2xl flex items-center justify-center mb-6 group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="hammer" class="w-8 h-8"></i>
                  </div>
                  <h3
                    class="text-2xl font-black text-slate-900 dark:text-white mb-2"
                  >
                    必備工具
                  </h3>
                  <p
                    class="text-slate-500 dark:text-slate-400 font-medium mb-6"
                  >
                    雪克杯、量酒器、吧叉匙。<br />工欲善其事，必先利其器。
                  </p>
                  <span
                    class="text-blue-600 dark:text-blue-400 font-bold flex items-center gap-2 group-hover:gap-4 transition-all"
                  >
                    前往探索 <i data-lucide="arrow-right" class="w-4 h-4"></i>
                  </span>
                </div>
              </div>
            </div>
          </div>

          <!-- === 實驗室 (Laboratory Hub) === -->
          <div
            x-show="activeTab === 'laboratory'"
            class="space-y-10 animate-fade-in"
            x-cloak
          >
            <div>
              <h2 class="text-4xl font-black text-slate-900 dark:text-white">
                實驗室
              </h2>
              <p class="text-slate-500 mt-2 text-lg">
                這裡是你施展魔法的地方。管理酒譜、庫存與派對酒單。
              </p>
            </div>

            <div class="grid md:grid-cols-2 gap-6">
              <!-- AI Bartender Card -->
              <div
                @click="isAiModalOpen = true"
                class="bg-gradient-to-br from-indigo-600 to-purple-700 text-white p-8 rounded-[2rem] shadow-lg border border-indigo-500 hover:scale-[1.02] cursor-pointer group transition-all relative overflow-hidden md:col-span-2"
              >
                <div class="absolute top-0 right-0 p-8 opacity-20 group-hover:opacity-30 transition-opacity">
                  <i data-lucide="bot" class="w-48 h-48 text-white"></i>
                </div>
                <div class="relative z-10 flex flex-col h-full justify-between">
                  <div>
                    <div class="w-12 h-12 bg-white/20 backdrop-blur rounded-2xl flex items-center justify-center mb-4 group-hover:rotate-12 transition-transform">
                      <i data-lucide="sparkles" class="w-6 h-6 text-yellow-300"></i>
                    </div>
                    <h3 class="text-3xl font-black mb-2">AI 智能調酒師</h3>
                    <p class="text-indigo-100 font-medium text-lg max-w-md">
                      不知道喝什麼？讓 AI 根據您目前的庫存 (清冰箱模式)，為您現場發明一杯專屬特調與故事。
                    </p>
                  </div>
                  <div class="mt-8 flex items-center gap-2 font-bold text-yellow-300">
                    <span>立即體驗</span> <i data-lucide="arrow-right" class="w-5 h-5"></i>
                  </div>
                </div>
              </div>

              <!-- 酒譜庫 Card -->
              <div
                @click="activeTab = 'recipes'"
                class="bg-white dark:bg-slate-900 p-8 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 hover:border-amber-400 dark:hover:border-amber-400 cursor-pointer group transition-all hover:shadow-xl relative overflow-hidden"
              >
                <div
                  class="absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity"
                >
                  <i data-lucide="search" class="w-32 h-32 text-amber-500"></i>
                </div>
                <div class="relative z-10">
                  <div
                    class="w-12 h-12 bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="search" class="w-6 h-6"></i>
                  </div>
                  <h3
                    class="text-2xl font-black text-slate-900 dark:text-white mb-2"
                  >
                    完整酒譜庫
                  </h3>
                  <p
                    class="text-slate-500 dark:text-slate-400 font-medium mb-4"
                  >
                    瀏覽所有經典與現代調酒配方，尋找您的下一杯靈感。
                  </p>
                  <span
                    class="text-amber-600 dark:text-amber-400 font-bold flex items-center gap-2 group-hover:gap-4 transition-all"
                  >
                    進入酒譜庫 <i data-lucide="arrow-right" class="w-4 h-4"></i>
                  </span>
                </div>
              </div>

              <!-- 吧檯 Card -->
              <div
                @click="activeTab = 'bar'"
                class="bg-white dark:bg-slate-900 p-8 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 hover:border-green-400 dark:hover:border-green-400 cursor-pointer group transition-all hover:shadow-xl relative overflow-hidden"
              >
                <div
                  class="absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity"
                >
                  <i data-lucide="martini" class="w-32 h-32 text-green-500"></i>
                </div>
                <div class="relative z-10">
                  <div
                    class="w-12 h-12 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-400 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="martini" class="w-6 h-6"></i>
                  </div>
                  <h3
                    class="text-2xl font-black text-slate-900 dark:text-white mb-2"
                  >
                    我的吧檯
                  </h3>
                  <p
                    class="text-slate-500 dark:text-slate-400 font-medium mb-4"
                  >
                    管理現有材料，查看目前可調製的酒譜。
                  </p>
                  <span
                    class="text-green-600 dark:text-green-400 font-bold flex items-center gap-2 group-hover:gap-4 transition-all"
                  >
                    進入吧檯 <i data-lucide="arrow-right" class="w-4 h-4"></i>
                  </span>
                </div>
              </div>

              <!-- 我的最愛 Card -->
              <div
                @click="activeTab = 'favorites'"
                class="bg-white dark:bg-slate-900 p-8 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 hover:border-red-400 dark:hover:border-red-400 cursor-pointer group transition-all hover:shadow-xl relative overflow-hidden"
              >
                <div
                  class="absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity"
                >
                  <i data-lucide="heart" class="w-32 h-32 text-red-500"></i>
                </div>
                <div class="relative z-10">
                  <div
                    class="w-12 h-12 bg-red-100 dark:bg-red-900/30 text-red-500 dark:text-red-400 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="heart" class="w-6 h-6"></i>
                  </div>
                  <h3
                    class="text-2xl font-black text-slate-900 dark:text-white mb-2"
                  >
                    我的最愛
                  </h3>
                  <p
                    class="text-slate-500 dark:text-slate-400 font-medium mb-4"
                  >
                    查看您收藏的精選酒譜清單。
                  </p>
                  <span
                    class="text-red-500 dark:text-red-400 font-bold flex items-center gap-2 group-hover:gap-4 transition-all"
                  >
                    查看收藏 <i data-lucide="arrow-right" class="w-4 h-4"></i>
                  </span>
                </div>
              </div>

              <!-- 派對酒單 Card -->
              <div
                @click="activeTab = 'menu'"
                class="bg-white dark:bg-slate-900 p-8 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 hover:border-blue-400 dark:hover:border-blue-400 cursor-pointer group transition-all hover:shadow-xl relative overflow-hidden"
              >
                <div
                  class="absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity"
                >
                  <i
                    data-lucide="clipboard-list"
                    class="w-32 h-32 text-blue-500"
                  ></i>
                </div>
                <div class="relative z-10">
                  <div
                    class="w-12 h-12 bg-blue-100 dark:bg-blue-900/30 text-blue-500 dark:text-blue-400 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform"
                  >
                    <i data-lucide="clipboard-list" class="w-6 h-6"></i>
                  </div>
                  <h3
                    class="text-2xl font-black text-slate-900 dark:text-white mb-2"
                  >
                    派對酒單
                  </h3>
                  <p
                    class="text-slate-500 dark:text-slate-400 font-medium mb-4"
                  >
                    從可調製的酒譜中勾選，產生一份專屬的今日特調菜單。
                  </p>
                  <span
                    class="text-blue-500 dark:text-blue-400 font-bold flex items-center gap-2 group-hover:gap-4 transition-all"
                  >
                    建立酒單 <i data-lucide="arrow-right" class="w-4 h-4"></i>
                  </span>
                </div>
              </div>

              <!-- IBA Official Cocktails Card -->
              <a
                href="https://iba-world.com/cocktails/all-cocktails/"
                target="_blank"
                rel="noopener noreferrer"
                class="md:col-span-2 bg-white dark:bg-slate-900 p-8 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 hover:border-purple-400 dark:hover:border-purple-400 cursor-pointer group transition-all hover:shadow-xl relative overflow-hidden"
              >
                <div class="absolute top-0 right-0 p-8 opacity-10 group-hover:opacity-20 transition-opacity">
                  <i data-lucide="globe" class="w-32 h-32 text-purple-500"></i>
                </div>
                <div class="relative z-10">
                  <div class="w-12 h-12 bg-purple-100 dark:bg-purple-900/30 text-purple-500 dark:text-purple-400 rounded-2xl flex items-center justify-center mb-4 group-hover:scale-110 transition-transform">
                    <i data-lucide="globe" class="w-6 h-6"></i>
                  </div>
                  <h3 class="text-2xl font-black text-slate-900 dark:text-white mb-2">IBA 官方酒譜</h3>
                  <p class="text-slate-500 dark:text-slate-400 font-medium mb-4">
                    前往國際調酒師協會 (IBA) 網站，探索官方認證的經典酒譜。
                  </p>
                  <span class="text-purple-500 dark:text-purple-400 font-bold flex items-center gap-2 group-hover:gap-4 transition-all">
                    開啟外部連結 <i data-lucide="external-link" class="w-4 h-4"></i>
                  </span>
                </div>
              </a>
            </div>
          </div>

          <!-- === 基酒百科 === -->
          <div
            x-show="activeTab === 'spirits'"
            class="space-y-12 animate-fade-in"
            x-cloak
          >
            <!-- Header -->
            <div>
              <button
                @click="activeTab = 'ingredients'"
                class="mb-4 text-slate-500 hover:text-amber-500 font-bold flex items-center gap-1 transition"
              >
                <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回調酒材料
              </button>
              <h2 class="text-4xl font-black text-slate-900 dark:text-white">
                《六大基酒全書》
              </h2>
              <p class="text-slate-500 mt-2 text-lg">
                依照國際烈酒認證 (WSET Level 2 Spirits)
                標準架構，並結合調酒師實務觀點所撰寫的深度解構。
              </p>
            </div>

            <!-- Grid of Cards -->
            <div class="grid md:grid-cols-2 gap-6">
              <template x-for="spirit in spiritsData" :key="spirit.id">
                <div
                  x-data="{ expanded: false }"
                  class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 hover:border-amber-400 dark:hover:border-amber-400 transition-all flex flex-col"
                >
                  <!-- Card Header -->
                  <div class="flex items-center gap-4 mb-4">
                    <div
                      class="w-14 h-14 rounded-2xl flex items-center justify-center shrink-0"
                      :class="spirit.color"
                    >
                      <i :data-lucide="spirit.icon" class="w-8 h-8"></i>
                    </div>
                    <div>
                      <h3
                        class="text-xl font-black text-slate-800 dark:text-white"
                        x-text="spirit.name.split(' ')[0]"
                      ></h3>
                      <p
                        class="text-xs text-slate-500 dark:text-slate-400 font-bold"
                        x-text="spirit.title"
                      ></p>
                    </div>
                  </div>

                  <!-- Intro -->
                  <div
                    class="text-slate-600 dark:text-slate-400 text-sm leading-relaxed mb-6"
                    :class="!expanded ? 'line-clamp-3' : ''"
                    x-html="spirit.intro"
                  ></div>

                  <!-- Buttons -->
                  <div class="flex gap-3 mt-auto">
                    <button
                      @click="activeTab = 'collection'; searchQuery = spirit.name.split(' ')[0]"
                      class="flex-1 bg-amber-500 text-slate-900 py-3 rounded-xl font-black text-sm hover:bg-amber-400 transition flex items-center justify-center gap-2 shadow-lg shadow-amber-500/20"
                    >
                      <i data-lucide="archive" class="w-4 h-4"></i> 查看酒櫃
                    </button>
                    <button
                      @click="expanded = !expanded"
                      class="flex-1 bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 py-3 rounded-xl font-black text-sm hover:bg-slate-200 dark:hover:bg-slate-700 transition flex items-center justify-center gap-2"
                    >
                      <i
                        :data-lucide="expanded ? 'chevron-up' : 'book-open'"
                        class="w-4 h-4"
                      ></i>
                      <span x-text="expanded ? '收起百科' : '閱讀百科'"></span>
                    </button>
                  </div>

                  <!-- Expanded Content (Encyclopedia) -->
                  <div
                    x-show="expanded"
                    x-transition
                    class="mt-6 pt-6 border-t border-slate-100 dark:border-slate-800 space-y-8"
                  >
                    <template x-for="section in spirit.sections">
                      <div class="space-y-4">
                        <h4
                          class="text-lg font-bold text-slate-700 dark:text-slate-300"
                          x-text="section.title"
                        ></h4>
                        <p
                          x-show="section.content"
                          x-html="section.content"
                          class="text-slate-600 dark:text-slate-400 leading-relaxed text-sm"
                        ></p>
                        <p
                          x-show="section.intro"
                          x-html="section.intro"
                          class="text-slate-600 dark:text-slate-400 leading-relaxed text-sm"
                        ></p>

                        <!-- Points -->
                        <dl x-show="section.points" class="space-y-3 text-sm">
                          <template x-for="point in section.points">
                            <div
                              class="flex flex-col md:flex-row gap-1 md:gap-3"
                            >
                              <dt
                                class="font-bold text-amber-600 dark:text-amber-400 shrink-0 md:w-32 md:text-right"
                                x-text="point.name"
                              ></dt>
                              <dd
                                class="text-slate-600 dark:text-slate-400 leading-relaxed md:pl-3 md:border-l-2 md:border-slate-200 dark:md:border-slate-700"
                                x-html="point.desc"
                              ></dd>
                            </div>
                          </template>
                        </dl>

                        <!-- Subsections -->
                        <div x-show="section.subsections" class="space-y-4">
                          <template x-for="subsection in section.subsections">
                            <div
                              class="p-4 bg-slate-50 dark:bg-slate-800/50 rounded-xl border border-slate-200 dark:border-slate-800"
                            >
                              <h5
                                class="text-base font-black text-slate-800 dark:text-white mb-2"
                                x-text="subsection.title"
                              ></h5>
                              <p
                                x-show="subsection.intro"
                                x-html="subsection.intro"
                                class="text-slate-600 dark:text-slate-400 leading-relaxed text-xs mb-2"
                              ></p>
                              <dl
                                x-show="subsection.points"
                                class="space-y-2 text-xs"
                              >
                                <template x-for="point in subsection.points">
                                  <div
                                    class="flex flex-col md:flex-row gap-1 md:gap-2"
                                  >
                                    <dt
                                      class="font-bold text-amber-600 dark:text-amber-400 shrink-0 md:w-24 md:text-right"
                                      x-text="point.name"
                                    ></dt>
                                    <dd
                                      class="text-slate-600 dark:text-slate-400 leading-relaxed"
                                      x-html="point.desc"
                                    ></dd>
                                  </div>
                                </template>
                              </dl>
                              <div
                                x-show="subsection.notes"
                                class="mt-3 pt-3 border-t border-slate-200 dark:border-slate-700"
                              >
                                <h6
                                  class="text-xs font-bold text-slate-500 dark:text-slate-400 mb-1"
                                  x-text="subsection.notesTitle || '註記：'"
                                ></h6>
                                <ul
                                  class="list-disc list-inside space-y-1 text-xs text-slate-600 dark:text-slate-400"
                                >
                                  <template x-for="note in subsection.notes">
                                    <li x-html="note"></li>
                                  </template>
                                </ul>
                              </div>
                            </div>
                          </template>
                        </div>
                      </div>
                    </template>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- === 調味 === -->
          <div
            x-show="activeTab === 'modifiers'"
            class="space-y-6 animate-fade-in"
            x-cloak
          >
            <button
              @click="activeTab = 'ingredients'"
              class="text-slate-500 hover:text-amber-500 font-bold flex items-center gap-1 transition"
            >
              <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回調酒材料
            </button>
            <div
              class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
            >
              <div>
                <h2 class="text-2xl font-bold text-slate-900 dark:text-white">
                  調味與裝飾
                </h2>
                <p class="text-slate-500">
                  讓調酒進化到「好喝又好看」的秘密武器。
                </p>
              </div>
              <button
                @click="isModifierFormOpen = true"
                class="flex items-center gap-2 bg-amber-500 text-slate-900 px-4 py-2 rounded-lg font-bold shadow-md hover:bg-amber-400 transition text-sm"
              >
                <i data-lucide="plus" class="w-4 h-4"></i> 新增自訂調味
              </button>
            </div>
            <template x-for="(category, catIndex) in modifiers">
              <div
                class="bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden"
              >
                <div
                  class="p-4 bg-slate-50 dark:bg-slate-800 border-b dark:border-slate-700 flex items-center gap-3"
                >
                  <div
                    class="p-2 bg-white dark:bg-slate-700 rounded-full shadow-sm"
                  >
                    <i
                      :data-lucide="category.iconType"
                      class="w-5 h-5 text-amber-600"
                    ></i>
                  </div>
                  <h3
                    class="font-bold text-slate-800 dark:text-white"
                    x-text="category.category"
                  ></h3>
                </div>
                <div class="p-4 grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                  <template x-for="item in category.items">
                    <div
                      class="flex gap-2 items-start p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-lg transition relative group"
                    >
                      <div
                        class="mt-1.5 w-1.5 h-1.5 rounded-full bg-amber-400 shrink-0"
                      ></div>
                      <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                          <span
                            class="font-bold text-slate-800 dark:text-slate-200 text-sm"
                            x-text="item.name"
                          ></span>
                          <span
                            class="text-[10px] px-1.5 py-0.5 rounded-full border bg-slate-100 dark:bg-slate-700 dark:border-slate-600 text-slate-500 dark:text-slate-400"
                            x-text="item.tag"
                          ></span>
                        </div>
                        <p
                          class="text-xs text-slate-600 dark:text-slate-400"
                          x-text="item.desc"
                        ></p>
                      </div>
                      <button
                        @click="deleteModifier(catIndex, item.id)"
                        class="absolute right-2 top-2 text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition p-1"
                        title="刪除"
                      >
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                      </button>
                    </div>
                  </template>
                </div>
              </div>
            </template>
          </div>

          <!-- === 工具百科 === -->
          <div
            x-show="activeTab === 'tools'"
            class="space-y-12 animate-fade-in"
            x-cloak
          >
            <div>
              <button
                @click="activeTab = 'ingredients'"
                class="mb-4 text-slate-500 hover:text-amber-500 font-bold flex items-center gap-1 transition"
              >
                <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回調酒材料
              </button>
              <h2
                class="text-4xl font-black text-slate-900 dark:text-white mb-2"
              >
                調酒工具全書
              </h2>
              <p class="text-slate-500 text-lg font-medium">
                地毯式的調酒工具清單，涵蓋從基礎操作到進階職人所需的每一項裝備。
              </p>
            </div>

            <template x-for="(arsenal, index) in toolsData" :key="index">
              <div class="space-y-8">
                <!-- Arsenal Header -->
                <div
                  class="flex items-center gap-4 pb-4 border-b-2 border-dashed border-slate-200 dark:border-slate-800"
                >
                  <div
                    class="w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-2xl flex items-center justify-center shrink-0"
                  >
                    <i
                      :data-lucide="arsenal.icon"
                      class="w-8 h-8 text-amber-500"
                    ></i>
                  </div>
                  <div>
                    <h3
                      class="text-2xl font-black text-slate-800 dark:text-white"
                      x-text="arsenal.category"
                    ></h3>
                    <p
                      class="text-slate-500 dark:text-slate-400"
                      x-text="arsenal.categoryDesc"
                    ></p>
                  </div>
                </div>

                <!-- Groups in Arsenal -->
                <div class="space-y-8">
                  <template x-for="group in arsenal.groups">
                    <div class="pl-0 md:pl-8">
                      <h4
                        class="text-xl font-bold text-slate-700 dark:text-slate-300 mb-4"
                        x-text="group.groupName"
                      ></h4>
                      <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <template x-for="tool in group.items">
                          <div
                            class="bg-white dark:bg-slate-900 p-6 rounded-3xl shadow-sm border border-slate-200 dark:border-slate-800 flex flex-col"
                          >
                            <h5
                              class="text-lg font-black text-slate-900 dark:text-white mb-4"
                              x-text="tool.name"
                            ></h5>
                            <dl class="space-y-3 text-xs">
                              <template x-for="(text, label) in tool.points">
                                <div class="flex gap-3">
                                  <dt
                                    class="font-bold text-amber-600 dark:text-amber-400 shrink-0 w-16 text-right"
                                    x-text="label"
                                  ></dt>
                                  <dd
                                    class="text-slate-600 dark:text-slate-400 leading-relaxed"
                                    x-text="text"
                                  ></dd>
                                </div>
                              </template>
                            </dl>
                          </div>
                        </template>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </template>
          </div>

          <!-- === 杯具百科 === -->
          <div
            x-show="activeTab === 'glassware'"
            class="space-y-12 animate-fade-in"
            x-cloak
          >
            <!-- Header -->
            <div>
              <button
                @click="activeTab = 'ingredients'"
                class="mb-4 text-slate-500 hover:text-amber-500 font-bold flex items-center gap-1 transition"
              >
                <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回調酒材料
              </button>
              <h2 class="text-4xl font-black text-slate-900 dark:text-white">
                杯具百科全書
              </h2>
              <p
                class="text-slate-500 mt-2 text-lg"
                x-html="glasswareData.intro"
              ></p>
            </div>

            <!-- Intro -->
            <div
              class="p-6 md:p-8 bg-white dark:bg-slate-900 rounded-3xl border-2 border-dashed border-slate-200 dark:border-slate-800"
            >
              <h3
                class="text-xl font-black text-slate-800 dark:text-white mb-4"
              >
                導論：杯具的三大物理功能
              </h3>
              <div class="grid md:grid-cols-3 gap-6">
                <template x-for="func in glasswareData.functions">
                  <div class="flex items-start gap-3">
                    <div
                      class="w-8 h-8 bg-amber-100 text-amber-600 rounded-lg flex items-center justify-center shrink-0 mt-1"
                    >
                      <i data-lucide="check" class="w-5 h-5"></i>
                    </div>
                    <div>
                      <h4
                        class="font-bold text-slate-700 dark:text-slate-200"
                        x-text="func.name"
                      ></h4>
                      <p
                        class="text-xs text-slate-500 dark:text-slate-400"
                        x-text="func.desc"
                      ></p>
                    </div>
                  </div>
                </template>
              </div>
            </div>

            <!-- Loop through systems -->
            <template
              x-for="system in glasswareData.systems"
              :key="system.name"
            >
              <div class="space-y-8">
                <!-- System Header -->
                <div
                  class="flex items-center gap-4 pb-4 border-b-2 border-dashed border-slate-200 dark:border-slate-800"
                >
                  <div
                    class="w-16 h-16 bg-slate-100 dark:bg-slate-800 rounded-2xl flex items-center justify-center shrink-0"
                  >
                    <i
                      :data-lucide="system.icon"
                      class="w-8 h-8 text-amber-500"
                    ></i>
                  </div>
                  <div>
                    <h3
                      class="text-2xl font-black text-slate-800 dark:text-white"
                      x-text="system.name"
                    ></h3>
                    <p
                      class="text-slate-500 dark:text-slate-400"
                      x-text="system.logic"
                    ></p>
                  </div>
                </div>
                <!-- Glasses in System -->
                <div
                  class="pl-0 md:pl-8 grid md:grid-cols-2 lg:grid-cols-3 gap-6"
                >
                  <template x-for="glass in system.glasses">
                    <div
                      class="bg-white dark:bg-slate-900 p-6 rounded-3xl shadow-sm border border-slate-200 dark:border-slate-800 flex flex-col"
                    >
                      <h5
                        class="text-lg font-black text-slate-900 dark:text-white mb-4"
                        x-text="glass.name"
                      ></h5>
                      <dl class="space-y-3 text-xs">
                        <template x-for="(text, label) in glass.details">
                          <div class="flex gap-3">
                            <dt
                              class="font-bold text-amber-600 dark:text-amber-400 shrink-0 w-16 text-right"
                              x-text="label"
                            ></dt>
                            <dd
                              class="text-slate-600 dark:text-slate-400 leading-relaxed whitespace-pre-line"
                              x-text="text"
                            ></dd>
                          </div>
                        </template>
                      </dl>
                    </div>
                  </template>
                </div>
              </div>
            </template>
          </div>

          <!-- === 酒譜庫 === -->
          <div
            x-show="activeTab === 'recipes'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <button
              @click="activeTab = 'laboratory'"
              class="text-slate-500 hover:text-amber-500 font-bold flex items-center gap-1 transition"
            >
              <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回實驗室
            </button>
            <div
              class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
            >
              <div>
                <h2 class="text-4xl font-black text-slate-900 dark:text-white">
                  完整酒譜庫
                </h2>
                <p class="text-slate-500 mt-2 text-lg">
                  瀏覽所有經典與現代調酒配方，尋找您的下一杯靈感。
                </p>
              </div>
              <div class="flex gap-3 w-full md:w-auto">
                <div class="relative flex-1 md:w-64">
                  <i
                    data-lucide="search"
                    class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"
                  ></i>
                  <input
                    type="text"
                    placeholder="搜尋酒譜..."
                    class="w-full pl-10 pr-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-sm font-bold focus:outline-none focus:border-amber-500 transition"
                    x-model="searchQuery"
                  />
                </div>
                <button
                  @click="openAddRecipeModal()"
                  class="bg-amber-500 text-slate-900 px-6 py-3 rounded-xl font-black shadow-lg hover:bg-amber-400 transition flex items-center gap-2 shrink-0"
                >
                  <i data-lucide="plus" class="w-5 h-5"></i>
                  <span class="hidden sm:inline">新增</span>
                </button>
              </div>
            </div>

            <!-- 篩選器 -->
            <div
              class="bg-white dark:bg-slate-900 p-4 rounded-2xl border border-slate-200 dark:border-slate-800 flex flex-wrap gap-4 items-center shadow-sm"
            >
              <div class="flex items-center gap-2 w-full md:w-auto">
                <i data-lucide="filter" class="w-4 h-4 text-amber-500"></i>
                <span
                  class="text-xs font-black uppercase tracking-widest text-slate-400"
                  >篩選</span
                >
              </div>

              <select
                x-model="filterBase"
                class="bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold rounded-lg py-2 pl-3 pr-8 focus:ring-2 focus:ring-amber-500 outline-none cursor-pointer text-slate-700 dark:text-slate-200 w-full md:w-auto"
              >
                <option value="all">所有基酒</option>
                <template x-for="spirit in spiritsData" :key="spirit.id">
                  <option :value="spirit.id" x-text="spirit.name"></option>
                </template>
              </select>

              <select
                x-model="filterDifficulty"
                class="bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold rounded-lg py-2 pl-3 pr-8 focus:ring-2 focus:ring-amber-500 outline-none cursor-pointer text-slate-700 dark:text-slate-200 w-full md:w-auto"
              >
                <option value="all">所有難度</option>
                <option value="1">難度 ★</option>
                <option value="2">難度 ★★</option>
                <option value="3">難度 ★★★</option>
                <option value="4">難度 ★★★★</option>
                <option value="5">難度 ★★★★★</option>
              </select>

              <select
                x-model="filterStyle"
                class="bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold rounded-lg py-2 pl-3 pr-8 focus:ring-2 focus:ring-amber-500 outline-none cursor-pointer text-slate-700 dark:text-slate-200 w-full md:w-auto"
              >
                <option value="all">所有風格</option>
                <template x-for="tag in commonTags" :key="tag">
                  <option :value="tag" x-text="tag"></option>
                </template>
              </select>

              <button
                x-show="filterBase !== 'all' || filterDifficulty !== 'all' || filterStyle !== 'all' || searchQuery !== ''"
                @click="filterBase = 'all'; filterDifficulty = 'all'; filterStyle = 'all'; searchQuery = ''"
                class="text-xs font-bold text-red-500 hover:text-red-600 flex items-center gap-1 w-full md:w-auto justify-center md:justify-start md:ml-auto"
              >
                <i data-lucide="x-circle" class="w-3 h-3"></i> 清除篩選
              </button>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              <template x-for="recipe in filteredRecipes" :key="recipe.id">
                <div
                  @click="openRecipeDetail(recipe)"
                  class="bg-white dark:bg-slate-900 rounded-[2rem] p-6 shadow-sm border border-slate-200 dark:border-slate-800 hover:border-amber-400 dark:hover:border-amber-400 transition-all group h-full flex flex-col cursor-pointer hover:scale-[1.02]"
                >
                  <div class="flex justify-between items-start mb-2">
                    <div
                      class="p-3 bg-amber-100 text-amber-600 rounded-2xl group-hover:scale-110 transition-transform"
                    >
                      <i data-lucide="glass-water" class="w-6 h-6"></i>
                    </div>
                    <div class="flex items-center gap-2">
                      <button
                        @click.stop="toggleFavorite(recipe.id)"
                        class="transition p-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800"
                        :class="favoriteRecipes.includes(recipe.id) ? 'text-red-500' : 'text-slate-300 hover:text-red-400'"
                      >
                        <i
                          data-lucide="heart"
                          class="w-5 h-5"
                          :class="favoriteRecipes.includes(recipe.id) ? 'fill-current' : ''"
                        ></i>
                      </button>
                      <button
                        @click.stop="openNoteModal(recipe)"
                        class="text-slate-300 hover:text-amber-500 transition p-1 hover:bg-amber-50 dark:hover:bg-amber-900/30 rounded-lg"
                        title="評分與筆記"
                      >
                        <i
                          data-lucide="notebook-pen"
                          class="w-4 h-4"
                          :class="recipe.myRating || recipe.myNotes ? 'text-amber-500 fill-amber-500' : ''"
                        ></i>
                      </button>
                      <button
                        @click.stop="shareRecipe(recipe)"
                        class="text-slate-300 hover:text-blue-500 transition p-1 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg"
                        title="分享酒譜"
                      >
                        <i data-lucide="share-2" class="w-4 h-4"></i>
                      </button>
                      <button
                        @click.stop="openJournalModal(recipe)"
                        class="text-slate-300 hover:text-green-500 transition p-1 hover:bg-green-50 dark:hover:bg-green-900/30 rounded-lg"
                        title="紀錄飲酒"
                      >
                        <i data-lucide="calendar-plus" class="w-4 h-4"></i>
                      </button>
                      <button
                        @click.stop="generateRecipeImage(recipe)"
                        class="text-slate-300 hover:text-purple-500 transition p-1 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded-lg"
                        title="下載酒譜卡片"
                      >
                        <i data-lucide="image-down" class="w-4 h-4"></i>
                      </button>
                      <button
                        @click.stop="editRecipe(recipe)"
                        class="text-slate-300 hover:text-amber-500 transition p-1 hover:bg-amber-50 dark:hover:bg-amber-900/30 rounded-lg"
                        title="編輯酒譜"
                      >
                        <i data-lucide="pencil" class="w-4 h-4"></i>
                      </button>
                      <button
                        @click.stop="deleteRecipe(recipe.id)"
                        class="text-slate-300 hover:text-red-500 transition p-1 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg"
                        title="刪除酒譜"
                      >
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                      </button>
                    </div>
                  </div>

                  <div class="mb-3">
                    <span
                      class="text-[10px] font-bold text-amber-600 bg-amber-50 dark:bg-amber-900/30 dark:text-amber-400 px-2 py-1 rounded border border-amber-100 dark:border-amber-800"
                      x-text="recipe.category"
                    ></span>
                  </div>

                  <h3
                    class="text-2xl font-black text-slate-800 dark:text-white mb-1"
                    x-text="recipe.name"
                  ></h3>

                  <div
                    class="flex gap-4 mb-4 text-xs font-bold text-slate-500 dark:text-slate-400"
                  >
                    <div class="flex items-center gap-1">
                      <i data-lucide="flame" class="w-3 h-3"></i>
                      <span x-text="recipe.abv"></span>
                    </div>
                    <div class="flex items-center gap-1">
                      <i
                        data-lucide="star"
                        class="w-3 h-3 text-amber-400 fill-amber-400"
                      ></i>
                      <span x-text="recipe.difficulty + '/5'"></span>
                    </div>
                    <div
                      class="flex items-center gap-1"
                      x-show="recipe.myRating"
                    >
                      <i
                        data-lucide="thumbs-up"
                        class="w-3 h-3 text-green-500"
                      ></i>
                      <span
                        class="text-green-600 dark:text-green-400"
                        x-text="'我的評分: ' + recipe.myRating"
                      ></span>
                    </div>
                  </div>

                  <p
                    class="text-sm font-bold text-slate-700 dark:text-slate-300 mb-1"
                    x-text="recipe.flavor"
                  ></p>
                  <p
                    class="text-xs text-slate-500 dark:text-slate-400 mb-4 leading-relaxed"
                    x-text="recipe.features"
                  ></p>

                  <div class="flex-1">
                    <div
                      class="mb-4 bg-slate-50 dark:bg-slate-800 rounded-xl p-3 border border-slate-100 dark:border-slate-700"
                    >
                      <h4
                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                      >
                        材料清單
                      </h4>
                      <div class="space-y-1.5">
                        <template x-for="ing in recipe.ingredients">
                          <div
                            class="flex justify-between items-center text-xs"
                          >
                            <span
                              class="font-bold text-slate-700 dark:text-slate-300 flex items-center gap-1"
                              :class="myIngredients.includes(ing.id) ? 'text-green-600 dark:text-green-400' : ''"
                            >
                              <i
                                x-show="myIngredients.includes(ing.id)"
                                data-lucide="check"
                                class="w-3 h-3"
                              ></i>
                              <span x-text="getIngredientName(ing.id)"></span>
                            </span>
                            <span
                              class="text-slate-500 dark:text-slate-400 font-mono font-bold"
                              x-text="convertAmount(ing.amount)"
                            ></span>
                          </div>
                        </template>
                      </div>
                    </div>
                    <!-- 舊版材料標籤 (隱藏或移除，改用上方清單) -->
                    <!-- <div class="flex flex-wrap gap-2 mb-6">
                      <template x-for="ing in recipe.ingredients">
                        <span
                          class="px-3 py-1.5 rounded-xl text-xs font-bold border transition-colors"
                          :class="myIngredients.includes(ing.id) ? 'bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800' : 'bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 border-slate-100 dark:border-slate-700'"
                          x-text="getIngredientName(ing.id)"
                        ></span>
                      </template>
                    </div> -->
                  </div>

                  <div class="mb-4 flex-1">
                    <h4
                      class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                    >
                      調製步驟
                    </h4>
                    <ol
                      class="list-decimal list-inside text-xs text-slate-600 dark:text-slate-400 space-y-1 font-medium"
                    >
                      <template x-for="step in recipe.steps">
                        <li x-text="convertStep(step)"></li>
                      </template>
                    </ol>
                  </div>

                  <div
                    class="bg-slate-50 dark:bg-slate-800 rounded-2xl p-4 mt-auto"
                  >
                    <div class="flex items-center gap-2 text-slate-400 mb-2">
                      <i data-lucide="lightbulb" class="w-4 h-4"></i>
                      <span
                        class="text-[10px] font-black uppercase tracking-widest"
                        >調製秘訣</span
                      >
                    </div>
                    <p
                      class="text-sm text-slate-600 dark:text-slate-300 font-medium"
                      x-text="recipe.tips"
                    ></p>
                  </div>

                  <!-- My Notes -->
                  <div
                    x-show="recipe.myNotes"
                    class="mt-4 bg-amber-50 dark:bg-amber-900/20 rounded-2xl p-4 border border-amber-100 dark:border-amber-900/30"
                  >
                    <div
                      class="flex items-center gap-2 text-amber-600 dark:text-amber-500 mb-2"
                    >
                      <i data-lucide="pen-tool" class="w-3 h-3"></i>
                      <span
                        class="text-[10px] font-black uppercase tracking-widest"
                        >我的筆記</span
                      >
                    </div>
                    <p
                      class="text-xs text-slate-700 dark:text-slate-300 font-medium whitespace-pre-line"
                      x-text="recipe.myNotes"
                    ></p>
                  </div>

                  <!-- Tags -->
                  <div
                    class="flex flex-wrap gap-1 mt-4 pt-4 border-t border-slate-100 dark:border-slate-800"
                  >
                    <template x-for="tag in recipe.tags">
                      <span
                        class="text-[10px] font-bold text-slate-400 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-lg"
                        x-text="'#'+tag"
                      ></span>
                    </template>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- === 我的最愛 === -->
          <div
            x-show="activeTab === 'favorites'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <button
              @click="activeTab = 'laboratory'"
              class="text-slate-500 hover:text-amber-500 font-bold flex items-center gap-1 transition"
            >
              <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回實驗室
            </button>
            <div
              class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
            >
              <div>
                <h2 class="text-4xl font-black text-slate-900 dark:text-white">
                  我的最愛
                </h2>
                <p class="text-slate-500 mt-2 text-lg">
                  您收藏的精選酒譜清單。
                </p>
              </div>
            </div>

            <div
              x-show="favoriteRecipeList.length === 0"
              class="text-center py-20 bg-white dark:bg-slate-900 rounded-[2.5rem] border-2 border-dashed border-slate-200 dark:border-slate-800"
            >
              <i
                data-lucide="heart-off"
                class="w-16 h-16 mx-auto text-slate-200 mb-6"
              ></i>
              <h3 class="text-2xl font-black text-slate-400">
                還沒有收藏任何酒譜
              </h3>
              <button
                @click="activeTab = 'recipes'"
                class="text-amber-600 font-black hover:underline mt-4"
              >
                前往酒譜庫探索
              </button>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              <template x-for="recipe in favoriteRecipeList" :key="recipe.id">
                <div
                  @click="openRecipeDetail(recipe)"
                  class="bg-white dark:bg-slate-900 rounded-[2rem] p-6 shadow-sm border border-slate-200 dark:border-slate-800 hover:border-amber-400 dark:hover:border-amber-400 transition-all group h-full flex flex-col cursor-pointer hover:scale-[1.02]"
                >
                  <div class="flex justify-between items-start mb-2">
                    <div
                      class="p-3 bg-red-50 text-red-500 rounded-2xl group-hover:scale-110 transition-transform"
                    >
                      <i data-lucide="heart" class="w-6 h-6 fill-current"></i>
                    </div>
                    <div class="flex items-center gap-2">
                      <button
                        @click.stop="toggleFavorite(recipe.id)"
                        class="text-red-500 hover:text-slate-300 transition p-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800"
                        title="取消收藏"
                      >
                        <i data-lucide="heart" class="w-5 h-5 fill-current"></i>
                      </button>
                      <button
                        @click.stop="openNoteModal(recipe)"
                        class="text-slate-300 hover:text-amber-500 transition p-1 hover:bg-amber-50 dark:hover:bg-amber-900/30 rounded-lg"
                        title="評分與筆記"
                      >
                        <i
                          data-lucide="notebook-pen"
                          class="w-4 h-4"
                          :class="recipe.myRating || recipe.myNotes ? 'text-amber-500 fill-amber-500' : ''"
                        ></i>
                      </button>
                      <button
                        @click.stop="shareRecipe(recipe)"
                        class="text-slate-300 hover:text-blue-500 transition p-1 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg"
                        title="分享酒譜"
                      >
                        <i data-lucide="share-2" class="w-4 h-4"></i>
                      </button>
                      <button
                        @click.stop="openJournalModal(recipe)"
                        class="text-slate-300 hover:text-green-500 transition p-1 hover:bg-green-50 dark:hover:bg-green-900/30 rounded-lg"
                        title="紀錄飲酒"
                      >
                        <i data-lucide="calendar-plus" class="w-4 h-4"></i>
                      </button>
                      <button
                        @click.stop="generateRecipeImage(recipe)"
                        class="text-slate-300 hover:text-purple-500 transition p-1 hover:bg-purple-50 dark:hover:bg-purple-900/30 rounded-lg"
                        title="下載酒譜卡片"
                      >
                        <i data-lucide="image-down" class="w-4 h-4"></i>
                      </button>
                      <button
                        @click.stop="editRecipe(recipe)"
                        class="text-slate-300 hover:text-amber-500 transition p-1 hover:bg-amber-50 dark:hover:bg-amber-900/30 rounded-lg"
                      >
                        <i data-lucide="pencil" class="w-4 h-4"></i>
                      </button>
                    </div>
                  </div>

                  <div class="mb-3">
                    <span
                      class="text-[10px] font-bold text-amber-600 bg-amber-50 dark:bg-amber-900/30 dark:text-amber-400 px-2 py-1 rounded border border-amber-100 dark:border-amber-800"
                      x-text="recipe.category"
                    ></span>
                  </div>

                  <h3
                    class="text-2xl font-black text-slate-800 dark:text-white mb-1"
                    x-text="recipe.name"
                  ></h3>

                  <div
                    class="flex gap-4 mb-4 text-xs font-bold text-slate-500 dark:text-slate-400"
                  >
                    <div class="flex items-center gap-1">
                      <i data-lucide="flame" class="w-3 h-3"></i>
                      <span x-text="recipe.abv"></span>
                    </div>
                    <div class="flex items-center gap-1">
                      <i
                        data-lucide="star"
                        class="w-3 h-3 text-amber-400 fill-amber-400"
                      ></i>
                      <span x-text="recipe.difficulty + '/5'"></span>
                    </div>
                    <div
                      class="flex items-center gap-1"
                      x-show="recipe.myRating"
                    >
                      <i
                        data-lucide="thumbs-up"
                        class="w-3 h-3 text-green-500"
                      ></i>
                      <span
                        class="text-green-600 dark:text-green-400"
                        x-text="'我的評分: ' + recipe.myRating"
                      ></span>
                    </div>
                  </div>

                  <p
                    class="text-sm font-bold text-slate-700 dark:text-slate-300 mb-1"
                    x-text="recipe.flavor"
                  ></p>
                  <p
                    class="text-xs text-slate-500 dark:text-slate-400 mb-4 leading-relaxed"
                    x-text="recipe.features"
                  ></p>

                  <div class="flex-1">
                    <div
                      class="mb-4 bg-slate-50 dark:bg-slate-800 rounded-xl p-3 border border-slate-100 dark:border-slate-700"
                    >
                      <h4
                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                      >
                        材料清單
                      </h4>
                      <div class="space-y-1.5">
                        <template x-for="ing in recipe.ingredients">
                          <div
                            class="flex justify-between items-center text-xs"
                          >
                            <span
                              class="font-bold text-slate-700 dark:text-slate-300 flex items-center gap-1"
                              :class="myIngredients.includes(ing.id) ? 'text-green-600 dark:text-green-400' : ''"
                            >
                              <i
                                x-show="myIngredients.includes(ing.id)"
                                data-lucide="check"
                                class="w-3 h-3"
                              ></i>
                              <span x-text="getIngredientName(ing.id)"></span>
                            </span>
                            <span
                              class="text-slate-500 dark:text-slate-400 font-mono font-bold"
                              x-text="convertAmount(ing.amount)"
                            ></span>
                          </div>
                        </template>
                      </div>
                    </div>
                  </div>

                  <div class="mb-4 flex-1">
                    <h4
                      class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                    >
                      調製步驟
                    </h4>
                    <ol
                      class="list-decimal list-inside text-xs text-slate-600 dark:text-slate-400 space-y-1 font-medium"
                    >
                      <template x-for="step in recipe.steps">
                        <li x-text="convertStep(step)"></li>
                      </template>
                    </ol>
                  </div>

                  <div
                    class="bg-slate-50 dark:bg-slate-800 rounded-2xl p-4 mt-auto"
                  >
                    <div class="flex items-center gap-2 text-slate-400 mb-2">
                      <i data-lucide="lightbulb" class="w-4 h-4"></i>
                      <span
                        class="text-[10px] font-black uppercase tracking-widest"
                        >調製秘訣</span
                      >
                    </div>
                    <p
                      class="text-sm text-slate-600 dark:text-slate-300 font-medium"
                      x-text="recipe.tips"
                    ></p>
                  </div>

                  <!-- My Notes -->
                  <div
                    x-show="recipe.myNotes"
                    class="mt-4 bg-amber-50 dark:bg-amber-900/20 rounded-2xl p-4 border border-amber-100 dark:border-amber-900/30"
                  >
                    <div
                      class="flex items-center gap-2 text-amber-600 dark:text-amber-500 mb-2"
                    >
                      <i data-lucide="pen-tool" class="w-3 h-3"></i>
                      <span
                        class="text-[10px] font-black uppercase tracking-widest"
                        >我的筆記</span
                      >
                    </div>
                    <p
                      class="text-xs text-slate-700 dark:text-slate-300 font-medium whitespace-pre-line"
                      x-text="recipe.myNotes"
                    ></p>
                  </div>

                  <div
                    class="flex flex-wrap gap-1 mt-4 pt-4 border-t border-slate-100 dark:border-slate-800"
                  >
                    <template x-for="tag in recipe.tags">
                      <span
                        class="text-[10px] font-bold text-slate-400 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-lg"
                        x-text="'#'+tag"
                      ></span>
                    </template>
                  </div>
                  <button
                    @click.stop="openRecipeDetail(recipe)"
                    class="mt-6 w-full py-3 rounded-2xl font-black text-sm transition bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-200 dark:hover:bg-slate-700"
                  >
                    查看詳細步驟
                  </button>
                </div>
              </template>
            </div>
          </div>

          <!-- === 吧檯 === -->
          <div
            x-show="activeTab === 'bar'"
            class="space-y-6 animate-fade-in"
            x-cloak
          >
            <button
              @click="activeTab = 'laboratory'"
              class="text-slate-500 hover:text-amber-500 font-bold flex items-center gap-1 transition"
            >
              <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回實驗室
            </button>
            <div class="grid xl:grid-cols-4 gap-8">
              <div class="xl:col-span-1 space-y-4">
                <div
                  class="bg-white dark:bg-slate-900 p-6 rounded-3xl shadow-sm border border-slate-200 dark:border-slate-800 static xl:sticky xl:top-10"
                >
                  <div
                    class="flex justify-between items-center mb-4 border-b pb-4"
                  >
                    <h3 class="font-black flex items-center gap-2 text-xl">
                      <i data-lucide="check" class="text-green-500"></i>
                      我的吧檯
                    </h3>
                  </div>

                  <div class="grid grid-cols-2 gap-2 mb-6">
                    <button
                      @click="openAddBottleModal()"
                      class="bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 py-2 rounded-xl text-xs font-black flex items-center justify-center gap-1 transition"
                    >
                      <i data-lucide="wine" class="w-3 h-3"></i> + 酒藏
                    </button>
                    <button
                      @click="isModifierFormOpen = true"
                      class="bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 py-2 rounded-xl text-xs font-black flex items-center justify-center gap-1 transition"
                    >
                      <i data-lucide="leaf" class="w-3 h-3"></i> + 調味
                    </button>
                  </div>

                  <div
                    class="space-y-8 overflow-y-auto max-h-[60vh] pr-2 custom-scrollbar"
                  >
                    <template
                      x-for="(items, category) in getRecipeIngredientsGrouped()"
                      :key="category"
                    >
                      <div>
                        <h4
                          class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3"
                          x-text="category"
                        ></h4>
                        <div class="space-y-1.5">
                          <template x-for="item in items" :key="item.id">
                            <label
                              class="flex items-center space-x-3 cursor-pointer p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition group"
                            >
                              <div
                                class="w-5 h-5 rounded-lg border-2 flex items-center justify-center transition-all"
                                :class="myIngredients.includes(item.id) ? 'bg-amber-500 border-amber-500 text-slate-900 shadow-lg' : 'border-slate-200 dark:border-slate-700'"
                              >
                                <i
                                  x-show="myIngredients.includes(item.id)"
                                  data-lucide="check"
                                  class="w-3 h-3 stroke-[4]"
                                ></i>
                              </div>
                              <input
                                type="checkbox"
                                class="hidden"
                                :value="item.id"
                                @change="toggleIngredient(item.id)"
                                :checked="myIngredients.includes(item.id)"
                              />
                              <span
                                class="text-sm font-bold"
                                :class="myIngredients.includes(item.id) ? 'text-slate-900 dark:text-white' : 'text-slate-500 dark:text-slate-500'"
                                x-text="item.name"
                              ></span>
                            </label>
                          </template>
                        </div>
                      </div>
                    </template>
                  </div>
                </div>
              </div>
              <div class="xl:col-span-3 space-y-12">
                <!-- Ready to Drink -->
                <div x-show="getReadyRecipes().length > 0">
                  <h3
                    class="font-black flex items-center gap-3 text-2xl mb-6 text-green-600 dark:text-green-400"
                  >
                    <i data-lucide="party-popper"></i>
                    現有材料可調製
                  </h3>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <template x-for="recipe in getReadyRecipes()">
                      <div
                        @click="openRecipeDetail(recipe)"
                        class="p-6 rounded-3xl border-2 transition-all flex flex-col justify-between bg-white dark:bg-slate-900 border-green-200 dark:border-green-900 shadow-lg cursor-pointer hover:scale-[1.02]"
                      >
                        <div>
                          <div class="flex justify-between items-start mb-4">
                            <div>
                              <h4
                                class="font-black text-xl text-slate-800 dark:text-white"
                                x-text="recipe.name"
                              ></h4>
                              <p
                                class="text-xs text-slate-500 font-bold"
                                x-text="recipe.flavor"
                              ></p>
                            </div>
                            <div
                              class="bg-green-500 text-white text-[10px] font-black px-3 py-1 rounded-full"
                            >
                              Ready
                            </div>
                          </div>
                        </div>
                        <button
                          @click.stop="openRecipeDetail(recipe)"
                          class="mt-6 w-full py-3 rounded-2xl font-black text-sm transition bg-slate-900 dark:bg-amber-500 dark:text-slate-900 text-white hover:bg-slate-800"
                        >
                          查看詳細步驟
                        </button>
                      </div>
                    </template>
                  </div>
                </div>

                <!-- Near Miss -->
                <div x-show="getNearMissRecipes().length > 0">
                  <h3
                    class="font-black flex items-center gap-3 text-2xl mb-6 text-amber-600 dark:text-amber-400"
                  >
                    <i data-lucide="sparkles"></i>
                    只缺一項！推薦嘗試
                  </h3>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <template x-for="recipe in getNearMissRecipes()">
                      <div
                        @click="openRecipeDetail(recipe)"
                        class="p-6 rounded-3xl border-2 transition-all flex flex-col justify-between bg-amber-50 dark:bg-amber-900/10 border-amber-200 dark:border-amber-800 cursor-pointer hover:scale-[1.02]"
                      >
                        <div>
                          <div class="flex justify-between items-start mb-4">
                            <div>
                              <h4
                                class="font-black text-xl text-slate-800 dark:text-white"
                                x-text="recipe.name"
                              ></h4>
                              <p
                                class="text-xs text-slate-500 font-bold"
                                x-text="recipe.flavor"
                              ></p>
                            </div>
                            <div
                              class="bg-amber-400 text-white text-[10px] font-black px-3 py-1 rounded-full"
                            >
                              缺 1 項
                            </div>
                          </div>
                          <div
                            class="bg-white dark:bg-slate-900 p-3 rounded-xl border border-amber-100 dark:border-amber-900 flex justify-between items-center gap-2"
                          >
                            <div
                              class="text-xs font-bold text-amber-600 dark:text-amber-400"
                            >
                              缺少：<span
                                x-text="getMissingNames(recipe.missing)"
                              ></span>
                            </div>
                            <button
                              @click.stop="addToShoppingList(recipe.missing)"
                              class="text-[10px] bg-amber-100 hover:bg-amber-200 dark:bg-amber-900 dark:hover:bg-amber-800 text-amber-800 dark:text-amber-200 px-2 py-1 rounded-lg font-black transition flex items-center gap-1 shrink-0"
                            >
                              <i data-lucide="plus" class="w-3 h-3"></i>
                              加入清單
                            </button>
                          </div>
                        </div>
                        <button
                          @click.stop="openRecipeDetail(recipe)"
                          class="mt-6 w-full py-3 rounded-2xl font-black text-sm transition bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700"
                        >
                          查看詳細步驟
                        </button>
                      </div>
                    </template>
                  </div>
                </div>

                <!-- Others -->
                <div x-show="getOtherRecipes().length > 0">
                  <h3
                    class="font-black flex items-center gap-3 text-xl mb-6 text-slate-500"
                  >
                    <i data-lucide="search"></i>
                    探索更多酒譜
                  </h3>
                  <div class="grid grid-cols-1 md:grid-cols-2 gap-6 opacity-75">
                    <template x-for="recipe in getOtherRecipes()">
                      <div
                        @click="openRecipeDetail(recipe)"
                        class="p-6 rounded-3xl border-2 transition-all flex flex-col justify-between bg-slate-100 dark:bg-slate-800 border-slate-200 dark:border-slate-700 cursor-pointer hover:scale-[1.02]"
                      >
                        <div>
                          <div class="flex justify-between items-start mb-4">
                            <div>
                              <h4
                                class="font-black text-xl text-slate-800 dark:text-white"
                                x-text="recipe.name"
                              ></h4>
                              <p
                                class="text-xs text-slate-500 font-bold"
                                x-text="recipe.flavor"
                              ></p>
                            </div>
                            <div
                              class="bg-slate-300 text-slate-700 text-[10px] font-black px-3 py-1 rounded-full"
                              x-text="'缺 ' + recipe.missing.length + ' 項'"
                            ></div>
                          </div>
                          <div
                            class="bg-red-50 dark:bg-red-900/20 p-3 rounded-xl border border-red-100 dark:border-red-900 flex justify-between items-center gap-2"
                          >
                            <div
                              class="text-xs font-bold text-red-600 dark:text-red-400"
                            >
                              缺少：<span
                                x-text="getMissingNames(recipe.missing)"
                              ></span>
                            </div>
                            <button
                              @click.stop="addToShoppingList(recipe.missing)"
                              class="text-[10px] bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:hover:bg-red-800 text-red-700 dark:text-red-300 px-2 py-1 rounded-lg font-black transition flex items-center gap-1 shrink-0"
                            >
                              <i data-lucide="plus" class="w-3 h-3"></i>
                              加入清單
                            </button>
                          </div>
                        </div>
                        <button
                          @click.stop="openRecipeDetail(recipe)"
                          class="mt-6 w-full py-3 rounded-2xl font-black text-sm transition bg-slate-200 dark:bg-slate-700 text-slate-400 dark:text-slate-500"
                        >
                          查看詳細步驟
                        </button>
                      </div>
                    </template>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- === 酒櫃 === -->
          <div
            x-show="activeTab === 'collection'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <div
              class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
            >
              <div>
                <h2 class="text-4xl font-black text-slate-900 dark:text-white">
                  我的私人酒櫃
                </h2>
                <div x-show="myBottles.length > 0" class="flex items-center gap-2 mt-2 text-slate-500">
                    <i data-lucide="piggy-bank" class="w-5 h-5"></i>
                    <span class="font-bold">總資產價值：</span>
                    <span class="font-black text-amber-600 text-lg" x-text="'$' + totalAssetValue.toLocaleString()"></span>
                </div>
              </div>
              <div class="flex gap-3 w-full md:w-auto">
                <div class="relative flex-1 md:w-64">
                  <i
                    data-lucide="search"
                    class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"
                  ></i>
                  <input
                    type="text"
                    placeholder="搜尋收藏..."
                    class="w-full pl-10 pr-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-sm font-bold focus:outline-none focus:border-amber-500 transition"
                    x-model="searchQuery"
                  />
                </div>
                <button
                  @click="openAddBottleModal()"
                  class="bg-amber-500 text-slate-900 px-6 py-3 rounded-xl font-black shadow-xl hover:scale-105 transition flex items-center gap-2 shrink-0"
                >
                  <i data-lucide="plus" class="w-5 h-5"></i>
                  <span class="hidden sm:inline">入庫</span>
                </button>
              </div>
            </div>

            <!-- 酒櫃篩選器 -->
            <div class="bg-white dark:bg-slate-900 p-4 rounded-2xl border border-slate-200 dark:border-slate-800 flex flex-wrap gap-4 items-center shadow-sm">
              <div class="flex items-center gap-2 w-full md:w-auto">
                <i data-lucide="filter" class="w-4 h-4 text-amber-500"></i>
                <span class="text-xs font-black uppercase tracking-widest text-slate-400">篩選與排序</span>
              </div>

              <select x-model="filterBottleType" class="bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold rounded-lg py-2 pl-3 pr-8 focus:ring-2 focus:ring-amber-500 outline-none cursor-pointer text-slate-700 dark:text-slate-200 w-full md:w-auto">
                <option value="all">所有類型</option>
                <template x-for="type in availableBottleTypes" :key="type.id">
                    <option :value="type.id" x-text="type.name"></option>
                </template>
              </select>
              
              <select x-model="sortBottleBy" class="bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold rounded-lg py-2 pl-3 pr-8 focus:ring-2 focus:ring-amber-500 outline-none cursor-pointer text-slate-700 dark:text-slate-200 w-full md:w-auto">
                <option value="date_desc">最新購入</option>
                <option value="date_asc">最舊購入</option>
                <option value="price_desc">價格 (高→低)</option>
                <option value="price_asc">價格 (低→高)</option>
                <option value="rating_desc">評分 (高→低)</option>
              </select>

               <button x-show="filterBottleType !== 'all' || sortBottleBy !== 'date_desc'" @click="filterBottleType = 'all'; sortBottleBy = 'date_desc'" class="text-xs font-bold text-red-500 hover:text-red-600 flex items-center gap-1 w-full md:w-auto justify-center md:justify-start md:ml-auto">
                <i data-lucide="x-circle" class="w-3 h-3"></i>
                重置
              </button>
            </div>
            <div
              x-show="myBottles.length === 0"
              class="text-center py-32 bg-white dark:bg-slate-900 rounded-[2.5rem] border-2 border-dashed border-slate-200 dark:border-slate-800"
            >
              <i
                data-lucide="wine"
                class="w-16 h-16 mx-auto text-slate-200 mb-6 text-slate-300"
              ></i>
              <h3 class="text-2xl font-black text-slate-400">目前沒有收藏</h3>
              <button
                @click="openAddBottleModal()"
                class="text-amber-600 font-black hover:underline mt-4"
              >
                ＋ 立即新增
              </button>
            </div>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              <template x-for="bottle in filteredBottles" :key="bottle.id">
                <div
                  class="bg-white dark:bg-slate-900 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden flex flex-col hover:shadow-2xl transition-all"
                >
                  <div
                    class="p-6 border-b dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/50 flex justify-between items-start"
                  >
                    <div>
                      <span
                        class="text-[10px] font-black text-amber-600 bg-amber-50 px-2 py-0.5 rounded-lg border border-amber-200 uppercase"
                        x-text="getIngredientName(bottle.typeId)"
                      ></span>
                      <h3
                        class="text-xl font-black text-slate-800 dark:text-white mt-2"
                        x-text="bottle.name"
                      ></h3>
                      <p
                        class="text-xs text-slate-400 font-bold mt-1"
                        x-show="bottle.brand"
                        x-text="bottle.brand"
                      ></p>
                    </div>
                    <div
                      class="text-lg font-black text-amber-600"
                      x-text="'$' + bottle.price"
                    ></div>
                  </div>
                  <div class="p-6 flex-1 space-y-4">
                    <div
                      class="flex flex-wrap gap-1"
                      x-show="bottle.tags && bottle.tags.length"
                    >
                      <template x-for="tag in bottle.tags">
                        <span
                          class="text-[10px] bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 px-2 py-1 rounded-lg font-bold"
                          x-text="'#'+tag"
                        ></span>
                      </template>
                    </div>

                    <div
                      class="flex flex-wrap gap-x-4 gap-y-2 text-xs text-slate-500 dark:text-slate-400 border-b border-slate-100 dark:border-slate-800 pb-3"
                      x-show="bottle.location || bottle.features || bottle.purchaseDate"
                    >
                      <div
                        x-show="bottle.location"
                        class="flex items-center gap-1"
                      >
                        <i data-lucide="map-pin" class="w-3 h-3"></i>
                        <span x-text="bottle.location"></span>
                      </div>
                      <div
                        x-show="bottle.purchaseDate"
                        class="flex items-center gap-1"
                      >
                        <i data-lucide="calendar" class="w-3 h-3"></i>
                        <span x-text="bottle.purchaseDate"></span>
                      </div>
                      <div x-show="bottle.features" class="w-full">
                        <span
                          class="font-bold text-amber-600 bg-amber-50 dark:bg-amber-900/30 dark:text-amber-400 px-1 rounded"
                          >特色</span
                        >
                        <span x-text="bottle.features"></span>
                      </div>
                    </div>

                    <div class="py-1">
                      <div class="flex justify-between items-end mb-1">
                        <span
                          class="text-[10px] font-black text-slate-400 uppercase tracking-widest"
                          >剩餘庫存</span
                        >
                        <span
                          class="text-xs font-bold"
                          :class="bottle.remaining < 30 ? 'text-red-500' : 'text-slate-600 dark:text-slate-400'"
                        >
                          <span x-text="bottle.remaining + '%'"></span>
                          <span class="text-slate-400 font-normal" x-text="' ≈ ' + Math.round((bottle.volume || 750) * bottle.remaining / 100) + 'ml'"></span>
                        </span>
                      </div>
                      <input
                        type="range"
                        min="0"
                        max="100"
                        step="10"
                        class="w-full h-1.5 bg-slate-100 dark:bg-slate-800 rounded-lg appearance-none cursor-pointer accent-amber-500"
                        x-model="bottle.remaining"
                        title="調整剩餘量"
                      />
                    </div>

                    <div
                      class="bg-slate-50 dark:bg-slate-800 p-4 rounded-2xl text-xs text-slate-600 dark:text-slate-400 font-medium italic"
                      x-text="'&quot;' + (bottle.notes || '尚未輸入筆記...') + '&quot;'"
                    ></div>
                    <div class="flex gap-1 justify-end">
                      <template x-for="i in 5">
                        <i
                          data-lucide="star"
                          class="w-3 h-3"
                          :class="i <= bottle.rating ? 'text-amber-400 fill-amber-400' : 'text-slate-200 dark:text-slate-700'"
                        ></i>
                      </template>
                    </div>
                  </div>
                  <div
                    class="p-4 bg-slate-50/50 dark:bg-slate-800/50 border-t dark:border-slate-800 flex justify-end"
                  >
                    <button
                      @click="editBottle(bottle)"
                      class="text-slate-300 hover:text-amber-500 transition-all p-2 rounded-xl hover:bg-amber-50 mr-2"
                    >
                      <i data-lucide="pencil" class="w-4 h-4"></i>
                    </button>
                    <button
                      @click="deleteBottle(bottle.id)"
                      class="text-slate-300 hover:text-red-500 transition-all p-2 rounded-xl hover:bg-red-50"
                    >
                      <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- === 喝什麼 (輪盤) === -->
          <div
            x-show="activeTab === 'roulette'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <div class="text-center mb-8">
              <h2
                class="text-4xl font-black text-slate-900 dark:text-white mb-2"
              >
                派對喝酒輪盤
              </h2>
              <p class="text-slate-500 text-lg">
                刺激的派對遊戲，看看幸運女神眷顧誰！
              </p>
            </div>

            <div
              class="flex flex-col items-center justify-center relative min-h-[500px]"
            >
              <!-- 指針 -->
              <div
                class="absolute top-0 left-1/2 -translate-x-1/2 z-20 text-slate-800 dark:text-white drop-shadow-xl translate-y-8"
              >
                <i
                  data-lucide="chevron-down"
                  class="w-12 h-12 fill-current"
                ></i>
              </div>

              <!-- 輪盤本體 -->
              <div class="relative w-80 h-80 md:w-96 md:h-96">
                <div
                  class="w-full h-full rounded-full overflow-hidden shadow-2xl border-8 border-slate-900 dark:border-slate-700 relative transition-transform duration-[3000ms] ease-out"
                  :style="`transform: rotate(${rouletteRotation}deg); background: conic-gradient(${getRouletteGradient()})`"
                >
                  <!-- 選項標籤 -->
                  <template x-for="(item, index) in rouletteCandidates">
                    <div
                      class="absolute top-0 left-1/2 w-1 h-1/2 origin-bottom flex justify-center pt-4"
                      :style="`transform: translateX(-50%) rotate(${index * (360/rouletteCandidates.length) + (360/rouletteCandidates.length)/2}deg)`"
                    >
                      <div
                        class="text-xs md:text-sm font-black text-slate-900 writing-vertical-rl h-32 text-center truncate drop-shadow-md"
                        style="writing-mode: vertical-rl"
                      >
                        <span x-text="item.name"></span>
                      </div>
                    </div>
                  </template>
                </div>

                <!-- 中心裝飾 -->
                <div
                  class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-20 h-20 bg-slate-900 dark:bg-slate-800 rounded-full z-10 flex items-center justify-center text-white shadow-lg border-4 border-white dark:border-slate-600"
                >
                  <i data-lucide="dices" class="w-10 h-10 text-amber-500"></i>
                </div>
              </div>

              <!-- 控制按鈕 -->
              <div class="mt-12 flex gap-6">
                <button
                  @click="spinRoulette()"
                  :disabled="isSpinning"
                  class="bg-amber-500 text-slate-900 px-10 py-4 rounded-2xl font-black shadow-xl hover:scale-105 transition disabled:opacity-50 disabled:scale-100 text-xl flex items-center gap-2"
                >
                  <i
                    data-lucide="rotate-cw"
                    class="w-6 h-6"
                    :class="isSpinning ? 'animate-spin' : ''"
                  ></i>
                  <span x-text="isSpinning ? '旋轉中...' : '開始轉動'"></span>
                </button>
              </div>

              <!-- 結果顯示 -->
              <div
                x-show="rouletteResult"
                class="mt-10 w-full max-w-md animate-fade-in"
                x-transition
              >
                <div
                  class="bg-white dark:bg-slate-900 p-6 rounded-3xl shadow-2xl border-2 border-amber-400 text-center relative overflow-hidden"
                >
                  <div
                    class="absolute top-0 left-0 w-full h-2 bg-amber-400"
                  ></div>
                  <div
                    class="text-amber-500 font-black uppercase tracking-widest text-xs mb-2"
                  >
                    Fate has chosen
                  </div>
                  <h3
                    class="text-3xl font-black text-slate-900 dark:text-white mb-4"
                    x-text="rouletteResult?.name"
                  ></h3>
                  <p
                    class="text-slate-500 dark:text-slate-400 mb-6"
                    x-text="rouletteResult?.flavor"
                  ></p>

                  <div class="flex gap-3 justify-center">
                    <button
                      @click="pickRandomRecipe()"
                      class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-8 py-3 rounded-xl font-bold text-sm hover:opacity-90 transition"
                    >
                      來杯隨機酒譜
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- === 派對酒單 (Menu Generator) === -->
          <div
            x-show="activeTab === 'menu'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <button
              @click="activeTab = 'laboratory'"
              class="text-slate-500 hover:text-amber-500 font-bold flex items-center gap-1 transition"
            >
              <i data-lucide="arrow-left" class="w-4 h-4"></i> 返回實驗室
            </button>
            <!-- Selection View -->
            <div x-show="!isMenuGenerated" class="animate-fade-in">
              <div
                class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
              >
                <div>
                  <h2
                    class="text-4xl font-black text-slate-900 dark:text-white"
                  >
                    建立您的派對酒單
                  </h2>
                  <p class="text-slate-500 mt-2 text-lg">
                    從「可調製」的酒譜中勾選，產生一份專屬的今日特調菜單。
                  </p>
                </div>
                <button
                  @click="isMenuGenerated = true"
                  :disabled="menuSelectedRecipes.length === 0"
                  class="bg-amber-500 text-slate-900 px-8 py-3 rounded-xl font-black shadow-lg hover:bg-amber-400 transition flex items-center gap-2 shrink-0 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <i data-lucide="file-check" class="w-5 h-5"></i>
                  產生酒單
                </button>
              </div>

              <div
                x-show="recipes.length === 0"
                class="text-center py-20 mt-8 bg-white dark:bg-slate-900 rounded-[2.5rem] border-2 border-dashed border-slate-200 dark:border-slate-800"
              >
                <i
                  data-lucide="book-x"
                  class="w-16 h-16 mx-auto text-slate-300 dark:text-slate-700 mb-6"
                ></i>
                <h3 class="text-2xl font-black text-slate-400">
                  您的酒譜庫是空的
                </h3>
                <p class="text-slate-500 mt-2">
                  請先到「酒譜庫」新增或匯入酒譜。
                </p>
                <button
                  @click="activeTab = 'recipes'"
                  class="text-amber-600 font-black hover:underline mt-4"
                >
                  前往酒譜庫
                </button>
              </div>

              <div
                x-show="recipes.length > 0"
                class="mt-8 grid md:grid-cols-2 lg:grid-cols-3 gap-6"
              >
                <template x-for="recipe in selectableRecipes" :key="recipe.id">
                  <label
                    class="bg-white dark:bg-slate-900 rounded-3xl p-6 shadow-sm border-2 transition-all cursor-pointer relative"
                    :class="menuSelectedRecipes.includes(recipe.id) ? 'border-amber-500 ring-4 ring-amber-500/20' : (recipe.missing.length === 0 ? 'border-green-300 dark:border-green-800' : 'border-slate-200 dark:border-slate-800')"
                  >
                    <div
                      x-show="recipe.missing.length > 0"
                      class="absolute top-4 right-4 text-xs font-bold px-2 py-1 rounded-full"
                      :class="recipe.missing.length === 1 ? 'bg-amber-100 text-amber-700' : 'bg-red-100 text-red-700'"
                      x-text="`缺 ${recipe.missing.length}`"
                    ></div>
                    <div
                      x-show="recipe.missing.length === 0"
                      class="absolute top-4 right-4 text-xs font-bold px-2 py-1 rounded-full bg-green-100 text-green-700"
                    >
                      可調製
                    </div>

                    <div class="flex items-start justify-between">
                      <div class="flex-1 pr-4">
                        <div class="flex items-center gap-2 mb-1">
                          <h4
                            class="font-black text-xl text-slate-800 dark:text-white"
                            x-text="recipe.name"
                          ></h4>
                          <button
                            @click.prevent="openRecipeDetail(recipe)"
                            class="text-slate-400 hover:text-amber-500 p-1"
                          >
                            <i data-lucide="info" class="w-4 h-4"></i>
                          </button>
                        </div>
                        <p
                          class="text-xs text-slate-500 dark:text-slate-400 font-bold"
                          x-text="recipe.flavor"
                        ></p>
                      </div>
                      <input
                        type="checkbox"
                        :value="recipe.id"
                        x-model="menuSelectedRecipes"
                        class="w-6 h-6 rounded-lg text-amber-500 focus:ring-amber-500 border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-800 shrink-0 ml-4"
                      />
                    </div>
                  </label>
                </template>
              </div>
            </div>

            <!-- Generated Menu View -->
            <div x-show="isMenuGenerated" class="animate-fade-in">
              <div class="flex items-center justify-between mb-8 print:hidden">
                <button
                  @click="isMenuGenerated = false; menuSelectedRecipes = []"
                  class="flex items-center gap-2 text-slate-500 hover:text-slate-800 dark:hover:text-white font-bold transition"
                >
                  <i data-lucide="arrow-left"></i> 返回編輯
                </button>
                <button
                  @click="window.print()"
                  class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold flex items-center gap-2"
                >
                  <i data-lucide="printer"></i> 列印
                </button>
              </div>

              <div
                class="max-w-2xl mx-auto bg-white dark:bg-slate-900 p-6 md:p-10 lg:p-16 rounded-lg shadow-2xl print:shadow-none print:p-0"
              >
                <div
                  class="text-center border-b-2 border-dashed border-slate-300 dark:border-slate-700 pb-8 mb-8"
                >
                  <p
                    class="text-sm font-bold tracking-widest uppercase text-amber-600"
                  >
                    Today's Special
                  </p>
                  <h2
                    class="text-4xl font-black text-slate-900 dark:text-white mt-2"
                    x-text="barName"
                  ></h2>
                  <p class="text-slate-400 mt-1" x-text="bartenderName"></p>
                </div>

                <div class="grid md:grid-cols-2 gap-x-12 gap-y-8">
                  <template
                    x-for="recipe in generatedMenuList"
                    :key="recipe.id"
                  >
                    <button
                      @click="openRecipeDetail(recipe)"
                      class="text-left p-4 -m-4 rounded-2xl hover:bg-slate-50 dark:hover:bg-slate-800 transition"
                    >
                      <div class="space-y-1">
                        <h3
                          class="text-xl font-black text-slate-800 dark:text-white"
                          x-text="recipe.name"
                        ></h3>
                        <p
                          class="text-sm text-amber-700 dark:text-amber-500 font-bold"
                          x-text="recipe.flavor"
                        ></p>
                        <p
                          class="text-xs text-slate-500 dark:text-slate-400 pt-1"
                        >
                          <template x-for="(ing, index) in recipe.ingredients">
                            <span
                              ><span x-text="getIngredientName(ing.id)"></span
                              ><span
                                x-show="index < recipe.ingredients.length - 1"
                              >
                                /
                              </span></span
                            >
                          </template>
                        </p>
                      </div>
                    </button>
                  </template>
                </div>
              </div>
            </div>
          </div>

          <!-- === 飲酒日誌 === -->
          <div x-show="activeTab === 'journal'" class="space-y-8 animate-fade-in" x-cloak>
            <h2 class="text-4xl font-black text-slate-900 dark:text-white">飲酒日誌</h2>
            
            <!-- 統計卡片 -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800">
                    <div class="flex items-center gap-3 mb-2 text-slate-500 dark:text-slate-400">
                        <i data-lucide="wine" class="w-5 h-5"></i>
                        <span class="font-bold text-xs uppercase tracking-widest">累積飲用</span>
                    </div>
                    <div class="text-4xl font-black text-slate-900 dark:text-white" x-text="journalStats.total + ' 杯'"></div>
                </div>
                <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800">
                    <div class="flex items-center gap-3 mb-2 text-slate-500 dark:text-slate-400">
                        <i data-lucide="calendar-days" class="w-5 h-5"></i>
                        <span class="font-bold text-xs uppercase tracking-widest">本週飲用</span>
                    </div>
                    <div class="text-4xl font-black text-amber-500" x-text="journalStats.thisWeek + ' 杯'"></div>
                </div>
                <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800">
                    <div class="flex items-center gap-3 mb-2 text-slate-500 dark:text-slate-400">
                        <i data-lucide="heart" class="w-5 h-5"></i>
                        <span class="font-bold text-xs uppercase tracking-widest">最常喝</span>
                    </div>
                    <div class="text-2xl font-black text-slate-900 dark:text-white truncate" x-text="journalStats.favorite"></div>
                </div>
                <div class="bg-white dark:bg-slate-900 p-6 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800">
                    <div class="flex items-center gap-3 mb-2 text-slate-500 dark:text-slate-400">
                        <i data-lucide="droplet" class="w-5 h-5"></i>
                        <span class="font-bold text-xs uppercase tracking-widest">最愛基酒</span>
                    </div>
                    <div class="text-2xl font-black text-slate-900 dark:text-white truncate" x-text="journalStats.favoriteBase"></div>
                </div>
            </div>

            <!-- 時間軸 -->
            <div class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 shadow-sm border border-slate-200 dark:border-slate-800">
                <h3 class="text-2xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-3">
                    <i data-lucide="history" class="text-amber-500"></i> 歷史紀錄
                </h3>
                
                <div x-show="drinkingHistory.length === 0" class="text-center py-10 text-slate-400">
                    <p>尚無紀錄，快去調一杯酒吧！</p>
                </div>

                <div class="space-y-8 relative before:absolute before:inset-0 before:ml-5 before:-translate-x-px md:before:mx-auto md:before:translate-x-0 before:h-full before:w-0.5 before:bg-gradient-to-b before:from-transparent before:via-slate-300 before:to-transparent">
                    <template x-for="item in drinkingHistory" :key="item.id">
                        <div class="relative flex items-center justify-between md:justify-normal md:odd:flex-row-reverse group is-active">
                            <!-- Icon -->
                            <div class="flex items-center justify-center w-10 h-10 rounded-full border-4 border-white dark:border-slate-900 bg-amber-500 text-slate-900 shadow shrink-0 md:order-1 md:group-odd:-translate-x-1/2 md:group-even:translate-x-1/2">
                                <i data-lucide="glass-water" class="w-5 h-5"></i>
                            </div>
                            
                            <!-- Card -->
                            <div class="w-[calc(100%-4rem)] md:w-[calc(50%-2.5rem)] bg-slate-50 dark:bg-slate-800 p-6 rounded-2xl border border-slate-100 dark:border-slate-700 shadow-sm">
                                <div class="flex justify-between items-start mb-2">
                                    <div class="font-black text-lg text-slate-800 dark:text-white" x-text="item.recipeName"></div>
                                    <div class="flex gap-2">
                                        <button @click="editJournalEntry(item)" class="text-slate-300 hover:text-amber-500 transition">
                                            <i data-lucide="pencil" class="w-4 h-4"></i>
                                        </button>
                                        <button @click="deleteJournalEntry(item.id)" class="text-slate-300 hover:text-red-500 transition">
                                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="text-xs font-bold text-slate-400 mb-3 flex items-center gap-2">
                                    <i data-lucide="clock" class="w-3 h-3"></i>
                                    <span x-text="new Date(item.date).toLocaleString()"></span>
                                </div>
                                <div class="flex items-center gap-1 mb-3">
                                    <template x-for="i in 5">
                                        <i data-lucide="star" class="w-3 h-3" :class="i <= item.rating ? 'fill-amber-400 text-amber-400' : 'text-slate-300 dark:text-slate-600'"></i>
                                    </template>
                                </div>
                                <p x-show="item.notes" class="text-sm text-slate-600 dark:text-slate-300 bg-white dark:bg-slate-900/50 p-3 rounded-xl italic" x-text="item.notes"></p>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
          </div>

          <!-- === 設定 === -->
          <div
            x-show="activeTab === 'settings'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <h2 class="text-4xl font-black text-slate-900 dark:text-white">
              設定
            </h2>

            <!-- 個人化設定 -->
            <div
              class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 shadow-sm border border-slate-200 dark:border-slate-800"
            >
              <h3
                class="text-2xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-3"
              >
                <i data-lucide="cloud" class="text-amber-500"></i> 雲端同步
                (Firebase)
              </h3>

              <div
                class="bg-slate-50 dark:bg-slate-800 rounded-2xl p-6 border border-slate-100 dark:border-slate-700"
              >
                <div x-show="!user" class="text-center py-4">
                  <p class="text-slate-500 mb-4">
                    登入 Google 帳號以啟用跨裝置備份功能。
                  </p>
                  <button
                    @click="loginFirebase()"
                    class="bg-white dark:bg-slate-700 text-slate-800 dark:text-white px-6 py-3 rounded-xl font-bold shadow-md hover:scale-105 transition flex items-center gap-2 mx-auto"
                  >
                    <img
                      src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"
                      class="w-5 h-5"
                    />
                    使用 Google 登入
                  </button>
                </div>

                <div
                  x-show="user"
                  class="flex flex-col md:flex-row items-center justify-between gap-4"
                >
                  <div class="flex items-center gap-3">
                    <img
                      :src="user?.photoURL"
                      class="w-12 h-12 rounded-full border-2 border-amber-500"
                    />
                    <div>
                      <div
                        class="font-black text-slate-800 dark:text-white"
                        x-text="user?.displayName"
                      ></div>
                      <div
                        class="text-xs text-slate-500"
                        x-text="user?.email"
                      ></div>
                    </div>
                  </div>
                  <div class="flex gap-3 w-full md:w-auto">
                    <button
                      @click="saveToCloud()"
                      class="flex-1 md:flex-none py-2 px-4 bg-amber-500 text-slate-900 font-bold rounded-xl hover:bg-amber-400 transition flex items-center justify-center gap-2"
                    >
                      <i data-lucide="upload-cloud" class="w-4 h-4"></i> 備份
                    </button>
                    <button
                      @click="loadFromCloud()"
                      class="flex-1 md:flex-none py-2 px-4 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200 font-bold rounded-xl hover:bg-slate-300 dark:hover:bg-slate-600 transition flex items-center justify-center gap-2"
                    >
                      <i data-lucide="download-cloud" class="w-4 h-4"></i> 還原
                    </button>
                    <button
                      @click="logoutFirebase()"
                      class="py-2 px-4 text-red-500 font-bold hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition"
                    >
                      登出
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- 個人化設定 -->
            <div
              class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 shadow-sm border border-slate-200 dark:border-slate-800"
            >
              <h3
                class="text-2xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-3"
              >
                <i data-lucide="user-cog" class="text-amber-500"></i> 個人化設定
              </h3>
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-xs font-bold text-slate-500 mb-2"
                    >吧檯名稱 (Bar Name)</label
                  >
                  <input
                    type="text"
                    x-model="barName"
                    class="w-full p-3 rounded-xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 font-bold text-slate-800 dark:text-white focus:border-amber-500 outline-none transition"
                  />
                </div>
                <div>
                  <label class="block text-xs font-bold text-slate-500 mb-2"
                    >調酒師 / 副標題 (Bartender)</label
                  >
                  <input
                    type="text"
                    x-model="bartenderName"
                    class="w-full p-3 rounded-xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 font-bold text-slate-800 dark:text-white focus:border-amber-500 outline-none transition"
                  />
                </div>
              </div>
            </div>

            <!-- API 設定 -->
            <div class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 shadow-sm border border-slate-200 dark:border-slate-800">
                <h3 class="text-2xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-3">
                    <i data-lucide="bot" class="text-amber-500"></i> AI 設定
                </h3>
                <div>
                    <label class="block text-xs font-bold text-slate-500 mb-2">Gemini API Key</label>
                    <div class="flex gap-2">
                        <input type="password" x-model="geminiApiKey" placeholder="輸入您的 Google Gemini API Key" class="w-full p-3 rounded-xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 font-bold text-slate-800 dark:text-white focus:border-amber-500 outline-none transition">
                        <button @click="testAiConnection()" class="shrink-0 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200 px-4 rounded-xl font-bold hover:bg-slate-300 dark:hover:bg-slate-600 transition flex items-center gap-2">
                            <i data-lucide="wifi" class="w-4 h-4"></i>
                            <span class="hidden sm:inline">測試連結</span>
                        </button>
                    </div>
                    <p class="text-xs text-slate-400 mt-2">
                        用於驅動 AI 智能調酒師功能。請至 <a href="https://aistudio.google.com/app/apikey" target="_blank" class="text-amber-500 hover:underline">Google AI Studio</a> 免費獲取。
                    </p>
                </div>
            </div>

            <!-- 偏好與外觀 -->
            <div
              class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 shadow-sm border border-slate-200 dark:border-slate-800"
            >
              <h3
                class="text-2xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-3"
              >
                <i data-lucide="sliders" class="text-amber-500"></i> 偏好與外觀
              </h3>
              <div class="space-y-6">
                <!-- 計量單位 -->
                <div class="flex items-center justify-between">
                  <div>
                    <div
                      class="font-bold text-lg text-slate-800 dark:text-white"
                    >
                      計量單位
                    </div>
                    <div class="text-slate-500 dark:text-slate-400 text-sm">
                      切換酒譜顯示單位 (ml / oz)
                    </div>
                  </div>
                  <div
                    class="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl"
                  >
                    <button
                      @click="unit = 'ml'"
                      :class="unit === 'ml' ? 'bg-white dark:bg-slate-700 shadow text-amber-600' : 'text-slate-400'"
                      class="px-4 py-2 rounded-lg text-xs font-black transition"
                    >
                      ml
                    </button>
                    <button
                      @click="unit = 'oz'"
                      :class="unit === 'oz' ? 'bg-white dark:bg-slate-700 shadow text-amber-600' : 'text-slate-400'"
                      class="px-4 py-2 rounded-lg text-xs font-black transition"
                    >
                      oz
                    </button>
                  </div>
                </div>

                <div
                  class="border-t border-slate-100 dark:border-slate-800"
                ></div>

                <!-- 深色模式 -->
                <div class="flex items-center justify-between">
                  <div>
                    <div
                      class="font-bold text-lg text-slate-800 dark:text-white"
                    >
                      深色模式
                    </div>
                    <div class="text-slate-500 dark:text-slate-400 text-sm">
                      切換適合夜間調酒的深色介面
                    </div>
                  </div>
                  <button
                    @click="toggleTheme()"
                    class="relative inline-flex h-8 w-14 items-center rounded-full transition-colors focus:outline-none"
                    :class="darkMode ? 'bg-amber-500' : 'bg-slate-200'"
                  >
                    <span
                      class="inline-block h-6 w-6 transform rounded-full bg-white transition-transform"
                      :class="darkMode ? 'translate-x-7' : 'translate-x-1'"
                    ></span>
                  </button>
                </div>
              </div>
            </div>

            <!-- 資料管理 -->
            <div
              class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 shadow-sm border border-slate-200 dark:border-slate-800"
            >
              <h3
                class="text-2xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-3"
              >
                <i data-lucide="database" class="text-amber-500"></i> 資料管理
              </h3>
              <div class="grid md:grid-cols-3 gap-6">
                <button
                  @click="backupData()"
                  class="p-6 rounded-2xl bg-slate-50 dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 hover:border-amber-400 dark:hover:border-amber-400 transition text-left group"
                >
                  <div
                    class="bg-blue-100 text-blue-600 w-10 h-10 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition"
                  >
                    <i data-lucide="download" class="w-5 h-5"></i>
                  </div>
                  <div
                    class="font-black text-lg text-slate-800 dark:text-white mb-1"
                  >
                    備份資料
                  </div>
                  <div class="text-xs text-slate-500 dark:text-slate-400">
                    下載目前的酒譜與酒櫃資料 (JSON)
                  </div>
                </button>

                <button
                  @click="triggerImport()"
                  class="p-6 rounded-2xl bg-slate-50 dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 hover:border-amber-400 dark:hover:border-amber-400 transition text-left group"
                >
                  <div
                    class="bg-green-100 text-green-600 w-10 h-10 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition"
                  >
                    <i data-lucide="upload" class="w-5 h-5"></i>
                  </div>
                  <div
                    class="font-black text-lg text-slate-800 dark:text-white mb-1"
                  >
                    匯入資料
                  </div>
                  <div class="text-xs text-slate-500 dark:text-slate-400">
                    從備份檔案還原或匯入新酒譜
                  </div>
                  <input
                    type="file"
                    x-ref="fileInput"
                    class="hidden"
                    accept=".json"
                    @change="importDataFile"
                  />
                </button>

                <button
                  @click="resetData()"
                  class="p-6 rounded-2xl bg-slate-50 dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 hover:border-red-400 dark:hover:border-red-400 transition text-left group"
                >
                  <div
                    class="bg-red-100 text-red-600 w-10 h-10 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition"
                  >
                    <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                  </div>
                  <div
                    class="font-black text-lg text-slate-800 dark:text-white mb-1"
                  >
                    重置預設
                  </div>
                  <div class="text-xs text-slate-500 dark:text-slate-400">
                    清除所有資料並恢復原廠設定
                  </div>
                </button>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- --- 手機版 底部導覽 --- -->
    <nav
      class="md:hidden fixed bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-800 grid grid-cols-6 items-center px-1 py-3 z-50 shadow-2xl print:hidden"
    >
      <template x-for="tab in navigation" :key="tab.id">
        <button
          @click="activeTab = tab.id"
          class="flex flex-col items-center gap-1.5 transition"
          :class="(activeTab === tab.id || (tab.id === 'ingredients' && ['spirits', 'modifiers', 'tools', 'glassware'].includes(activeTab)) || (tab.id === 'laboratory' && ['recipes', 'bar', 'favorites', 'menu'].includes(activeTab))) ? 'text-amber-500 scale-110' : 'text-slate-500'"
        >
          <i :data-lucide="tab.icon" class="w-5 h-5"></i>
          <span
            class="text-[9px] font-black tracking-tight"
            x-text="tab.label"
          ></span>
        </button>
      </template>
    </nav>

    <!-- --- 表單彈窗：新增收藏 --- -->
    <div
      x-show="isBottleFormOpen"
      class="fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div
        class="bg-white rounded-[2.5rem] w-full max-w-xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col"
      >
        <div class="p-8 bg-slate-50 border-b flex justify-between items-center">
          <h3 class="font-black text-2xl flex items-center gap-3">
            <i data-lucide="archive" class="text-amber-500"></i>
            <span x-text="editingBottleId ? '編輯酒藏' : '入庫新酒收藏'"></span>
          </h3>
          <button
            @click="isBottleFormOpen = false"
            class="text-slate-400 hover:text-slate-600"
          >
            <i data-lucide="x"></i>
          </button>
        </div>
        <form
          @submit.prevent="saveBottle()"
          class="p-8 space-y-6 overflow-y-auto custom-scrollbar"
        >
          <div class="grid grid-cols-2 gap-6">
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >分類</label
              >
              <select
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.typeId"
              >
                <template x-for="ing in allIngredientsList">
                  <option :value="ing.id" x-text="ing.name"></option>
                </template>
              </select>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >酒名</label
              >
              <input
                type="text"
                required
                placeholder="例如：坦奎瑞"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.name"
              />
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >品牌</label
              >
              <input
                type="text"
                placeholder="例如：Tanqueray"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.brand"
              />
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >購買地點</label
              >
              <input
                type="text"
                placeholder="例如：好市多"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.location"
              />
            </div>
          </div>
          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >購入價格</label
              >
              <input
                type="number"
                placeholder="$"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.price"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >購買日期</label
              >
              <input
                type="date"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.purchaseDate"
              />
            </div>
          </div>
          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >容量 (ml)</label
              >
              <input
                type="number"
                placeholder="750"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.volume"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >評價星等 (1-5)</label
              >
              <input
                type="number"
                min="1"
                max="5"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.rating"
              />
            </div>
          </div>
          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >標籤 (逗號分隔)</label
            >
            <input
              type="text"
              placeholder="例如：清爽, 限量"
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model="bottleForm.tags"
            />
          </div>
          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >初始酒量</label
            >
            <div class="flex items-center gap-4">
              <input
                type="range"
                min="0"
                max="100"
                step="10"
                class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-amber-500"
                x-model="bottleForm.remaining"
              />
              <span
                class="font-black text-amber-600 w-12 text-right"
                x-text="bottleForm.remaining + '%'"
              ></span>
            </div>
          </div>
          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >特色描述</label
            >
            <input
              type="text"
              placeholder="例如：帶有獨特的柑橘香氣"
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model="bottleForm.features"
            />
          </div>
          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >風味筆記</label
            >
            <textarea
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50 resize-none"
              rows="3"
              x-model="bottleForm.notes"
            ></textarea>
          </div>
          <button
            type="submit"
            class="w-full py-5 bg-slate-900 text-white font-black rounded-2xl shadow-2xl hover:bg-slate-800 transition flex items-center justify-center gap-3"
          >
            <i data-lucide="save" class="w-5 h-5"></i>
            <span x-text="editingBottleId ? '儲存變更' : '完成入庫'"></span>
          </button>
        </form>
      </div>
    </div>

    <!-- --- 彈窗：AI 調酒師 --- -->
    <div
      x-show="isAiModalOpen"
      class="fixed inset-0 bg-slate-900/90 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div class="bg-white dark:bg-slate-900 rounded-[2.5rem] w-full max-w-lg shadow-2xl overflow-hidden max-h-[90vh] flex flex-col relative border border-slate-200 dark:border-slate-700">
        <button @click="isAiModalOpen = false" class="absolute top-6 right-6 z-10 p-2 bg-slate-100 dark:bg-slate-800 rounded-full text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition">
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>

        <!-- 初始狀態 / Loading -->
        <div x-show="!aiResult" class="p-10 flex flex-col items-center justify-center text-center h-full min-h-[400px]">
            <div class="w-24 h-24 bg-indigo-100 dark:bg-indigo-900/30 rounded-full flex items-center justify-center mb-6 relative">
                <i data-lucide="bot" class="w-12 h-12 text-indigo-600 dark:text-indigo-400" :class="aiLoading ? 'animate-bounce' : ''"></i>
                <div x-show="aiLoading" class="absolute inset-0 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
            </div>
            
            <h3 class="text-2xl font-black text-slate-900 dark:text-white mb-2" x-text="aiLoading ? '正在構思酒譜...' : 'AI 智能調酒師'"></h3>
            <p class="text-slate-500 dark:text-slate-400 mb-8 max-w-xs mx-auto" x-text="aiLoading ? 'AI 正在掃描您的庫存，並嘗試發明一杯獨一無二的調酒。' : '我會根據您目前的庫存，為您發明一杯新調酒。'"></p>
            
            <button @click="generateAiCocktail()" :disabled="aiLoading" class="bg-indigo-600 text-white px-8 py-4 rounded-2xl font-black shadow-xl hover:bg-indigo-500 transition flex items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed hover:scale-105">
                <i data-lucide="sparkles" class="w-5 h-5"></i>
                <span x-text="aiLoading ? '請稍候...' : '開始發明調酒'"></span>
            </button>
        </div>

        <!-- 結果顯示 -->
        <div x-show="aiResult" class="flex flex-col h-full">
            <div class="p-8 overflow-y-auto custom-scrollbar flex-1">
                <div class="flex items-center gap-3 mb-6">
                    <div class="p-3 bg-indigo-100 text-indigo-600 rounded-2xl">
                        <i data-lucide="sparkles" class="w-8 h-8"></i>
                    </div>
                    <div>
                        <div class="text-xs font-black text-indigo-400 uppercase tracking-widest">AI Generated</div>
                        <h3 class="text-3xl font-black text-slate-900 dark:text-white" x-text="aiResult?.name"></h3>
                    </div>
                </div>

                <p class="text-lg font-bold text-indigo-600 dark:text-indigo-400 mb-2" x-text="aiResult?.flavor"></p>
                <p class="text-sm text-slate-600 dark:text-slate-300 italic mb-6 bg-slate-50 dark:bg-slate-800 p-4 rounded-xl border border-slate-100 dark:border-slate-700" x-text="aiResult?.features"></p>

                <!-- Radar Chart for AI Result -->
                <div class="mb-6 flex justify-center" x-show="aiResult?.profile">
                    <div class="relative w-48 h-48">
                        <svg viewBox="0 0 200 200" class="w-full h-full">
                            <g class="text-slate-200 dark:text-slate-700 stroke-current stroke-1 fill-none">
                                <polygon :points="getRadarGrid(5)" /><polygon :points="getRadarGrid(3)" /><polygon :points="getRadarGrid(1)" />
                            </g>
                            <polygon :points="getRadarPath(aiResult?.profile)" class="fill-indigo-500/50 stroke-indigo-500 stroke-2" />
                        </svg>
                    </div>
                </div>

                <div class="space-y-4 mb-6">
                    <h4 class="text-xs font-black text-slate-400 uppercase tracking-widest">材料</h4>
                    <ul class="space-y-2">
                        <template x-for="ing in aiResult?.ingredients">
                            <li class="flex justify-between text-sm font-bold text-slate-700 dark:text-slate-200 border-b border-slate-100 dark:border-slate-800 pb-2">
                                <span x-text="ing.name"></span>
                                <span x-text="ing.amount" class="text-slate-500"></span>
                            </li>
                        </template>
                    </ul>
                </div>
            </div>
            <div class="p-6 border-t border-slate-100 dark:border-slate-800 bg-slate-50 dark:bg-slate-900 flex gap-4 shrink-0">
                <button @click="generateAiCocktail()" class="flex-1 py-3 bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 font-bold rounded-xl border border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-700 transition">不滿意，重來</button>
                <button @click="saveAiRecipe()" class="flex-[2] py-3 bg-indigo-600 text-white font-bold rounded-xl shadow-lg hover:bg-indigo-500 transition flex items-center justify-center gap-2">
                    <i data-lucide="save" class="w-4 h-4"></i> 收藏這份酒譜
                </button>
            </div>
        </div>
      </div>
    </div>

    <!-- --- 表單彈窗：新增調味 --- -->
    <div
      x-show="isModifierFormOpen"
      class="fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div
        class="bg-white rounded-[2.5rem] w-full max-w-xl shadow-2xl overflow-hidden flex flex-col"
      >
        <div class="p-8 bg-slate-50 border-b flex justify-between items-center">
          <h3 class="font-black text-2xl flex items-center gap-3">
            <i data-lucide="leaf" class="text-amber-500"></i> 新增自訂調味
          </h3>
          <button
            @click="isModifierFormOpen = false"
            class="text-slate-400 hover:text-slate-600"
          >
            <i data-lucide="x"></i>
          </button>
        </div>
        <form @submit.prevent="saveModifier()" class="p-8 space-y-6">
          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >分類</label
            >
            <select
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model.number="modifierForm.categoryIndex"
            >
              <template x-for="(cat, index) in modifiers" :key="index">
                <option :value="index" x-text="cat.category"></option>
              </template>
            </select>
          </div>
          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >名稱</label
            >
            <input
              type="text"
              required
              placeholder="例如：接骨木糖漿"
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model="modifierForm.name"
            />
          </div>
          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >標籤 (Tag)</label
              >
              <input
                type="text"
                placeholder="例如：花香"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="modifierForm.tag"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >描述</label
              >
              <input
                type="text"
                placeholder="簡短描述風味"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="modifierForm.desc"
              />
            </div>
          </div>
          <button
            type="submit"
            class="w-full py-5 bg-slate-900 text-white font-black rounded-2xl shadow-2xl hover:bg-slate-800 transition flex items-center justify-center gap-3"
          >
            <i data-lucide="plus-circle" class="w-5 h-5"></i> 加入資料庫
          </button>
        </form>
      </div>
    </div>

    <!-- --- 表單彈窗：新增酒譜 --- -->
    <div
      x-show="isRecipeFormOpen"
      class="fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div
        class="bg-white rounded-[2.5rem] w-full max-w-2xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col"
      >
        <div
          class="p-8 bg-slate-50 border-b flex justify-between items-center shrink-0"
        >
          <h3 class="font-black text-2xl flex items-center gap-3">
            <i data-lucide="book-open" class="text-amber-500"></i>
            <span x-text="editingRecipeId ? '編輯酒譜' : '新增自創酒譜'"></span>
          </h3>
          <button
            @click="isRecipeFormOpen = false"
            class="text-slate-400 hover:text-slate-600"
          >
            <i data-lucide="x"></i>
          </button>
        </div>
        <form
          @submit.prevent="saveRecipe()"
          class="p-8 space-y-6 overflow-y-auto custom-scrollbar"
        >
          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >酒譜名稱</label
              >
              <input
                type="text"
                required
                placeholder="例如：特製水果茶酒"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="recipeForm.name"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >分類</label
              >
              <input
                type="text"
                placeholder="例如：長飲型 (Long Drink)"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="recipeForm.category"
              />
            </div>
          </div>

          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >酒精度 (ABV)</label
              >
              <input
                type="text"
                placeholder="例如：15%"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="recipeForm.abv"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >難易度 (1-5)</label
              >
              <div class="flex items-center gap-4 h-[46px]">
                <input
                  type="range"
                  min="1"
                  max="5"
                  class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-amber-500"
                  x-model="recipeForm.difficulty"
                />
                <span
                  class="font-black text-amber-600 w-8 text-right"
                  x-text="recipeForm.difficulty"
                ></span>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >風味描述</label
              >
              <input
                type="text"
                placeholder="例如：酸甜、果香濃郁"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="recipeForm.flavor"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >標籤 (逗號分隔)</label
              >
              <input
                type="text"
                placeholder="例如：經典, 派對"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="recipeForm.tags"
              />
            </div>
          </div>

          <div class="grid grid-cols-2 gap-6">
            <div class="col-span-2">
                <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-4">風味輪廓 (1-5分)</label>
                <div class="grid grid-cols-1 sm:grid-cols-5 gap-4 bg-slate-50 p-4 rounded-2xl border-2 border-slate-100">
                    <div class="text-center">
                        <label class="block text-xs font-bold text-slate-600 mb-1">甜度</label>
                        <input type="range" min="1" max="5" step="1" x-model="recipeForm.profile.sweet" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-pink-500">
                        <div class="text-xs font-black text-pink-500 mt-1" x-text="recipeForm.profile.sweet"></div>
                    </div>
                    <div class="text-center">
                        <label class="block text-xs font-bold text-slate-600 mb-1">酸度</label>
                        <input type="range" min="1" max="5" step="1" x-model="recipeForm.profile.sour" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-yellow-500">
                        <div class="text-xs font-black text-yellow-500 mt-1" x-text="recipeForm.profile.sour"></div>
                    </div>
                    <div class="text-center">
                        <label class="block text-xs font-bold text-slate-600 mb-1">苦度</label>
                        <input type="range" min="1" max="5" step="1" x-model="recipeForm.profile.bitter" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-green-700">
                        <div class="text-xs font-black text-green-700 mt-1" x-text="recipeForm.profile.bitter"></div>
                    </div>
                    <div class="text-center">
                        <label class="block text-xs font-bold text-slate-600 mb-1">酒精感</label>
                        <input type="range" min="1" max="5" step="1" x-model="recipeForm.profile.boozy" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-red-600">
                        <div class="text-xs font-black text-red-600 mt-1" x-text="recipeForm.profile.boozy"></div>
                    </div>
                    <div class="text-center">
                        <label class="block text-xs font-bold text-slate-600 mb-1">複雜度</label>
                        <input type="range" min="1" max="5" step="1" x-model="recipeForm.profile.complex" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-purple-600">
                        <div class="text-xs font-black text-purple-600 mt-1" x-text="recipeForm.profile.complex"></div>
                    </div>
                </div>
            </div>
          </div>

          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >預估成本 (手動覆蓋)</label
            >
            <input
              type="number"
              placeholder="留空則自動計算"
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model="recipeForm.cost"
            />
          </div>

          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >特色/簡介</label
            >
            <input
              type="text"
              placeholder="一句話形容這杯酒..."
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model="recipeForm.features"
            />
          </div>

          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >選擇材料與份量</label
            >
            <div
              class="max-h-60 overflow-y-auto custom-scrollbar p-4 border-2 border-slate-100 rounded-2xl bg-slate-50 space-y-5"
            >
              <template
                x-for="(items, category) in getRecipeIngredientsGrouped()"
                :key="category"
              >
                <div>
                  <h4
                    class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 sticky top-0 bg-slate-50/95 backdrop-blur py-1 z-10 border-b border-slate-100"
                    x-text="category"
                  ></h4>
                  <div class="grid grid-cols-1 gap-2">
                    <template x-for="ing in items" :key="ing.id">
                      <div
                        class="flex items-center justify-between p-2 rounded-lg hover:bg-white border border-transparent hover:border-slate-200 transition group"
                      >
                        <label
                          class="flex items-center gap-2 cursor-pointer flex-1"
                        >
                          <input
                            type="checkbox"
                            :value="ing.id"
                            x-model="recipeForm.ingredients"
                            class="rounded text-amber-500 focus:ring-amber-500"
                          />
                          <span
                            class="text-xs font-bold text-slate-700"
                            x-text="ing.name"
                          ></span>
                        </label>
                        <input
                          type="text"
                          x-show="recipeForm.ingredients.includes(ing.id)"
                          x-model="recipeForm.amounts[ing.id]"
                          placeholder="份量 (如: 45ml)"
                          class="w-28 p-1.5 text-xs border border-slate-200 rounded-lg bg-white focus:border-amber-500 outline-none"
                        />
                      </div>
                    </template>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >調製步驟 (一行一步驟)</label
            >
            <textarea
              required
              placeholder="1. 加入冰塊&#10;2. 倒入琴酒 45ml..."
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50 resize-none"
              rows="4"
              x-model="recipeForm.steps"
            ></textarea>
          </div>

          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >調製秘訣</label
            >
            <input
              type="text"
              placeholder="例如：最後噴附橙皮油增加香氣"
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model="recipeForm.tips"
            />
          </div>

          <button
            type="submit"
            class="w-full py-5 bg-slate-900 text-white font-black rounded-2xl shadow-2xl hover:bg-slate-800 transition flex items-center justify-center gap-3"
          >
            <i data-lucide="save" class="w-5 h-5"></i>
            <span x-text="editingRecipeId ? '儲存變更' : '儲存酒譜'"></span>
          </button>
        </form>
      </div>
    </div>

    <!-- --- 彈窗：隨機酒譜展示 --- -->
    <div
      x-show="isRecipeModalOpen"
      class="fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-[2.5rem] w-full max-w-lg shadow-2xl overflow-hidden max-h-[90vh] flex flex-col relative"
        @click.away="isRecipeModalOpen = false"
      >
        <button
          @click="isRecipeModalOpen = false"
          class="absolute top-6 right-6 z-10 p-2 bg-slate-100 dark:bg-slate-800 rounded-full text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition"
        >
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>

        <div
          class="p-8 overflow-y-auto custom-scrollbar"
          x-show="selectedRecipe"
        >
          <button
            @click="toggleFavorite(selectedRecipe.id)"
            class="absolute top-8 right-20 z-10 p-2 rounded-full transition"
            :class="favoriteRecipes.includes(selectedRecipe.id) ? 'text-red-500 bg-red-50 dark:bg-red-900/20' : 'text-slate-300 bg-slate-100 dark:bg-slate-800 hover:text-red-400'"
          >
            <i
              data-lucide="heart"
              class="w-5 h-5"
              :class="favoriteRecipes.includes(selectedRecipe.id) ? 'fill-current' : ''"
            ></i>
          </button>
          <button
            @click="openNoteModal(selectedRecipe)"
            class="absolute top-8 right-32 z-10 p-2 rounded-full transition text-slate-300 bg-slate-100 dark:bg-slate-800 hover:text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-900/20"
            title="評分與筆記"
          >
            <i
              data-lucide="notebook-pen"
              class="w-5 h-5"
              :class="selectedRecipe.myRating || selectedRecipe.myNotes ? 'text-amber-500 fill-amber-500' : ''"
            ></i>
          </button>
          <button
            @click="shareRecipe(selectedRecipe)"
            class="absolute top-8 right-44 z-10 p-2 rounded-full transition text-slate-300 bg-slate-100 dark:bg-slate-800 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20"
            title="分享酒譜"
          >
            <i data-lucide="share-2" class="w-5 h-5"></i>
          </button>
          <button
            @click="generateRecipeImage(selectedRecipe)"
            class="absolute top-8 right-56 z-10 p-2 rounded-full transition text-slate-300 bg-slate-100 dark:bg-slate-800 hover:text-purple-500 hover:bg-purple-50 dark:hover:bg-purple-900/20"
            title="下載酒譜卡片"
          >
            <i data-lucide="image-down" class="w-5 h-5"></i>
          </button>
          <button
            @click="openJournalModal(selectedRecipe)"
            class="absolute top-8 right-[17rem] z-10 p-2 rounded-full transition text-slate-300 bg-slate-100 dark:bg-slate-800 hover:text-green-500 hover:bg-green-50 dark:hover:bg-green-900/20"
            title="紀錄飲酒"
          >
            <i data-lucide="calendar-plus" class="w-5 h-5"></i>
          </button>
          <div class="flex items-center gap-3 mb-6">
            <div class="p-3 bg-amber-100 text-amber-600 rounded-2xl">
              <i data-lucide="glass-water" class="w-8 h-8"></i>
            </div>
            <div>
              <div
                class="text-xs font-black text-slate-400 uppercase tracking-widest"
              >
                Recipe Detail
              </div>
              <h3
                class="text-3xl font-black text-slate-900 dark:text-white"
                x-text="selectedRecipe.name"
              ></h3>
            </div>
          </div>

          <div
            class="flex gap-4 mb-6 text-xs font-bold text-slate-500 dark:text-slate-400"
          >
            <span
              class="bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 px-2 py-1 rounded"
              x-text="selectedRecipe.category"
            ></span>
            <div class="flex items-center gap-1">
              <i data-lucide="flame" class="w-3 h-3"></i>
              <span x-text="selectedRecipe.abv"></span>
              <span
                class="text-amber-500 text-[10px] bg-amber-100 dark:bg-amber-900/30 px-1.5 py-0.5 rounded ml-1"
                x-show="calculateRecipeABV(selectedRecipe) > 0"
                x-text="'試算: ' + calculateRecipeABV(selectedRecipe) + '%'"
              ></span>
            </div>
            <div class="flex items-center gap-1">
              <i data-lucide="coins" class="w-3 h-3 text-slate-400"></i>
              <span class="text-slate-500 dark:text-slate-400" 
                    x-text="'約 $' + estimateCost(selectedRecipe)">
              </span>
            </div>
            <div class="flex items-center gap-1">
              <i
                data-lucide="star"
                class="w-3 h-3 text-amber-400 fill-amber-400"
              ></i>
              <span x-text="selectedRecipe.difficulty + '/5'"></span>
            </div>
            <div
              class="flex items-center gap-1"
              x-show="selectedRecipe.myRating"
            >
              <i data-lucide="thumbs-up" class="w-3 h-3 text-green-500"></i>
              <span
                class="text-green-600 dark:text-green-400"
                x-text="'我的評分: ' + selectedRecipe.myRating"
              ></span>
            </div>
          </div>

          <!-- Flavor Profile Radar Chart -->
          <div class="mb-8 flex flex-col items-center" x-show="selectedRecipe.profile">
            <div class="relative w-64 h-64">
                <svg viewBox="0 0 200 200" class="w-full h-full drop-shadow-xl">
                    <!-- Background Grid -->
                    <g class="text-slate-200 dark:text-slate-700 stroke-current stroke-1 fill-none">
                        <polygon :points="getRadarGrid(5)" />
                        <polygon :points="getRadarGrid(4)" />
                        <polygon :points="getRadarGrid(3)" />
                        <polygon :points="getRadarGrid(2)" />
                        <polygon :points="getRadarGrid(1)" />
                    </g>
                    <!-- Axes -->
                    <g class="text-slate-200 dark:text-slate-700 stroke-current stroke-1">
                        <line x1="100" y1="100" x2="100" y2="20" />
                        <line x1="100" y1="100" x2="176" y2="75" />
                        <line x1="100" y1="100" x2="147" y2="165" />
                        <line x1="100" y1="100" x2="53" y2="165" />
                        <line x1="100" y1="100" x2="24" y2="75" />
                    </g>
                    <!-- Data Polygon -->
                    <polygon :points="getRadarPath(selectedRecipe.profile)" class="fill-amber-500/50 stroke-amber-500 stroke-2" />
                    <!-- Labels -->
                    <g class="text-[10px] font-black fill-slate-500 dark:fill-slate-400 text-center" style="text-anchor: middle; dominant-baseline: middle;">
                        <text x="100" y="10">甜度</text>
                        <text x="190" y="75">酸度</text>
                        <text x="160" y="180">苦度</text>
                        <text x="40" y="180">酒精感</text>
                        <text x="10" y="75">複雜度</text>
                    </g>
                </svg>
            </div>
            <p class="text-xs text-slate-400 font-bold mt-2">風味輪廓分析</p>
          </div>

          <p
            class="text-lg font-bold text-slate-700 dark:text-slate-300 mb-2"
            x-text="selectedRecipe.flavor"
          ></p>
          <p
            class="text-sm text-slate-500 dark:text-slate-400 mb-8"
            x-text="selectedRecipe.features"
          ></p>

          <div class="mb-8">
            <div class="flex items-center justify-between mb-3 flex-wrap gap-2">
              <h4
                class="text-[10px] font-black text-slate-400 uppercase tracking-widest"
              >
                材料清單
              </h4>
              <div class="flex items-center gap-2">
                <button 
                    @click="toggleBatchMode()"
                    class="text-xs font-bold px-3 py-1.5 rounded-lg border transition flex items-center gap-1"
                    :class="batchMode ? 'bg-amber-100 text-amber-700 border-amber-200 dark:bg-amber-900/30 dark:text-amber-400 dark:border-amber-800' : 'bg-slate-100 text-slate-500 border-transparent dark:bg-slate-800 dark:text-slate-400'"
                    title="派對總量計算機"
                >
                    <i data-lucide="calculator" class="w-3 h-3"></i>
                    <span x-show="batchMode">派對模式</span>
                </button>
                <div x-show="!batchMode" class="flex bg-slate-100 dark:bg-slate-800 rounded-lg p-1">
                    <button
                    @click="currentScale = 1"
                    :class="currentScale === 1 ? 'bg-white dark:bg-slate-700 shadow text-amber-600' : 'text-slate-400'"
                    class="px-3 py-1 rounded-md text-xs font-bold transition"
                    >
                    x1
                    </button>
                    <button
                    @click="currentScale = 2"
                    :class="currentScale === 2 ? 'bg-white dark:bg-slate-700 shadow text-amber-600' : 'text-slate-400'"
                    class="px-3 py-1 rounded-md text-xs font-bold transition"
                    >
                    x2
                    </button>
                    <button
                    @click="currentScale = 4"
                    :class="currentScale === 4 ? 'bg-white dark:bg-slate-700 shadow text-amber-600' : 'text-slate-400'"
                    class="px-3 py-1 rounded-md text-xs font-bold transition"
                    >
                    x4
                    </button>
                </div>
              </div>
            </div>
            
            <!-- Batch Calculator Input -->
            <div x-show="batchMode" class="mb-4 bg-amber-50 dark:bg-amber-900/20 p-3 rounded-xl border border-amber-100 dark:border-amber-900/30 flex items-center gap-4 animate-fade-in">
                <div class="flex-1">
                    <label class="text-[10px] font-black text-amber-600/70 dark:text-amber-400/70 uppercase tracking-widest block mb-1">預計總量 (ml)</label>
                    <input type="number" x-model="targetVolume" @input="updateBatchScale()" class="w-full bg-white dark:bg-slate-800 border border-amber-200 dark:border-amber-800 rounded-lg px-3 py-2 text-sm font-bold text-amber-700 dark:text-amber-400 focus:outline-none focus:ring-2 focus:ring-amber-500">
                </div>
                <div class="text-right">
                    <div class="text-[10px] font-black text-amber-600/70 dark:text-amber-400/70 uppercase tracking-widest mb-1">放大倍率</div>
                    <div class="text-xl font-black text-amber-600 dark:text-amber-400" x-text="'x' + currentScale.toFixed(1)"></div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-3">
              <template x-for="ing in selectedRecipe.ingredients">
                <div
                  class="flex justify-between items-center p-3 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700"
                >
                  <span
                    class="text-xs font-bold"
                    :class="myIngredients.includes(ing.id) ? 'text-green-600 dark:text-green-400' : 'text-slate-700 dark:text-slate-300'"
                    x-text="getIngredientName(ing.id)"
                  ></span>
                  <span
                    class="text-xs font-mono text-slate-500"
                    x-text="getScaledAmount(ing.amount, ing.id)"
                  ></span>
                </div>
              </template>
            </div>
          </div>

          <div class="mb-8">
            <h4
              class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3"
            >
              調製步驟
            </h4>
            <ol
              class="list-decimal list-inside text-sm text-slate-600 dark:text-slate-300 space-y-2 font-medium"
            >
              <template x-for="step in selectedRecipe.steps">
                <li x-text="convertStep(step)"></li>
              </template>
            </ol>
          </div>

          <div class="bg-slate-50 dark:bg-slate-800 rounded-2xl p-5">
            <div class="flex items-center gap-2 text-slate-400 mb-2">
              <i data-lucide="lightbulb" class="w-4 h-4"></i>
              <span class="text-[10px] font-black uppercase tracking-widest"
                >調製秘訣</span
              >
            </div>
            <p
              class="text-sm text-slate-600 dark:text-slate-300 font-medium"
              x-text="selectedRecipe.tips"
            ></p>
          </div>

          <!-- My Notes -->
          <div
            x-show="selectedRecipe.myNotes"
            class="mt-4 bg-amber-50 dark:bg-amber-900/20 rounded-2xl p-4 border border-amber-100 dark:border-amber-900/30"
          >
            <div
              class="flex items-center gap-2 text-amber-600 dark:text-amber-500 mb-2"
            >
              <i data-lucide="pen-tool" class="w-3 h-3"></i>
              <span class="text-[10px] font-black uppercase tracking-widest"
                >我的筆記</span
              >
            </div>
            <p
              class="text-sm text-slate-700 dark:text-slate-300 font-medium whitespace-pre-line"
              x-text="selectedRecipe.myNotes"
            ></p>
          </div>

          <!-- Tags -->
          <div
            class="flex flex-wrap gap-1 mt-4 pt-4 border-t border-slate-100 dark:border-slate-800"
          >
            <template x-for="tag in selectedRecipe.tags">
              <span
                class="text-[10px] font-bold text-slate-400 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-lg"
                x-text="'#'+tag"
              ></span>
            </template>
          </div>
        </div>
      </div>
    </div>

    <!-- --- 表單彈窗：評分與筆記 --- -->
    <div
      x-show="isNoteModalOpen"
      class="fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-[2.5rem] w-full max-w-md shadow-2xl overflow-hidden flex flex-col"
      >
        <div
          class="p-8 bg-slate-50 dark:bg-slate-800 border-b dark:border-slate-700 flex justify-between items-center"
        >
          <h3
            class="font-black text-2xl flex items-center gap-3 text-slate-900 dark:text-white"
          >
            <i data-lucide="notebook-pen" class="text-amber-500"></i> 評分與筆記
          </h3>
          <button
            @click="isNoteModalOpen = false"
            class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200"
          >
            <i data-lucide="x"></i>
          </button>
        </div>
        <form @submit.prevent="saveNote()" class="p-8 space-y-6">
          <div class="text-center">
            <h4
              class="text-lg font-bold text-slate-800 dark:text-white mb-4"
              x-text="noteForm.name"
            ></h4>
            <div class="flex justify-center gap-3">
              <template x-for="i in 5">
                <button
                  type="button"
                  @click="noteForm.rating = (noteForm.rating === i ? 0 : i)"
                  class="transition hover:scale-110 focus:outline-none"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" 
                    class="w-8 h-8" 
                    :class="i <= noteForm.rating ? 'fill-amber-400 text-amber-400' : 'text-slate-300 dark:text-slate-600'"
                  >
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                  </svg>
                </button>
              </template>
            </div>
            <p
              class="text-xs text-slate-400 mt-2 font-bold uppercase tracking-widest"
            >
              點擊星星評分
            </p>
          </div>

          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >心得筆記</label
            >
            <textarea
              placeholder="寫下您的品飲心得、調整建議..."
              class="w-full p-4 rounded-2xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-800 dark:text-white font-medium text-sm resize-none focus:border-amber-500 outline-none transition"
              rows="5"
              x-model="noteForm.notes"
            ></textarea>
          </div>

          <div class="flex gap-4">
            <button
              type="button"
              @click="deleteNote()"
              x-show="noteForm.rating > 0 || noteForm.notes"
              class="flex-1 py-4 bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 font-black rounded-2xl hover:bg-red-50 hover:text-red-500 dark:hover:bg-red-900/20 dark:hover:text-red-400 transition flex items-center justify-center gap-2"
            >
              <i data-lucide="trash-2" class="w-5 h-5"></i> 刪除
            </button>
            <button
              type="submit"
              class="py-4 bg-amber-500 text-slate-900 font-black rounded-2xl shadow-lg hover:bg-amber-400 transition flex items-center justify-center gap-2"
              :class="(noteForm.rating > 0 || noteForm.notes) ? 'flex-[2]' : 'w-full'"
            >
              <i data-lucide="save" class="w-5 h-5"></i> 儲存筆記
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- --- 表單彈窗：飲酒日誌紀錄 --- -->
    <div
      x-show="isJournalModalOpen"
      class="fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-[2.5rem] w-full max-w-md shadow-2xl overflow-hidden flex flex-col"
      >
        <div
          class="p-8 bg-slate-50 dark:bg-slate-800 border-b dark:border-slate-700 flex justify-between items-center"
        >
          <h3
            class="font-black text-2xl flex items-center gap-3 text-slate-900 dark:text-white"
          >
            <i data-lucide="calendar-plus" class="text-green-500"></i> <span x-text="journalForm.id ? '編輯紀錄' : '紀錄一杯'"></span>
          </h3>
          <button
            @click="isJournalModalOpen = false"
            class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200"
          >
            <i data-lucide="x"></i>
          </button>
        </div>
        <form @submit.prevent="saveJournalEntry()" class="p-8 space-y-6">
          <div class="text-center mb-4">
            <h4 class="text-xl font-black text-slate-800 dark:text-white" x-text="journalForm.recipeName"></h4>
            <p class="text-sm text-slate-500 dark:text-slate-400 mt-1">紀錄美好的微醺時刻</p>
          </div>
          
          <div>
            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">飲用時間</label>
            <input type="datetime-local" required class="w-full p-3 rounded-2xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 font-bold text-slate-800 dark:text-white" x-model="journalForm.date">
          </div>

          <div>
            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">本次評分</label>
            <div class="flex gap-2">
               <template x-for="i in 5">
                <button type="button" @click="journalForm.rating = (journalForm.rating === i ? 0 : i)" class="focus:outline-none transition hover:scale-110">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" 
                    class="w-8 h-8" 
                    :class="i <= journalForm.rating ? 'fill-amber-400 text-amber-400' : 'text-slate-200 dark:text-slate-700'"
                  >
                    <polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon>
                  </svg>
                </button>
               </template>
            </div>
          </div>

          <div>
            <label class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2">品飲筆記 (選填)</label>
            <textarea placeholder="這次的口感如何？太酸？太甜？還是完美？" class="w-full p-3 rounded-2xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 font-medium text-sm resize-none h-24" x-model="journalForm.notes"></textarea>
          </div>

          <button type="submit" class="w-full py-4 bg-green-500 text-white font-black rounded-2xl shadow-lg hover:bg-green-400 transition flex items-center justify-center gap-2">
            <i data-lucide="check" class="w-5 h-5"></i> <span x-text="journalForm.id ? '更新紀錄' : '儲存紀錄'"></span>
          </button>
        </form>
      </div>
    </div>
  </body>
</html>
  </body>
</html>
