<!DOCTYPE html>
<html lang="zh-TW">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>居家調酒實驗室 - Home Mixology Lab</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <!-- Firebase SDK (Module) -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
      import {
        getAuth,
        signInWithPopup,
        GoogleAuthProvider,
        signOut,
        onAuthStateChanged,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
        getDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      // [注意] 請確認此處的設定與您的 Firebase Console > Project Settings 中的設定一致
      const firebaseConfig = {
        apiKey: "AIzaSyAsdPV7Em9xIyr-2HjpyG4nbrcE7GdDUpg",
        authDomain: "home-bartending-lab.firebaseapp.com",
        projectId: "home-bartending-lab",
        storageBucket: "home-bartending-lab.firebasestorage.app",
        messagingSenderId: "975937953200",
        appId: "1:975937953200:web:49784e2b4aebe103c00a75",
        measurementId: "G-GF5BVYL7CY",
      };

      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
      const analytics = getAnalytics(app);
      const auth = getAuth(app);
      auth.languageCode = "zh-TW";
      const db = getFirestore(app);
      const provider = new GoogleAuthProvider();
      provider.addScope("profile");
      provider.addScope("email");
      provider.setCustomParameters({ prompt: "select_account" });

      // [除錯用] 驗證 Firebase 與資料庫初始化狀態
      if (app && db) {
        console.log(
          "%c✅ Firebase 與 Firestore 資料庫已成功初始化",
          "color: #10b981; font-weight: bold; font-size: 14px;"
        );
        console.log("目前連結專案 ID:", firebaseConfig.projectId);
      } else {
        console.error("❌ Firebase 初始化失敗");
      }

      // Expose to Global for Alpine.js
      window.firebaseService = {
        login: async () => {
          if (window.location.protocol === "file:") {
            alert(
              "Google 登入功能無法在檔案模式 (file://) 下運作。\n請使用 Local Server (例如 VSCode Live Server) 開啟此網頁。"
            );
            return;
          }
          try {
            await signInWithPopup(auth, provider);
            console.log("Google 登入成功");
          } catch (error) {
            console.error("Login failed", error);
            let errorMessage = "登入失敗: " + error.message;

            // 針對常見錯誤提供更清楚的提示
            if (error.code === "auth/configuration-not-found") {
              errorMessage =
                "設定錯誤 (auth/configuration-not-found)：\n請確認 Firebase Console > Authentication > Sign-in method 中已啟用「Google」登入供應商。";
            } else if (error.code === "auth/popup-closed-by-user") {
              errorMessage = "登入已取消 (視窗被關閉)";
            } else if (error.code === "auth/unauthorized-domain") {
              errorMessage =
                "網域未授權 (auth/unauthorized-domain)：\n目前的網域尚未加入 Firebase 白名單。\n請前往 Firebase Console > Authentication > Settings > Authorized domains 新增此網域。";
            }
            alert(errorMessage);
          }
        },
        logout: async () => {
          await signOut(auth);
        },
        save: async (uid, data) => {
          try {
            await setDoc(
              doc(db, "users", uid),
              { content: data, updatedAt: new Date() },
              { merge: true }
            );
            alert("☁️ 雲端備份成功！");
          } catch (e) {
            console.error("Save failed", e);
            alert("備份失敗: " + e.message);
          }
        },
        load: async (uid) => {
          try {
            const docSnap = await getDoc(doc(db, "users", uid));
            return docSnap.exists() ? docSnap.data().content : null;
          } catch (e) {
            console.error("Load failed", e);
            alert("讀取失敗: " + e.message);
            return null;
          }
        },
        onAuth: (cb) => {
          return onAuthStateChanged(auth, (user) => {
            // 轉換為純物件，避免 Alpine.js Proxy 與 Firebase User 物件衝突導致 UI 無法更新
            if (user) {
              const { uid, displayName, email, photoURL } = user;
              cb({ uid, displayName, email, photoURL });
            } else {
              cb(null);
            }
          });
        },
      };

      // Notify Alpine that Firebase is ready
      window.dispatchEvent(new Event("firebase-ready"));
    </script>

    <style>
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fade-in {
        animation: fadeIn 0.4s ease-out forwards;
      }
      /* 統一全站卷軸樣式 */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #cbd5e1;
        border-radius: 99px;
      }
      ::-webkit-scrollbar-thumb:hover {
        background: #94a3b8;
      }
      [x-cloak] {
        display: none !important;
      }
      html {
        overflow-y: scroll;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
    </style>

    <script>
      // 在 Alpine 載入前先定義邏輯，確保初始化時能找到資料
      document.addEventListener("alpine:init", () => {
        Alpine.data("cocktailApp", () => ({
          activeTab: "home",
          isBottleFormOpen: false,
          isModifierFormOpen: false,
          isRecipeFormOpen: false,
          isRecipeModalOpen: false,
          isNoteModalOpen: false,
          selectedRecipe: null,
          darkMode: localStorage.getItem("theme") === "dark",
          isSidebarOpen: window.innerWidth >= 768,
          searchQuery: "",
          myIngredients: ["gin", "tonic", "juice_lime"],
          myBottles: [],
          shoppingList: [],
          editingBottleId: null,
          editingRecipeId: null,
          favoriteRecipes: [],
          filterBase: "all",
          filterDifficulty: "all",
          filterStyle: "all",
          // Firebase User State
          user: null,
          // 設定與偏好
          barName: "居家調酒實驗室",
          bartenderName: "Home Mixology Lab",
          unit: "ml",
          // 輪盤資料
          rouletteRotation: 0,
          isSpinning: false,
          rouletteResult: null,
          rouletteCandidates: [],
          menuSelectedRecipes: [],
          isMenuGenerated: false,

          // 表單資料
          bottleForm: {
            typeId: "gin",
            name: "",
            brand: "",
            price: "",
            location: "",
            expirationDate: "",
            rating: 5,
            notes: "",
            tags: "",
            features: "",
            remaining: 100,
          },
          modifierForm: { categoryIndex: 0, name: "", desc: "", tag: "" },
          recipeForm: {
            name: "",
            category: "",
            abv: "",
            difficulty: 1,
            flavor: "",
            features: "",
            tags: "",
            ingredients: [],
            amounts: {},
            steps: "",
            tips: "",
          },
          noteForm: { id: null, name: "", rating: 0, notes: "" },

          navigation: [
            { id: "home", label: "首頁", icon: "book-open" },
            { id: "spirits", label: "六大基酒", icon: "wine" },
            { id: "modifiers", label: "調味", icon: "leaf" },
            { id: "recipes", label: "酒譜庫", icon: "search" },
            { id: "favorites", label: "我的最愛", icon: "heart" },
            { id: "bar", label: "吧檯", icon: "martini" },
            { id: "roulette", label: "喝什麼", icon: "dices" },
            { id: "menu", label: "派對酒單", icon: "clipboard-list" },
            { id: "collection", label: "酒櫃", icon: "archive" },
            { id: "settings", label: "設定", icon: "settings" },
          ],

          shopItems: [
            { name: "高登琴酒 (Gordon's)", price: 380, icon: "wine" },
            { name: "舒味思通寧水 (2罐)", price: 50, icon: "beer" },
            { name: "新鮮檸檬 (1顆)", price: 15, icon: "citrus" },
            { name: "超商硬冰塊 (1包)", price: 25, icon: "zap" },
          ],

          spiritsData: [
            {
              id: "gin",
              name: "琴酒 (Gin)",
              engName: "The Perfume of Cocktails",
              desc: "被稱為「香氣魔術師」。以穀物為基底，將杜松子與各種藥草香料蒸餾而成。",
              abv: "37.5%-47%",
              origin: "荷蘭/英國",
              tags: ["清新", "草本"],
              color: "bg-green-100 text-green-800",
              icon: "wine",
            },
            {
              id: "vodka",
              name: "伏特加 (Vodka)",
              engName: "Pure & Clean",
              desc: "最純淨的畫布。通常由穀物或馬鈴薯發酵蒸餾，經過多次過濾。",
              abv: "40%",
              origin: "俄羅斯/波蘭",
              tags: ["純淨", "百搭"],
              color: "bg-blue-100 text-blue-800",
              icon: "glass-water",
            },
            {
              id: "whiskey",
              name: "威士忌 (Whiskey)",
              engName: "Water of Life",
              desc: "成熟紳士的代名詞。風味涵蓋花果香、焦糖，甚至泥煤煙燻味。",
              abv: "40%+",
              origin: "多國",
              tags: ["濃郁", "木質"],
              color: "bg-amber-100 text-amber-800",
              icon: "wine",
            },
            {
              id: "rum",
              name: "蘭姆酒 (Rum)",
              engName: "Spirit of the Caribbean",
              desc: "熱情的甜點師。風味自帶甜感，聞起來有熱帶水果或焦糖香。",
              abv: "40%+",
              origin: "加勒比海",
              tags: ["甜美", "熱帶"],
              color: "bg-yellow-100 text-yellow-800",
              icon: "wine",
            },
            {
              id: "tequila",
              name: "龍舌蘭 (Tequila)",
              engName: "Soul of Mexico",
              desc: "狂野的搖滾樂手。只能使用「藍色龍舌蘭」草心釀造。",
              abv: "35%+",
              origin: "墨西哥",
              tags: ["獨特", "派對"],
              color: "bg-orange-100 text-orange-800",
              icon: "zap",
            },
            {
              id: "brandy",
              name: "白蘭地 (Brandy)",
              engName: "Burnt Wine",
              desc: "華麗的貴族。口感圓潤，帶有濃縮葡萄果香與花香。",
              abv: "40%",
              origin: "法國",
              tags: ["高貴", "果香"],
              color: "bg-purple-100 text-purple-800",
              icon: "wine",
            },
          ],

          modifiers: [
            {
              category: "氣泡與副材料 (Mixers)",
              iconType: "glass-water",
              items: [
                {
                  id: "tonic",
                  name: "通寧水",
                  desc: "帶有奎寧苦味，琴酒靈魂伴侶。",
                  tag: "氣泡",
                },
                { id: "soda", name: "蘇打水", desc: "無味清爽。", tag: "氣泡" },
                {
                  id: "coke",
                  name: "可樂",
                  desc: "蘭姆酒好拍檔。",
                  tag: "氣泡",
                },
                {
                  id: "ginger_beer",
                  name: "薑汁汽水",
                  desc: "辛辣氣泡感。",
                  tag: "氣泡",
                },
                {
                  id: "sprite",
                  name: "雪碧",
                  desc: "檸檬風味汽水。",
                  tag: "氣泡",
                },
                {
                  id: "ginger_ale",
                  name: "薑汁汽水 (Ale)",
                  desc: "溫和的薑味汽水。",
                  tag: "氣泡",
                },
                {
                  id: "soda_grapefruit",
                  name: "葡萄柚汽水",
                  desc: "帕洛瑪調酒靈魂。",
                  tag: "氣泡",
                },
                {
                  id: "coffee_espresso",
                  name: "濃縮咖啡",
                  desc: "咖啡馬丁尼基底。",
                  tag: "咖啡",
                },
                {
                  id: "coffee_hot",
                  name: "熱咖啡",
                  desc: "愛爾蘭咖啡用。",
                  tag: "咖啡",
                },
                {
                  id: "coconut_milk",
                  name: "椰奶",
                  desc: "濃郁熱帶風味。",
                  tag: "奶香",
                },
              ],
            },
            {
              category: "利口酒 & 加烈酒 (Liqueurs)",
              iconType: "wine",
              items: [
                {
                  id: "orange_liqueur",
                  name: "橙酒 (Cointreau)",
                  desc: "濃郁柑橘香氣，調酒必備。",
                  tag: "甜",
                },
                {
                  id: "campari",
                  name: "金巴利 (Campari)",
                  desc: "義大利藥草苦酒，開胃酒之王。",
                  tag: "苦",
                },
                {
                  id: "vermouth_dry",
                  name: "不甜香艾酒",
                  desc: "白葡萄酒基底，馬丁尼專用。",
                  tag: "草本",
                },
                {
                  id: "vermouth_sweet",
                  name: "甜香艾酒",
                  desc: "紅葡萄酒基底，色澤深紅。",
                  tag: "甜",
                },
                {
                  id: "kahlua",
                  name: "咖啡利口酒",
                  desc: "濃郁咖啡香與香草味。",
                  tag: "甜",
                },
                {
                  id: "baileys",
                  name: "貝禮詩奶酒",
                  desc: "愛爾蘭威士忌與鮮奶油。",
                  tag: "奶香",
                },
                {
                  id: "liqueur_cherry",
                  name: "櫻桃白蘭地",
                  desc: "帶有櫻桃果香。",
                  tag: "甜",
                },
                {
                  id: "liqueur_benedictine",
                  name: "班尼迪克汀",
                  desc: "藥草利口酒。",
                  tag: "藥草",
                },
                {
                  id: "liqueur_violet",
                  name: "紫羅蘭酒",
                  desc: "夢幻紫色花香。",
                  tag: "花香",
                },
                {
                  id: "liqueur_maraschino",
                  name: "黑櫻桃酒",
                  desc: "獨特果核香氣。",
                  tag: "甜",
                },
                {
                  id: "lillet_blanc",
                  name: "麗葉酒",
                  desc: "法國開胃酒。",
                  tag: "花果",
                },
                {
                  id: "absinthe",
                  name: "艾碧斯",
                  desc: "綠色精靈，茴香。",
                  tag: "藥草",
                },
                {
                  id: "liqueur_peach",
                  name: "水蜜桃酒",
                  desc: "香甜水蜜桃味。",
                  tag: "果香",
                },
                {
                  id: "rum_dark",
                  name: "深色蘭姆酒",
                  desc: "陳年風味，焦糖香。",
                  tag: "基酒",
                },
                {
                  id: "rum_151",
                  name: "151 蘭姆酒",
                  desc: "75.5% 高濃度烈酒。",
                  tag: "烈酒",
                },
                {
                  id: "liqueur_cassis",
                  name: "黑醋栗利口酒",
                  desc: "酸甜莓果味。",
                  tag: "果香",
                },
                {
                  id: "liqueur_cacao",
                  name: "可可酒",
                  desc: "巧克力風味。",
                  tag: "甜",
                },
                {
                  id: "pisco",
                  name: "皮斯可",
                  desc: "秘魯葡萄蒸餾酒。",
                  tag: "基酒",
                },
                {
                  id: "aperol",
                  name: "艾普羅",
                  desc: "義大利橘色開胃酒。",
                  tag: "苦甜",
                },
                {
                  id: "sparkling_wine",
                  name: "氣泡酒",
                  desc: "Prosecco 或香檳。",
                  tag: "氣泡",
                },
                {
                  id: "liqueur_mint",
                  name: "薄荷酒",
                  desc: "綠色清涼薄荷。",
                  tag: "香草",
                },
                {
                  id: "liqueur_amaretto",
                  name: "杏仁酒",
                  desc: "杏仁豆腐風味。",
                  tag: "甜",
                },
                {
                  id: "sloe_gin",
                  name: "黑刺李琴酒",
                  desc: "莓果風味琴酒。",
                  tag: "果香",
                },
                {
                  id: "liqueur_apricot",
                  name: "杏桃白蘭地",
                  desc: "杏桃果香。",
                  tag: "果香",
                },
                {
                  id: "liqueur_drambuie",
                  name: "蜂蜜威士忌酒",
                  desc: "蘇格蘭藥草蜂蜜酒。",
                  tag: "甜",
                },
                {
                  id: "whiskey_peat",
                  name: "泥煤威士忌",
                  desc: "強烈煙燻消毒水味。",
                  tag: "煙燻",
                },
              ],
            },
            {
              category: "酸甜與果汁 (Juices & Syrups)",
              iconType: "citrus",
              items: [
                {
                  id: "juice_lemon",
                  name: "黃檸檬汁",
                  desc: "溫和酸度，帶有清香。",
                  tag: "酸",
                },
                {
                  id: "juice_lime",
                  name: "綠萊姆汁",
                  desc: "尖銳酸度，熱帶調酒靈魂。",
                  tag: "酸",
                },
                {
                  id: "juice_orange",
                  name: "柳橙汁",
                  desc: "新鮮現榨為佳。",
                  tag: "果香",
                },
                {
                  id: "juice_cranberry",
                  name: "蔓越莓汁",
                  desc: "酸甜澀感，色澤鮮豔。",
                  tag: "果香",
                },
                {
                  id: "syrup_simple",
                  name: "糖漿 (Simple)",
                  desc: "1:1 砂糖水，平衡酸度。",
                  tag: "甜",
                },
                {
                  id: "grenadine",
                  name: "紅石榴糖漿",
                  desc: "鮮紅調色用，莓果風味。",
                  tag: "甜",
                },
                {
                  id: "honey",
                  name: "蜂蜜",
                  desc: "獨特花蜜香氣。",
                  tag: "甜",
                },
                {
                  id: "juice_pineapple",
                  name: "鳳梨汁",
                  desc: "熱帶水果之王。",
                  tag: "果香",
                },
                {
                  id: "juice_tomato",
                  name: "番茄汁",
                  desc: "血腥瑪麗必備。",
                  tag: "蔬果",
                },
                {
                  id: "syrup_almond",
                  name: "杏仁糖漿",
                  desc: "Tiki 調酒常用。",
                  tag: "甜",
                },
                {
                  id: "syrup_passion",
                  name: "百香果糖漿",
                  desc: "熱帶酸甜風味。",
                  tag: "酸甜",
                },
                {
                  id: "syrup_agave",
                  name: "龍舌蘭糖漿",
                  desc: "獨特植物甜味。",
                  tag: "甜",
                },
                {
                  id: "sugar",
                  name: "砂糖/方糖",
                  desc: "基礎甜味來源。",
                  tag: "甜",
                },
                {
                  id: "syrup_ginger",
                  name: "薑糖漿",
                  desc: "辛辣甜味。",
                  tag: "辛辣",
                },
                {
                  id: "juice_grapefruit",
                  name: "葡萄柚汁",
                  desc: "帶有苦味的柑橘果汁。",
                  tag: "果香",
                },
              ],
            },
            {
              category: "裝飾與苦精 (Garnish & Bitters)",
              iconType: "flower",
              items: [
                {
                  id: "bitters_angostura",
                  name: "安格氏苦精",
                  desc: "調酒的鹽巴，增加層次。",
                  tag: "苦",
                },
                {
                  id: "mint",
                  name: "薄荷葉",
                  desc: "拍打後釋放清涼香氣。",
                  tag: "香草",
                },
                {
                  id: "olive",
                  name: "橄欖",
                  desc: "馬丁尼標配，帶有鹹味。",
                  tag: "鹹",
                },
                {
                  id: "salt",
                  name: "鹽",
                  desc: "杯口鹽圈 (Rim) 使用。",
                  tag: "鹹",
                },
                {
                  id: "orange_peel",
                  name: "橙皮",
                  desc: "擠壓皮油增添香氣。",
                  tag: "香氣",
                },
                {
                  id: "sauce_worcestershire",
                  name: "伍斯特醬",
                  desc: "英式烏醋。",
                  tag: "鹹鮮",
                },
                {
                  id: "sauce_tabasco",
                  name: "辣椒醬",
                  desc: "增加辛辣感。",
                  tag: "辣",
                },
                {
                  id: "celery",
                  name: "芹菜",
                  desc: "裝飾與提味。",
                  tag: "蔬果",
                },
                {
                  id: "cream",
                  name: "鮮奶油",
                  desc: "增加綿密口感。",
                  tag: "奶香",
                },
                {
                  id: "egg_white",
                  name: "蛋白",
                  desc: "搖盪產生綿密泡沫。",
                  tag: "口感",
                },
                {
                  id: "nutmeg",
                  name: "肉豆蔻",
                  desc: "磨粉增添香氣。",
                  tag: "香料",
                },
                {
                  id: "cucumber",
                  name: "小黃瓜",
                  desc: "清爽瓜果香氣。",
                  tag: "蔬果",
                },
                {
                  id: "basil",
                  name: "羅勒",
                  desc: "獨特草本香氣。",
                  tag: "香草",
                },
              ],
            },
          ],

          categoryNames: {
            base: "基酒",
            liqueur: "利口酒",
            mixer: "副材料與調味",
            fresh: "新鮮蔬果",
            pantry: "調味",
          },

          recipes: [
            {
              id: 1,
              name: "Gin Tonic (琴通寧)",
              category: "Gin / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["經典", "氣泡", "清爽"],
              flavor: "清爽氣泡、微苦回甘",
              features: "琴酒與通寧水的完美結合，簡單卻考驗細節的經典調酒。",
              ingredients: [
                { id: "gin", amount: "45ml" },
                { id: "tonic", amount: "補滿 (約120ml)" },
                { id: "juice_lemon", amount: "1個" },
              ],
              steps: [
                "將高球杯裝滿冰塊。",
                "倒入琴酒。",
                "沿著杯壁緩緩倒入通寧水（保留氣泡）。",
                "輕輕提拉冰塊混合（勿過度攪拌）。",
                "擠入檸檬汁並將檸檬角放入杯中。",
              ],
              tips: "冰塊要裝滿杯子，通寧水要冰鎮。",
            },
            {
              id: 2,
              name: "Dry Martini (干馬丁尼)",
              category: "Gin / 攪拌法 (Stir)",
              abv: "高 (~30%)",
              difficulty: 3,
              tags: ["雞尾酒之王", "辛辣", "高酒精"],
              flavor: "辛辣、乾燥、草本香氣",
              features: "被譽為雞尾酒之王，展現琴酒與香艾酒的完美結合。",
              ingredients: [
                { id: "gin", amount: "60ml" },
                { id: "vermouth_dry", amount: "10ml" },
                { id: "olive", amount: "1顆" },
              ],
              steps: [
                "預先將馬丁尼杯冰鎮。",
                "在攪拌杯中加入冰塊。",
                "倒入琴酒與香艾酒。",
                "使用吧叉匙攪拌約 30-45 秒至充分冷卻。",
                "濾掉冰塊，倒入馬丁尼杯。",
                "放入橄欖裝飾。",
              ],
              tips: "攪拌(Stir)而非搖盪，保持酒體清澈如水。",
            },
            {
              id: 3,
              name: "Negroni (內格羅尼)",
              category: "Gin / 攪拌法 (Stir)",
              abv: "中高 (~24%)",
              difficulty: 2,
              tags: ["苦甜", "經典", "開胃"],
              flavor: "苦甜平衡、藥草香",
              features: "義大利經典開胃酒，苦甜風味令人著迷，藥草香氣濃郁。",
              ingredients: [
                { id: "gin", amount: "30ml" },
                { id: "campari", amount: "30ml" },
                { id: "vermouth_sweet", amount: "30ml" },
                { id: "orange_peel", amount: "1片" },
              ],
              steps: [
                "在岩石杯中放入一顆大冰塊。",
                "依序倒入琴酒、金巴利與甜香艾酒。",
                "攪拌約 20 秒使其混合冷卻。",
                "擠壓橙皮釋放精油，並放入杯中裝飾。",
              ],
              tips: "經典 1:1:1 比例，加冰攪拌冷卻即可。",
            },
            {
              id: 4,
              name: "Gimlet (琴蕾)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["酸甜", "經典", "短飲"],
              flavor: "酸甜銳利、清新",
              features: "雷蒙德·錢德勒筆下的經典，酸甜銳利，清新爽口。",
              ingredients: [
                { id: "gin", amount: "60ml" },
                { id: "juice_lime", amount: "22.5ml" },
                { id: "syrup_simple", amount: "22.5ml" },
              ],
              steps: [
                "將材料倒入雪克杯。",
                "加入冰塊用力搖盪（Shake）。",
                "濾入冰鎮過的淺碟香檳杯。",
              ],
              tips: "使用新鮮萊姆汁風味最佳。",
            },
            {
              id: 5,
              name: "White Lady (白色佳人)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中高 (~22%)",
              difficulty: 2,
              tags: ["三合一", "經典", "短飲"],
              flavor: "柑橘香、酸甜、優雅",
              features: "優雅的白色雞尾酒，帶有細緻的柑橘香氣與酸甜口感。",
              ingredients: [
                { id: "gin", amount: "40ml" },
                { id: "orange_liqueur", amount: "30ml" },
                { id: "juice_lemon", amount: "20ml" },
              ],
              steps: [
                "將所有材料倒入雪克杯。",
                "加入冰塊搖盪均勻。",
                "濾入冰鎮過的雞尾酒杯。",
              ],
              tips: "搖盪要充分，使酒體產生綿密口感。",
            },
            {
              id: 6,
              name: "Singapore Sling (新加坡司令)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中 (~15%)",
              difficulty: 3,
              tags: ["長飲", "熱帶", "複雜"],
              flavor: "熱帶水果、甜美、層次豐富",
              features: "源自新加坡萊佛士酒店，充滿熱帶風情的華麗調酒。",
              ingredients: [
                { id: "gin", amount: "30ml" },
                { id: "liqueur_cherry", amount: "15ml" },
                { id: "liqueur_benedictine", amount: "7.5ml" },
                { id: "orange_liqueur", amount: "7.5ml" },
                { id: "juice_pineapple", amount: "120ml" },
                { id: "juice_lime", amount: "15ml" },
                { id: "grenadine", amount: "10ml" },
                { id: "bitters_angostura", amount: "1滴" },
              ],
              steps: [
                "將所有材料倒入雪克杯。",
                "加入冰塊用力搖盪。",
                "過濾倒入裝滿冰塊的高球杯。",
                "以鳳梨片與櫻桃裝飾。",
              ],
              tips: "材料繁多，比例需精準控制。",
            },
            {
              id: 7,
              name: "Tom Collins (湯姆柯林斯)",
              category: "Gin / 直調法 (Build)",
              abv: "低 (~12%)",
              difficulty: 1,
              tags: ["長飲", "夏日", "解渴"],
              flavor: "檸檬汽水感、清爽",
              features: "經典的琴酒檸檬蘇打，夏日解渴首選。",
              ingredients: [
                { id: "gin", amount: "45ml" },
                { id: "juice_lemon", amount: "30ml" },
                { id: "syrup_simple", amount: "15ml" },
                { id: "soda", amount: "補滿" },
              ],
              steps: [
                "在高球杯中加入琴酒、檸檬汁與糖漿攪拌。",
                "加入冰塊。",
                "補滿蘇打水並輕輕提拉。",
                "放入檸檬片裝飾。",
              ],
              tips: "使用新鮮檸檬汁口感更佳。",
            },
            {
              id: 8,
              name: "Bee's Knees (蜜蜂之膝)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 2,
              tags: ["禁酒令時期", "酸甜", "復古"],
              flavor: "蜂蜜香、酸甜、圓潤",
              features: "禁酒令時期的經典，蜂蜜的甜潤中和了琴酒的銳利。",
              ingredients: [
                { id: "gin", amount: "60ml" },
                { id: "juice_lemon", amount: "22.5ml" },
                { id: "honey", amount: "22.5ml" },
              ],
              steps: [
                "將琴酒、檸檬汁與蜂蜜糖漿倒入雪克杯。",
                "加冰搖盪至冷卻。",
                "濾入冰鎮過的雞尾酒杯。",
              ],
              tips: "蜂蜜糖漿可用蜂蜜與水 1:1 調製以便溶解。",
            },
            {
              id: 9,
              name: "Aviation (飛行)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 3,
              tags: ["花香", "經典", "視覺系"],
              flavor: "花香、夢幻藍紫色",
              features: "帶有夢幻紫羅蘭花香的經典調酒，色澤如天空般迷人。",
              ingredients: [
                { id: "gin", amount: "45ml" },
                { id: "liqueur_violet", amount: "5ml" },
                { id: "liqueur_maraschino", amount: "15ml" },
                { id: "juice_lemon", amount: "15ml" },
              ],
              steps: [
                "將所有材料倒入雪克杯。",
                "加冰搖盪。",
                "雙重過濾倒入馬丁尼杯。",
                "沉入一顆酒漬櫻桃。",
              ],
              tips: "紫羅蘭酒用量需謹慎，以免蓋過其他風味。",
            },
            {
              id: 10,
              name: "Corpse Reviver #2 (亡者復甦二號)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中高 (~22%)",
              difficulty: 3,
              tags: ["醒酒酒", "經典", "層次豐富"],
              flavor: "柑橘、藥草、茴香尾韻",
              features: "著名的醒酒酒，層次豐富，帶有淡淡的艾碧斯香氣。",
              ingredients: [
                { id: "gin", amount: "22.5ml" },
                { id: "orange_liqueur", amount: "22.5ml" },
                { id: "lillet_blanc", amount: "22.5ml" },
                { id: "juice_lemon", amount: "22.5ml" },
                { id: "absinthe", amount: "1滴" },
              ],
              steps: [
                "在冰鎮的杯中倒入艾碧斯刷杯後倒掉。",
                "將其他材料加入雪克杯搖盪。",
                "濾入杯中。",
              ],
              tips: "艾碧斯刷杯能提供香氣而不搶味。",
            },
            {
              id: 11,
              name: "Moscow Mule (莫斯科騾子)",
              category: "Vodka / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["銅杯", "長飲", "派對"],
              flavor: "薑味辛辣、清爽",
              features: "使用銅杯盛裝的經典調酒，薑汁汽水帶來清爽辛辣感。",
              ingredients: [
                { id: "vodka", amount: "45ml" },
                { id: "ginger_beer", amount: "補滿 (約120ml)" },
                { id: "juice_lemon", amount: "10ml" },
              ],
              steps: [
                "銅馬克杯裝滿冰塊。",
                "倒入伏特加與檸檬汁。",
                "補滿薑汁汽水。",
                "輕輕攪拌，放上薄荷葉裝飾。",
              ],
              tips: "銅杯能保持冰涼口感。",
            },
            {
              id: 12,
              name: "Cosmopolitan (柯夢波丹)",
              category: "Vodka / 搖盪法 (Shake)",
              abv: "中 (~18%)",
              difficulty: 2,
              tags: ["都會", "女性喜愛", "短飲"],
              flavor: "莓果酸甜、粉紅時尚",
              features: "慾望城市女主角的最愛，時尚與性感的象徵。",
              ingredients: [
                { id: "vodka", amount: "40ml" },
                { id: "orange_liqueur", amount: "15ml" },
                { id: "juice_cranberry", amount: "30ml" },
                { id: "juice_lemon", amount: "15ml" },
              ],
              steps: [
                "將液體材料加入雪克杯。",
                "加冰搖盪。",
                "濾入馬丁尼杯。",
                "噴附橙皮油。",
              ],
              tips: "搖盪後濾掉冰塊，呈現粉紅色澤。",
            },
            {
              id: 13,
              name: "Bloody Mary (血腥瑪麗)",
              category: "Vodka / 滾動法 (Roll)",
              abv: "低 (~10%)",
              difficulty: 2,
              tags: ["解宿醉", "早午餐", "鹹味"],
              flavor: "鹹鮮、辛辣、蔬菜味",
              features: "著名的解宿醉酒，口感豐富如冷湯。",
              ingredients: [
                { id: "vodka", amount: "45ml" },
                { id: "juice_tomato", amount: "90ml" },
                { id: "juice_lemon", amount: "15ml" },
                { id: "sauce_worcestershire", amount: "適量" },
                { id: "sauce_tabasco", amount: "適量" },
                { id: "celery", amount: "1根" },
              ],
              steps: [
                "雪克杯加冰與所有材料。",
                "使用滾動法（Rolling）混和避免番茄汁過度起泡。",
                "倒入裝滿冰的高球杯。",
                "插入芹菜棒。",
              ],
              tips: "可依個人口味調整辣度與鹹度。",
            },
            {
              id: 14,
              name: "Espresso Martini (咖啡馬丁尼)",
              category: "Vodka / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 3,
              tags: ["餐後酒", "提神", "甜點系"],
              flavor: "濃郁咖啡、綿密泡沫",
              features: "結合咖啡與酒精的現代經典，泡沫綿密。",
              ingredients: [
                { id: "vodka", amount: "40ml" },
                { id: "kahlua", amount: "20ml" },
                { id: "coffee_espresso", amount: "30ml" },
                { id: "syrup_simple", amount: "5-10ml" },
              ],
              steps: [
                "將液體材料加入雪克杯。",
                "加入大量冰塊用力搖盪（Hard Shake）。",
                "濾入馬丁尼杯。",
                "放上三顆咖啡豆裝飾。",
              ],
              tips: "必須趁熱縮咖啡新鮮時搖盪，泡沫才豐富。",
            },
            {
              id: 15,
              name: "Screwdriver (螺絲起子)",
              category: "Vodka / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["派對", "超簡單", "長飲"],
              flavor: "果汁感、簡單",
              features: "最簡單的伏特加調酒，據說是用螺絲起子攪拌而得名。",
              ingredients: [
                { id: "vodka", amount: "45ml" },
                { id: "juice_orange", amount: "補滿" },
              ],
              steps: [
                "高球杯裝滿冰塊。",
                "倒入伏特加。",
                "補滿柳橙汁。",
                "攪拌均勻。",
              ],
              tips: "使用新鮮柳橙汁風味最佳。",
            },
            {
              id: 16,
              name: "White Russian (白色俄羅斯)",
              category: "Vodka / 直調法 (Build)",
              abv: "中 (~18%)",
              difficulty: 1,
              tags: ["甜點系", "餐後", "奶香"],
              flavor: "咖啡牛奶、滑順、甜美",
              features: "如甜點般的調酒，滑順的鮮奶油與咖啡酒完美融合。",
              ingredients: [
                { id: "vodka", amount: "40ml" },
                { id: "kahlua", amount: "20ml" },
                { id: "cream", amount: "30ml" },
              ],
              steps: [
                "在古典杯中加入冰塊。",
                "倒入伏特加與咖啡酒攪拌。",
                "將鮮奶油緩緩倒在表面使其漂浮。",
              ],
              tips: "鮮奶油可稍微打發，層次更分明。",
            },
            {
              id: 17,
              name: "Black Russian (黑色俄羅斯)",
              category: "Vodka / 攪拌法 (Stir)",
              abv: "高 (~30%)",
              difficulty: 1,
              tags: ["重口味", "經典", "簡單"],
              flavor: "咖啡苦甜、酒精感重",
              features: "白色俄羅斯的前身，風味更為濃烈直接。",
              ingredients: [
                { id: "vodka", amount: "50ml" },
                { id: "kahlua", amount: "20ml" },
              ],
              steps: [
                "在古典杯中加入冰塊。",
                "倒入伏特加與咖啡酒。",
                "輕輕攪拌冷卻。",
              ],
              tips: "適合喜愛重口味的飲用者。",
            },
            {
              id: 18,
              name: "Kamikaze (神風特攻隊)",
              category: "Vodka / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["Shot", "酸味", "派對"],
              flavor: "酸度強烈、清爽醒腦",
              features: "酸度強烈，常以 Shot 的形式飲用。",
              ingredients: [
                { id: "vodka", amount: "30ml" },
                { id: "orange_liqueur", amount: "30ml" },
                { id: "juice_lemon", amount: "30ml" },
              ],
              steps: [
                "將材料倒入雪克杯。",
                "加冰搖盪。",
                "濾入一口杯(Shot)或雞尾酒杯。",
              ],
              tips: "比例 1:1:1，簡單易記。",
            },
            {
              id: 19,
              name: "Sex on the Beach (性慾海灘)",
              category: "Vodka / 直調法 (Build)",
              abv: "低 (~12%)",
              difficulty: 1,
              tags: ["長飲", "派對", "妹酒"],
              flavor: "熱帶水果、甜美",
              features: "名字大膽，風味卻是甜美的熱帶水果風情。",
              ingredients: [
                { id: "vodka", amount: "40ml" },
                { id: "liqueur_peach", amount: "20ml" },
                { id: "juice_orange", amount: "40ml" },
                { id: "juice_cranberry", amount: "40ml" },
              ],
              steps: [
                "高球杯裝滿冰塊。",
                "依序倒入所有材料。",
                "攪拌均勻，以柳橙片裝飾。",
              ],
              tips: "分層倒入可製造視覺效果。",
            },
            {
              id: 20,
              name: "Vesper (維斯佩爾)",
              category: "Vodka/Gin / 搖盪法 (Shake)",
              abv: "高 (~35%)",
              difficulty: 2,
              tags: ["007", "電影", "重酒感"],
              flavor: "強烈、草本、007最愛",
              features: "007 龐德的原創酒譜，結合琴酒與伏特加的烈性。",
              ingredients: [
                { id: "gin", amount: "45ml" },
                { id: "vodka", amount: "15ml" },
                { id: "lillet_blanc", amount: "7.5ml" },
              ],
              steps: [
                "將酒類加入雪克杯。",
                "加冰用力搖盪。",
                "濾入馬丁尼杯。",
                "削檸檬皮裝飾。",
              ],
              tips: "Shaken, not stirred.",
            },
            {
              id: 21,
              name: "Mojito (莫希托)",
              category: "Rum / 直調+搗碎 (Muddle)",
              abv: "低 (~10%)",
              difficulty: 2,
              tags: ["夏日", "人氣", "長飲"],
              flavor: "薄荷清涼、酸甜",
              features: "古巴國民調酒，夏日消暑首選。",
              ingredients: [
                { id: "rum", amount: "45ml" },
                { id: "mint", amount: "8-10片" },
                { id: "sugar", amount: "2茶匙" },
                { id: "juice_lime", amount: "2個(萊姆角)" },
                { id: "soda", amount: "補滿" },
              ],
              steps: [
                "杯中放入薄荷、糖與萊姆角輕輕搗壓。",
                "加入碎冰與蘭姆酒攪拌。",
                "補滿蘇打水與碎冰。",
              ],
              tips: "輕壓薄荷葉即可，不要搗碎以免產生苦味。",
            },
            {
              id: 22,
              name: "Daiquiri (戴基里)",
              category: "Rum / 搖盪法 (Shake)",
              abv: "中高 (~22%)",
              difficulty: 2,
              tags: ["三合一", "經典", "海明威"],
              flavor: "酸甜平衡、清爽",
              features: "海明威的最愛，考驗調酒師功力的經典酸酒。",
              ingredients: [
                { id: "rum", amount: "60ml" },
                { id: "juice_lime", amount: "20ml" },
                { id: "syrup_simple", amount: "20ml" },
              ],
              steps: [
                "將材料加入雪克杯。",
                "加冰搖盪。",
                "濾入冰鎮過的淺碟香檳杯。",
              ],
              tips: "搖盪要猛烈，產生細緻碎冰口感。",
            },
            {
              id: 23,
              name: "Cuba Libre (自由古巴)",
              category: "Rum / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["簡單", "派對", "長飲"],
              flavor: "可樂甜、微酸",
              features: "慶祝古巴獨立的酒款，簡單卻經典。",
              ingredients: [
                { id: "rum", amount: "50ml" },
                { id: "coke", amount: "120ml" },
                { id: "juice_lime", amount: "10ml" },
              ],
              steps: [
                "高球杯裝滿冰塊。",
                "擠入萊姆汁，倒入蘭姆酒。",
                "補滿可樂。",
                "放入萊姆角。",
              ],
              tips: "加入萊姆汁是與 Rum Coke 的區別。",
            },
            {
              id: 24,
              name: "Mai Tai (邁泰)",
              category: "Rum / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 3,
              tags: ["Tiki", "熱帶", "度假"],
              flavor: "熱帶水果、堅果香、豐富",
              features: "Tiki 調酒的代表作，層次豐富的熱帶風味。",
              ingredients: [
                { id: "rum", amount: "30ml" },
                { id: "rum_dark", amount: "30ml" },
                { id: "orange_liqueur", amount: "15ml" },
                { id: "syrup_almond", amount: "10ml" },
                { id: "juice_lime", amount: "30ml" },
              ],
              steps: [
                "除深色蘭姆酒外，其他材料加冰搖盪。",
                "倒入裝滿碎冰的杯中。",
                "漂浮深色蘭姆酒。",
                "裝飾薄荷葉。",
              ],
              tips: "使用高品質的杏仁糖漿是關鍵。",
            },
            {
              id: 25,
              name: "Piña Colada (鳳梨可樂達)",
              category: "Rum / 混合法 (Blend)",
              abv: "低 (~12%)",
              difficulty: 2,
              tags: ["Tiki", "冰沙", "甜美"],
              flavor: "椰香、鳳梨、奶昔感",
              features: "波多黎各國酒，濃郁的椰奶與鳳梨香氣。",
              ingredients: [
                { id: "rum", amount: "30ml" },
                { id: "coconut_milk", amount: "30ml" },
                { id: "juice_pineapple", amount: "90ml" },
              ],
              steps: [
                "將材料與冰塊放入果汁機打成冰沙。",
                "倒入颶風杯。",
                "裝飾鳳梨片。",
              ],
              tips: "若無果汁機，可使用搖盪法代替。",
            },
            {
              id: 26,
              name: "Dark 'n' Stormy (月黑風高)",
              category: "Rum / 直調法 (Build)",
              abv: "低 (~12%)",
              difficulty: 1,
              tags: ["長飲", "辛辣", "經典"],
              flavor: "薑辣、焦糖、氣泡",
              features: "深色蘭姆酒漂浮在薑汁啤酒上，如暴風雨前的烏雲。",
              ingredients: [
                { id: "rum_dark", amount: "60ml" },
                { id: "ginger_beer", amount: "100ml" },
                { id: "juice_lime", amount: "10ml" },
              ],
              steps: [
                "高球杯裝滿冰塊。",
                "倒入薑汁啤酒與萊姆汁。",
                "將深色蘭姆酒緩緩倒在頂層。",
                "攪拌後飲用。",
              ],
              tips: "分層效果是視覺重點。",
            },
            {
              id: 27,
              name: "Zombie (殭屍)",
              category: "Rum / 搖盪法 (Shake)",
              abv: "高 (~30%)",
              difficulty: 4,
              tags: ["Tiki", "斷片酒", "高濃度"],
              flavor: "極度濃烈、果香掩蓋酒味",
              features: "Tiki 文化的傳奇，高酒精濃度卻順口易飲。",
              ingredients: [
                { id: "rum", amount: "30ml" },
                { id: "rum_dark", amount: "30ml" },
                { id: "rum_151", amount: "30ml" },
                { id: "juice_pineapple", amount: "30ml" },
                { id: "juice_lime", amount: "30ml" },
                { id: "syrup_passion", amount: "15ml" },
                { id: "bitters_angostura", amount: "1滴" },
              ],
              steps: [
                "除151外所有材料加冰搖盪。",
                "倒入碎冰杯。",
                "漂浮151蘭姆酒，可點火。",
              ],
              tips: "每人限點兩杯的強力調酒。",
            },
            {
              id: 28,
              name: "Jungle Bird (叢林鳥)",
              category: "Rum / 搖盪法 (Shake)",
              abv: "中 (~18%)",
              difficulty: 3,
              tags: ["Tiki", "苦味", "層次"],
              flavor: "苦甜交織、鳳梨香",
              features: "少數使用金巴利的 Tiki 調酒，苦甜風味獨特。",
              ingredients: [
                { id: "rum_dark", amount: "45ml" },
                { id: "campari", amount: "20ml" },
                { id: "juice_pineapple", amount: "45ml" },
                { id: "juice_lime", amount: "15ml" },
                { id: "syrup_simple", amount: "15ml" },
              ],
              steps: [
                "將所有材料加入雪克杯。",
                "加冰搖盪。",
                "濾入裝有大冰塊的古典杯。",
              ],
              tips: "鳳梨汁產生的泡沫能增加口感。",
            },
            {
              id: 29,
              name: "Canchanchara (坎昌查拉)",
              category: "Rum / 攪拌法 (Stir)",
              abv: "中 (~18%)",
              difficulty: 2,
              tags: ["古巴最古老", "簡單", "順口"],
              flavor: "蜂蜜甜潤、原始風味",
              features: "古巴最古老的調酒之一，使用蜂蜜帶來獨特風味。",
              ingredients: [
                { id: "rum", amount: "60ml" },
                { id: "honey", amount: "20ml" },
                { id: "juice_lime", amount: "20ml" },
              ],
              steps: [
                "混合蜂蜜水與萊姆汁。",
                "加入蘭姆酒與大量碎冰。",
                "快速攪拌至杯壁結霜。",
              ],
              tips: "使用陶杯盛裝更有風味。",
            },
            {
              id: 30,
              name: "X.Y.Z.",
              category: "Rum / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["短飲", "經典", "三合一"],
              flavor: "柑橘酸甜",
              features: "代表「結束」的調酒，意指這杯之後再無更好的選擇。",
              ingredients: [
                { id: "rum", amount: "30ml" },
                { id: "orange_liqueur", amount: "15ml" },
                { id: "juice_lemon", amount: "15ml" },
              ],
              steps: ["將材料加入雪克杯。", "加冰搖盪。", "濾入雞尾酒杯。"],
              tips: "側車 (Sidecar) 的蘭姆酒版本。",
            },
            {
              id: 31,
              name: "Old Fashioned (古典雞尾酒)",
              category: "Whiskey / 攪拌法 (Stir)",
              abv: "高 (~35%)",
              difficulty: 3,
              tags: ["經典", "硬漢", "慢飲"],
              flavor: "麥芽香、苦甜、陳穩",
              features: "最古老的雞尾酒形式，品味威士忌的最佳方式。",
              ingredients: [
                { id: "whiskey", amount: "60ml" },
                { id: "sugar", amount: "1顆" },
                { id: "bitters_angostura", amount: "2-3滴" },
                { id: "orange_peel", amount: "1片" },
              ],
              steps: [
                "方糖加苦精與少許水搗碎。",
                "加入大冰塊與一半威士忌攪拌。",
                "加剩餘威士忌攪拌至冷卻。",
                "噴附橙皮油。",
              ],
              tips: "慢慢攪拌融水，釋放威士忌香氣。",
            },
            {
              id: 32,
              name: "Whiskey Sour (威士忌酸酒)",
              category: "Whiskey / 搖盪法 (Shake)",
              abv: "中 (~18%)",
              difficulty: 2,
              tags: ["酸甜", "經典", "人氣"],
              flavor: "酸甜、滑順(若加蛋白)",
              features: "酸甜平衡的經典威士忌調酒，加入蛋白可增加綿密口感。",
              ingredients: [
                { id: "whiskey", amount: "45ml" },
                { id: "juice_lemon", amount: "30ml" },
                { id: "syrup_simple", amount: "15ml" },
                { id: "egg_white", amount: "1顆(選用)" },
              ],
              steps: [
                "將材料加入雪克杯。",
                "乾搖打發蛋白。",
                "加冰再次搖盪。",
                "濾入杯中。",
              ],
              tips: "乾搖 (Dry Shake) 是產生泡沫的關鍵。",
            },
            {
              id: 33,
              name: "Highball (威士忌蘇打)",
              category: "Whiskey / 直調法 (Build)",
              abv: "低 (~8%)",
              difficulty: 1,
              tags: ["居酒屋", "搭餐", "長飲"],
              flavor: "氣泡清爽、麥香",
              features: "極致清爽，能引出威士忌最純粹的香氣。",
              ingredients: [
                { id: "whiskey", amount: "45ml" },
                { id: "soda", amount: "補滿" },
                { id: "juice_lemon", amount: "1個(檸檬角)" },
              ],
              steps: [
                "冰杯。",
                "倒入威士忌攪拌。",
                "沿杯壁倒入蘇打水。",
                "輕輕提拉冰塊。",
                "加入檸檬角。",
              ],
              tips: "杯子與威士忌都要先冷凍過，氣泡更持久。",
            },
            {
              id: 34,
              name: "Manhattan (曼哈頓)",
              category: "Whiskey / 攪拌法 (Stir)",
              abv: "高 (~30%)",
              difficulty: 3,
              tags: ["雞尾酒之后", "短飲", "經典"],
              flavor: "藥草甜、濃厚、優雅",
              features: "被稱為雞尾酒之后，優雅而濃郁。",
              ingredients: [
                { id: "whiskey", amount: "50ml" },
                { id: "vermouth_sweet", amount: "20ml" },
                { id: "bitters_angostura", amount: "2滴" },
              ],
              steps: [
                "攪拌杯加冰。",
                "倒入所有材料。",
                "攪拌冷卻。",
                "濾入馬丁尼杯，放櫻桃。",
              ],
              tips: "建議使用裸麥威士忌 (Rye Whiskey)。",
            },
            {
              id: 35,
              name: "Mint Julep (薄荷朱利普)",
              category: "Whiskey / 直調+搗碎 (Muddle)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["賽馬酒", "夏日", "碎冰"],
              flavor: "極度冰涼、薄荷香、波本甜",
              features: "美國肯塔基賽馬的傳統飲料，極度冰涼消暑。",
              ingredients: [
                { id: "whiskey", amount: "60ml" },
                { id: "mint", amount: "8片" },
                { id: "syrup_simple", amount: "15ml" },
              ],
              steps: [
                "搗薄荷糖。",
                "加酒與碎冰攪拌至杯壁結霜。",
                "補滿碎冰與薄荷裝飾。",
              ],
              tips: "使用金屬杯能保持最佳冰度。",
            },
            {
              id: 36,
              name: "Boulevardier (林蔭大道)",
              category: "Whiskey / 攪拌法 (Stir)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["變化版", "苦味", "經典"],
              flavor: "Negroni威士忌版、苦甜",
              features: "Negroni 的威士忌版本，更加厚實溫暖。",
              ingredients: [
                { id: "whiskey", amount: "45ml" },
                { id: "campari", amount: "30ml" },
                { id: "vermouth_sweet", amount: "30ml" },
              ],
              steps: [
                "攪拌杯加冰與所有材料。",
                "攪拌冷卻。",
                "濾入加冰古典杯。",
                "橙皮裝飾。",
              ],
              tips: "適合秋冬飲用的苦甜調酒。",
            },
            {
              id: 37,
              name: "Sazerac (賽澤瑞克)",
              category: "Whiskey / 攪拌法 (Stir)",
              abv: "高 (~35%)",
              difficulty: 4,
              tags: ["紐奧良", "經典", "行家"],
              flavor: "茴香、藥草、層次極多",
              features: "紐奧良的官方雞尾酒，工序繁複但風味絕佳。",
              ingredients: [
                { id: "whiskey", amount: "60ml" },
                { id: "bitters_angostura", amount: "3滴" },
                { id: "absinthe", amount: "5ml" },
                { id: "sugar", amount: "1顆" },
              ],
              steps: [
                "冰鎮杯子並用艾碧斯刷杯。",
                "另一杯搗糖與苦精，加酒攪拌。",
                "濾入刷過艾碧斯的杯中。",
                "噴附檸檬皮油。",
              ],
              tips: "不加冰塊飲用，需充分攪拌冷卻。",
            },
            {
              id: 38,
              name: "Rusty Nail (鏽釘)",
              category: "Whiskey / 直調法 (Build)",
              abv: "高 (~35%)",
              difficulty: 1,
              tags: ["簡單", "重酒感", "經典"],
              flavor: "蜂蜜藥草、濃厚",
              features: "簡單卻濃烈的經典，蜂蜜威士忌酒帶來獨特藥草香。",
              ingredients: [
                { id: "whiskey", amount: "45ml" },
                { id: "liqueur_drambuie", amount: "25ml" },
              ],
              steps: ["古典杯放大冰塊。", "倒入兩種酒。", "輕輕攪拌。"],
              tips: "使用蘇格蘭威士忌風味最佳。",
            },
            {
              id: 39,
              name: "Penicillin (盤尼西林)",
              category: "Whiskey / 搖盪法 (Shake)",
              abv: "中 (~18%)",
              difficulty: 3,
              tags: ["現代經典", "療癒", "層次"],
              flavor: "煙燻泥煤、薑辣、酸甜",
              features: "現代經典調酒，煙燻泥煤與薑味帶來療癒感。",
              ingredients: [
                { id: "whiskey", amount: "50ml" },
                { id: "syrup_ginger", amount: "20ml" },
                { id: "juice_lemon", amount: "20ml" },
                { id: "whiskey_peat", amount: "7.5ml" },
              ],
              steps: [
                "主材料加冰搖盪。",
                "濾入加冰杯。",
                "漂浮泥煤威士忌。",
                "薑片裝飾。",
              ],
              tips: "泥煤威士忌最後漂浮，香氣更明顯。",
            },
            {
              id: 40,
              name: "Irish Coffee (愛爾蘭咖啡)",
              category: "Whiskey / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 2,
              tags: ["熱調酒", "冬季", "暖身"],
              flavor: "熱飲、咖啡奶香、酒香",
              features: "溫暖身心的熱調酒，咖啡與威士忌的完美結合。",
              ingredients: [
                { id: "whiskey", amount: "40ml" },
                { id: "coffee_hot", amount: "120ml" },
                { id: "cream", amount: "適量" },
              ],
              steps: ["溫杯。", "咖啡溶糖。", "加入威士忌。", "鋪上鮮奶油。"],
              tips: "鮮奶油需輕輕鋪在表面，不要攪拌。",
            },
            {
              id: 41,
              name: "Margarita (瑪格麗特)",
              category: "Tequila / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["經典", "鹽口杯", "短飲"],
              flavor: "酸、甜、鹹、植物香",
              features: "龍舌蘭調酒的代名詞，鹽口杯是其靈魂。",
              ingredients: [
                { id: "tequila", amount: "45ml" },
                { id: "orange_liqueur", amount: "20ml" },
                { id: "juice_lemon", amount: "20ml" },
                { id: "salt", amount: "適量" },
              ],
              steps: ["製作鹽口杯。", "材料加冰搖盪。", "濾入杯中。"],
              tips: "杯口抹鹽圈(Salt Rim)是靈魂。",
            },
            {
              id: 42,
              name: "Paloma (帕洛瑪)",
              category: "Tequila / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["墨西哥國民酒", "長飲", "夏日"],
              flavor: "葡萄柚香、微苦清爽",
              features: "墨西哥最受歡迎的調酒，清爽的葡萄柚風味。",
              ingredients: [
                { id: "tequila", amount: "45ml" },
                { id: "soda_grapefruit", amount: "100ml" },
                { id: "juice_lemon", amount: "10ml" },
              ],
              steps: ["加冰。", "倒酒與檸檬。", "補滿汽水。", "輕輕攪拌。"],
              tips: "可使用葡萄柚切片裝飾。",
            },
            {
              id: 43,
              name: "Tequila Sunrise (龍舌蘭日出)",
              category: "Tequila / 直調法 (Build)",
              abv: "低 (~12%)",
              difficulty: 1,
              tags: ["漸層", "派對", "甜美"],
              flavor: "柳橙甜、漸層美",
              features: "如日出般的夢幻漸層，滾石樂團的最愛。",
              ingredients: [
                { id: "tequila", amount: "45ml" },
                { id: "juice_orange", amount: "90ml" },
                { id: "grenadine", amount: "15ml" },
              ],
              steps: ["加冰。", "倒酒與果汁攪拌。", "沉入紅石榴糖漿。"],
              tips: "紅石榴糖漿最後沿杯壁緩緩倒入。",
            },
            {
              id: 44,
              name: "Tommy's Margarita",
              category: "Tequila / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 2,
              tags: ["現代經典", "純粹", "酸甜"],
              flavor: "強調龍舌蘭原味、無橙酒干擾",
              features: "現代經典版本，使用龍舌蘭糖漿取代橙酒，風味更純粹。",
              ingredients: [
                { id: "tequila", amount: "60ml" },
                { id: "juice_lime", amount: "30ml" },
                { id: "syrup_agave", amount: "15ml" },
              ],
              steps: ["加冰搖盪。", "濾入加冰古典杯。"],
              tips: "更能凸顯優質龍舌蘭的風味。",
            },
            {
              id: 45,
              name: "El Diablo (惡魔)",
              category: "Tequila / 直調法 (Build)",
              abv: "低 (~12%)",
              difficulty: 1,
              tags: ["長飲", "易飲", "派對"],
              flavor: "莓果酸甜、薑味",
              features: "酸甜莓果與辛辣薑味的完美平衡。",
              ingredients: [
                { id: "tequila", amount: "45ml" },
                { id: "liqueur_cassis", amount: "15ml" },
                { id: "juice_lime", amount: "15ml" },
                { id: "ginger_ale", amount: "適量" },
              ],
              steps: ["加冰。", "倒酒與萊姆。", "補滿薑汁汽水。"],
              tips: "黑醋栗利口酒帶來獨特的深紅色。",
            },
            {
              id: 46,
              name: "Batanga (巴坦加)",
              category: "Tequila / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["簡單", "長飲", "墨西哥"],
              flavor: "鹹味可樂、龍舌蘭香",
              features: "墨西哥當地的喝法，用刀攪拌是其特色。",
              ingredients: [
                { id: "tequila", amount: "50ml" },
                { id: "coke", amount: "補滿" },
                { id: "salt", amount: "適量" },
              ],
              steps: ["鹽口。", "加冰。", "倒酒補可樂。", "用刀攪拌。"],
              tips: "傳說中必須用切萊姆的刀攪拌才對味。",
            },
            {
              id: 47,
              name: "Matador (鬥牛士)",
              category: "Tequila / 搖盪法 (Shake)",
              abv: "中 (~15%)",
              difficulty: 2,
              tags: ["水果", "短飲", "簡單"],
              flavor: "鳳梨酸甜、熱帶感",
              features: "鳳梨與龍舌蘭的經典組合，酸甜適中。",
              ingredients: [
                { id: "tequila", amount: "45ml" },
                { id: "juice_pineapple", amount: "60ml" },
                { id: "juice_lemon", amount: "15ml" },
              ],
              steps: ["加冰搖盪。", "濾入冰杯。"],
              tips: "搖盪至產生泡沫口感更佳。",
            },
            {
              id: 48,
              name: "Long Island Iced Tea (長島冰茶)",
              category: "Mix / 直調法 (Build)",
              abv: "高 (~25%但無感)",
              difficulty: 2,
              tags: ["失身酒", "混酒", "派對"],
              flavor: "像檸檬紅茶但超烈",
              features: "混酒之王，雖然沒有茶，但喝起來像檸檬紅茶。",
              ingredients: [
                { id: "gin", amount: "15ml" },
                { id: "vodka", amount: "15ml" },
                { id: "rum", amount: "15ml" },
                { id: "tequila", amount: "15ml" },
                { id: "orange_liqueur", amount: "15ml" },
                { id: "juice_lemon", amount: "25ml" },
                { id: "syrup_simple", amount: "15ml" },
                { id: "coke", amount: "適量" },
              ],
              steps: [
                "除可樂外所有材料加冰搖盪(或直調)。",
                "濾入冰杯。",
                "補可樂。",
              ],
              tips: "小心飲用，後勁強烈。",
            },
            {
              id: 49,
              name: "Sidecar (側車)",
              category: "Brandy / 搖盪法 (Shake)",
              abv: "中高 (~25%)",
              difficulty: 2,
              tags: ["三合一", "經典", "優雅"],
              flavor: "葡萄果香、柑橘、酸甜",
              features: "白蘭地調酒的代表作，優雅而平衡。",
              ingredients: [
                { id: "brandy", amount: "50ml" },
                { id: "orange_liqueur", amount: "20ml" },
                { id: "juice_lemon", amount: "20ml" },
              ],
              steps: ["加冰搖盪。", "濾入糖口杯(選用)。"],
              tips: "經典酸酒比例 2:1:1，杯口可抹糖圈。",
            },
            {
              id: 50,
              name: "Brandy Alexander (白蘭地亞歷山大)",
              category: "Brandy / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 2,
              tags: ["甜點系", "餐後", "奶香"],
              flavor: "巧克力奶昔、滑順甜美",
              features: "如融化冰淇淋般的甜點酒，滑順濃郁。",
              ingredients: [
                { id: "brandy", amount: "30ml" },
                { id: "liqueur_cacao", amount: "30ml" },
                { id: "cream", amount: "30ml" },
              ],
              steps: ["加冰搖盪。", "濾入杯中。", "撒肉豆蔻粉。"],
              tips: "肉豆蔻粉能提升香氣層次。",
            },
            {
              id: 51,
              name: "Vieux Carré (老廣場)",
              category: "Brandy / 攪拌法 (Stir)",
              abv: "高 (~30%)",
              difficulty: 3,
              tags: ["紐奧良", "行家", "重酒感"],
              flavor: "藥草、木質、複雜厚重",
              features: "紐奧良法國區的經典，風味複雜厚重。",
              ingredients: [
                { id: "whiskey", amount: "20ml" },
                { id: "brandy", amount: "20ml" },
                { id: "vermouth_sweet", amount: "20ml" },
                { id: "bitters_angostura", amount: "適量" },
              ],
              steps: ["加冰攪拌。", "濾入加冰古典杯。"],
              tips: "需充分攪拌釋放香氣。",
            },
            {
              id: 52,
              name: "Horse's Neck (馬頸)",
              category: "Brandy / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["裝飾", "長飲", "簡單"],
              flavor: "薑味、清爽",
              features: "以長長的檸檬皮裝飾如馬頸而得名。",
              ingredients: [
                { id: "brandy", amount: "45ml" },
                { id: "ginger_ale", amount: "補滿" },
                { id: "juice_lemon", amount: "1個(長檸檬皮)" },
              ],
              steps: ["削長檸檬皮入杯。", "加冰。", "倒酒與汽水。"],
              tips: "檸檬皮削得越長越好。",
            },
            {
              id: 53,
              name: "Pisco Sour (皮斯可酸酒)",
              category: "Brandy / 搖盪法 (Shake)",
              abv: "中 (~18%)",
              difficulty: 3,
              tags: ["南美", "酸甜", "蛋白"],
              flavor: "葡萄蒸餾香、綿密泡沫",
              features: "南美洲的經典，皮斯可獨特的葡萄香氣。",
              ingredients: [
                { id: "pisco", amount: "60ml" },
                { id: "juice_lemon", amount: "30ml" },
                { id: "syrup_simple", amount: "20ml" },
                { id: "egg_white", amount: "適量" },
              ],
              steps: ["乾搖打發。", "加冰搖盪。", "濾入杯。", "滴苦精。"],
              tips: "最後滴上苦精可去除蛋白腥味。",
            },
            {
              id: 54,
              name: "Aperol Spritz",
              category: "Liqueur / 直調法 (Build)",
              abv: "低 (~11%)",
              difficulty: 1,
              tags: ["開胃酒", "義大利", "輕鬆"],
              flavor: "柳橙苦甜、氣泡感",
              features: "義大利最受歡迎的開胃酒，橘色氣泡充滿活力。",
              ingredients: [
                { id: "aperol", amount: "60ml" },
                { id: "sparkling_wine", amount: "90ml" },
                { id: "soda", amount: "30ml" },
              ],
              steps: ["加冰。", "依序倒入氣泡酒、Aperol、蘇打水。"],
              tips: "比例 3:2:1 (氣泡酒:Aperol:蘇打水)。",
            },
            {
              id: 55,
              name: "Americano (美國佬)",
              category: "Liqueur / 直調法 (Build)",
              abv: "低 (~10%)",
              difficulty: 1,
              tags: ["開胃酒", "Negroni前身", "低酒精"],
              flavor: "苦甜藥草、清爽",
              features: "Negroni 的前身，少了琴酒更為清爽低負擔。",
              ingredients: [
                { id: "campari", amount: "30ml" },
                { id: "vermouth_sweet", amount: "30ml" },
                { id: "soda", amount: "補滿" },
              ],
              steps: ["加冰。", "倒酒。", "補蘇打水。", "攪拌。"],
              tips: "適合下午飲用的輕鬆調酒。",
            },
            {
              id: 56,
              name: "Grasshopper (綠色蚱蜢)",
              category: "Liqueur / 搖盪法 (Shake)",
              abv: "低 (~15%)",
              difficulty: 2,
              tags: ["甜點系", "顏色美", "餐後"],
              flavor: "薄荷巧克力、冰淇淋感",
              features: "經典的甜點酒，薄荷巧克力口味。",
              ingredients: [
                { id: "liqueur_mint", amount: "30ml" },
                { id: "liqueur_cacao", amount: "30ml" },
                { id: "cream", amount: "30ml" },
              ],
              steps: ["加冰搖盪。", "濾入杯中。"],
              tips: "顏色如蚱蜢般翠綠。",
            },
            {
              id: 57,
              name: "B-52 (B52轟炸機)",
              category: "Liqueur / 分層法 (Layer)",
              abv: "中 (~25%)",
              difficulty: 4,
              tags: ["分層", "Shot", "視覺系"],
              flavor: "咖啡奶香橙味、一口乾",
              features: "著名的分層 Shot，視覺效果十足。",
              ingredients: [
                { id: "kahlua", amount: "15ml" },
                { id: "baileys", amount: "15ml" },
                { id: "orange_liqueur", amount: "15ml" },
              ],
              steps: ["依序沿湯匙背緩緩倒入形成分層。"],
              tips: "密度不同是分層的關鍵，動作要輕。",
            },
            {
              id: 58,
              name: "Amaretto Sour (杏仁酸酒)",
              category: "Liqueur / 搖盪法 (Shake)",
              abv: "低 (~15%)",
              difficulty: 2,
              tags: ["酸甜", "低酒精", "妹酒"],
              flavor: "杏仁豆腐味、酸甜",
              features: "帶有杏仁豆腐香氣的酸甜調酒，接受度極高。",
              ingredients: [
                { id: "liqueur_amaretto", amount: "60ml" },
                { id: "juice_lemon", amount: "30ml" },
                { id: "syrup_simple", amount: "10ml" },
              ],
              steps: ["乾搖打發。", "加冰搖盪。", "濾入加冰杯。"],
              tips: "杏仁酒本身較甜，糖漿可斟酌。",
            },
            {
              id: 59,
              name: "Negroni Sbagliato",
              category: "Liqueur / 直調法 (Build)",
              abv: "低 (~15%)",
              difficulty: 1,
              tags: ["網紅酒", "開胃", "變化版"],
              flavor: "苦甜、氣泡、比原版清爽",
              features: "美麗的錯誤，將琴酒換成氣泡酒，意外好喝。",
              ingredients: [
                { id: "campari", amount: "30ml" },
                { id: "vermouth_sweet", amount: "30ml" },
                { id: "sparkling_wine", amount: "30ml" },
              ],
              steps: ["加冰。", "倒酒攪拌。", "補氣泡酒。"],
              tips: "Sbagliato 在義大利文中意為「錯誤」。",
            },
            {
              id: 60,
              name: "Charlie Chaplin (卓別林)",
              category: "Gin / 搖盪法 (Shake)",
              abv: "中 (~20%)",
              difficulty: 2,
              tags: ["復古", "酸甜", "低酒精"],
              flavor: "梅果酸甜、杏桃香",
              features: "以喜劇大師命名的經典調酒，酸甜適中。",
              ingredients: [
                { id: "sloe_gin", amount: "30ml" },
                { id: "liqueur_apricot", amount: "30ml" },
                { id: "juice_lemon", amount: "30ml" },
              ],
              steps: ["加冰搖盪。", "濾入雞尾酒杯。"],
              tips: "黑刺李琴酒帶有獨特的莓果風味。",
            },
          ],

          get allIngredientsList() {
            let list = [];
            this.spiritsData.forEach((s) =>
              list.push({ id: s.id, name: s.name, category: "base" })
            );
            this.modifiers.forEach((cat) => {
              cat.items.forEach((item) =>
                list.push({ id: item.id, name: item.name, category: "mixer" })
              );
            });
            return list;
          },

          getGroupedIngredients() {
            let groups = {};
            this.allIngredientsList.forEach((ing) => {
              if (!groups[ing.category]) groups[ing.category] = [];
              groups[ing.category].push(ing);
            });
            return groups;
          },

          getRecipeIngredientsGrouped() {
            let groups = {
              "六大基酒 (Base Spirits)": this.spiritsData.map((s) => ({
                id: s.id,
                name: s.name,
              })),
            };
            this.modifiers.forEach((cat) => {
              groups[cat.category] = cat.items.map((i) => ({
                id: i.id,
                name: i.name,
              }));
            });
            return groups;
          },

          toggleFavorite(id) {
            if (this.favoriteRecipes.includes(id)) {
              this.favoriteRecipes = this.favoriteRecipes.filter(
                (fid) => fid !== id
              );
            } else {
              this.favoriteRecipes.push(id);
            }
          },

          get favoriteRecipeList() {
            return this.recipes.filter((r) =>
              this.favoriteRecipes.includes(r.id)
            );
          },

          get commonTags() {
            const tags = new Set([
              "經典",
              "酸甜",
              "清爽",
              "高酒精",
              "派對",
              "長飲",
              "短飲",
              "熱帶",
              "苦甜",
              "Tiki",
              "妹酒",
              "重口味",
            ]);

            this.recipes.forEach((r) => {
              if (r.tags && Array.isArray(r.tags)) {
                r.tags.forEach((t) => tags.add(t));
              }
            });

            return Array.from(tags).sort();
          },

          get filteredRecipes() {
            let result = this.recipes;

            if (this.searchQuery) {
              const lowerQuery = this.searchQuery.toLowerCase();
              result = result.filter(
                (r) =>
                  r.name.toLowerCase().includes(lowerQuery) ||
                  r.ingredients.some((i) =>
                    this.getIngredientName(i.id)
                      .toLowerCase()
                      .includes(lowerQuery)
                  )
              );
            }

            if (this.filterBase !== "all") {
              result = result.filter((r) =>
                r.ingredients.some((i) => i.id === this.filterBase)
              );
            }

            if (this.filterDifficulty !== "all") {
              result = result.filter(
                (r) => r.difficulty === parseInt(this.filterDifficulty)
              );
            }

            if (this.filterStyle !== "all") {
              result = result.filter(
                (r) => r.tags && r.tags.includes(this.filterStyle)
              );
            }

            return result;
          },

          get filteredBottles() {
            if (!this.searchQuery) return this.myBottles;
            const lowerQuery = this.searchQuery.toLowerCase();
            return this.myBottles.filter(
              (b) =>
                b.name.toLowerCase().includes(lowerQuery) ||
                (b.brand && b.brand.toLowerCase().includes(lowerQuery))
            );
          },

          getAvailableRecipes() {
            return this.recipes
              .map((r) => {
                let missing = (r.ingredients || [])
                  .filter((ing) => !this.myIngredients.includes(ing.id))
                  .map((ing) => ing.id);
                return { ...r, missing };
              })
              .sort((a, b) => a.missing.length - b.missing.length);
          },

          getReadyRecipes() {
            return this.getAvailableRecipes().filter(
              (r) => r.missing.length === 0
            );
          },
          getNearMissRecipes() {
            return this.getAvailableRecipes().filter(
              (r) => r.missing.length === 1
            );
          },
          getOtherRecipes() {
            return this.getAvailableRecipes().filter(
              (r) => r.missing.length > 1
            );
          },

          get generatedMenuList() {
            return this.menuSelectedRecipes.map((id) =>
              this.recipes.find((r) => r.id === id)
            );
          },

          getIngredientName(id) {
            let item = this.allIngredientsList.find((i) => i.id === id);
            return item ? item.name : "未知";
          },

          getMissingNames(missingIds) {
            return missingIds
              .map((id) => this.getIngredientName(id))
              .join(", ");
          },

          convertStep(step) {
            if (this.unit === "ml") return step;
            return step.replace(/(\d+)\s*ml/gi, (match, p1) => {
              const ml = parseFloat(p1);
              const oz = Math.round((ml / 30) * 100) / 100; // 簡單換算 30ml = 1oz，保留兩位小數
              return oz + " oz";
            });
          },

          convertAmount(amount) {
            if (this.unit === "ml") return amount;
            if (!amount) return "";
            return amount.replace(/(\d+)\s*ml/gi, (match, p1) => {
              const ml = parseFloat(p1);
              const oz = Math.round((ml / 30) * 100) / 100;
              return oz + " oz";
            });
          },

          toggleIngredient(id) {
            if (this.myIngredients.includes(id)) {
              this.myIngredients = this.myIngredients.filter((i) => i !== id);
            } else {
              this.myIngredients.push(id);
            }
          },

          openAddBottleModal(typeId = "gin") {
            this.editingBottleId = null;
            this.bottleForm = {
              typeId: typeId,
              name: "",
              brand: "",
              price: "",
              location: "",
              expirationDate: "",
              rating: 5,
              notes: "",
              tags: "",
              features: "",
              remaining: 100,
            };
            this.isBottleFormOpen = true;
          },

          editBottle(bottle) {
            this.editingBottleId = bottle.id;
            this.bottleForm = {
              ...bottle,
              tags: bottle.tags.join(", "),
            };
            this.isBottleFormOpen = true;
          },

          saveBottle() {
            const bottleData = {
              ...this.bottleForm,
              tags: (this.bottleForm.tags || "")
                .split(",")
                .map((t) => t.trim())
                .filter((t) => t),
            };

            if (this.editingBottleId) {
              const index = this.myBottles.findIndex(
                (b) => b.id === this.editingBottleId
              );
              if (index !== -1) {
                this.myBottles[index] = {
                  id: this.editingBottleId,
                  ...bottleData,
                };
              }
            } else {
              this.myBottles.push({
                id: Date.now(),
                ...bottleData,
              });
              if (!this.myIngredients.includes(this.bottleForm.typeId)) {
                this.myIngredients.push(this.bottleForm.typeId);
              }
            }

            this.isBottleFormOpen = false;
            this.$nextTick(() => lucide.createIcons());
          },

          deleteBottle(id) {
            this.myBottles = this.myBottles.filter((b) => b.id !== id);
          },

          deleteRecipe(id) {
            if (confirm("確定要刪除這份酒譜嗎？")) {
              this.recipes = this.recipes.filter((r) => r.id !== id);
            }
          },

          deleteModifier(catIndex, itemId) {
            if (confirm("確定要刪除這個調味資料嗎？")) {
              this.modifiers[catIndex].items = this.modifiers[
                catIndex
              ].items.filter((i) => i.id !== itemId);
            }
          },

          saveModifier() {
            const catIndex = this.modifierForm.categoryIndex;
            const newItem = {
              id: "custom_" + Date.now(),
              name: this.modifierForm.name,
              desc: this.modifierForm.desc,
              tag: this.modifierForm.tag || "自訂",
            };
            if (this.modifiers[catIndex]) {
              this.modifiers[catIndex].items.push(newItem);
            }
            this.isModifierFormOpen = false;
            this.modifierForm = {
              categoryIndex: 0,
              name: "",
              desc: "",
              tag: "",
            };
            this.$nextTick(() => lucide.createIcons());
          },

          openAddRecipeModal() {
            this.editingRecipeId = null;
            this.recipeForm = {
              name: "",
              category: "自創酒譜",
              abv: "10%",
              difficulty: 1,
              flavor: "",
              features: "",
              tags: "",
              ingredients: [],
              amounts: {},
              steps: "",
              tips: "",
            };
            this.isRecipeFormOpen = true;
          },

          editRecipe(recipe) {
            this.editingRecipeId = recipe.id;
            const amounts = {};
            recipe.ingredients.forEach((i) => {
              amounts[i.id] = i.amount;
            });
            this.recipeForm = {
              name: recipe.name,
              category: recipe.category || "自創酒譜",
              abv: recipe.abv || "未知",
              difficulty: recipe.difficulty || 1,
              flavor: recipe.flavor,
              features: recipe.features || "",
              tags: (recipe.tags || []).join(", "),
              ingredients: recipe.ingredients.map((i) => i.id),
              amounts: amounts,
              steps: recipe.steps.join("\n"),
              tips: recipe.tips,
            };
            this.isRecipeFormOpen = true;
          },

          openNoteModal(recipe) {
            this.noteForm = {
              id: recipe.id,
              name: recipe.name,
              rating: recipe.myRating || 0,
              notes: recipe.myNotes || "",
            };
            this.isNoteModalOpen = true;
          },

          saveNote() {
            const index = this.recipes.findIndex(
              (r) => r.id === this.noteForm.id
            );
            if (index !== -1) {
              this.recipes[index].myRating = parseInt(this.noteForm.rating);
              this.recipes[index].myNotes = this.noteForm.notes;
              // Watcher 會自動觸發 saveData
            }
            this.isNoteModalOpen = false;
            this.$nextTick(() => lucide.createIcons());
          },

          saveRecipe() {
            const ingredientsArray = this.recipeForm.ingredients.map((id) => {
              return { id, amount: this.recipeForm.amounts[id] || "適量" };
            });

            const recipeData = {
              name: this.recipeForm.name,
              category: this.recipeForm.category,
              abv: this.recipeForm.abv,
              difficulty: parseInt(this.recipeForm.difficulty),
              tags: this.recipeForm.tags
                .split(/[,，]/)
                .map((t) => t.trim())
                .filter((t) => t),
              flavor: this.recipeForm.flavor,
              features: this.recipeForm.features,
              ingredients: ingredientsArray,
              steps: this.recipeForm.steps.split("\n").filter((s) => s.trim()),
              tips: this.recipeForm.tips,
            };

            if (this.editingRecipeId) {
              const index = this.recipes.findIndex(
                (r) => r.id === this.editingRecipeId
              );
              if (index !== -1) {
                this.recipes[index] = {
                  ...this.recipes[index],
                  ...recipeData,
                };
              }
            } else {
              this.recipes.push({
                id: Date.now(),
                ...recipeData,
              });
            }

            this.isRecipeFormOpen = false;
            this.editingRecipeId = null;
            this.recipeForm = {
              name: "",
              category: "",
              abv: "",
              difficulty: 1,
              flavor: "",
              features: "",
              tags: "",
              ingredients: [],
              amounts: {},
              steps: "",
              tips: "",
            };
            this.$nextTick(() => lucide.createIcons());
          },

          addToShoppingList(missingIds) {
            let count = 0;
            missingIds.forEach((id) => {
              if (!this.shoppingList.some((item) => item.id === id)) {
                this.shoppingList.push({
                  id: id,
                  name: this.getIngredientName(id),
                  checked: false,
                });
                count++;
              }
            });
            if (count > 0) {
              this.saveData();
              alert(`已將 ${count} 項材料加入購物清單！`);
            } else {
              alert("這些材料都已經在清單中囉！");
            }
          },

          removeFromShoppingList(index) {
            this.shoppingList.splice(index, 1);
            this.saveData();
          },

          setupRoulette() {
            const partyOptions = [
              { name: "自己喝一杯", flavor: "逃不掉的，乾杯吧！" },
              { name: "安全下莊", flavor: "恭喜！這回合你是觀眾。" },
              { name: "指定人喝", flavor: "權力在你手中，選個幸運兒。" },
              { name: "左邊的人喝", flavor: "你的左手邊那位，請舉杯。" },
              { name: "右邊的人喝", flavor: "你的右手邊那位，別裝傻。" },
              { name: "大家一起喝", flavor: "Cheers! 氣氛炒起來！" },
              { name: "與對面喝交杯", flavor: "深情對望，喝完這杯。" },
              { name: "下一位喝兩杯", flavor: "把這份福氣加倍傳下去。" },
            ];

            // 隨機打亂
            this.rouletteCandidates = partyOptions.sort(
              () => 0.5 - Math.random()
            );
            this.rouletteRotation = 0;
            this.rouletteResult = null;
          },

          getRouletteGradient() {
            const count = this.rouletteCandidates.length;
            if (count === 0) return "#cbd5e1 0% 100%"; // 灰色預設

            let gradient = [];
            const colors = [
              "#fcd34d",
              "#fbbf24",
              "#f59e0b",
              "#d97706",
              "#fcd34d",
              "#fbbf24",
              "#f59e0b",
              "#d97706",
            ]; // Amber shades
            const step = 100 / count;

            for (let i = 0; i < count; i++) {
              gradient.push(
                `${colors[i % colors.length]} ${i * step}% ${(i + 1) * step}%`
              );
            }
            return gradient.join(", ");
          },

          spinRoulette() {
            if (this.isSpinning || this.rouletteCandidates.length === 0) return;
            this.isSpinning = true;
            this.rouletteResult = null;

            // 旋轉至少 5 圈 + 隨機角度
            const spinAmount = 360 * 5 + Math.floor(Math.random() * 360);
            this.rouletteRotation += spinAmount;

            setTimeout(() => {
              this.isSpinning = false;
              const count = this.rouletteCandidates.length;
              const segmentAngle = 360 / count;
              // 計算指針指向的區塊 (指針在上方 0 度，輪盤順時針轉，相當於指針逆時針移動)
              const currentRot = this.rouletteRotation % 360;
              const pointerAngle = (360 - currentRot) % 360;
              const winningIndex = Math.floor(pointerAngle / segmentAngle);
              this.rouletteResult = this.rouletteCandidates[winningIndex];

              // 簡單的慶祝效果
              if (this.rouletteResult) {
                // 可以加入音效或 confetti
              }
            }, 3000); // 配合 CSS transition 時間
          },

          pickRandomRecipe() {
            if (this.recipes.length === 0) return;
            const randomRecipe =
              this.recipes[Math.floor(Math.random() * this.recipes.length)];
            this.selectedRecipe = randomRecipe;
            this.isRecipeModalOpen = true;
            this.rouletteResult = null; // 清除輪盤結果，下次進來是新的
          },

          // --- Firebase Actions ---
          loginFirebase() {
            if (window.firebaseService) window.firebaseService.login();
          },

          logoutFirebase() {
            if (window.firebaseService) window.firebaseService.logout();
          },

          async saveToCloud() {
            if (!this.user || !window.firebaseService) return;
            const data = {
              myIngredients: this.myIngredients,
              myBottles: this.myBottles,
              recipes: this.recipes,
              favoriteRecipes: this.favoriteRecipes,
              modifiers: this.modifiers,
              shoppingList: this.shoppingList,
              barName: this.barName,
              bartenderName: this.bartenderName,
              unit: this.unit,
            };
            await window.firebaseService.save(this.user.uid, data);
          },

          async loadFromCloud() {
            if (!this.user || !window.firebaseService) return;
            const data = await window.firebaseService.load(this.user.uid);
            if (data) {
              if (confirm("發現雲端備份資料，是否覆蓋目前的本地資料？")) {
                this.applyData(data);
                alert("☁️ 資料同步完成！");
              }
            } else {
              alert("尚無雲端備份資料。");
            }
          },

          shareRecipe(recipe) {
            let text = `🍸 ${recipe.name}\n`;
            text += `------------------\n`;
            text += `📜 分類：${recipe.category}\n`;
            text += `🔥 難度：${"★".repeat(recipe.difficulty)}\n`;
            text += `👅 風味：${recipe.flavor}\n\n`;

            text += `🥃 材料：\n`;
            recipe.ingredients.forEach((ing) => {
              const amount = this.convertAmount(ing.amount);
              const name = this.getIngredientName(ing.id);
              text += `• ${name} ${amount}\n`;
            });

            text += `\n🥣 步驟：\n`;
            recipe.steps.forEach((step, index) => {
              text += `${index + 1}. ${this.convertStep(step)}\n`;
            });

            if (recipe.tips) {
              text += `\n💡 秘訣：${recipe.tips}\n`;
            }

            text += `\n------------------\n`;
            text += `🏠 ${this.barName}\n`;
            text += `👨‍🍳 ${this.bartenderName}`;

            navigator.clipboard
              .writeText(text)
              .then(() => {
                alert("📋 酒譜已複製到剪貼簿！\n快去分享給朋友吧！");
              })
              .catch((err) => {
                console.error("複製失敗", err);
                alert("複製失敗，請手動截圖分享。");
              });
          },

          saveData() {
            localStorage.setItem(
              "cocktail_data",
              JSON.stringify({
                myIngredients: this.myIngredients,
                myBottles: this.myBottles,
                recipes: this.recipes,
                favoriteRecipes: this.favoriteRecipes,
                modifiers: this.modifiers,
                shoppingList: this.shoppingList,
                barName: this.barName,
                bartenderName: this.bartenderName,
                unit: this.unit,
              })
            );
          },

          loadData() {
            const saved = localStorage.getItem("cocktail_data");
            if (saved) {
              try {
                const data = JSON.parse(saved);
                this.applyData(data);
              } catch (e) {
                console.error("Failed to load data", e);
              }
            }
          },

          applyData(data) {
            if (data.myIngredients) this.myIngredients = data.myIngredients;
            if (data.myBottles) this.myBottles = data.myBottles;
            if (data.favoriteRecipes)
              this.favoriteRecipes = data.favoriteRecipes;

            if (data.recipes) {
              const savedRecipes = data.recipes;
              const savedIds = new Set(savedRecipes.map((r) => r.id));
              const newRecipes = this.recipes.filter(
                (r) => !savedIds.has(r.id)
              );
              this.recipes = [...savedRecipes, ...newRecipes].sort(
                (a, b) => a.id - b.id
              );
            }

            if (data.modifiers) {
              const savedIds = new Set();
              data.modifiers.forEach((cat) =>
                cat.items.forEach((i) => savedIds.add(i.id))
              );
              this.modifiers.forEach((defaultCat) => {
                let targetCat = data.modifiers.find(
                  (c) => c.category === defaultCat.category
                );
                if (!targetCat) {
                  data.modifiers.push(JSON.parse(JSON.stringify(defaultCat)));
                } else {
                  defaultCat.items.forEach((item) => {
                    if (!savedIds.has(item.id)) targetCat.items.push(item);
                  });
                }
              });
              this.modifiers = data.modifiers;
            }

            if (data.shoppingList) this.shoppingList = data.shoppingList;
            if (data.barName) this.barName = data.barName;
            if (data.bartenderName) this.bartenderName = data.bartenderName;
            if (data.unit) this.unit = data.unit;
          },

          toggleTheme() {
            this.darkMode = !this.darkMode;
            if (this.darkMode) {
              document.documentElement.classList.add("dark");
              localStorage.setItem("theme", "dark");
            } else {
              document.documentElement.classList.remove("dark");
              localStorage.setItem("theme", "light");
            }
          },

          backupData() {
            const data = {
              myIngredients: this.myIngredients,
              myBottles: this.myBottles,
              recipes: this.recipes,
              modifiers: this.modifiers,
              shoppingList: this.shoppingList,
              barName: this.barName,
              bartenderName: this.bartenderName,
              unit: this.unit,
            };
            const blob = new Blob([JSON.stringify(data, null, 2)], {
              type: "application/json",
            });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download =
              "cocktail_lab_backup_" +
              new Date().toISOString().slice(0, 10) +
              ".json";
            a.click();
          },

          triggerImport() {
            this.$refs.fileInput.click();
          },

          importDataFile(event) {
            const file = event.target.files[0];
            if (!file) return;
            const reader = new FileReader();
            reader.onload = (e) => {
              try {
                const data = JSON.parse(e.target.result);
                if (data.myIngredients) this.myIngredients = data.myIngredients;
                if (data.myBottles) this.myBottles = data.myBottles;
                if (data.recipes) this.recipes = data.recipes;
                if (data.modifiers) this.modifiers = data.modifiers;
                if (data.shoppingList) this.shoppingList = data.shoppingList;
                if (data.barName) this.barName = data.barName;
                if (data.bartenderName) this.bartenderName = data.bartenderName;
                if (data.unit) this.unit = data.unit;
                alert("資料匯入成功！");
              } catch (err) {
                alert("匯入失敗，檔案格式錯誤。");
              }
            };
            reader.readAsText(file);
            event.target.value = "";
          },

          resetData() {
            if (
              confirm("確定要重置所有資料嗎？這將會清除您的酒櫃與自訂設定。")
            ) {
              localStorage.removeItem("cocktail_data");
              location.reload();
            }
          },

          init() {
            this.loadData();

            // Setup Firebase Listener
            const setupFirebase = () => {
              if (window.firebaseService)
                window.firebaseService.onAuth((u) => (this.user = u));
            };
            if (window.firebaseService) setupFirebase();
            window.addEventListener("firebase-ready", setupFirebase);

            this.$watch("myIngredients", () => this.saveData());
            this.$watch("myBottles", () => this.saveData());
            this.$watch("recipes", () => this.saveData());
            this.$watch("favoriteRecipes", () => {
              this.saveData();
            });
            this.$watch("modifiers", () => this.saveData());
            this.$watch("shoppingList", () => this.saveData());
            this.$watch("barName", (val) => {
              this.saveData();
              document.title = val + " - " + this.bartenderName;
            });
            this.$watch("bartenderName", (val) => {
              this.saveData();
              document.title = this.barName + " - " + val;
            });
            this.$watch("unit", () => this.saveData());

            lucide.createIcons();
            this.$watch("activeTab", () => {
              this.searchQuery = "";
              this.$nextTick(() => lucide.createIcons());
            });
            this.$watch("isBottleFormOpen", () =>
              this.$nextTick(() => lucide.createIcons())
            );
            this.$watch("isModifierFormOpen", () =>
              this.$nextTick(() => lucide.createIcons())
            );
            this.$watch("isRecipeFormOpen", () =>
              this.$nextTick(() => lucide.createIcons())
            );
            this.$watch("isRecipeModalOpen", () =>
              this.$nextTick(() => lucide.createIcons())
            );
            this.$watch("isNoteModalOpen", () =>
              this.$nextTick(() => lucide.createIcons())
            );
            this.setupRoulette(); // 初始化輪盤
            if (this.darkMode) {
              document.documentElement.classList.add("dark");
            } else {
              document.documentElement.classList.remove("dark");
            }
          },
        }));
      });
    </script>
    <!-- Alpine.js CDN (放在邏輯定義之後) -->
    <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  </head>
  <body
    class="bg-slate-50 dark:bg-slate-950 font-sans text-slate-800 dark:text-slate-100 transition-colors duration-300"
    x-data="cocktailApp()"
    x-init="init()"
  >
    <div class="flex min-h-screen relative">
      <!-- --- 平板/電腦版 側邊選單 --- -->
      <aside
        class="bg-slate-900 text-white w-72 shrink-0 h-screen sticky top-0 flex-col p-6 hidden md:flex transition-all z-40"
        x-show="isSidebarOpen"
        x-cloak
        x-transition:enter="transition ease-out duration-300"
        x-transition:enter-start="-translate-x-full opacity-0"
        x-transition:enter-end="translate-x-0 opacity-100"
        x-transition:leave="transition ease-in duration-300"
        x-transition:leave-start="translate-x-0 opacity-100"
        x-transition:leave-end="-translate-x-full opacity-0"
      >
        <div class="flex justify-between items-center mb-10">
          <div
            @click="activeTab = 'home'"
            class="flex items-center gap-3 cursor-pointer group"
          >
            <div
              class="bg-amber-500 p-2 rounded-lg group-hover:rotate-12 transition text-slate-900"
            >
              <i data-lucide="wine"></i>
            </div>
            <div>
              <h1 class="text-lg font-black tracking-tight" x-text="barName">
                居家調酒實驗室
              </h1>
              <p
                class="text-slate-400 text-[9px] uppercase tracking-widest font-bold"
                x-text="bartenderName"
              ></p>
            </div>
          </div>
          <button
            @click="isSidebarOpen = false"
            class="text-slate-400 hover:text-white transition"
          >
            <i data-lucide="chevrons-left"></i>
          </button>
        </div>

        <nav class="space-y-2 flex-1 overflow-y-auto no-scrollbar pr-2">
          <template x-for="tab in navigation" :key="tab.id">
            <button
              @click="activeTab = tab.id"
              :class="activeTab === tab.id ? 'bg-amber-500 text-slate-900 shadow-lg' : 'text-slate-400 hover:bg-slate-800 hover:text-white'"
              class="w-full px-5 py-4 rounded-2xl font-bold text-sm flex items-center gap-4 transition-all"
            >
              <i :data-lucide="tab.icon" class="w-5 h-5"></i>
              <span x-text="tab.label"></span>
            </button>
          </template>
        </nav>
      </aside>

      <!-- --- 漢堡選單按鈕 (當側邊欄隱藏時顯示) --- -->
      <button
        class="fixed top-6 left-6 z-50 bg-slate-900 text-white p-3 rounded-xl shadow-xl hidden md:block hover:bg-slate-800 transition hover:scale-110 print:hidden"
        x-show="!isSidebarOpen"
        @click="isSidebarOpen = true"
        x-cloak
      >
        <i data-lucide="menu"></i>
      </button>

      <!-- --- 主內容區域 --- -->
      <div
        class="flex-1 min-w-0 bg-slate-50 dark:bg-slate-950 transition-colors duration-300"
      >
        <main
          class="max-w-7xl mx-auto p-4 md:p-8 lg:p-10 pb-48 md:pb-10 transition-all duration-300"
          :class="!isSidebarOpen ? 'md:pt-24' : ''"
        >
          <!-- === 首頁 === -->
          <div
            x-show="activeTab === 'home'"
            class="space-y-10 animate-fade-in"
            x-cloak
          >
            <div
              class="bg-slate-900 dark:bg-slate-900 text-white rounded-[2rem] p-10 lg:p-16 shadow-2xl relative overflow-hidden flex flex-col lg:flex-row items-center gap-10"
            >
              <div class="relative z-10 flex-1 text-center lg:text-left">
                <div
                  class="bg-amber-500/10 text-amber-500 text-xs font-black px-3 py-1 rounded-full w-fit mx-auto lg:mx-0 mb-4 uppercase tracking-widest"
                >
                  入門指南
                </div>
                <h2 class="text-4xl lg:text-6xl font-black mb-6 leading-tight">
                  探索無限可能的<br /><span class="text-amber-500"
                    >微醺藝術</span
                  >
                </h2>
                <p class="mb-8 text-slate-400 text-lg max-w-xl mx-auto lg:mx-0">
                  想喝一杯好的雞尾酒，不一定要走進昂貴的酒吧，我們相信最好的酒吧，就是你家的客廳。<br /><br />我們為所有熱愛生活的朋友，打造了一個最親民的調酒指南。無論你是剛買下第一支琴酒的初學者，還是追求派對驚喜的居家調酒師，這裡都有你需要的靈感。
                </p>
                <div
                  class="flex flex-wrap justify-center lg:justify-start gap-4"
                >
                  <button
                    @click="activeTab = 'bar'"
                    class="bg-amber-500 hover:bg-amber-400 text-slate-900 font-black py-4 px-10 rounded-2xl transition-all hover:scale-105 shadow-xl shadow-amber-500/20"
                  >
                    進入我的吧檯
                  </button>
                  <button
                    @click="activeTab = 'collection'"
                    class="bg-slate-800 hover:bg-slate-700 text-white font-black py-4 px-10 rounded-2xl transition-all"
                  >
                    管理我的酒櫃
                  </button>
                </div>
              </div>
              <div
                class="relative w-64 lg:w-96 h-64 lg:h-96 flex items-center justify-center"
              >
                <div
                  class="absolute inset-0 bg-amber-500/20 blur-[100px] rounded-full"
                ></div>
                <i
                  data-lucide="wine"
                  class="w-48 h-48 lg:w-64 lg:h-64 text-amber-500 relative z-10 drop-shadow-2xl"
                ></i>
              </div>
            </div>

            <!-- 我的待買清單 -->
            <div x-show="shoppingList.length > 0" class="animate-fade-in">
              <h3
                class="text-2xl font-black mb-6 flex items-center gap-3 text-slate-800 dark:text-white"
              >
                <i data-lucide="list-todo" class="text-amber-500"></i>
                我的待買清單
              </h3>
              <div
                class="bg-white dark:bg-slate-900 rounded-3xl p-8 border border-slate-200 dark:border-slate-800 shadow-sm mb-10"
              >
                <div class="space-y-3">
                  <template
                    x-for="(item, index) in shoppingList"
                    :key="item.id"
                  >
                    <div
                      class="flex items-center justify-between p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 group transition hover:border-amber-200 dark:hover:border-amber-800"
                    >
                      <div class="flex items-center gap-3">
                        <input
                          type="checkbox"
                          x-model="item.checked"
                          class="w-5 h-5 rounded text-amber-500 focus:ring-amber-500 border-slate-300 cursor-pointer"
                          @change="saveData()"
                        />
                        <span
                          :class="item.checked ? 'line-through text-slate-400' : 'text-slate-700 dark:text-slate-200 font-bold'"
                          x-text="item.name"
                        ></span>
                      </div>
                      <button
                        @click="removeFromShoppingList(index)"
                        class="text-slate-400 hover:text-red-500 transition p-2 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-xl"
                      >
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                      </button>
                    </div>
                  </template>
                </div>
              </div>
            </div>

            <!-- 500元攻略 -->
            <div class="grid lg:grid-cols-3 gap-8">
              <div
                class="lg:col-span-2 bg-white dark:bg-slate-900 rounded-3xl p-8 border border-slate-200 dark:border-slate-800 shadow-sm"
              >
                <h3
                  class="text-2xl font-black mb-6 flex items-center gap-3 text-slate-800 dark:text-white"
                >
                  <i data-lucide="shopping-bag" class="text-amber-500"></i> 新手
                  500 元採購清單
                </h3>
                <div class="grid sm:grid-cols-2 gap-4">
                  <template x-for="item in shopItems">
                    <div
                      class="flex justify-between items-center p-4 bg-slate-50 dark:bg-slate-800 rounded-2xl border border-slate-100 dark:border-slate-700 font-bold text-slate-700 dark:text-slate-200"
                    >
                      <div class="flex items-center gap-3">
                        <i
                          :data-lucide="item.icon"
                          class="w-4 h-4 text-slate-400"
                        ></i>
                        <span x-text="item.name"></span>
                      </div>
                      <div
                        class="font-black text-amber-600"
                        x-text="'$' + item.price"
                      ></div>
                    </div>
                  </template>
                  <div
                    class="sm:col-span-2 mt-2 p-5 bg-green-50 dark:bg-green-900/20 border border-green-100 dark:border-green-900 rounded-2xl flex justify-between items-center font-black"
                  >
                    <span class="text-green-800 dark:text-green-400"
                      >總計預算控制</span
                    >
                    <span class="text-2xl text-green-600">$470</span>
                  </div>
                </div>
              </div>
              <div
                class="bg-amber-600 dark:bg-amber-700 text-white rounded-3xl p-8 flex flex-col justify-between shadow-xl"
              >
                <div>
                  <h3 class="text-2xl font-black mb-4 flex items-center gap-2">
                    <i data-lucide="info"></i> 學習秘訣
                  </h3>
                  <p class="text-amber-100 font-medium leading-relaxed italic">
                    「冰塊」是調酒中最便宜卻也最重要的材料。超市購買的硬冰塊，能極大減少融水量，維持酒體香氣不被稀釋。
                  </p>
                </div>
                <button
                  @click="activeTab = 'spirits'"
                  class="mt-6 w-full py-3 bg-white/10 hover:bg-white/20 rounded-xl font-bold transition"
                >
                  查看基酒百科 →
                </button>
              </div>
            </div>
          </div>

          <!-- === 基酒百科 === -->
          <div
            x-show="activeTab === 'spirits'"
            class="grid md:grid-cols-2 lg:grid-cols-3 gap-6 animate-fade-in"
            x-cloak
          >
            <div class="md:col-span-full mb-6">
              <h2
                class="text-4xl font-black text-slate-900 dark:text-white mb-2"
              >
                六大基酒 百科
              </h2>
              <p class="text-slate-500 text-lg font-medium">
                調酒世界的六位核心主角，理解它們的個性是創作的第一步。
              </p>
            </div>
            <template x-for="spirit in spiritsData">
              <div
                class="bg-white dark:bg-slate-900 p-8 rounded-3xl shadow-sm border border-slate-200 dark:border-slate-800 hover:border-amber-400 dark:hover:border-amber-400 transition-all group"
              >
                <div class="flex items-start justify-between mb-6">
                  <div
                    class="p-4 rounded-2xl group-hover:scale-110 transition"
                    :class="spirit.color"
                  >
                    <i :data-lucide="spirit.icon" class="w-6 h-6"></i>
                  </div>
                  <div class="flex gap-1 flex-wrap justify-end">
                    <template x-for="tag in spirit.tags">
                      <span
                        class="text-[10px] bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-300 px-2 py-1 rounded-lg font-bold"
                        x-text="'#'+tag"
                      ></span>
                    </template>
                  </div>
                </div>
                <h3
                  class="text-2xl font-black text-slate-800 dark:text-white"
                  x-text="spirit.name"
                ></h3>
                <p
                  class="text-xs font-serif italic text-slate-400 mb-4 uppercase tracking-widest"
                  x-text="spirit.engName"
                ></p>
                <p
                  class="text-slate-600 dark:text-slate-400 text-sm leading-relaxed mb-6 h-20 overflow-y-auto custom-scrollbar"
                  x-text="spirit.desc"
                ></p>
                <div
                  class="grid grid-cols-2 gap-4 text-[10px] border-t border-slate-100 dark:border-slate-800 pt-5"
                >
                  <div>
                    <span
                      class="text-slate-400 font-bold flex items-center gap-1 uppercase tracking-tighter"
                      ><i data-lucide="flame" class="w-3 h-3"></i> ABV</span
                    >
                    <span
                      class="font-black text-slate-700 dark:text-slate-200 text-sm"
                      x-text="spirit.abv"
                    ></span>
                  </div>
                  <div>
                    <span
                      class="text-slate-400 font-bold flex items-center gap-1 uppercase tracking-tighter"
                      ><i data-lucide="map-pin" class="w-3 h-3"></i>
                      Origin</span
                    >
                    <span
                      class="font-black text-slate-700 dark:text-slate-200 text-sm"
                      x-text="spirit.origin"
                    ></span>
                  </div>
                </div>

                <div
                  class="mt-4 pt-4 border-t border-slate-100 dark:border-slate-800 flex items-center justify-between"
                >
                  <div class="flex items-center gap-2">
                    <div x-show="myBottles.some(b => b.typeId === spirit.id)">
                      <span
                        class="text-xs font-bold text-green-600 dark:text-green-400 flex items-center gap-1"
                      >
                        <i data-lucide="check-circle" class="w-4 h-4"></i>
                        已收藏
                      </span>
                    </div>
                    <div x-show="!myBottles.some(b => b.typeId === spirit.id)">
                      <span class="text-xs font-bold text-slate-400"
                        >尚未收藏</span
                      >
                    </div>
                  </div>
                  <button
                    @click="openAddBottleModal(spirit.id)"
                    class="px-4 py-2 rounded-xl text-xs font-black transition-colors flex items-center gap-2"
                    :class="myBottles.some(b => b.typeId === spirit.id) ? 'bg-slate-100 dark:bg-slate-800 text-slate-600 dark:text-slate-400 hover:bg-slate-200 dark:hover:bg-slate-700' : 'bg-amber-500 text-slate-900 hover:bg-amber-400 shadow-lg shadow-amber-500/20'"
                  >
                    <i data-lucide="plus" class="w-3 h-3"></i>
                    <span
                      x-text="myBottles.some(b => b.typeId === spirit.id) ? '再入庫' : '加入酒櫃'"
                    ></span>
                  </button>
                </div>
              </div>
            </template>
          </div>

          <!-- === 調味 === -->
          <div
            x-show="activeTab === 'modifiers'"
            class="space-y-6 animate-fade-in"
            x-cloak
          >
            <div
              class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
            >
              <div>
                <h2 class="text-2xl font-bold text-slate-900 dark:text-white">
                  調味與裝飾
                </h2>
                <p class="text-slate-500">
                  讓調酒進化到「好喝又好看」的秘密武器。
                </p>
              </div>
              <button
                @click="isModifierFormOpen = true"
                class="flex items-center gap-2 bg-amber-500 text-slate-900 px-4 py-2 rounded-lg font-bold shadow-md hover:bg-amber-400 transition text-sm"
              >
                <i data-lucide="plus" class="w-4 h-4"></i> 新增自訂調味
              </button>
            </div>
            <template x-for="(category, catIndex) in modifiers">
              <div
                class="bg-white dark:bg-slate-900 rounded-xl shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden"
              >
                <div
                  class="p-4 bg-slate-50 dark:bg-slate-800 border-b dark:border-slate-700 flex items-center gap-3"
                >
                  <div
                    class="p-2 bg-white dark:bg-slate-700 rounded-full shadow-sm"
                  >
                    <i
                      :data-lucide="category.iconType"
                      class="w-5 h-5 text-amber-600"
                    ></i>
                  </div>
                  <h3
                    class="font-bold text-slate-800 dark:text-white"
                    x-text="category.category"
                  ></h3>
                </div>
                <div class="p-4 grid md:grid-cols-2 lg:grid-cols-3 gap-4">
                  <template x-for="item in category.items">
                    <div
                      class="flex gap-2 items-start p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-lg transition relative group"
                    >
                      <div
                        class="mt-1.5 w-1.5 h-1.5 rounded-full bg-amber-400 shrink-0"
                      ></div>
                      <div class="flex-1">
                        <div class="flex items-center gap-2 mb-1">
                          <span
                            class="font-bold text-slate-800 dark:text-slate-200 text-sm"
                            x-text="item.name"
                          ></span>
                          <span
                            class="text-[10px] px-1.5 py-0.5 rounded-full border bg-slate-100 dark:bg-slate-700 dark:border-slate-600 text-slate-500 dark:text-slate-400"
                            x-text="item.tag"
                          ></span>
                        </div>
                        <p
                          class="text-xs text-slate-600 dark:text-slate-400"
                          x-text="item.desc"
                        ></p>
                      </div>
                      <button
                        @click="deleteModifier(catIndex, item.id)"
                        class="absolute right-2 top-2 text-slate-300 hover:text-red-500 opacity-0 group-hover:opacity-100 transition p-1"
                        title="刪除"
                      >
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                      </button>
                    </div>
                  </template>
                </div>
              </div>
            </template>
          </div>

          <!-- === 酒譜庫 === -->
          <div
            x-show="activeTab === 'recipes'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <div
              class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
            >
              <div>
                <h2 class="text-4xl font-black text-slate-900 dark:text-white">
                  完整酒譜庫
                </h2>
                <p class="text-slate-500 mt-2 text-lg">
                  瀏覽所有經典與現代調酒配方，尋找您的下一杯靈感。
                </p>
              </div>
              <div class="flex gap-3 w-full md:w-auto">
                <div class="relative flex-1 md:w-64">
                  <i
                    data-lucide="search"
                    class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"
                  ></i>
                  <input
                    type="text"
                    placeholder="搜尋酒譜..."
                    class="w-full pl-10 pr-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-sm font-bold focus:outline-none focus:border-amber-500 transition"
                    x-model="searchQuery"
                  />
                </div>
                <button
                  @click="openAddRecipeModal()"
                  class="bg-amber-500 text-slate-900 px-6 py-3 rounded-xl font-black shadow-lg hover:bg-amber-400 transition flex items-center gap-2 shrink-0"
                >
                  <i data-lucide="plus" class="w-5 h-5"></i>
                  <span class="hidden sm:inline">新增</span>
                </button>
              </div>
            </div>

            <!-- 篩選器 -->
            <div
              class="bg-white dark:bg-slate-900 p-4 rounded-2xl border border-slate-200 dark:border-slate-800 flex flex-wrap gap-4 items-center shadow-sm"
            >
              <div class="flex items-center gap-2">
                <i data-lucide="filter" class="w-4 h-4 text-amber-500"></i>
                <span
                  class="text-xs font-black uppercase tracking-widest text-slate-400"
                  >篩選</span
                >
              </div>

              <select
                x-model="filterBase"
                class="bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold rounded-lg py-2 pl-3 pr-8 focus:ring-2 focus:ring-amber-500 outline-none cursor-pointer text-slate-700 dark:text-slate-200"
              >
                <option value="all">所有基酒</option>
                <template x-for="spirit in spiritsData" :key="spirit.id">
                  <option :value="spirit.id" x-text="spirit.name"></option>
                </template>
              </select>

              <select
                x-model="filterDifficulty"
                class="bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold rounded-lg py-2 pl-3 pr-8 focus:ring-2 focus:ring-amber-500 outline-none cursor-pointer text-slate-700 dark:text-slate-200"
              >
                <option value="all">所有難度</option>
                <option value="1">難度 ★</option>
                <option value="2">難度 ★★</option>
                <option value="3">難度 ★★★</option>
                <option value="4">難度 ★★★★</option>
                <option value="5">難度 ★★★★★</option>
              </select>

              <select
                x-model="filterStyle"
                class="bg-slate-50 dark:bg-slate-800 border-none text-sm font-bold rounded-lg py-2 pl-3 pr-8 focus:ring-2 focus:ring-amber-500 outline-none cursor-pointer text-slate-700 dark:text-slate-200"
              >
                <option value="all">所有風格</option>
                <template x-for="tag in commonTags" :key="tag">
                  <option :value="tag" x-text="tag"></option>
                </template>
              </select>

              <button
                x-show="filterBase !== 'all' || filterDifficulty !== 'all' || filterStyle !== 'all' || searchQuery !== ''"
                @click="filterBase = 'all'; filterDifficulty = 'all'; filterStyle = 'all'; searchQuery = ''"
                class="text-xs font-bold text-red-500 hover:text-red-600 flex items-center gap-1 ml-auto"
              >
                <i data-lucide="x-circle" class="w-3 h-3"></i> 清除篩選
              </button>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              <template x-for="recipe in filteredRecipes" :key="recipe.id">
                <div
                  class="bg-white dark:bg-slate-900 rounded-[2rem] p-6 shadow-sm border border-slate-200 dark:border-slate-800 hover:border-amber-400 dark:hover:border-amber-400 transition-all group h-full flex flex-col"
                >
                  <div class="flex justify-between items-start mb-2">
                    <div
                      class="p-3 bg-amber-100 text-amber-600 rounded-2xl group-hover:scale-110 transition-transform"
                    >
                      <i data-lucide="glass-water" class="w-6 h-6"></i>
                    </div>
                    <div class="flex items-center gap-2">
                      <button
                        @click="toggleFavorite(recipe.id)"
                        class="transition p-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800"
                        :class="favoriteRecipes.includes(recipe.id) ? 'text-red-500' : 'text-slate-300 hover:text-red-400'"
                      >
                        <i
                          data-lucide="heart"
                          class="w-5 h-5"
                          :class="favoriteRecipes.includes(recipe.id) ? 'fill-current' : ''"
                        ></i>
                      </button>
                      <button
                        @click="openNoteModal(recipe)"
                        class="text-slate-300 hover:text-amber-500 transition p-1 hover:bg-amber-50 dark:hover:bg-amber-900/30 rounded-lg"
                        title="評分與筆記"
                      >
                        <i
                          data-lucide="notebook-pen"
                          class="w-4 h-4"
                          :class="recipe.myRating || recipe.myNotes ? 'text-amber-500 fill-amber-500' : ''"
                        ></i>
                      </button>
                      <button
                        @click="shareRecipe(recipe)"
                        class="text-slate-300 hover:text-blue-500 transition p-1 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg"
                        title="分享酒譜"
                      >
                        <i data-lucide="share-2" class="w-4 h-4"></i>
                      </button>
                      <button
                        @click="editRecipe(recipe)"
                        class="text-slate-300 hover:text-amber-500 transition p-1 hover:bg-amber-50 dark:hover:bg-amber-900/30 rounded-lg"
                        title="編輯酒譜"
                      >
                        <i data-lucide="pencil" class="w-4 h-4"></i>
                      </button>
                      <button
                        @click="deleteRecipe(recipe.id)"
                        class="text-slate-300 hover:text-red-500 transition p-1 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg"
                        title="刪除酒譜"
                      >
                        <i data-lucide="trash-2" class="w-4 h-4"></i>
                      </button>
                    </div>
                  </div>

                  <div class="mb-3">
                    <span
                      class="text-[10px] font-bold text-amber-600 bg-amber-50 dark:bg-amber-900/30 dark:text-amber-400 px-2 py-1 rounded border border-amber-100 dark:border-amber-800"
                      x-text="recipe.category"
                    ></span>
                  </div>

                  <h3
                    class="text-2xl font-black text-slate-800 dark:text-white mb-1"
                    x-text="recipe.name"
                  ></h3>

                  <div
                    class="flex gap-4 mb-4 text-xs font-bold text-slate-500 dark:text-slate-400"
                  >
                    <div class="flex items-center gap-1">
                      <i data-lucide="flame" class="w-3 h-3"></i>
                      <span x-text="recipe.abv"></span>
                    </div>
                    <div class="flex items-center gap-1">
                      <i
                        data-lucide="star"
                        class="w-3 h-3 text-amber-400 fill-amber-400"
                      ></i>
                      <span x-text="recipe.difficulty + '/5'"></span>
                    </div>
                    <div
                      class="flex items-center gap-1"
                      x-show="recipe.myRating"
                    >
                      <i
                        data-lucide="thumbs-up"
                        class="w-3 h-3 text-green-500"
                      ></i>
                      <span
                        class="text-green-600 dark:text-green-400"
                        x-text="'我的評分: ' + recipe.myRating"
                      ></span>
                    </div>
                  </div>

                  <p
                    class="text-sm font-bold text-slate-700 dark:text-slate-300 mb-1"
                    x-text="recipe.flavor"
                  ></p>
                  <p
                    class="text-xs text-slate-500 dark:text-slate-400 mb-4 leading-relaxed"
                    x-text="recipe.features"
                  ></p>

                  <div class="flex-1">
                    <div
                      class="mb-4 bg-slate-50 dark:bg-slate-800 rounded-xl p-3 border border-slate-100 dark:border-slate-700"
                    >
                      <h4
                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                      >
                        材料清單
                      </h4>
                      <div class="space-y-1.5">
                        <template x-for="ing in recipe.ingredients">
                          <div
                            class="flex justify-between items-center text-xs"
                          >
                            <span
                              class="font-bold text-slate-700 dark:text-slate-300 flex items-center gap-1"
                              :class="myIngredients.includes(ing.id) ? 'text-green-600 dark:text-green-400' : ''"
                            >
                              <i
                                x-show="myIngredients.includes(ing.id)"
                                data-lucide="check"
                                class="w-3 h-3"
                              ></i>
                              <span x-text="getIngredientName(ing.id)"></span>
                            </span>
                            <span
                              class="text-slate-500 dark:text-slate-400 font-mono font-bold"
                              x-text="convertAmount(ing.amount)"
                            ></span>
                          </div>
                        </template>
                      </div>
                    </div>
                    <!-- 舊版材料標籤 (隱藏或移除，改用上方清單) -->
                    <!-- <div class="flex flex-wrap gap-2 mb-6">
                      <template x-for="ing in recipe.ingredients">
                        <span
                          class="px-3 py-1.5 rounded-xl text-xs font-bold border transition-colors"
                          :class="myIngredients.includes(ing.id) ? 'bg-green-50 dark:bg-green-900/30 text-green-700 dark:text-green-400 border-green-200 dark:border-green-800' : 'bg-slate-50 dark:bg-slate-800 text-slate-500 dark:text-slate-400 border-slate-100 dark:border-slate-700'"
                          x-text="getIngredientName(ing.id)"
                        ></span>
                      </template>
                    </div> -->
                  </div>

                  <div class="mb-4 flex-1">
                    <h4
                      class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                    >
                      調製步驟
                    </h4>
                    <ol
                      class="list-decimal list-inside text-xs text-slate-600 dark:text-slate-400 space-y-1 font-medium"
                    >
                      <template x-for="step in recipe.steps">
                        <li x-text="convertStep(step)"></li>
                      </template>
                    </ol>
                  </div>

                  <div
                    class="bg-slate-50 dark:bg-slate-800 rounded-2xl p-4 mt-auto"
                  >
                    <div class="flex items-center gap-2 text-slate-400 mb-2">
                      <i data-lucide="lightbulb" class="w-4 h-4"></i>
                      <span
                        class="text-[10px] font-black uppercase tracking-widest"
                        >調製秘訣</span
                      >
                    </div>
                    <p
                      class="text-sm text-slate-600 dark:text-slate-300 font-medium"
                      x-text="recipe.tips"
                    ></p>
                  </div>

                  <!-- My Notes -->
                  <div
                    x-show="recipe.myNotes"
                    class="mt-4 bg-amber-50 dark:bg-amber-900/20 rounded-2xl p-4 border border-amber-100 dark:border-amber-900/30"
                  >
                    <div
                      class="flex items-center gap-2 text-amber-600 dark:text-amber-500 mb-2"
                    >
                      <i data-lucide="pen-tool" class="w-3 h-3"></i>
                      <span
                        class="text-[10px] font-black uppercase tracking-widest"
                        >我的筆記</span
                      >
                    </div>
                    <p
                      class="text-xs text-slate-700 dark:text-slate-300 font-medium whitespace-pre-line"
                      x-text="recipe.myNotes"
                    ></p>
                  </div>

                  <!-- Tags -->
                  <div
                    class="flex flex-wrap gap-1 mt-4 pt-4 border-t border-slate-100 dark:border-slate-800"
                  >
                    <template x-for="tag in recipe.tags">
                      <span
                        class="text-[10px] font-bold text-slate-400 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-lg"
                        x-text="'#'+tag"
                      ></span>
                    </template>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- === 我的最愛 === -->
          <div
            x-show="activeTab === 'favorites'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <div
              class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
            >
              <div>
                <h2 class="text-4xl font-black text-slate-900 dark:text-white">
                  我的最愛
                </h2>
                <p class="text-slate-500 mt-2 text-lg">
                  您收藏的精選酒譜清單。
                </p>
              </div>
            </div>

            <div
              x-show="favoriteRecipeList.length === 0"
              class="text-center py-20 bg-white dark:bg-slate-900 rounded-[2.5rem] border-2 border-dashed border-slate-200 dark:border-slate-800"
            >
              <i
                data-lucide="heart-off"
                class="w-16 h-16 mx-auto text-slate-200 mb-6"
              ></i>
              <h3 class="text-2xl font-black text-slate-400">
                還沒有收藏任何酒譜
              </h3>
              <button
                @click="activeTab = 'recipes'"
                class="text-amber-600 font-black hover:underline mt-4"
              >
                前往酒譜庫探索
              </button>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              <template x-for="recipe in favoriteRecipeList" :key="recipe.id">
                <div
                  class="bg-white dark:bg-slate-900 rounded-[2rem] p-6 shadow-sm border border-slate-200 dark:border-slate-800 hover:border-amber-400 dark:hover:border-amber-400 transition-all group h-full flex flex-col"
                >
                  <div class="flex justify-between items-start mb-2">
                    <div
                      class="p-3 bg-red-50 text-red-500 rounded-2xl group-hover:scale-110 transition-transform"
                    >
                      <i data-lucide="heart" class="w-6 h-6 fill-current"></i>
                    </div>
                    <div class="flex items-center gap-2">
                      <button
                        @click="toggleFavorite(recipe.id)"
                        class="text-red-500 hover:text-slate-300 transition p-1.5 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800"
                        title="取消收藏"
                      >
                        <i data-lucide="heart" class="w-5 h-5 fill-current"></i>
                      </button>
                      <button
                        @click="openNoteModal(recipe)"
                        class="text-slate-300 hover:text-amber-500 transition p-1 hover:bg-amber-50 dark:hover:bg-amber-900/30 rounded-lg"
                        title="評分與筆記"
                      >
                        <i
                          data-lucide="notebook-pen"
                          class="w-4 h-4"
                          :class="recipe.myRating || recipe.myNotes ? 'text-amber-500 fill-amber-500' : ''"
                        ></i>
                      </button>
                      <button
                        @click="shareRecipe(recipe)"
                        class="text-slate-300 hover:text-blue-500 transition p-1 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg"
                        title="分享酒譜"
                      >
                        <i data-lucide="share-2" class="w-4 h-4"></i>
                      </button>
                      <button
                        @click="editRecipe(recipe)"
                        class="text-slate-300 hover:text-amber-500 transition p-1 hover:bg-amber-50 dark:hover:bg-amber-900/30 rounded-lg"
                      >
                        <i data-lucide="pencil" class="w-4 h-4"></i>
                      </button>
                    </div>
                  </div>

                  <div class="mb-3">
                    <span
                      class="text-[10px] font-bold text-amber-600 bg-amber-50 dark:bg-amber-900/30 dark:text-amber-400 px-2 py-1 rounded border border-amber-100 dark:border-amber-800"
                      x-text="recipe.category"
                    ></span>
                  </div>

                  <h3
                    class="text-2xl font-black text-slate-800 dark:text-white mb-1"
                    x-text="recipe.name"
                  ></h3>

                  <div
                    class="flex gap-4 mb-4 text-xs font-bold text-slate-500 dark:text-slate-400"
                  >
                    <div class="flex items-center gap-1">
                      <i data-lucide="flame" class="w-3 h-3"></i>
                      <span x-text="recipe.abv"></span>
                    </div>
                    <div class="flex items-center gap-1">
                      <i
                        data-lucide="star"
                        class="w-3 h-3 text-amber-400 fill-amber-400"
                      ></i>
                      <span x-text="recipe.difficulty + '/5'"></span>
                    </div>
                    <div
                      class="flex items-center gap-1"
                      x-show="recipe.myRating"
                    >
                      <i
                        data-lucide="thumbs-up"
                        class="w-3 h-3 text-green-500"
                      ></i>
                      <span
                        class="text-green-600 dark:text-green-400"
                        x-text="'我的評分: ' + recipe.myRating"
                      ></span>
                    </div>
                  </div>

                  <p
                    class="text-sm font-bold text-slate-700 dark:text-slate-300 mb-1"
                    x-text="recipe.flavor"
                  ></p>
                  <p
                    class="text-xs text-slate-500 dark:text-slate-400 mb-4 leading-relaxed"
                    x-text="recipe.features"
                  ></p>

                  <div class="flex-1">
                    <div
                      class="mb-4 bg-slate-50 dark:bg-slate-800 rounded-xl p-3 border border-slate-100 dark:border-slate-700"
                    >
                      <h4
                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                      >
                        材料清單
                      </h4>
                      <div class="space-y-1.5">
                        <template x-for="ing in recipe.ingredients">
                          <div
                            class="flex justify-between items-center text-xs"
                          >
                            <span
                              class="font-bold text-slate-700 dark:text-slate-300 flex items-center gap-1"
                              :class="myIngredients.includes(ing.id) ? 'text-green-600 dark:text-green-400' : ''"
                            >
                              <i
                                x-show="myIngredients.includes(ing.id)"
                                data-lucide="check"
                                class="w-3 h-3"
                              ></i>
                              <span x-text="getIngredientName(ing.id)"></span>
                            </span>
                            <span
                              class="text-slate-500 dark:text-slate-400 font-mono font-bold"
                              x-text="convertAmount(ing.amount)"
                            ></span>
                          </div>
                        </template>
                      </div>
                    </div>
                  </div>

                  <div class="mb-4 flex-1">
                    <h4
                      class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                    >
                      調製步驟
                    </h4>
                    <ol
                      class="list-decimal list-inside text-xs text-slate-600 dark:text-slate-400 space-y-1 font-medium"
                    >
                      <template x-for="step in recipe.steps">
                        <li x-text="convertStep(step)"></li>
                      </template>
                    </ol>
                  </div>

                  <div
                    class="bg-slate-50 dark:bg-slate-800 rounded-2xl p-4 mt-auto"
                  >
                    <div class="flex items-center gap-2 text-slate-400 mb-2">
                      <i data-lucide="lightbulb" class="w-4 h-4"></i>
                      <span
                        class="text-[10px] font-black uppercase tracking-widest"
                        >調製秘訣</span
                      >
                    </div>
                    <p
                      class="text-sm text-slate-600 dark:text-slate-300 font-medium"
                      x-text="recipe.tips"
                    ></p>
                  </div>

                  <!-- My Notes -->
                  <div
                    x-show="recipe.myNotes"
                    class="mt-4 bg-amber-50 dark:bg-amber-900/20 rounded-2xl p-4 border border-amber-100 dark:border-amber-900/30"
                  >
                    <div
                      class="flex items-center gap-2 text-amber-600 dark:text-amber-500 mb-2"
                    >
                      <i data-lucide="pen-tool" class="w-3 h-3"></i>
                      <span
                        class="text-[10px] font-black uppercase tracking-widest"
                        >我的筆記</span
                      >
                    </div>
                    <p
                      class="text-xs text-slate-700 dark:text-slate-300 font-medium whitespace-pre-line"
                      x-text="recipe.myNotes"
                    ></p>
                  </div>

                  <div
                    class="flex flex-wrap gap-1 mt-4 pt-4 border-t border-slate-100 dark:border-slate-800"
                  >
                    <template x-for="tag in recipe.tags">
                      <span
                        class="text-[10px] font-bold text-slate-400 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-lg"
                        x-text="'#'+tag"
                      ></span>
                    </template>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- === 吧檯 === -->
          <div
            x-show="activeTab === 'bar'"
            class="grid xl:grid-cols-4 gap-8 animate-fade-in"
            x-cloak
          >
            <div class="xl:col-span-1 space-y-4">
              <div
                class="bg-white dark:bg-slate-900 p-6 rounded-3xl shadow-sm border border-slate-200 dark:border-slate-800 static xl:sticky xl:top-10"
              >
                <div
                  class="flex justify-between items-center mb-4 border-b pb-4"
                >
                  <h3 class="font-black flex items-center gap-2 text-xl">
                    <i data-lucide="check" class="text-green-500"></i> 我的吧檯
                  </h3>
                </div>

                <div class="grid grid-cols-2 gap-2 mb-6">
                  <button
                    @click="openAddBottleModal()"
                    class="bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 py-2 rounded-xl text-xs font-black flex items-center justify-center gap-1 transition"
                  >
                    <i data-lucide="wine" class="w-3 h-3"></i> + 酒藏
                  </button>
                  <button
                    @click="isModifierFormOpen = true"
                    class="bg-slate-100 dark:bg-slate-800 hover:bg-slate-200 dark:hover:bg-slate-700 text-slate-600 dark:text-slate-300 py-2 rounded-xl text-xs font-black flex items-center justify-center gap-1 transition"
                  >
                    <i data-lucide="leaf" class="w-3 h-3"></i> + 調味
                  </button>
                </div>

                <div
                  class="space-y-8 overflow-y-auto max-h-[60vh] pr-2 custom-scrollbar"
                >
                  <template
                    x-for="(items, category) in getRecipeIngredientsGrouped()"
                    :key="category"
                  >
                    <div>
                      <h4
                        class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3"
                        x-text="category"
                      ></h4>
                      <div class="space-y-1.5">
                        <template x-for="item in items" :key="item.id">
                          <label
                            class="flex items-center space-x-3 cursor-pointer p-2 hover:bg-slate-50 dark:hover:bg-slate-800 rounded-xl transition group"
                          >
                            <div
                              class="w-5 h-5 rounded-lg border-2 flex items-center justify-center transition-all"
                              :class="myIngredients.includes(item.id) ? 'bg-amber-500 border-amber-500 text-slate-900 shadow-lg' : 'border-slate-200 dark:border-slate-700'"
                            >
                              <i
                                x-show="myIngredients.includes(item.id)"
                                data-lucide="check"
                                class="w-3 h-3 stroke-[4]"
                              ></i>
                            </div>
                            <input
                              type="checkbox"
                              class="hidden"
                              :value="item.id"
                              @change="toggleIngredient(item.id)"
                              :checked="myIngredients.includes(item.id)"
                            />
                            <span
                              class="text-sm font-bold"
                              :class="myIngredients.includes(item.id) ? 'text-slate-900 dark:text-white' : 'text-slate-500 dark:text-slate-500'"
                              x-text="item.name"
                            ></span>
                          </label>
                        </template>
                      </div>
                    </div>
                  </template>
                </div>
              </div>
            </div>
            <div class="xl:col-span-3 space-y-12">
              <!-- Ready to Drink -->
              <div x-show="getReadyRecipes().length > 0">
                <h3
                  class="font-black flex items-center gap-3 text-2xl mb-6 text-green-600 dark:text-green-400"
                >
                  <i data-lucide="party-popper"></i>
                  現有材料可調製
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <template x-for="recipe in getReadyRecipes()">
                    <div
                      class="p-6 rounded-3xl border-2 transition-all flex flex-col justify-between bg-white dark:bg-slate-900 border-green-200 dark:border-green-900 shadow-lg"
                    >
                      <div>
                        <div class="flex justify-between items-start mb-4">
                          <div>
                            <h4
                              class="font-black text-xl text-slate-800 dark:text-white"
                              x-text="recipe.name"
                            ></h4>
                            <p
                              class="text-xs text-slate-500 font-bold"
                              x-text="recipe.flavor"
                            ></p>
                          </div>
                          <div
                            class="bg-green-500 text-white text-[10px] font-black px-3 py-1 rounded-full"
                          >
                            Ready
                          </div>
                        </div>
                      </div>
                      <button
                        @click="selectedRecipe = recipe; isRecipeModalOpen = true"
                        class="mt-6 w-full py-3 rounded-2xl font-black text-sm transition bg-slate-900 dark:bg-amber-500 dark:text-slate-900 text-white hover:bg-slate-800"
                      >
                        查看詳細步驟
                      </button>
                    </div>
                  </template>
                </div>
              </div>

              <!-- Near Miss -->
              <div x-show="getNearMissRecipes().length > 0">
                <h3
                  class="font-black flex items-center gap-3 text-2xl mb-6 text-amber-600 dark:text-amber-400"
                >
                  <i data-lucide="sparkles"></i>
                  只缺一項！推薦嘗試
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <template x-for="recipe in getNearMissRecipes()">
                    <div
                      class="p-6 rounded-3xl border-2 transition-all flex flex-col justify-between bg-amber-50 dark:bg-amber-900/10 border-amber-200 dark:border-amber-800"
                    >
                      <div>
                        <div class="flex justify-between items-start mb-4">
                          <div>
                            <h4
                              class="font-black text-xl text-slate-800 dark:text-white"
                              x-text="recipe.name"
                            ></h4>
                            <p
                              class="text-xs text-slate-500 font-bold"
                              x-text="recipe.flavor"
                            ></p>
                          </div>
                          <div
                            class="bg-amber-400 text-white text-[10px] font-black px-3 py-1 rounded-full"
                          >
                            缺 1 項
                          </div>
                        </div>
                        <div
                          class="bg-white dark:bg-slate-900 p-3 rounded-xl border border-amber-100 dark:border-amber-900 flex justify-between items-center gap-2"
                        >
                          <div
                            class="text-xs font-bold text-amber-600 dark:text-amber-400"
                          >
                            缺少：<span
                              x-text="getMissingNames(recipe.missing)"
                            ></span>
                          </div>
                          <button
                            @click="addToShoppingList(recipe.missing)"
                            class="text-[10px] bg-amber-100 hover:bg-amber-200 dark:bg-amber-900 dark:hover:bg-amber-800 text-amber-800 dark:text-amber-200 px-2 py-1 rounded-lg font-black transition flex items-center gap-1 shrink-0"
                          >
                            <i data-lucide="plus" class="w-3 h-3"></i> 加入清單
                          </button>
                        </div>
                      </div>
                      <button
                        @click="selectedRecipe = recipe; isRecipeModalOpen = true"
                        class="mt-6 w-full py-3 rounded-2xl font-black text-sm transition bg-white dark:bg-slate-800 text-slate-600 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700"
                      >
                        查看詳細步驟
                      </button>
                    </div>
                  </template>
                </div>
              </div>

              <!-- Others -->
              <div x-show="getOtherRecipes().length > 0">
                <h3
                  class="font-black flex items-center gap-3 text-xl mb-6 text-slate-500"
                >
                  <i data-lucide="search"></i>
                  探索更多酒譜
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 opacity-75">
                  <template x-for="recipe in getOtherRecipes()">
                    <div
                      class="p-6 rounded-3xl border-2 transition-all flex flex-col justify-between bg-slate-100 dark:bg-slate-800 border-slate-200 dark:border-slate-700"
                    >
                      <div>
                        <div class="flex justify-between items-start mb-4">
                          <div>
                            <h4
                              class="font-black text-xl text-slate-800 dark:text-white"
                              x-text="recipe.name"
                            ></h4>
                            <p
                              class="text-xs text-slate-500 font-bold"
                              x-text="recipe.flavor"
                            ></p>
                          </div>
                          <div
                            class="bg-slate-300 text-slate-700 text-[10px] font-black px-3 py-1 rounded-full"
                            x-text="'缺 ' + recipe.missing.length + ' 項'"
                          ></div>
                        </div>
                        <div
                          class="bg-red-50 dark:bg-red-900/20 p-3 rounded-xl border border-red-100 dark:border-red-900 flex justify-between items-center gap-2"
                        >
                          <div
                            class="text-xs font-bold text-red-600 dark:text-red-400"
                          >
                            缺少：<span
                              x-text="getMissingNames(recipe.missing)"
                            ></span>
                          </div>
                          <button
                            @click="addToShoppingList(recipe.missing)"
                            class="text-[10px] bg-red-100 hover:bg-red-200 dark:bg-red-900 dark:hover:bg-red-800 text-red-700 dark:text-red-300 px-2 py-1 rounded-lg font-black transition flex items-center gap-1 shrink-0"
                          >
                            <i data-lucide="plus" class="w-3 h-3"></i> 加入清單
                          </button>
                        </div>
                      </div>
                      <button
                        @click="selectedRecipe = recipe; isRecipeModalOpen = true"
                        class="mt-6 w-full py-3 rounded-2xl font-black text-sm transition bg-slate-200 dark:bg-slate-700 text-slate-400 dark:text-slate-500"
                      >
                        查看詳細步驟
                      </button>
                    </div>
                  </template>
                </div>
              </div>
            </div>
          </div>

          <!-- === 酒櫃 === -->
          <div
            x-show="activeTab === 'collection'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <div
              class="flex flex-col md:flex-row justify-between items-center gap-4"
            >
              <h2 class="text-4xl font-black text-slate-900 dark:text-white">
                我的私人酒櫃
              </h2>
              <div class="flex gap-3 w-full md:w-auto">
                <div class="relative flex-1 md:w-64">
                  <i
                    data-lucide="search"
                    class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400"
                  ></i>
                  <input
                    type="text"
                    placeholder="搜尋收藏..."
                    class="w-full pl-10 pr-4 py-3 rounded-xl border-2 border-slate-200 dark:border-slate-800 bg-white dark:bg-slate-900 text-sm font-bold focus:outline-none focus:border-amber-500 transition"
                    x-model="searchQuery"
                  />
                </div>
                <button
                  @click="openAddBottleModal()"
                  class="bg-amber-500 text-slate-900 px-6 py-3 rounded-xl font-black shadow-xl hover:scale-105 transition flex items-center gap-2 shrink-0"
                >
                  <i data-lucide="plus" class="w-5 h-5"></i>
                  <span class="hidden sm:inline">入庫</span>
                </button>
              </div>
            </div>
            <div
              x-show="myBottles.length === 0"
              class="text-center py-32 bg-white dark:bg-slate-900 rounded-[2.5rem] border-2 border-dashed border-slate-200 dark:border-slate-800"
            >
              <i
                data-lucide="wine"
                class="w-16 h-16 mx-auto text-slate-200 mb-6 text-slate-300"
              ></i>
              <h3 class="text-2xl font-black text-slate-400">目前沒有收藏</h3>
              <button
                @click="openAddBottleModal()"
                class="text-amber-600 font-black hover:underline mt-4"
              >
                ＋ 立即新增
              </button>
            </div>
            <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
              <template x-for="bottle in filteredBottles" :key="bottle.id">
                <div
                  class="bg-white dark:bg-slate-900 rounded-[2rem] shadow-sm border border-slate-200 dark:border-slate-800 overflow-hidden flex flex-col hover:shadow-2xl transition-all"
                >
                  <div
                    class="p-6 border-b dark:border-slate-800 bg-slate-50/50 dark:bg-slate-800/50 flex justify-between items-start"
                  >
                    <div>
                      <span
                        class="text-[10px] font-black text-amber-600 bg-amber-50 px-2 py-0.5 rounded-lg border border-amber-200 uppercase"
                        x-text="getIngredientName(bottle.typeId)"
                      ></span>
                      <h3
                        class="text-xl font-black text-slate-800 dark:text-white mt-2"
                        x-text="bottle.name"
                      ></h3>
                      <p
                        class="text-xs text-slate-400 font-bold mt-1"
                        x-show="bottle.brand"
                        x-text="bottle.brand"
                      ></p>
                    </div>
                    <div
                      class="text-lg font-black text-amber-600"
                      x-text="'$' + bottle.price"
                    ></div>
                  </div>
                  <div class="p-6 flex-1 space-y-4">
                    <div
                      class="flex flex-wrap gap-1"
                      x-show="bottle.tags && bottle.tags.length"
                    >
                      <template x-for="tag in bottle.tags">
                        <span
                          class="text-[10px] bg-slate-100 dark:bg-slate-800 text-slate-500 dark:text-slate-400 px-2 py-1 rounded-lg font-bold"
                          x-text="'#'+tag"
                        ></span>
                      </template>
                    </div>

                    <div
                      class="grid grid-cols-2 gap-y-2 gap-x-4 text-xs text-slate-500 dark:text-slate-400 border-b border-slate-100 dark:border-slate-800 pb-3"
                      x-show="bottle.location || bottle.expirationDate || bottle.features"
                    >
                      <div
                        x-show="bottle.location"
                        class="col-span-1 flex items-center gap-1"
                      >
                        <i data-lucide="map-pin" class="w-3 h-3"></i>
                        <span x-text="bottle.location"></span>
                      </div>
                      <div
                        x-show="bottle.expirationDate"
                        class="col-span-1 flex items-center gap-1"
                      >
                        <i data-lucide="calendar" class="w-3 h-3"></i>
                        <span x-text="bottle.expirationDate"></span>
                      </div>
                      <div x-show="bottle.features" class="col-span-2 mt-1">
                        <span
                          class="font-bold text-amber-600 bg-amber-50 px-1 rounded"
                          >特色</span
                        >
                        <span x-text="bottle.features"></span>
                      </div>
                    </div>

                    <div class="py-1">
                      <div class="flex justify-between items-end mb-1">
                        <span
                          class="text-[10px] font-black text-slate-400 uppercase tracking-widest"
                          >剩餘庫存</span
                        >
                        <span
                          class="text-xs font-bold"
                          :class="bottle.remaining < 30 ? 'text-red-500' : 'text-slate-600 dark:text-slate-400'"
                          x-text="bottle.remaining + '%'"
                        ></span>
                      </div>
                      <input
                        type="range"
                        min="0"
                        max="100"
                        step="10"
                        class="w-full h-1.5 bg-slate-100 dark:bg-slate-800 rounded-lg appearance-none cursor-pointer accent-amber-500"
                        x-model="bottle.remaining"
                        title="調整剩餘量"
                      />
                    </div>

                    <div
                      class="bg-slate-50 dark:bg-slate-800 p-4 rounded-2xl text-xs text-slate-600 dark:text-slate-400 font-medium italic"
                      x-text="'&quot;' + (bottle.notes || '尚未輸入筆記...') + '&quot;'"
                    ></div>
                    <div class="flex gap-1 justify-end">
                      <template x-for="i in 5">
                        <i
                          data-lucide="star"
                          class="w-3 h-3"
                          :class="i <= bottle.rating ? 'text-amber-400 fill-amber-400' : 'text-slate-200 dark:text-slate-700'"
                        ></i>
                      </template>
                    </div>
                  </div>
                  <div
                    class="p-4 bg-slate-50/50 dark:bg-slate-800/50 border-t dark:border-slate-800 flex justify-end"
                  >
                    <button
                      @click="editBottle(bottle)"
                      class="text-slate-300 hover:text-amber-500 transition-all p-2 rounded-xl hover:bg-amber-50 mr-2"
                    >
                      <i data-lucide="pencil" class="w-4 h-4"></i>
                    </button>
                    <button
                      @click="deleteBottle(bottle.id)"
                      class="text-slate-300 hover:text-red-500 transition-all p-2 rounded-xl hover:bg-red-50"
                    >
                      <i data-lucide="trash-2" class="w-4 h-4"></i>
                    </button>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <!-- === 喝什麼 (輪盤) === -->
          <div
            x-show="activeTab === 'roulette'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <div class="text-center mb-8">
              <h2
                class="text-4xl font-black text-slate-900 dark:text-white mb-2"
              >
                派對喝酒輪盤
              </h2>
              <p class="text-slate-500 text-lg">
                刺激的派對遊戲，看看幸運女神眷顧誰！
              </p>
            </div>

            <div
              class="flex flex-col items-center justify-center relative min-h-[500px]"
            >
              <!-- 指針 -->
              <div
                class="absolute top-0 left-1/2 -translate-x-1/2 z-20 text-slate-800 dark:text-white drop-shadow-xl translate-y-8"
              >
                <i
                  data-lucide="chevron-down"
                  class="w-12 h-12 fill-current"
                ></i>
              </div>

              <!-- 輪盤本體 -->
              <div class="relative w-80 h-80 md:w-96 md:h-96">
                <div
                  class="w-full h-full rounded-full overflow-hidden shadow-2xl border-8 border-slate-900 dark:border-slate-700 relative transition-transform duration-[3000ms] ease-out"
                  :style="`transform: rotate(${rouletteRotation}deg); background: conic-gradient(${getRouletteGradient()})`"
                >
                  <!-- 選項標籤 -->
                  <template x-for="(item, index) in rouletteCandidates">
                    <div
                      class="absolute top-0 left-1/2 w-1 h-1/2 origin-bottom flex justify-center pt-4"
                      :style="`transform: translateX(-50%) rotate(${index * (360/rouletteCandidates.length) + (360/rouletteCandidates.length)/2}deg)`"
                    >
                      <div
                        class="text-xs md:text-sm font-black text-slate-900 writing-vertical-rl h-32 text-center truncate drop-shadow-md"
                        style="writing-mode: vertical-rl"
                      >
                        <span x-text="item.name"></span>
                      </div>
                    </div>
                  </template>
                </div>

                <!-- 中心裝飾 -->
                <div
                  class="absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-20 h-20 bg-slate-900 dark:bg-slate-800 rounded-full z-10 flex items-center justify-center text-white shadow-lg border-4 border-white dark:border-slate-600"
                >
                  <i data-lucide="dices" class="w-10 h-10 text-amber-500"></i>
                </div>
              </div>

              <!-- 控制按鈕 -->
              <div class="mt-12 flex gap-6">
                <button
                  @click="spinRoulette()"
                  :disabled="isSpinning"
                  class="bg-amber-500 text-slate-900 px-10 py-4 rounded-2xl font-black shadow-xl hover:scale-105 transition disabled:opacity-50 disabled:scale-100 text-xl flex items-center gap-2"
                >
                  <i
                    data-lucide="rotate-cw"
                    class="w-6 h-6"
                    :class="isSpinning ? 'animate-spin' : ''"
                  ></i>
                  <span x-text="isSpinning ? '旋轉中...' : '開始轉動'"></span>
                </button>
              </div>

              <!-- 結果顯示 -->
              <div
                x-show="rouletteResult"
                class="mt-10 w-full max-w-md animate-fade-in"
                x-transition
              >
                <div
                  class="bg-white dark:bg-slate-900 p-6 rounded-3xl shadow-2xl border-2 border-amber-400 text-center relative overflow-hidden"
                >
                  <div
                    class="absolute top-0 left-0 w-full h-2 bg-amber-400"
                  ></div>
                  <div
                    class="text-amber-500 font-black uppercase tracking-widest text-xs mb-2"
                  >
                    Fate has chosen
                  </div>
                  <h3
                    class="text-3xl font-black text-slate-900 dark:text-white mb-4"
                    x-text="rouletteResult?.name"
                  ></h3>
                  <p
                    class="text-slate-500 dark:text-slate-400 mb-6"
                    x-text="rouletteResult?.flavor"
                  ></p>

                  <div class="flex gap-3 justify-center">
                    <button
                      @click="pickRandomRecipe()"
                      class="bg-slate-900 dark:bg-white text-white dark:text-slate-900 px-8 py-3 rounded-xl font-bold text-sm hover:opacity-90 transition"
                    >
                      來杯隨機酒譜
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- === 派對酒單 (Menu Generator) === -->
          <div
            x-show="activeTab === 'menu'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <!-- Selection View -->
            <div x-show="!isMenuGenerated" class="animate-fade-in">
              <div
                class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4"
              >
                <div>
                  <h2
                    class="text-4xl font-black text-slate-900 dark:text-white"
                  >
                    建立您的派對酒單
                  </h2>
                  <p class="text-slate-500 mt-2 text-lg">
                    從「可調製」的酒譜中勾選，產生一份專屬的今日特調菜單。
                  </p>
                </div>
                <button
                  @click="isMenuGenerated = true"
                  :disabled="menuSelectedRecipes.length === 0"
                  class="bg-amber-500 text-slate-900 px-8 py-3 rounded-xl font-black shadow-lg hover:bg-amber-400 transition flex items-center gap-2 shrink-0 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  <i data-lucide="file-check" class="w-5 h-5"></i>
                  產生酒單
                </button>
              </div>

              <div
                x-show="getReadyRecipes().length === 0"
                class="text-center py-20 mt-8 bg-white dark:bg-slate-900 rounded-[2.5rem] border-2 border-dashed border-slate-200 dark:border-slate-800"
              >
                <i
                  data-lucide="clipboard-x"
                  class="w-16 h-16 mx-auto text-slate-300 dark:text-slate-700 mb-6"
                ></i>
                <h3 class="text-2xl font-black text-slate-400">
                  沒有可調製的酒譜
                </h3>
                <p class="text-slate-500 mt-2">
                  請先到「吧檯」頁面，確認您擁有的材料。
                </p>
                <button
                  @click="activeTab = 'bar'"
                  class="text-amber-600 font-black hover:underline mt-4"
                >
                  前往我的吧檯
                </button>
              </div>

              <div
                x-show="getReadyRecipes().length > 0"
                class="mt-8 grid md:grid-cols-2 lg:grid-cols-3 gap-6"
              >
                <template x-for="recipe in getReadyRecipes()" :key="recipe.id">
                  <label
                    class="bg-white dark:bg-slate-900 rounded-3xl p-6 shadow-sm border-2 transition-all cursor-pointer"
                    :class="menuSelectedRecipes.includes(recipe.id) ? 'border-amber-500 ring-4 ring-amber-500/20' : 'border-slate-200 dark:border-slate-800'"
                  >
                    <div class="flex items-start justify-between">
                      <div class="flex-1">
                        <h4
                          class="font-black text-xl text-slate-800 dark:text-white"
                          x-text="recipe.name"
                        ></h4>
                        <p
                          class="text-xs text-slate-500 font-bold"
                          x-text="recipe.flavor"
                        ></p>
                      </div>
                      <input
                        type="checkbox"
                        :value="recipe.id"
                        x-model="menuSelectedRecipes"
                        class="w-6 h-6 rounded-lg text-amber-500 focus:ring-amber-500 border-slate-300 dark:border-slate-600 bg-slate-100 dark:bg-slate-800 shrink-0 ml-4"
                      />
                    </div>
                  </label>
                </template>
              </div>
            </div>

            <!-- Generated Menu View -->
            <div x-show="isMenuGenerated" class="animate-fade-in">
              <div class="flex items-center justify-between mb-8 print:hidden">
                <button
                  @click="isMenuGenerated = false; menuSelectedRecipes = []"
                  class="flex items-center gap-2 text-slate-500 hover:text-slate-800 dark:hover:text-white font-bold transition"
                >
                  <i data-lucide="arrow-left"></i> 返回編輯
                </button>
                <button
                  @click="window.print()"
                  class="bg-slate-800 text-white px-6 py-2 rounded-lg font-bold flex items-center gap-2"
                >
                  <i data-lucide="printer"></i> 列印
                </button>
              </div>

              <div
                class="max-w-2xl mx-auto bg-white dark:bg-slate-900 p-10 md:p-16 rounded-lg shadow-2xl print:shadow-none print:p-0"
              >
                <div
                  class="text-center border-b-2 border-dashed border-slate-300 dark:border-slate-700 pb-8 mb-8"
                >
                  <p
                    class="text-sm font-bold tracking-widest uppercase text-amber-600"
                  >
                    Today's Special
                  </p>
                  <h2
                    class="text-4xl font-black text-slate-900 dark:text-white mt-2"
                    x-text="barName"
                  ></h2>
                  <p class="text-slate-400 mt-1" x-text="bartenderName"></p>
                </div>

                <div class="grid md:grid-cols-2 gap-x-12 gap-y-8">
                  <template
                    x-for="recipe in generatedMenuList"
                    :key="recipe.id"
                  >
                    <div class="space-y-1">
                      <h3
                        class="text-xl font-black text-slate-800 dark:text-white"
                        x-text="recipe.name"
                      ></h3>
                      <p
                        class="text-sm text-amber-700 dark:text-amber-500 font-bold"
                        x-text="recipe.flavor"
                      ></p>
                      <p
                        class="text-xs text-slate-500 dark:text-slate-400 pt-1"
                      >
                        <template x-for="(ing, index) in recipe.ingredients">
                          <span
                            ><span x-text="getIngredientName(ing.id)"></span
                            ><span
                              x-show="index < recipe.ingredients.length - 1"
                            >
                              /
                            </span></span
                          >
                        </template>
                      </p>
                    </div>
                  </template>
                </div>
              </div>
            </div>
          </div>

          <!-- === 設定 === -->
          <div
            x-show="activeTab === 'settings'"
            class="space-y-8 animate-fade-in"
            x-cloak
          >
            <h2 class="text-4xl font-black text-slate-900 dark:text-white">
              設定
            </h2>

            <!-- 個人化設定 -->
            <div
              class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 shadow-sm border border-slate-200 dark:border-slate-800"
            >
              <h3
                class="text-2xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-3"
              >
                <i data-lucide="cloud" class="text-amber-500"></i> 雲端同步
                (Firebase)
              </h3>

              <div
                class="bg-slate-50 dark:bg-slate-800 rounded-2xl p-6 border border-slate-100 dark:border-slate-700"
              >
                <div x-show="!user" class="text-center py-4">
                  <p class="text-slate-500 mb-4">
                    登入 Google 帳號以啟用跨裝置備份功能。
                  </p>
                  <button
                    @click="loginFirebase()"
                    class="bg-white dark:bg-slate-700 text-slate-800 dark:text-white px-6 py-3 rounded-xl font-bold shadow-md hover:scale-105 transition flex items-center gap-2 mx-auto"
                  >
                    <img
                      src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg"
                      class="w-5 h-5"
                    />
                    使用 Google 登入
                  </button>
                </div>

                <div
                  x-show="user"
                  class="flex flex-col md:flex-row items-center justify-between gap-4"
                >
                  <div class="flex items-center gap-3">
                    <img
                      :src="user?.photoURL"
                      class="w-12 h-12 rounded-full border-2 border-amber-500"
                    />
                    <div>
                      <div
                        class="font-black text-slate-800 dark:text-white"
                        x-text="user?.displayName"
                      ></div>
                      <div
                        class="text-xs text-slate-500"
                        x-text="user?.email"
                      ></div>
                    </div>
                  </div>
                  <div class="flex gap-3 w-full md:w-auto">
                    <button
                      @click="saveToCloud()"
                      class="flex-1 md:flex-none py-2 px-4 bg-amber-500 text-slate-900 font-bold rounded-xl hover:bg-amber-400 transition flex items-center justify-center gap-2"
                    >
                      <i data-lucide="upload-cloud" class="w-4 h-4"></i> 備份
                    </button>
                    <button
                      @click="loadFromCloud()"
                      class="flex-1 md:flex-none py-2 px-4 bg-slate-200 dark:bg-slate-700 text-slate-700 dark:text-slate-200 font-bold rounded-xl hover:bg-slate-300 dark:hover:bg-slate-600 transition flex items-center justify-center gap-2"
                    >
                      <i data-lucide="download-cloud" class="w-4 h-4"></i> 還原
                    </button>
                    <button
                      @click="logoutFirebase()"
                      class="py-2 px-4 text-red-500 font-bold hover:bg-red-50 dark:hover:bg-red-900/20 rounded-xl transition"
                    >
                      登出
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- 個人化設定 -->
            <div
              class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 shadow-sm border border-slate-200 dark:border-slate-800"
            >
              <h3
                class="text-2xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-3"
              >
                <i data-lucide="user-cog" class="text-amber-500"></i> 個人化設定
              </h3>
              <div class="grid md:grid-cols-2 gap-6">
                <div>
                  <label class="block text-xs font-bold text-slate-500 mb-2"
                    >吧檯名稱 (Bar Name)</label
                  >
                  <input
                    type="text"
                    x-model="barName"
                    class="w-full p-3 rounded-xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 font-bold text-slate-800 dark:text-white focus:border-amber-500 outline-none transition"
                  />
                </div>
                <div>
                  <label class="block text-xs font-bold text-slate-500 mb-2"
                    >調酒師 / 副標題 (Bartender)</label
                  >
                  <input
                    type="text"
                    x-model="bartenderName"
                    class="w-full p-3 rounded-xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 font-bold text-slate-800 dark:text-white focus:border-amber-500 outline-none transition"
                  />
                </div>
              </div>
            </div>

            <!-- 偏好與外觀 -->
            <div
              class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 shadow-sm border border-slate-200 dark:border-slate-800"
            >
              <h3
                class="text-2xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-3"
              >
                <i data-lucide="sliders" class="text-amber-500"></i> 偏好與外觀
              </h3>
              <div class="space-y-6">
                <!-- 計量單位 -->
                <div class="flex items-center justify-between">
                  <div>
                    <div
                      class="font-bold text-lg text-slate-800 dark:text-white"
                    >
                      計量單位
                    </div>
                    <div class="text-slate-500 dark:text-slate-400 text-sm">
                      切換酒譜顯示單位 (ml / oz)
                    </div>
                  </div>
                  <div
                    class="flex bg-slate-100 dark:bg-slate-800 p-1 rounded-xl"
                  >
                    <button
                      @click="unit = 'ml'"
                      :class="unit === 'ml' ? 'bg-white dark:bg-slate-700 shadow text-amber-600' : 'text-slate-400'"
                      class="px-4 py-2 rounded-lg text-xs font-black transition"
                    >
                      ml
                    </button>
                    <button
                      @click="unit = 'oz'"
                      :class="unit === 'oz' ? 'bg-white dark:bg-slate-700 shadow text-amber-600' : 'text-slate-400'"
                      class="px-4 py-2 rounded-lg text-xs font-black transition"
                    >
                      oz
                    </button>
                  </div>
                </div>

                <div
                  class="border-t border-slate-100 dark:border-slate-800"
                ></div>

                <!-- 深色模式 -->
                <div class="flex items-center justify-between">
                  <div>
                    <div
                      class="font-bold text-lg text-slate-800 dark:text-white"
                    >
                      深色模式
                    </div>
                    <div class="text-slate-500 dark:text-slate-400 text-sm">
                      切換適合夜間調酒的深色介面
                    </div>
                  </div>
                  <button
                    @click="toggleTheme()"
                    class="relative inline-flex h-8 w-14 items-center rounded-full transition-colors focus:outline-none"
                    :class="darkMode ? 'bg-amber-500' : 'bg-slate-200'"
                  >
                    <span
                      class="inline-block h-6 w-6 transform rounded-full bg-white transition-transform"
                      :class="darkMode ? 'translate-x-7' : 'translate-x-1'"
                    ></span>
                  </button>
                </div>
              </div>
            </div>

            <!-- 資料管理 -->
            <div
              class="bg-white dark:bg-slate-900 rounded-[2rem] p-8 shadow-sm border border-slate-200 dark:border-slate-800"
            >
              <h3
                class="text-2xl font-bold mb-6 text-slate-800 dark:text-white flex items-center gap-3"
              >
                <i data-lucide="database" class="text-amber-500"></i> 資料管理
              </h3>
              <div class="grid md:grid-cols-3 gap-6">
                <button
                  @click="backupData()"
                  class="p-6 rounded-2xl bg-slate-50 dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 hover:border-amber-400 dark:hover:border-amber-400 transition text-left group"
                >
                  <div
                    class="bg-blue-100 text-blue-600 w-10 h-10 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition"
                  >
                    <i data-lucide="download" class="w-5 h-5"></i>
                  </div>
                  <div
                    class="font-black text-lg text-slate-800 dark:text-white mb-1"
                  >
                    備份資料
                  </div>
                  <div class="text-xs text-slate-500 dark:text-slate-400">
                    下載目前的酒譜與酒櫃資料 (JSON)
                  </div>
                </button>

                <button
                  @click="triggerImport()"
                  class="p-6 rounded-2xl bg-slate-50 dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 hover:border-amber-400 dark:hover:border-amber-400 transition text-left group"
                >
                  <div
                    class="bg-green-100 text-green-600 w-10 h-10 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition"
                  >
                    <i data-lucide="upload" class="w-5 h-5"></i>
                  </div>
                  <div
                    class="font-black text-lg text-slate-800 dark:text-white mb-1"
                  >
                    匯入資料
                  </div>
                  <div class="text-xs text-slate-500 dark:text-slate-400">
                    從備份檔案還原或匯入新酒譜
                  </div>
                  <input
                    type="file"
                    x-ref="fileInput"
                    class="hidden"
                    accept=".json"
                    @change="importDataFile"
                  />
                </button>

                <button
                  @click="resetData()"
                  class="p-6 rounded-2xl bg-slate-50 dark:bg-slate-800 border-2 border-slate-100 dark:border-slate-700 hover:border-red-400 dark:hover:border-red-400 transition text-left group"
                >
                  <div
                    class="bg-red-100 text-red-600 w-10 h-10 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition"
                  >
                    <i data-lucide="refresh-cw" class="w-5 h-5"></i>
                  </div>
                  <div
                    class="font-black text-lg text-slate-800 dark:text-white mb-1"
                  >
                    重置預設
                  </div>
                  <div class="text-xs text-slate-500 dark:text-slate-400">
                    清除所有資料並恢復原廠設定
                  </div>
                </button>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>

    <!-- --- 手機版 底部導覽 --- -->
    <nav
      class="md:hidden fixed bottom-0 left-0 right-0 bg-slate-900 border-t border-slate-800 grid grid-cols-7 items-center px-1 py-3 z-50 shadow-2xl print:hidden"
    >
      <template x-for="tab in navigation" :key="tab.id">
        <button
          @click="activeTab = tab.id"
          class="flex flex-col items-center gap-1.5 transition"
          :class="activeTab === tab.id ? 'text-amber-500 scale-110' : 'text-slate-500'"
        >
          <i :data-lucide="tab.icon" class="w-5 h-5"></i>
          <span
            class="text-[9px] font-black tracking-tight"
            x-text="tab.label"
          ></span>
        </button>
      </template>
    </nav>

    <!-- --- 表單彈窗：新增收藏 --- -->
    <div
      x-show="isBottleFormOpen"
      class="fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div
        class="bg-white rounded-[2.5rem] w-full max-w-xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col"
      >
        <div class="p-8 bg-slate-50 border-b flex justify-between items-center">
          <h3 class="font-black text-2xl flex items-center gap-3">
            <i data-lucide="archive" class="text-amber-500"></i>
            <span x-text="editingBottleId ? '編輯酒藏' : '入庫新酒收藏'"></span>
          </h3>
          <button
            @click="isBottleFormOpen = false"
            class="text-slate-400 hover:text-slate-600"
          >
            <i data-lucide="x"></i>
          </button>
        </div>
        <form
          @submit.prevent="saveBottle()"
          class="p-8 space-y-6 overflow-y-auto custom-scrollbar"
        >
          <div class="grid grid-cols-2 gap-6">
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >分類</label
              >
              <select
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.typeId"
              >
                <template x-for="ing in allIngredientsList">
                  <option :value="ing.id" x-text="ing.name"></option>
                </template>
              </select>
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >酒名</label
              >
              <input
                type="text"
                required
                placeholder="例如：坦奎瑞"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.name"
              />
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >品牌</label
              >
              <input
                type="text"
                placeholder="例如：Tanqueray"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.brand"
              />
            </div>
            <div class="col-span-2 sm:col-span-1">
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >購買地點</label
              >
              <input
                type="text"
                placeholder="例如：好市多"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.location"
              />
            </div>
          </div>
          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >購入價格</label
              >
              <input
                type="number"
                placeholder="$"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.price"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >保存期限</label
              >
              <input
                type="date"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.expirationDate"
              />
            </div>
          </div>
          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >評價星等 (1-5)</label
              >
              <input
                type="number"
                min="1"
                max="5"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.rating"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >標籤 (逗號分隔)</label
              >
              <input
                type="text"
                placeholder="例如：清爽, 限量"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="bottleForm.tags"
              />
            </div>
          </div>
          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >初始酒量</label
            >
            <div class="flex items-center gap-4">
              <input
                type="range"
                min="0"
                max="100"
                step="10"
                class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-amber-500"
                x-model="bottleForm.remaining"
              />
              <span
                class="font-black text-amber-600 w-12 text-right"
                x-text="bottleForm.remaining + '%'"
              ></span>
            </div>
          </div>
          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >特色描述</label
            >
            <input
              type="text"
              placeholder="例如：帶有獨特的柑橘香氣"
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model="bottleForm.features"
            />
          </div>
          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >風味筆記</label
            >
            <textarea
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50 resize-none"
              rows="3"
              x-model="bottleForm.notes"
            ></textarea>
          </div>
          <button
            type="submit"
            class="w-full py-5 bg-slate-900 text-white font-black rounded-2xl shadow-2xl hover:bg-slate-800 transition flex items-center justify-center gap-3"
          >
            <i data-lucide="save" class="w-5 h-5"></i>
            <span x-text="editingBottleId ? '儲存變更' : '完成入庫'"></span>
          </button>
        </form>
      </div>
    </div>

    <!-- --- 表單彈窗：新增調味 --- -->
    <div
      x-show="isModifierFormOpen"
      class="fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div
        class="bg-white rounded-[2.5rem] w-full max-w-xl shadow-2xl overflow-hidden flex flex-col"
      >
        <div class="p-8 bg-slate-50 border-b flex justify-between items-center">
          <h3 class="font-black text-2xl flex items-center gap-3">
            <i data-lucide="leaf" class="text-amber-500"></i> 新增自訂調味
          </h3>
          <button
            @click="isModifierFormOpen = false"
            class="text-slate-400 hover:text-slate-600"
          >
            <i data-lucide="x"></i>
          </button>
        </div>
        <form @submit.prevent="saveModifier()" class="p-8 space-y-6">
          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >分類</label
            >
            <select
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model.number="modifierForm.categoryIndex"
            >
              <template x-for="(cat, index) in modifiers" :key="index">
                <option :value="index" x-text="cat.category"></option>
              </template>
            </select>
          </div>
          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >名稱</label
            >
            <input
              type="text"
              required
              placeholder="例如：接骨木糖漿"
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model="modifierForm.name"
            />
          </div>
          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >標籤 (Tag)</label
              >
              <input
                type="text"
                placeholder="例如：花香"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="modifierForm.tag"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >描述</label
              >
              <input
                type="text"
                placeholder="簡短描述風味"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="modifierForm.desc"
              />
            </div>
          </div>
          <button
            type="submit"
            class="w-full py-5 bg-slate-900 text-white font-black rounded-2xl shadow-2xl hover:bg-slate-800 transition flex items-center justify-center gap-3"
          >
            <i data-lucide="plus-circle" class="w-5 h-5"></i> 加入資料庫
          </button>
        </form>
      </div>
    </div>

    <!-- --- 表單彈窗：新增酒譜 --- -->
    <div
      x-show="isRecipeFormOpen"
      class="fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div
        class="bg-white rounded-[2.5rem] w-full max-w-2xl shadow-2xl overflow-hidden max-h-[90vh] flex flex-col"
      >
        <div
          class="p-8 bg-slate-50 border-b flex justify-between items-center shrink-0"
        >
          <h3 class="font-black text-2xl flex items-center gap-3">
            <i data-lucide="book-open" class="text-amber-500"></i>
            <span x-text="editingRecipeId ? '編輯酒譜' : '新增自創酒譜'"></span>
          </h3>
          <button
            @click="isRecipeFormOpen = false"
            class="text-slate-400 hover:text-slate-600"
          >
            <i data-lucide="x"></i>
          </button>
        </div>
        <form
          @submit.prevent="saveRecipe()"
          class="p-8 space-y-6 overflow-y-auto custom-scrollbar"
        >
          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >酒譜名稱</label
              >
              <input
                type="text"
                required
                placeholder="例如：特製水果茶酒"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="recipeForm.name"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >分類</label
              >
              <input
                type="text"
                placeholder="例如：長飲型 (Long Drink)"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="recipeForm.category"
              />
            </div>
          </div>

          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >酒精度 (ABV)</label
              >
              <input
                type="text"
                placeholder="例如：15%"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="recipeForm.abv"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >難易度 (1-5)</label
              >
              <div class="flex items-center gap-4 h-[46px]">
                <input
                  type="range"
                  min="1"
                  max="5"
                  class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-amber-500"
                  x-model="recipeForm.difficulty"
                />
                <span
                  class="font-black text-amber-600 w-8 text-right"
                  x-text="recipeForm.difficulty"
                ></span>
              </div>
            </div>
          </div>

          <div class="grid grid-cols-2 gap-6">
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >風味描述</label
              >
              <input
                type="text"
                placeholder="例如：酸甜、果香濃郁"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="recipeForm.flavor"
              />
            </div>
            <div>
              <label
                class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
                >標籤 (逗號分隔)</label
              >
              <input
                type="text"
                placeholder="例如：經典, 派對"
                class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
                x-model="recipeForm.tags"
              />
            </div>
          </div>

          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >特色/簡介</label
            >
            <input
              type="text"
              placeholder="一句話形容這杯酒..."
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model="recipeForm.features"
            />
          </div>

          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >選擇材料與份量</label
            >
            <div
              class="max-h-60 overflow-y-auto custom-scrollbar p-4 border-2 border-slate-100 rounded-2xl bg-slate-50 space-y-5"
            >
              <template
                x-for="(items, category) in getRecipeIngredientsGrouped()"
                :key="category"
              >
                <div>
                  <h4
                    class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2 sticky top-0 bg-slate-50/95 backdrop-blur py-1 z-10 border-b border-slate-100"
                    x-text="category"
                  ></h4>
                  <div class="grid grid-cols-1 gap-2">
                    <template x-for="ing in items" :key="ing.id">
                      <div
                        class="flex items-center justify-between p-2 rounded-lg hover:bg-white border border-transparent hover:border-slate-200 transition group"
                      >
                        <label
                          class="flex items-center gap-2 cursor-pointer flex-1"
                        >
                          <input
                            type="checkbox"
                            :value="ing.id"
                            x-model="recipeForm.ingredients"
                            class="rounded text-amber-500 focus:ring-amber-500"
                          />
                          <span
                            class="text-xs font-bold text-slate-700"
                            x-text="ing.name"
                          ></span>
                        </label>
                        <input
                          type="text"
                          x-show="recipeForm.ingredients.includes(ing.id)"
                          x-model="recipeForm.amounts[ing.id]"
                          placeholder="份量 (如: 45ml)"
                          class="w-28 p-1.5 text-xs border border-slate-200 rounded-lg bg-white focus:border-amber-500 outline-none"
                        />
                      </div>
                    </template>
                  </div>
                </div>
              </template>
            </div>
          </div>

          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >調製步驟 (一行一步驟)</label
            >
            <textarea
              required
              placeholder="1. 加入冰塊&#10;2. 倒入琴酒 45ml..."
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50 resize-none"
              rows="4"
              x-model="recipeForm.steps"
            ></textarea>
          </div>

          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >調製秘訣</label
            >
            <input
              type="text"
              placeholder="例如：最後噴附橙皮油增加香氣"
              class="w-full p-3 rounded-2xl border-2 border-slate-100 font-bold text-sm bg-slate-50"
              x-model="recipeForm.tips"
            />
          </div>

          <button
            type="submit"
            class="w-full py-5 bg-slate-900 text-white font-black rounded-2xl shadow-2xl hover:bg-slate-800 transition flex items-center justify-center gap-3"
          >
            <i data-lucide="save" class="w-5 h-5"></i>
            <span x-text="editingRecipeId ? '儲存變更' : '儲存酒譜'"></span>
          </button>
        </form>
      </div>
    </div>

    <!-- --- 彈窗：隨機酒譜展示 --- -->
    <div
      x-show="isRecipeModalOpen"
      class="fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-[2.5rem] w-full max-w-lg shadow-2xl overflow-hidden max-h-[90vh] flex flex-col relative"
        @click.away="isRecipeModalOpen = false"
      >
        <button
          @click="isRecipeModalOpen = false"
          class="absolute top-6 right-6 z-10 p-2 bg-slate-100 dark:bg-slate-800 rounded-full text-slate-500 hover:bg-slate-200 dark:hover:bg-slate-700 transition"
        >
          <i data-lucide="x" class="w-5 h-5"></i>
        </button>

        <div
          class="p-8 overflow-y-auto custom-scrollbar"
          x-show="selectedRecipe"
        >
          <button
            @click="toggleFavorite(selectedRecipe.id)"
            class="absolute top-8 right-20 z-10 p-2 rounded-full transition"
            :class="favoriteRecipes.includes(selectedRecipe.id) ? 'text-red-500 bg-red-50 dark:bg-red-900/20' : 'text-slate-300 bg-slate-100 dark:bg-slate-800 hover:text-red-400'"
          >
            <i
              data-lucide="heart"
              class="w-5 h-5"
              :class="favoriteRecipes.includes(selectedRecipe.id) ? 'fill-current' : ''"
            ></i>
          </button>
          <button
            @click="openNoteModal(selectedRecipe)"
            class="absolute top-8 right-32 z-10 p-2 rounded-full transition text-slate-300 bg-slate-100 dark:bg-slate-800 hover:text-amber-500 hover:bg-amber-50 dark:hover:bg-amber-900/20"
            title="評分與筆記"
          >
            <i
              data-lucide="notebook-pen"
              class="w-5 h-5"
              :class="selectedRecipe.myRating || selectedRecipe.myNotes ? 'text-amber-500 fill-amber-500' : ''"
            ></i>
          </button>
          <button
            @click="shareRecipe(selectedRecipe)"
            class="absolute top-8 right-44 z-10 p-2 rounded-full transition text-slate-300 bg-slate-100 dark:bg-slate-800 hover:text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/20"
            title="分享酒譜"
          >
            <i data-lucide="share-2" class="w-5 h-5"></i>
          </button>
          <div class="flex items-center gap-3 mb-6">
            <div class="p-3 bg-amber-100 text-amber-600 rounded-2xl">
              <i data-lucide="glass-water" class="w-8 h-8"></i>
            </div>
            <div>
              <div
                class="text-xs font-black text-slate-400 uppercase tracking-widest"
              >
                Random Pick
              </div>
              <h3
                class="text-3xl font-black text-slate-900 dark:text-white"
                x-text="selectedRecipe.name"
              ></h3>
            </div>
          </div>

          <div
            class="flex gap-4 mb-6 text-xs font-bold text-slate-500 dark:text-slate-400"
          >
            <span
              class="bg-amber-100 dark:bg-amber-900/30 text-amber-600 dark:text-amber-400 px-2 py-1 rounded"
              x-text="selectedRecipe.category"
            ></span>
            <div class="flex items-center gap-1">
              <i data-lucide="flame" class="w-3 h-3"></i>
              <span x-text="selectedRecipe.abv"></span>
            </div>
            <div class="flex items-center gap-1">
              <i
                data-lucide="star"
                class="w-3 h-3 text-amber-400 fill-amber-400"
              ></i>
              <span x-text="selectedRecipe.difficulty + '/5'"></span>
            </div>
            <div
              class="flex items-center gap-1"
              x-show="selectedRecipe.myRating"
            >
              <i data-lucide="thumbs-up" class="w-3 h-3 text-green-500"></i>
              <span
                class="text-green-600 dark:text-green-400"
                x-text="'我的評分: ' + selectedRecipe.myRating"
              ></span>
            </div>
          </div>

          <p
            class="text-lg font-bold text-slate-700 dark:text-slate-300 mb-2"
            x-text="selectedRecipe.flavor"
          ></p>
          <p
            class="text-sm text-slate-500 dark:text-slate-400 mb-8"
            x-text="selectedRecipe.features"
          ></p>

          <div class="mb-8">
            <h4
              class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3"
            >
              材料清單
            </h4>
            <div class="grid grid-cols-2 gap-3">
              <template x-for="ing in selectedRecipe.ingredients">
                <div
                  class="flex justify-between items-center p-3 bg-slate-50 dark:bg-slate-800 rounded-xl border border-slate-100 dark:border-slate-700"
                >
                  <span
                    class="text-xs font-bold"
                    :class="myIngredients.includes(ing.id) ? 'text-green-600 dark:text-green-400' : 'text-slate-700 dark:text-slate-300'"
                    x-text="getIngredientName(ing.id)"
                  ></span>
                  <span
                    class="text-xs font-mono text-slate-500"
                    x-text="convertAmount(ing.amount)"
                  ></span>
                </div>
              </template>
            </div>
          </div>

          <div class="mb-8">
            <h4
              class="text-[10px] font-black text-slate-400 uppercase tracking-widest mb-3"
            >
              調製步驟
            </h4>
            <ol
              class="list-decimal list-inside text-sm text-slate-600 dark:text-slate-300 space-y-2 font-medium"
            >
              <template x-for="step in selectedRecipe.steps">
                <li x-text="convertStep(step)"></li>
              </template>
            </ol>
          </div>

          <div class="bg-slate-50 dark:bg-slate-800 rounded-2xl p-5">
            <div class="flex items-center gap-2 text-slate-400 mb-2">
              <i data-lucide="lightbulb" class="w-4 h-4"></i>
              <span class="text-[10px] font-black uppercase tracking-widest"
                >調製秘訣</span
              >
            </div>
            <p
              class="text-sm text-slate-600 dark:text-slate-300 font-medium"
              x-text="selectedRecipe.tips"
            ></p>
          </div>

          <!-- My Notes -->
          <div
            x-show="selectedRecipe.myNotes"
            class="mt-4 bg-amber-50 dark:bg-amber-900/20 rounded-2xl p-4 border border-amber-100 dark:border-amber-900/30"
          >
            <div
              class="flex items-center gap-2 text-amber-600 dark:text-amber-500 mb-2"
            >
              <i data-lucide="pen-tool" class="w-3 h-3"></i>
              <span class="text-[10px] font-black uppercase tracking-widest"
                >我的筆記</span
              >
            </div>
            <p
              class="text-sm text-slate-700 dark:text-slate-300 font-medium whitespace-pre-line"
              x-text="selectedRecipe.myNotes"
            ></p>
          </div>

          <!-- Tags -->
          <div
            class="flex flex-wrap gap-1 mt-4 pt-4 border-t border-slate-100 dark:border-slate-800"
          >
            <template x-for="tag in selectedRecipe.tags">
              <span
                class="text-[10px] font-bold text-slate-400 bg-slate-100 dark:bg-slate-800 px-2 py-1 rounded-lg"
                x-text="'#'+tag"
              ></span>
            </template>
          </div>
        </div>
      </div>
    </div>

    <!-- --- 表單彈窗：評分與筆記 --- -->
    <div
      x-show="isNoteModalOpen"
      class="fixed inset-0 bg-slate-900/80 backdrop-blur-md flex items-center justify-center z-[100] p-4 animate-fade-in"
      x-cloak
    >
      <div
        class="bg-white dark:bg-slate-900 rounded-[2.5rem] w-full max-w-md shadow-2xl overflow-hidden flex flex-col"
      >
        <div
          class="p-8 bg-slate-50 dark:bg-slate-800 border-b dark:border-slate-700 flex justify-between items-center"
        >
          <h3
            class="font-black text-2xl flex items-center gap-3 text-slate-900 dark:text-white"
          >
            <i data-lucide="notebook-pen" class="text-amber-500"></i> 評分與筆記
          </h3>
          <button
            @click="isNoteModalOpen = false"
            class="text-slate-400 hover:text-slate-600 dark:hover:text-slate-200"
          >
            <i data-lucide="x"></i>
          </button>
        </div>
        <form @submit.prevent="saveNote()" class="p-8 space-y-6">
          <div class="text-center">
            <h4
              class="text-lg font-bold text-slate-800 dark:text-white mb-4"
              x-text="noteForm.name"
            ></h4>
            <div class="flex justify-center gap-3">
              <template x-for="i in 5">
                <button
                  type="button"
                  @click="noteForm.rating = i"
                  class="transition hover:scale-110 focus:outline-none"
                >
                  <i
                    data-lucide="star"
                    class="w-8 h-8"
                    :class="i <= noteForm.rating ? 'fill-amber-400 text-amber-400' : 'text-slate-300 dark:text-slate-600'"
                  ></i>
                </button>
              </template>
            </div>
            <p
              class="text-xs text-slate-400 mt-2 font-bold uppercase tracking-widest"
            >
              點擊星星評分
            </p>
          </div>

          <div>
            <label
              class="block text-[10px] font-black text-slate-400 uppercase tracking-widest mb-2"
              >心得筆記</label
            >
            <textarea
              placeholder="寫下您的品飲心得、調整建議..."
              class="w-full p-4 rounded-2xl border-2 border-slate-100 dark:border-slate-700 bg-slate-50 dark:bg-slate-800 text-slate-800 dark:text-white font-medium text-sm resize-none focus:border-amber-500 outline-none transition"
              rows="5"
              x-model="noteForm.notes"
            ></textarea>
          </div>

          <button
            type="submit"
            class="w-full py-4 bg-amber-500 text-slate-900 font-black rounded-2xl shadow-lg hover:bg-amber-400 transition flex items-center justify-center gap-2"
          >
            <i data-lucide="save" class="w-5 h-5"></i> 儲存筆記
          </button>
        </form>
      </div>
    </div>
  </body>
</html>
